!function(){"use strict";function Poll(){this.$get=["$q","API","$log",function($q,API,$log){var api={},polls={};return api.polls=function(){return!Object.keys(polls).length&&localStorage.polls&&(polls=JSON.parse(localStorage.polls)),polls},api.addPoll=function(poll){polls[poll._id]=poll,localStorage.polls=JSON.stringify(polls)},api.removePolls=function(){},api.vote=function(){},api.hasExpired=function(date){var now=Date.now(),end_date=1e3*date,hasExpired=now-end_date>0;return hasExpired},api.hasVoted=function(poll){var hasVoted=null!==poll.voted||!!api.polls()[poll._id];return $log.debug("Poll is voted [Object]"+(null!==poll.voted)),$log.debug("Poll is voted [locaStorage]"+!!api.polls()[poll._id]),$log.debug("Has voted ? "+hasVoted),hasVoted},api.paramify=function(poll){var values={},obj={};return values.value=poll.values,obj.params=values,obj.id=poll._id,obj},api.computeResults=function(poll){var results=[],result={},total=api.totalVotes(poll);$log.debug("Total votes: "+total);for(var x in poll.results)isNaN(poll.results[x].value)||(result=poll.results[x],result.myVote=null!==poll.voted&&poll.voted.values.hasOwnProperty(x),result.label=poll.options[result.value],result.ratio=0!==total?parseInt(poll.results[x].votes)/total*100+"%":"0%",results.push(result));return results},api.totalVotes=function(poll){var total=0;for(var x in poll.results)total+=poll.results[x].votes;return total},{statuses:{open:"open",closed:"closed",voted:"voted"},get:function(poll){$log.debug("===== Poll: "+poll.title);var status=this.getStatus(poll);return status==this.statuses.voted&&api.polls()[poll._id]?(poll=api.polls()[poll._id],$log.debug("Poll loaded from localStorage")):(poll.status=status,poll.total=api.totalVotes(poll)),poll.status!==this.statuses.open&&(poll.results=api.computeResults(poll)),poll},getStatus:function(poll){var statuses=this.statuses,status=statuses.open;return api.hasExpired(poll.end_date)?status=statuses.closed:api.hasVoted(poll)&&(status=statuses.voted),$log.debug("Get Status: "+status),status},vote:function(poll){var deferred=$q.defer(),statuses=this.statuses,vote={success:function(response){$log.debug(response),UtilsService.toast(translateFilter("poll.vote.Success")),poll.status=statuses.voted,poll.total=api.totalVotes(response.data),poll.results=api.computeResults(response.data),poll.voted=response.data.voted,poll.status=statuses.voted,api.addPoll(poll),deferred.resolve(poll)},error:function(response){var msg=translateFilter("poll.vote.Error");msg+=response.data&&response.data.error?": "+translateFilter("[API]: "+response.data.error):": "+translateFilter("default.network.Error"),UtilsService.toast(msg),$log.debug(msg),deferred.reject(response.data)}};return API.Poll.submit(api.paramify(poll),vote.success,vote.error),deferred.promise}}}]}angular.module("ngMeumobi.Utils.services",[]).provider("Poll",Poll)}(),function(){"use strict";function meuFilesServices($log,$location,$q){function open(uri,type){var q=$q.defer();return cordova.plugins.fileOpener2.open(uri,type,{error:function(e){"File doest not exist"==e.message?e.message="File not found":e.message="Couldn't open this file. No handler found on device for ".type,q.reject(e)},success:function(){q.resolve()}}),q.promise}var service={};return service.open=open,service}angular.module("ngMeumobi.Utils.services",[]).factory("meuFilesServices",["$log","$location","$q",meuFilesServices])}(),function(){"use strict";function isEmpty(){return function(obj){return!Object.keys(obj).length}}function br2nl(){return function(text){return text.replace(/<br\s*[\/]?>/gi,"\n")}}function striptags(){return function(text){return angular.element("<div/>").html(text).text()}}angular.module("ngMeumobi.Utils.filters",[]).filter("isEmpty",isEmpty).filter("br2nl",br2nl).filter("striptags",striptags)}(),function(){"use strict";angular.module("ngMeumobi.Utils",["ngMeumobi.Utils.services","ngMeumobi.Utils.filters"])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL1BvbGxzX21ldW1vYmkuc2VydmljZXMuanMiLCJzZXJ2aWNlcy9GaWxlc19tZXVtb2JpLnNlcnZpY2VzLmpzIiwiZmlsdGVycy9tZXUtZmlsdGVycy5qcyIsIm1vZHVsZS5qcyJdLCJuYW1lcyI6WyJQb2xsIiwidGhpcyIsIiRnZXQiLCIkcSIsIkFQSSIsIiRsb2ciLCJhcGkiLCJwb2xscyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJsb2NhbFN0b3JhZ2UiLCJKU09OIiwicGFyc2UiLCJhZGRQb2xsIiwicG9sbCIsIl9pZCIsInN0cmluZ2lmeSIsInJlbW92ZVBvbGxzIiwidm90ZSIsImhhc0V4cGlyZWQiLCJkYXRlIiwibm93IiwiRGF0ZSIsImVuZF9kYXRlIiwiaGFzVm90ZWQiLCJ2b3RlZCIsImRlYnVnIiwicGFyYW1pZnkiLCJ2YWx1ZXMiLCJvYmoiLCJ2YWx1ZSIsInBhcmFtcyIsImlkIiwiY29tcHV0ZVJlc3VsdHMiLCJyZXN1bHRzIiwicmVzdWx0IiwidG90YWwiLCJ0b3RhbFZvdGVzIiwieCIsImlzTmFOIiwibXlWb3RlIiwiaGFzT3duUHJvcGVydHkiLCJsYWJlbCIsIm9wdGlvbnMiLCJyYXRpbyIsInBhcnNlSW50Iiwidm90ZXMiLCJwdXNoIiwic3RhdHVzZXMiLCJvcGVuIiwiY2xvc2VkIiwiZ2V0IiwidGl0bGUiLCJzdGF0dXMiLCJnZXRTdGF0dXMiLCJkZWZlcnJlZCIsImRlZmVyIiwic3VjY2VzcyIsInJlc3BvbnNlIiwiVXRpbHNTZXJ2aWNlIiwidG9hc3QiLCJ0cmFuc2xhdGVGaWx0ZXIiLCJkYXRhIiwicmVzb2x2ZSIsImVycm9yIiwibXNnIiwicmVqZWN0Iiwic3VibWl0IiwicHJvbWlzZSIsImFuZ3VsYXIiLCJtb2R1bGUiLCJwcm92aWRlciIsIm1ldUZpbGVzU2VydmljZXMiLCIkbG9jYXRpb24iLCJ1cmkiLCJ0eXBlIiwicSIsImNvcmRvdmEiLCJwbHVnaW5zIiwiZmlsZU9wZW5lcjIiLCJlIiwibWVzc2FnZSIsInNlcnZpY2UiLCJmYWN0b3J5IiwiaXNFbXB0eSIsImJyMm5sIiwidGV4dCIsInJlcGxhY2UiLCJzdHJpcHRhZ3MiLCJlbGVtZW50IiwiaHRtbCIsImZpbHRlciJdLCJtYXBwaW5ncyI6IkNBRUEsV0FDQSxZQU1BLFNBQUFBLFFBSUFDLEtBQUFDLE1BQUEsS0FBQSxNQUFBLE9BQUEsU0FBQUMsR0FBQUMsSUFBQUMsTUFDQSxHQUFBQyxRQUNBQyxRQTJGQSxPQXJGQUQsS0FBQUMsTUFBQSxXQUdBLE9BRkFDLE9BQUFDLEtBQUFGLE9BQUFHLFFBQUFDLGFBQUFKLFFBQ0FBLE1BQUFLLEtBQUFDLE1BQUFGLGFBQUFKLFFBQ0FBLE9BSUFELElBQUFRLFFBQUEsU0FBQUMsTUFDQVIsTUFBQVEsS0FBQUMsS0FBQUQsS0FDQUosYUFBQUosTUFBQUssS0FBQUssVUFBQVYsUUFHQUQsSUFBQVksWUFBQSxhQUlBWixJQUFBYSxLQUFBLGFBSUFiLElBQUFjLFdBQUEsU0FBQUMsTUFDQSxHQUFBQyxLQUFBQyxLQUFBRCxNQUNBRSxTQUFBLElBQUFILEtBQ0FELFdBQUFFLElBQUFFLFNBQUEsQ0FFQSxPQUFBSixhQUdBZCxJQUFBbUIsU0FBQSxTQUFBVixNQUNBLEdBQUFVLFVBQUEsT0FBQVYsS0FBQVcsU0FBQXBCLElBQUFDLFFBQUFRLEtBQUFDLElBTUEsT0FKQVgsTUFBQXNCLE1BQUEsMEJBQUEsT0FBQVosS0FBQVcsUUFDQXJCLEtBQUFzQixNQUFBLGdDQUFBckIsSUFBQUMsUUFBQVEsS0FBQUMsTUFDQVgsS0FBQXNCLE1BQUEsZUFBQUYsVUFFQUEsVUFHQW5CLElBQUFzQixTQUFBLFNBQUFiLE1BQ0EsR0FBQWMsV0FDQUMsTUFNQSxPQUpBRCxRQUFBRSxNQUFBaEIsS0FBQWMsT0FDQUMsSUFBQUUsT0FBQUgsT0FDQUMsSUFBQUcsR0FBQWxCLEtBQUFDLElBRUFjLEtBR0F4QixJQUFBNEIsZUFBQSxTQUFBbkIsTUFDQSxHQUFBb0IsWUFDQUMsVUFDQUMsTUFBQS9CLElBQUFnQyxXQUFBdkIsS0FDQVYsTUFB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QUQsRUFBQUMsUUFBQSxpQkFFQUQsRUFBQUMsUUFBQSwyREFBQU4sS0FHQUMsRUFBQVYsT0FBQWMsSUFDQXZCLFFBQUEsV0FFQW1CLEVBQUFiLGFBR0FhLEVBQUFSLFFBNUJBLEdBQUFjLFdBSUEsT0FGQUEsU0FBQWpDLEtBQUFBLEtBRUFpQyxRQVhBYixRQUFBQyxPQUFBLCtCQUlBYSxRQUFBLG9CQUFBLE9BQUEsWUFBQSxLQUFBWCxzQkNQQSxXQUNBLFlBT0EsU0FBQVksV0FDQSxNQUFBLFVBQUF2RCxLQUNBLE9BQUF0QixPQUFBQyxLQUFBcUIsS0FBQXBCLFFBSUEsUUFBQTRFLFNBQ0EsTUFBQSxVQUFBQyxNQUNBLE1BQUFBLE1BQUFDLFFBQUEsaUJBQUEsT0FJQSxRQUFBQyxhQUNBLE1BQUEsVUFBQUYsTUFDQSxNQUFBakIsU0FDQW9CLFFBQUEsVUFDQUMsS0FBQUosTUFDQUEsUUF0QkFqQixRQUFBQyxPQUFBLDhCQUNBcUIsT0FBQSxVQUFBUCxTQUNBTyxPQUFBLFFBQUFOLE9BQ0FNLE9BQUEsWUFBQUgsY0NOQSxXQUNBLFlBRUFuQixTQUFBQyxPQUFBLG1CQUNBLDJCQUNBIiwiZmlsZSI6Im5nLW1ldW1vYmktdXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgYW5ndWxhciwgbG9jYWxTdG9yYWdlICovXG4vKiBlc2xpbnQgbm8tdW5kZWY6IFwiZXJyb3JcIiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLnNlcnZpY2VzJywgW10pXG4gIC5wcm92aWRlcignUG9sbCcsIFBvbGwpO1xuXG4gIGZ1bmN0aW9uIFBvbGwoKSB7XG4gICAgLypcbiAgICAgIFRPRE86IFNob3VsZCBiZSBtZXVBUElTZXJ2aWNlcyBhZ25vc3RpY1xuICAgICovXG4gICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24gKCRxLCBBUEksICRsb2cpIHtcbiAgICAgIHZhciBhcGkgPSB7fTtcbiAgICAgIHZhciBwb2xscyA9IHt9O1xuICAgICAgLyoqXG4gICAgICAqIEFwaSBtZXRob2RzLCBhdmFpbGFibGUgb25seSBvbiB0aGUgaW5zaWRlIHRoZSBzZXJ2aWNlXG4gICAgICAqL1xuXG4gICAgICAvL2dldCBsb2NhbHN0b3JhZ2UgcG9sbHNcbiAgICAgIGFwaS5wb2xscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFPYmplY3Qua2V5cyhwb2xscykubGVuZ3RoICYmIGxvY2FsU3RvcmFnZS5wb2xscylcbiAgICAgICAgIHBvbGxzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UucG9sbHMpO1xuICAgICAgICByZXR1cm4gcG9sbHM7XG4gICAgICB9LFxuICAgICAgXG4gICAgICAvL2FkZCBwb2xsIHRvIGxvY2Fsc3RvcmFnZVxuICAgICAgYXBpLmFkZFBvbGwgPSBmdW5jdGlvbiAocG9sbCkge1xuICAgICAgICBwb2xsc1twb2xsLl9pZF0gPSBwb2xsO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucG9sbHMgPSBKU09OLnN0cmluZ2lmeShwb2xscyk7XG4gICAgICB9LFxuXG4gICAgICBhcGkucmVtb3ZlUG9sbHMgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgIH0sXG5cbiAgICAgIGFwaS52b3RlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICB9LFxuXG4gICAgICBhcGkuaGFzRXhwaXJlZCA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAgIHZhciBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICB2YXIgZW5kX2RhdGUgPSBkYXRlICogMTAwMDsgLy8gY29udmVydCBzZWMuIHRvIG1zXG4gICAgICAgIHZhciBoYXNFeHBpcmVkID0gKG5vdyAtIGVuZF9kYXRlKSA+IDA7XG5cbiAgICAgICAgcmV0dXJuIGhhc0V4cGlyZWQ7XG4gICAgICB9LFxuXG4gICAgICBhcGkuaGFzVm90ZWQgPSBmdW5jdGlvbiAocG9sbCkge1xuICAgICAgICB2YXIgaGFzVm90ZWQgPSBwb2xsLnZvdGVkICE9PSBudWxsIHx8ICEhYXBpLnBvbGxzKClbcG9sbC5faWRdO1xuXG4gICAgICAgICRsb2cuZGVidWcoJ1BvbGwgaXMgdm90ZWQgW09iamVjdF0nICsgKHBvbGwudm90ZWQgIT09IG51bGwpKTtcbiAgICAgICAgJGxvZy5kZWJ1ZygnUG9sbCBpcyB2b3RlZCBbbG9jYVN0b3JhZ2VdJyArICEhYXBpLnBvbGxzKClbcG9sbC5faWRdKTtcbiAgICAgICAgJGxvZy5kZWJ1ZygnSGFzIHZvdGVkID8gJyArIGhhc1ZvdGVkKTtcblxuICAgICAgICByZXR1cm4gaGFzVm90ZWQ7XG4gICAgICB9LFxuXG4gICAgICBhcGkucGFyYW1pZnkgPSBmdW5jdGlvbiAocG9sbCkge1xuICAgICAgICB2YXIgdmFsdWVzID0ge307XG4gICAgICAgIHZhciBvYmogPSB7fTtcblxuICAgICAgICB2YWx1ZXMudmFsdWUgPSBwb2xsLnZhbHVlcztcbiAgICAgICAgb2JqLnBhcmFtcyA9IHZhbHVlcztcbiAgICAgICAgb2JqLmlkID0gcG9sbC5faWQ7XG5cbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgIH0sXG5cbiAgICAgIGFwaS5jb21wdXRlUmVzdWx0cyA9IGZ1bmN0aW9uIChwb2xsKSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgICAgdmFyIHRvdGFsID0gYXBpLnRvdGFsVm90ZXMocG9sbCk7XG4gICAgICAgICRsb2cuZGVidWcoJ1RvdGFsIHZvdGVzOiAnICsgdG90YWwpO1xuICAgICAgICAvLyAkbG9nLmRlYnVnKHBvbGwudm90ZWQpO1xuXG4gICAgICAgIGZvciAodmFyIHggaW4gcG9sbC5yZXN1bHRzKSB7XG4gICAgICAgICAgLyoqXG4gICAgICAgICAgKiBTaG91bGQgaWdub3JlIGlmIHZhbHVlIGlzIFwiX1wiXG4gICAgICAgICAgKiBGb3IgbW9yZSBkZXRhaWxzIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbWV1bW9iaS9zaXRlYnVpbGRlci9pc3N1ZXMvMzUxXG4gICAgICAgICAgKi9cbiAgICAgICAgICBpZiAoIWlzTmFOKHBvbGwucmVzdWx0c1t4XS52YWx1ZSkpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHBvbGwucmVzdWx0c1t4XTtcbiAgICAgICAgICAgIHJlc3VsdC5teVZvdGUgPSAocG9sbC52b3RlZCAhPT0gbnVsbCkgPyBwb2xsLnZvdGVkLnZhbHVlcy5oYXNPd25Qcm9wZXJ0eSh4KSA6IGZhbHNlO1xuICAgICAgICAgICAgcmVzdWx0LmxhYmVsID0gcG9sbC5vcHRpb25zW3Jlc3VsdC52YWx1ZV07XG4gICAgICAgICAgICByZXN1bHQucmF0aW8gPSAodG90YWwgIT09IDApID8gKHBhcnNlSW50KHBvbGwucmVzdWx0c1t4XS52b3RlcykgLyB0b3RhbCkgKiAxMDAgKyAnJScgOiAnMCUnO1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICB9LFxuXG4gICAgICBhcGkudG90YWxWb3RlcyA9IGZ1bmN0aW9uIChwb2xsKSB7XG4gICAgICAgIHZhciB0b3RhbCA9IDA7XG4gICAgICAgIGZvciAodmFyIHggaW4gcG9sbC5yZXN1bHRzKSB7XG4gICAgICAgICAgdG90YWwgKz0gcG9sbC5yZXN1bHRzW3hdLnZvdGVzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRvdGFsO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLyoqXG4gICAgICAqIFNlcnZpY2UgbWV0aG9kcywgdGhhdCBhcmUgcHVibGljIGFuZCBhdmFpbGFibGUgZm9yIGFueSByZXNvdXJjZVxuICAgICAgKi9cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1c2VzOiB7XG4gICAgICAgICAgb3BlbjogJ29wZW4nLFxuICAgICAgICAgIGNsb3NlZDogJ2Nsb3NlZCcsXG4gICAgICAgICAgdm90ZWQ6ICd2b3RlZCdcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAocG9sbCkge1xuICAgICAgICAgICRsb2cuZGVidWcoJz09PT09IFBvbGw6ICcgKyBwb2xsLnRpdGxlKTtcbiAgICAgICAgICB2YXIgc3RhdHVzID0gdGhpcy5nZXRTdGF0dXMocG9sbCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLypcbiAgICAgICAgICAgIGxvYWQgcG9sbCBmcm9tIGxvY2Fsc3RvcmFnZSBpZiB2b3RlZCBidXQgZmVlZCBoYXNuJ3QgYmVlbiByZWxvYWRlZCBmcm9tIHNlcnZlclxuICAgICAgICAgIE9uIHJlbG9hZCBwb2xscyBwcmV2aW91c2x5IHNhdmVkIG9uIGxvY2Fsc3RvcmFnZSBhcmUgZXJhc2VkXG4gICAgICAgICAgKi9cbiAgICAgICAgICBpZiAoc3RhdHVzID09IHRoaXMuc3RhdHVzZXMudm90ZWQgJiYgISFhcGkucG9sbHMoKVtwb2xsLl9pZF0pIHtcbiAgICAgICAgICAgIHBvbGwgPSBhcGkucG9sbHMoKVtwb2xsLl9pZF07XG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdQb2xsIGxvYWRlZCBmcm9tIGxvY2FsU3RvcmFnZScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwb2xsLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHBvbGwudG90YWwgPSBhcGkudG90YWxWb3Rlcyhwb2xsKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocG9sbC5zdGF0dXMgIT09IHRoaXMuc3RhdHVzZXMub3Blbikge1xuICAgICAgICAgICAgcG9sbC5yZXN1bHRzID0gYXBpLmNvbXB1dGVSZXN1bHRzKHBvbGwpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBwb2xsO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFN0YXR1czogZnVuY3Rpb24gKHBvbGwpIHtcbiAgICAgICAgICB2YXIgc3RhdHVzZXMgPSB0aGlzLnN0YXR1c2VzO1xuXG4gICAgICAgICAgdmFyIHN0YXR1cyA9IHN0YXR1c2VzLm9wZW47XG4gICAgICAgICAgaWYgKGFwaS5oYXNFeHBpcmVkKHBvbGwuZW5kX2RhdGUpKSB7XG4gICAgICAgICAgICBzdGF0dXMgPSBzdGF0dXNlcy5jbG9zZWQ7XG4gICAgICAgICAgfSBlbHNlIGlmIChhcGkuaGFzVm90ZWQocG9sbCkpIHtcbiAgICAgICAgICAgIHN0YXR1cyA9IHN0YXR1c2VzLnZvdGVkO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICRsb2cuZGVidWcoJ0dldCBTdGF0dXM6ICcgKyBzdGF0dXMpO1xuICAgICAgICAgIHJldHVybiBzdGF0dXM7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdm90ZTogZnVuY3Rpb24gKHBvbGwpIHtcblxuICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgdmFyIHN0YXR1c2VzID0gdGhpcy5zdGF0dXNlcztcblxuICAgICAgICAgIHZhciB2b3RlID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICRsb2cuZGVidWcocmVzcG9uc2UpO1xuICAgICAgICAgICAgICBVdGlsc1NlcnZpY2UudG9hc3QodHJhbnNsYXRlRmlsdGVyKCdwb2xsLnZvdGUuU3VjY2VzcycpKTtcbiAgICAgICAgICAgICAgcG9sbC5zdGF0dXMgPSBzdGF0dXNlcy52b3RlZDtcbiAgICAgICAgICAgICAgcG9sbC50b3RhbCA9IGFwaS50b3RhbFZvdGVzKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICBwb2xsLnJlc3VsdHMgPSBhcGkuY29tcHV0ZVJlc3VsdHMocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgIHBvbGwudm90ZWQgPSByZXNwb25zZS5kYXRhLnZvdGVkO1xuICAgICAgICAgICAgICBwb2xsLnN0YXR1cyA9IHN0YXR1c2VzLnZvdGVkO1xuICAgICAgICAgICAgICBhcGkuYWRkUG9sbChwb2xsKTtcbiAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShwb2xsKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgdmFyIG1zZyA9IHRyYW5zbGF0ZUZpbHRlcigncG9sbC52b3RlLkVycm9yJyk7XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBtc2cgKz0gJzogJyArIHRyYW5zbGF0ZUZpbHRlcignW0FQSV06ICcgKyByZXNwb25zZS5kYXRhLmVycm9yKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtc2cgKz0gJzogJyArIHRyYW5zbGF0ZUZpbHRlcignZGVmYXVsdC5uZXR3b3JrLkVycm9yJyk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBVdGlsc1NlcnZpY2UudG9hc3QobXNnKTtcbiAgICAgICAgICAgICAgJGxvZy5kZWJ1Zyhtc2cpO1xuICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIEFQSS5Qb2xsLnN1Ym1pdChhcGkucGFyYW1pZnkocG9sbCksIHZvdGUuc3VjY2Vzcywgdm90ZS5lcnJvcik7XG5cbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICB9XG59KSgpO1xuIiwiLypnbG9iYWwgYW5ndWxhciwgY29yZG92YSovXG4vKmVzbGludCBuby11bmRlZjogXCJlcnJvclwiKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLnNlcnZpY2VzJywgW10pXG4gIC8qXG4gICAgVE9ETzogUmVtb3ZlIHVzZWxlc3MgaW5qZWN0aW9uc1xuICAqL1xuICAuZmFjdG9yeSgnbWV1RmlsZXNTZXJ2aWNlcycsIFsnJGxvZycsICckbG9jYXRpb24nLCAnJHEnLCBtZXVGaWxlc1NlcnZpY2VzXSk7XG5cbiAgZnVuY3Rpb24gbWV1RmlsZXNTZXJ2aWNlcygkbG9nLCAkbG9jYXRpb24sICRxKSB7XG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcblxuICAgIHNlcnZpY2Uub3BlbiA9IG9wZW47XG5cbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIC8vIGluc3RhbGwgICA6ICAgICAgY29yZG92YSBwbHVnaW4gYWRkIGh0dHBzOi8vZ2l0aHViLmNvbS9wd2xpbi9jb3Jkb3ZhLXBsdWdpbi1maWxlLW9wZW5lcjIuZ2l0XG4gICAgLy8gbGluayAgICAgIDogICAgICBodHRwczovL2dpdGh1Yi5jb20vcHdsaW4vY29yZG92YS1wbHVnaW4tZmlsZS1vcGVuZXIyXG5cbiAgICBmdW5jdGlvbiBvcGVuKHVyaSwgdHlwZSkge1xuICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuICAgICAgY29yZG92YS5wbHVnaW5zLmZpbGVPcGVuZXIyLm9wZW4odXJpLCB0eXBlLCB7XG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIC8qXG4gICAgICAgICAgICBUbyBob21vZ2VuZWl6ZSBBbmRyb2lkIGFuZCBpT1MgcmVzcG9uc2VzXG4gICAgICAgICAgKi9cbiAgICAgICAgICBpZiAoZS5tZXNzYWdlID09ICdGaWxlIGRvZXN0IG5vdCBleGlzdCcpIHtcbiAgICAgICAgICAgIGUubWVzc2FnZSA9ICdGaWxlIG5vdCBmb3VuZCc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiQ291bGRuJ3Qgb3BlbiB0aGlzIGZpbGUuIE5vIGhhbmRsZXIgZm91bmQgb24gZGV2aWNlIGZvciBcIiAuIHR5cGU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgIH0sIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgIHEucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgfVxuICB9XG59KSgpO1xuIiwiLyogZ2xvYmFsIGFuZ3VsYXIgKi9cbi8qIGVzbGludCBuby11bmRlZjogXCJlcnJvclwiICovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5maWx0ZXJzJywgW10pXG4gIC5maWx0ZXIoJ2lzRW1wdHknLCBpc0VtcHR5KVxuICAuZmlsdGVyKCdicjJubCcsIGJyMm5sKVxuICAuZmlsdGVyKCdzdHJpcHRhZ3MnLCBzdHJpcHRhZ3MpO1xuXG4gIGZ1bmN0aW9uIGlzRW1wdHkoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiAhT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJyMm5sKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvPGJyXFxzKltcXC9dPz4vZ2ksICdcXG4nKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gc3RyaXB0YWdzKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXJcbiAgICAgICAgICAuZWxlbWVudCgnPGRpdi8+JylcbiAgICAgICAgICAuaHRtbCh0ZXh0KVxuICAgICAgICAgIC50ZXh0KCk7XG4gICAgfTtcbiAgfVxufSkoKTtcbiIsIi8qIGdsb2JhbCBhbmd1bGFyICovXG4vKiBlc2xpbnQgbm8tdW5kZWY6IFwiZXJyb3JcIiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMnLCBbXG4gICAgJ25nTWV1bW9iaS5VdGlscy5zZXJ2aWNlcycsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5maWx0ZXJzJ1xuICBdKTtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
