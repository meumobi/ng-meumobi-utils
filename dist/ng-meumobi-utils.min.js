(function() {
	'use strict';

	angular
	.module('ngMeumobi.Utils.socialSharing', [])
	.factory('meuSocialSharing', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', '$log', meuSocialSharing]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin
  */
  
  function meuSocialSharing($q, $window, striptags, br2nl, $log) {
    
    var service = {};
    var options = {
      postfix: ''
    };
    
    service.shareItem = shareItem;
    service.shareMedia = shareMedia;
    service.setOption = setOption;
    service.setOptions = setOptions;
    service.share = share;
    service.shareViaWhatsAppToReceiver = shareViaWhatsAppToReceiver;
    
    return service;

    function setOptions(options) {
      angular.extend(options, options);
    }

    function setOption(name, value) {
      options[name] = value;
    }

		function shareViaWhatsAppToReceiver(receiver) {
      var social = $window.plugins && $window.plugins.socialsharing;
		  
      social.shareViaWhatsAppToReceiver(receiver, 'Message via WhatsApp', null /* img */, null /* url */, function() {$log.debug('share ok');});
		}
    
    function shareItem(item) {
			
			var params = {
			  message: item.description,
        subject: item.title,
        files: [],
        url: item.hasOwnProperty('link') ? item.link : null
			};

      if (item.thumbnails && item.thumbnails.length > 0) {
				params.files.push(item.thumbnails[0].url);
			}

			return share(params);
		}

		function shareMedia(media) {

			var params = {
			  message: media.title,
        subject: media.title,
        files: [],
        url: media.url
			};
			
			// If media is saved locally (media.path) then share it
			// Else share its link (media.url)
			// Couldn't share together local pdf and link
			if (media.hasOwnProperty('fullPath')) {
				params.files.push(media.fullPath);
				params.url = null;
			} else if (media.thumbnails && media.thumbnails.length > 0) {
				params.files.push(media.thumbnails[0].url);
			}
			
			return share(params);
		}
		
		function share(params) {
    /*
      this is the complete list of currently supported params you can pass to the plugin (all optional)
      var options = {
        message: 'share this', // not supported on some apps (Facebook, Instagram)
        subject: 'the subject', // fi. for email
        files: ['', ''], // an array of filenames either locally or remotely
        url: 'https://www.website.com/foo/#bar?a=b',
        chooserTitle: 'Pick an app' // Android only, you can override the default share sheet title
      }
    */
      var d = $q.defer();			
      var social = $window.plugins && $window.plugins.socialsharing;
      
      // If params.description is null
    
			if (social) {
        if (options.postfix) {
  				params.subject += options.postfix;
        }
      
        params.message = params.message && striptags(br2nl(params.message));
        params.subject = params.subject && striptags(br2nl(params.subject));
        var cb_share = {
          success: function(result) {
            d.resolve(result);
          },
          fail: function(msg) {
            d.reject(msg);
          }  
        };
        
        $log.debug('shareWithOptions');
        $log.debug(params);
        social.shareWithOptions(params, cb_share.success, cb_share.fail); 
			} else {
			  d.reject('Plugin socialsharing missing');
			}
      
      return d.promise;
		}
  }
})();
(function() {
	'use strict';
  
	phoneCallCordova.$inject = ["$log", "$window"];
	phoneCall.$inject = ["$log", "$window"];
	meuPhoneCall.$inject = ["$injector", "$window"];
	angular
	.module('ngMeumobi.Utils.phoneCall', [])
	.factory('phoneCallCordova', phoneCallCordova)
	.factory('phoneCall', phoneCall)
	.factory('meuPhoneCall', meuPhoneCall);
  
  /*
    install   :     cordova plugin add https://github.com/Rohfosho/CordovaCallNumberPlugin.git
  
    How to use it: 
    meuPhoneCall(number, true)
    .then(function(result) {})
    .catch(function(error) {});
  */
		
	function phoneCallCordova($log, $window) {
    
    var service = {};
    
    service.call = call;
    
    return service;
    
    function call(number, bypassAppChooser) {
      
      if (angular.isUndefined(bypassAppChooser)) {
        bypassAppChooser = false;
      }
      
      return new Promise(function (resolve, reject) {
        
        var cb_callNumber = {
          success: function(result) {
            resolve(result);
          },
          fail: function(result) {
            $log.debug(result);
            reject(result);
          }
        };
        
				var CallNumber = $window.plugins && $window.plugins.CallNumber;
        
        if (CallNumber) {
          CallNumber.callNumber(cb_callNumber.success, cb_callNumber.fail, number, bypassAppChooser);
        } else {
          throw new Error('Missing CordovaCallNumber Plugin');
        }       
      });
    }
	}
  
	function phoneCall($log, $window) {
    
    var service = {};
    
    service.call = call;
    
    return service;
    
    function call(number, bypassAppChooser) {
      
      if (angular.isUndefined(bypassAppChooser)) {
        bypassAppChooser = false;
      }
      
      return new Promise(function (resolve, reject) {
        try {
          var passedNumber = encodeURIComponent(number);
          $window.location = 'tel:' + passedNumber;
          resolve();
        } catch (e) {
          $log.debug('phoneCall catch');
          $log.debug(e);
          reject(e);
        }
      });
    }
	}
  
	function meuPhoneCall($injector, $window) {

		if ($window.cordova) {
			return $injector.get('phoneCallCordova');
		} else {
		  return $injector.get('phoneCall');
		}
	}
})();
(function() {
	'use strict';

	loadingInterceptor.$inject = ["$q", "$rootScope", "$log"];
	angular
	.module('ngMeumobi.Utils.loading', [])
	.factory('loadingInterceptor', loadingInterceptor);
	
	function loadingInterceptor($q, $rootScope, $log) {
		
		var numLoadings = 0;
		
		return {
			request: function(config) {
        if (!numLoadings++) {
          $rootScope.$broadcast('loading:start');
        }

				return config || $q.when(config);
			},
			response: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return response || $q.when(response);
			},
			requestError: function(request) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return $q.reject(request);
			},
			responseError: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}
				
				return $q.reject(response);
			}
		};
	}
})();

(function () {
  'use strict';
  
mediaClickLabel.$inject = ["MIMES"];
mediaIconClass.$inject = ["MIMES"];
mediaOpenClass.$inject = ["MIMES"];
  angular
  .module('ngMeumobi.Utils.files', ['slugifier'])
  .constant('MIMES', {
    'application/pdf': {
      class: 'fa-file-pdf-o',
      label: 'View',
      extension: 'pdf',
      download: true
    },
    'text/html': {
      class: 'fa-rss',
      label: 'Open',
      extension: 'html',
      download: false
    },
    'application/vnd.youtube.video+html': {
      class: 'fa-youtube-play',
      openClass: 'fa-play',
      label: 'Play',
      extension: 'html',
      download: false
    },
    'application/vnd.ms-excel': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    },
    'audio/mpeg': {
      class: 'fa-file-audio-o',
      label: 'Play',
      openClass: 'fa-play',
      extension: 'mp3',
      download: true
    },
    'application/vnd.ms-powerpoint': {
      class: 'fa-file-powerpoint-o',
      label: 'View',
      extension: 'ppt',
      download: true,
    },
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    }
  })
  .filter('mediaClickLabel', mediaClickLabel)
  .filter('mediaIconClass', mediaIconClass)
  .filter('mediaOpenClass', mediaOpenClass) 
  .provider('meuFiles', meuFiles); 
        
  function meuFiles() {
    var fileTransfers = {};
    var files = {};
    var options = {
      localFolder: 'Downloads'
    };
    var statuses = {
      download: 'download',
      downloading: 'downloading',
      downloaded: 'downloaded'
    };
    
    this.setOptions = function(options) {
      angular.extend(options, options);
    };

    this.setOption = function(name, value) {
      options[name] = value;
    };

    this.$get = ["$q", "$log", "$window", "MIMES", "Slug", function($q, $log, $window, MIMES, Slug) {
      var api = {};
      var service = {};
      
      /**
      *  Api methods, available only on the inside the service
      */

      api.fileErrorHandler = function(e) {
        /*
        List of Errors cordova-plugin-file
        https://github.com/apache/cordova-plugin-file#list-of-error-codes-and-meanings
        For the meaning I recommend to read https://wicg.github.io/entries-api/#common-types
        */
        switch (e.code) {
        case FileError.NOT_FOUND_ERR:
          e.message = 'Requested file could not be found';
          break;
        case FileError.SECURITY_ERR:
          e.message = 'SECURITY_ERR';
          break;
        case FileError.ABORT_ERR:
          e.message = 'ABORT_ERR';
          break;
        case FileError.NOT_READABLE_ERR:
          e.message = 'NOT_READABLE_ERR';
          break;
        case FileError.ENCODING_ERR:
          e.message = 'Malformed URI';
          break;
        case FileError.NO_MODIFICATION_ALLOWED_ERR:
          e.message = 'NO_MODIFICATION_ALLOWED_ERR';
          break;
        case FileError.INVALID_STATE_ERR:
          e.message = 'INVALID_STATE_ERR';
          break;
        case FileError.SYNTAX_ERR:
          e.message = 'SYNTAX_ERR';
          break;
        case FileError.INVALID_MODIFICATION_ERR:
          e.message = 'INVALID_MODIFICATION_ERR';
          break;
        case FileError.QUOTA_EXCEEDED_ERR:
          e.message = 'QUOTA_EXCEEDED_ERR';
          break;
        case FileError.TYPE_MISMATCH_ERR:
          e.message = 'TYPE_MISMATCH_ERR';
          break;
        case FileError.PATH_EXISTS_ERR:
          e.message = 'PATH_EXISTS_ERR';
          break;
        default:
          e.message = 'Unknown Error';
          break;
        }
        $log.debug('Error: ' + e.message);
        
        return e;
      };
      
      api.fileTransferErrorHandler = function(e) {
        /*
        A FileTransferError object is passed to an error callback when an error occurs.
        https://github.com/apache/cordova-plugin-file-transfer#filetransfererror
        */
        switch (e.code) {
        case FileTransferError.FILE_NOT_FOUND_ERR:
          e.message = 'FILE_NOT_FOUND_ERR';
          break;
        case FileTransferError.INVALID_URL_ERR:
          e.message = 'INVALID_URL_ERR';
          break;
        case FileTransferError.CONNECTION_ERR:
          e.message = 'CONNECTION_ERR';
          break;
        case FileTransferError.ABORT_ERR:
          e.message = 'Operation aborted';
          break;
        case FileTransferError.NOT_MODIFIED_ERR:
          e.message = 'NOT_MODIFIED_ERR';
          break;
        default:
          e.message = 'Unknown Error';
          break;
        }
        $log.debug('Error: ' + e.message);
        
        return e;
      };

      api.getFilesFromLocalStorage = function() {
        /*
        Check if files is already loaded (if not is empty)
        TODO: is loading localStorage['files] for each media, should be optimized to only load once for all
        */
        if (!Object.keys(files).length  && localStorage['files']) { 
          var entries = angular.fromJson(localStorage['files']);
          files = api.checkRepositoryConsistency(entries);
        }
        return files;
      };
      
      api.getFileName = function(file) {
        var ext = file.extension || '';
        
        if (!ext && MIMES[file.type])
          ext = MIMES[file.type].extension;
                
        var name = file.title || '';
        
        if (!name) {
          name = md5(file.url);
        } else {
          name = Slug.slugify(name);
        }
                          
        return name + '.' + ext;
      };
      
      api.checkRepositoryConsistency = function(entries) {
        /*
        id must be equals to file.path
        and fullPath can be updated if App is updated (iOS)
        */
        var obj = {};
        Object.keys(entries).forEach(function(key,index) {
          obj[entries[key].path] = entries[key];
          obj[entries[key].path].fullPath = api.getFileFullPath(entries[key].path);
        });
        localStorage['files'] = angular.toJson(obj);

        return obj;
      };
      
      // Returns the full absolute path from the root to the FileEntry
      api.getFileFullPath = function (filePath) {
        var directory = null;
        if (device.platform == 'Android') {
          directory = cordova.file.externalDataDirectory;
        } else {
          directory = cordova.file.dataDirectory;
        }
        return directory + filePath;
      };
      
      api.getFilePath = function (fileName) {
        return options.localFolder + '/' + fileName;
      };
      
      //add file to localstorage
      api.addFile = function(file) {
        files[file.path] = file;
        localStorage['files'] = angular.toJson(files);
      };
      
      //remove file from localstorage
      api.removeFile = function(id) {
        delete files[id];
        localStorage['files'] = angular.toJson(files);
      };
      
      //get files handler
      api.getFileEntry = function (path) {
        var q = $q.defer();
        $window.resolveLocalFileSystemURL(
          path, 
          function(entry) {
            q.resolve(entry);
          },
          function(error) {
            $log.debug(error);
            error = api.fileErrorHandler(error);
            q.reject(error);
          }
        );
        return q.promise;
      };
      
      api.isDownloaded = function(filePath) {
        /*
        TODO: If status is downloaded but local file is missing then return FALSE
        Keep record on localstorage to appears as file already downloaded, user can re-download if needed
        */
        return !!api.getFilesFromLocalStorage()[filePath];
      };
      
      api.isDownloading = function(filePath) {
        return !!fileTransfers[filePath];     
      };
      
      api.getFileStatus = function(filePath) {
        if (api.isDownloaded(filePath)) {
          return statuses.downloaded;
        } else if (api.isDownloading(filePath)) {
          return statuses.downloading;
        } else {
          return statuses.download; 
        }
      };
    
      /**
      * Service methods, that are public and available for any resource
      */
      // File available statuses, best for debug and maitain than just string.
      
      service.download = download;
      service.decorateFile = decorateFile;
      service.remove = remove;
      service.list = api.getFilesFromLocalStorage;
      service.open = open;
      service.isDownloadable = isDownloadable;
      service.openFileOpener = openFileOpener;
      
      return service;
      
      /*
      Install: cordova plugin add cordova-plugin-file-opener2
      https://www.npmjs.com/package/cordova-plugin-file-opener2
      */
      
      function isDownloadable(file) {
        return (file.type in MIMES) ? MIMES[file.type].download : true;
      }
      
      function openFileOpener(uri, type) {
        var q = $q.defer();

        cordova.plugins.fileOpener2.open(uri, type, {
          error: function (e) {
            q.reject(e);
          }, success: function () {
            q.resolve();
          }
        });
        return q.promise;
      };
      
      function open(file) {
        var q = $q.defer();
        var cb_entry = {
          success: function(entry) {
            openFileOpener(entry.toURL(), file.type).then(
              function() {
                q.resolve();
              },
              function(e) {
                q.reject(e);
              }
            );
          },
          fail: function(e) {
            q.reject(e);
          }
        };
        
        file.fullPath = api.getFileFullPath(file.path);
        api.getFileEntry(file.fullPath)
        .then(function(entry) {
          cb_entry.success(entry);
        }, function(e) {
          cb_entry.fail(e);
        }
      );
        
      return q.promise;
    };
      
    function download(file) {
      var q = $q.defer();
      var ft = new FileTransfer();
      var uri = encodeURI(file.url);
        
      file.status = statuses.downloading;
      file.fullPath = api.getFileFullPath(file.path);
      fileTransfers[file.path] = ft;

      ft.onprogress = function (progress) {
        q.notify(progress);
      };

      q.promise.abort = function () {
        ft.abort();
      };

      var cb_download = {
        success: function(fileEntry) {
          file.status = statuses.downloaded;
          api.addFile(file);
          delete fileTransfers[file.path];
          q.resolve(file);
        },
        fail: function(error) {
          $log.debug(error);
          file.status = statuses.download;
          error = api.fileTransferErrorHandler(error);
          delete fileTransfers[file.path];
          q.reject(error);
        }
      };
      ft.download(uri, file.fullPath, cb_download.success, cb_download.fail, false);
        
      return q.promise;
    };
      
    function remove(file) {
      var q = $q.defer();

      file.fullPath = api.getFileFullPath(file.path);
      api.getFileEntry(file.fullPath)
      .then(function(entry) {
        entry.remove(
          function (status) {
            api.removeFile(file.path);
            file.status = statuses.download;
            q.resolve(file);
          },function (error) {
            q.reject(error);
          }
        );
      }, function(error) {
        file.status = statuses.download;
        q.reject(error);
      }
    );
        
    return q.promise;
  }
      
  function decorateFile(file) {
    file.name = file.name || api.getFileName(file);
    file.path = file.path || api.getFilePath(file.name);
    file.status = api.getFileStatus(file.path);
        
    /*
    If device not exists then app run on browser
    */
    if (!typeof(device)) {
      var fullPath = api.getFileFullPath(file.path);
      if (api.isDownloaded(fullPath))
        file.fullPath = fullPath;
    };

    return file;
  };
}];
};
  
function mediaClickLabel(MIMES) {
  return function(type) {
    return MIMES[type] ? MIMES[type].label : 'Open';
  };
}
	
function mediaIconClass(MIMES) {
  return function(type) {
    return MIMES[type] ? MIMES[type].class : 'fa-external-link';
  };
}
  
function mediaOpenClass(MIMES) {
  return function(type) {
    return (MIMES[type] && MIMES[type].openClass )? MIMES[type].openClass : 'fa-eye';
  };
}
})();
(function() {
	'use strict';

  meuDialogs.$inject = ["$q", "$window"];
	angular
	.module('ngMeumobi.Utils.dialogs', [])
	.factory('meuDialogs', meuDialogs);
  
  /*
    install   :     cordova plugin add cordova-plugin-dialogs nl.x-services.plugins.toast
    link      :     https://github.com/apache/cordova-plugin-dialogs
    link      :     https://github.com/EddyVerbruggen/Toast-PhoneGap-Plugin  
  */
  
  function meuDialogs($q, $window) {
    
    var service = {};
    
    service.alert = alert;
    service.confirm = confirm;
    service.toast = toast;
    
    return service;
    
    function alert (message, title, buttonName) {
      var q = $q.defer();

      if (!$window.navigator.notification) {
        $window.alert(message);
        q.resolve();
      } else {
        navigator.notification.alert(message, function () {
          q.resolve();
        }, title, buttonName);
      }

      return q.promise;
    };
    
    function confirm (message, title, buttonLabels) {
      var q = $q.defer();

      if (!$window.navigator.notification) {
        if ($window.confirm(message)) {
          q.resolve(1);
        } else {
          q.resolve(2);
        }
      } else {
        navigator.notification.confirm(message, function (buttonIndex) {
          q.resolve(buttonIndex);
        }, title, buttonLabels);
      }

      return q.promise;
    };
    
    function toast (message) {
      var q = $q.defer();
			var toast = $window.plugins && $window.plugins.toast;
      
			if (toast) {
        toast.showLongBottom(message, function (response) {
          q.resolve(response);
        }, function (error) {
          q.reject(error);
        });
      } else {
        alert(message);
      }
      
      return q.promise;
    };
  }
})();
(function() {
	'use strict';

	angular
	.module('ngMeumobi.Utils.calendar', [])
	.factory('meuCalendar', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', meuCalendar]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin.git
    If start and end_date equal 00:00 then the event occurs all day long
  */
  
  function meuCalendar($q, $window, striptags, br2nl) {
    
    var service = {};
    
    service.createEventInteractively = createEventInteractively;
    
    return service;
    
    function createEventInteractively(options) {
      var d = $q.defer(),
        defaultOptions = {
          title: null,
          address: null,
          description: '',
          start_date: null,
          end_date: null
        };

      defaultOptions = angular.extend(defaultOptions, options);

      $window.plugins.calendar.createEventInteractively(
        striptags(defaultOptions.title),
        striptags(defaultOptions.address),
        striptags(br2nl(defaultOptions.description)),
        new Date(defaultOptions.start_date  * 1000),
        new Date(defaultOptions.end_date  * 1000),
        function (message) {
          d.resolve(message);
        }, function (error) {
          d.reject(error);
        }
      );

      return d.promise;
    }
  }
})();
(function() {
  'use strict';
  
  meuAuthentication.$inject = ["$http", "$rootScope", "$timeout"];
  angular
  .module('ngMeumobi.Utils.authentication', [])
  .factory('meuAuthentication', meuAuthentication);
  
  /*
  Inspired by Jason Watmore Blog Post
  http://jasonwatmore.com/post/2014/05/26/angularjs-basic-http-authentication-example
  */

  function meuAuthentication($http, $rootScope, $timeout) {
    
    var service = {};
    service.SetCredentials = function (data) { 
      /*
      *  data.visitor && data.token
      */
      $rootScope.auth = data;

      $http.defaults.headers.common['X-Visitor-Token'] = data.token;
      localStorage.globals = angular.toJson($rootScope.auth);
    };

    service.ClearCredentials = function () {
      $rootScope.auth = {};
      localStorage.removeItem('auth');
      delete $http.defaults.headers.common['X-Visitor-Token'];
    };

    return service;
  }
})();
(function() {
	'use strict';
  
	googleAnalyticsCordova.$inject = ["$cordovaGoogleAnalytics", "$log"];
	googleAnalytics.$inject = ["$log", "$q"];
  $cordovaGoogleAnalytics.$inject = ["$q", "$window", "$log"];
	meuAnalytics.$inject = ["$injector", "$window"];
	angular
	.module('ngMeumobi.Utils.analytics', [])
	.factory('googleAnalyticsCordova', googleAnalyticsCordova)
	.factory('googleAnalytics', googleAnalytics)
  .factory('$cordovaGoogleAnalytics', $cordovaGoogleAnalytics)
	.factory('meuAnalytics', meuAnalytics);
  
  /*
    Inspired by ngCordova
    We've extracted only required methods 
  
    install   :     cordova plugin add https://github.com/danwilson/google-analytics-plugin.git
  */

  function $cordovaGoogleAnalytics($q, $window, $log) {
    
    var service = {};
    
    service.startTrackerWithId = startTrackerWithId;
    service.debugMode = debugMode;
    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.setUserId = setUserId;
    
    return service;

    function setUserId(id) {
      var d = $q.defer();

      $log.debug('Set User Id: ' + id);
      
      $window.analytics.setUserId(id, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }

    function startTrackerWithId(id) {
      var d = $q.defer();

      $log.debug('Start tracking GA Id: ' + id);

      $window.analytics.startTrackerWithId(id, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }

    function debugMode() {
      var d = $q.defer();

      $window.analytics.debugMode(function (response) {
        d.resolve(response);
      }, function () {
        d.reject();
      });

      return d.promise;
    }

    function trackView(screenName) {
      var d = $q.defer();
      
      $log.debug('Track View: ' + screenName);
      
      $window.analytics.trackView(screenName, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }

    function trackEvent(category, action, label, value) {
      var d = $q.defer();

      var ev = [category, action, label, value];
      $log.debug('Track Event: ' + ev.toString());
      
      $window.analytics.trackEvent(category, action, label, value, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }
  }
		
	function googleAnalyticsCordova($cordovaGoogleAnalytics, $log) {
    
    var service = {};
    
    service.init = init;
    service.debugMode = $cordovaGoogleAnalytics.debugMode;
    service.trackView = $cordovaGoogleAnalytics.trackView;
    service.trackEvent = $cordovaGoogleAnalytics.trackEvent;
    service.startTrackerWithId = $cordovaGoogleAnalytics.startTrackerWithId;
    service.setUserId = $cordovaGoogleAnalytics.setUserId;
    
    return service;
    
    function init(trackId) {
      $cordovaGoogleAnalytics.startTrackerWithId(trackId);
    }
	}
  
	function googleAnalytics($log, $q) {
    
    var service = {};
    
    service.init = init;
    service.debugMode = debugMode;
    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.startTrackerWithId  = startTrackerWithId;
    service.setUserId = setUserId;
    
    return service;
    
    function init(trackId) {
      $log.debug('Google Analytics track Id: ' + trackId);
    }
    
    function debugMode() {
      $log.debug('Enable Debug');
    }
    
    function trackView(title) {
      $log.debug('Tracking Page: ' + title);
    }
    
    function trackEvent(category, action, label, value) {
      $log.debug('Tracking Event: ' + action);
    }
    
    function startTrackerWithId(id) {
      var msg = 'Tracking GA Id: ' + id;
      var d = $q.defer();

      d.resolve(msg);

      return d.promise;
    }
    
    function setUserId(id) {
      $log.debug('Tracking User: ' + id);
    }
	}
  
	function meuAnalytics($injector, $window) {

		if ($window.cordova) {
			return $injector.get('googleAnalyticsCordova');
		} else {
		  return $injector.get('googleAnalytics');
		}
	}
})();
/* global angular */
/* eslint no-undef: "error" */
(function () {
  'use strict';

  angular.module('ngMeumobi.Utils.filters', [])
  .filter('isEmpty', isEmpty)
  .filter('br2nl', br2nl)
  .filter('striptags', striptags);

  function isEmpty() {
    return function (obj) {
      return !Object.keys(obj).length;
    };
  }

  function br2nl() {
    return function (text) {
      return text.replace(/<br\s*[\/]?>/gi, '\n');
    };
  }

  function striptags() {
    return function (text) {
      return angular
          .element('<div/>')
          .html(text)
          .text();
    };
  }
})();

/* global angular */
/* eslint no-undef: "error" */
/*
  TODO: should release minified (.min.js) and not (.js)
*/
(function () {
  'use strict';

  angular.module('ngMeumobi.Utils', [
    //'ngMeumobi.Utils.files',
    //'ngMeumobi.Utils.api',
    'ngMeumobi.Utils.loading',
    //'ngMeumobi.Utils.connection',
    'ngMeumobi.Utils.phoneCall',
    'ngMeumobi.Utils.calendar',
    'ngMeumobi.Utils.analytics',
    'ngMeumobi.Utils.socialSharing',
    'ngMeumobi.Utils.dialogs',
    'ngMeumobi.Utils.files',
    'ngMeumobi.Utils.authentication'
    //'ngMeumobi.Utils.filters'
  ]);
  
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNvY2lhbFNoYXJpbmcuanMiLCJQaG9uZUNhbGwuanMiLCJMb2FkaW5nLmpzIiwiRmlsZXMuanMiLCJEaWFsb2dzLmpzIiwiQ2FsZW5kYXIuanMiLCJBdXRoZW50aWNhdGlvbi5qcyIsIkFuYWx5dGljcy5qcyIsIm1ldS1maWx0ZXJzLmpzIiwibW9kdWxlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtDQUNBOztDQUVBO0VBQ0EsT0FBQSxpQ0FBQTtFQUNBLFFBQUEsb0JBQUEsQ0FBQSxNQUFBLFdBQUEsbUJBQUEsZUFBQSxRQUFBOzs7Ozs7RUFNQSxTQUFBLGlCQUFBLElBQUEsU0FBQSxXQUFBLE9BQUEsTUFBQTs7SUFFQSxJQUFBLFVBQUE7SUFDQSxJQUFBLFVBQUE7TUFDQSxTQUFBOzs7SUFHQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFFBQUE7SUFDQSxRQUFBLDZCQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxXQUFBLFNBQUE7TUFDQSxRQUFBLE9BQUEsU0FBQTs7O0lBR0EsU0FBQSxVQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0VBR0EsU0FBQSwyQkFBQSxVQUFBO01BQ0EsSUFBQSxTQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O01BRUEsT0FBQSwyQkFBQSxVQUFBLHdCQUFBLGdCQUFBLGdCQUFBLFdBQUEsQ0FBQSxLQUFBLE1BQUE7OztJQUdBLFNBQUEsVUFBQSxNQUFBOztHQUVBLElBQUEsU0FBQTtLQUNBLFNBQUEsS0FBQTtRQUNBLFNBQUEsS0FBQTtRQUNBLE9BQUE7UUFDQSxLQUFBLEtBQUEsZUFBQSxVQUFBLEtBQUEsT0FBQTs7O01BR0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxXQUFBLFNBQUEsR0FBQTtJQUNBLE9BQUEsTUFBQSxLQUFBLEtBQUEsV0FBQSxHQUFBOzs7R0FHQSxPQUFBLE1BQUE7OztFQUdBLFNBQUEsV0FBQSxPQUFBOztHQUVBLElBQUEsU0FBQTtLQUNBLFNBQUEsTUFBQTtRQUNBLFNBQUEsTUFBQTtRQUNBLE9BQUE7UUFDQSxLQUFBLE1BQUE7Ozs7OztHQU1BLElBQUEsTUFBQSxlQUFBLGFBQUE7SUFDQSxPQUFBLE1BQUEsS0FBQSxNQUFBO0lBQ0EsT0FBQSxNQUFBO1VBQ0EsSUFBQSxNQUFBLGNBQUEsTUFBQSxXQUFBLFNBQUEsR0FBQTtJQUNBLE9BQUEsTUFBQSxLQUFBLE1BQUEsV0FBQSxHQUFBOzs7R0FHQSxPQUFBLE1BQUE7OztFQUdBLFNBQUEsTUFBQSxRQUFBOzs7Ozs7Ozs7OztNQVdBLElBQUEsSUFBQSxHQUFBO01BQ0EsSUFBQSxTQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7Ozs7R0FJQSxJQUFBLFFBQUE7UUFDQSxJQUFBLFFBQUEsU0FBQTtNQUNBLE9BQUEsV0FBQSxRQUFBOzs7UUFHQSxPQUFBLFVBQUEsT0FBQSxXQUFBLFVBQUEsTUFBQSxPQUFBO1FBQ0EsT0FBQSxVQUFBLE9BQUEsV0FBQSxVQUFBLE1BQUEsT0FBQTtRQUNBLElBQUEsV0FBQTtVQUNBLFNBQUEsU0FBQSxRQUFBO1lBQ0EsRUFBQSxRQUFBOztVQUVBLE1BQUEsU0FBQSxLQUFBO1lBQ0EsRUFBQSxPQUFBOzs7O1FBSUEsS0FBQSxNQUFBO1FBQ0EsS0FBQSxNQUFBO1FBQ0EsT0FBQSxpQkFBQSxRQUFBLFNBQUEsU0FBQSxTQUFBO1VBQ0E7S0FDQSxFQUFBLE9BQUE7OztNQUdBLE9BQUEsRUFBQTs7OztBQ3RIQSxDQUFBLFdBQUE7Q0FDQTs7Ozs7Q0FFQTtFQUNBLE9BQUEsNkJBQUE7RUFDQSxRQUFBLG9CQUFBO0VBQ0EsUUFBQSxhQUFBO0VBQ0EsUUFBQSxnQkFBQTs7Ozs7Ozs7Ozs7Q0FXQSxTQUFBLGlCQUFBLE1BQUEsU0FBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxPQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxLQUFBLFFBQUEsa0JBQUE7O01BRUEsSUFBQSxRQUFBLFlBQUEsbUJBQUE7UUFDQSxtQkFBQTs7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QTtNQUNBLFFBQUEsUUFBQTs7O0lBR0EsS0FBQSxrREFBQSxTQUFBLElBQUEsTUFBQSxTQUFBLE9BQUEsTUFBQTtNQUNBLElBQUEsTUFBQTtNQUNBLElBQUEsVUFBQTs7Ozs7O01BTUEsSUFBQSxtQkFBQSxTQUFBLEdBQUE7Ozs7OztRQU1BLFFBQUEsRUFBQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7O1FBRUEsS0FBQSxNQUFBLFlBQUEsRUFBQTs7UUFFQSxPQUFBOzs7TUFHQSxJQUFBLDJCQUFBLFNBQUEsR0FBQTs7Ozs7UUFLQSxRQUFBLEVBQUE7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQTtVQUNBLEVBQUEsVUFBQTtVQUNBOztRQUVBLEtBQUEsTUFBQSxZQUFBLEVBQUE7O1FBRUEsT0FBQTs7O01BR0EsSUFBQSwyQkFBQSxXQUFBOzs7OztRQUtBLElBQUEsQ0FBQSxPQUFBLEtBQUEsT0FBQSxXQUFBLGFBQUEsVUFBQTtVQUNBLElBQUEsVUFBQSxRQUFBLFNBQUEsYUFBQTtVQUNBLFFBQUEsSUFBQSwyQkFBQTs7UUFFQSxPQUFBOzs7TUFHQSxJQUFBLGNBQUEsU0FBQSxNQUFBO1FBQ0EsSUFBQSxNQUFBLEtBQUEsYUFBQTs7UUFFQSxJQUFBLENBQUEsT0FBQSxNQUFBLEtBQUE7VUFDQSxNQUFBLE1BQUEsS0FBQSxNQUFBOztRQUVBLElBQUEsT0FBQSxLQUFBLFNBQUE7O1FBRUEsSUFBQSxDQUFBLE1BQUE7VUFDQSxPQUFBLElBQUEsS0FBQTtlQUNBO1VBQ0EsT0FBQSxLQUFBLFFBQUE7OztRQUdBLE9BQUEsT0FBQSxNQUFBOzs7TUFHQSxJQUFBLDZCQUFBLFNBQUEsU0FBQTs7Ozs7UUFLQSxJQUFBLE1BQUE7UUFDQSxPQUFBLEtBQUEsU0FBQSxRQUFBLFNBQUEsSUFBQSxPQUFBO1VBQ0EsSUFBQSxRQUFBLEtBQUEsUUFBQSxRQUFBO1VBQ0EsSUFBQSxRQUFBLEtBQUEsTUFBQSxXQUFBLElBQUEsZ0JBQUEsUUFBQSxLQUFBOztRQUVBLGFBQUEsV0FBQSxRQUFBLE9BQUE7O1FBRUEsT0FBQTs7OztNQUlBLElBQUEsa0JBQUEsVUFBQSxVQUFBO1FBQ0EsSUFBQSxZQUFBO1FBQ0EsSUFBQSxPQUFBLFlBQUEsV0FBQTtVQUNBLFlBQUEsUUFBQSxLQUFBO2VBQ0E7VUFDQSxZQUFBLFFBQUEsS0FBQTs7UUFFQSxPQUFBLFlBQUE7OztNQUdBLElBQUEsY0FBQSxVQUFBLFVBQUE7UUFDQSxPQUFBLFFBQUEsY0FBQSxNQUFBOzs7O01BSUEsSUFBQSxVQUFBLFNBQUEsTUFBQTtRQUNBLE1BQUEsS0FBQSxRQUFBO1FBQ0EsYUFBQSxXQUFBLFFBQUEsT0FBQTs7OztNQUlBLElBQUEsYUFBQSxTQUFBLElBQUE7UUFDQSxPQUFBLE1BQUE7UUFDQSxhQUFBLFdBQUEsUUFBQSxPQUFBOzs7O01BSUEsSUFBQSxlQUFBLFVBQUEsTUFBQTtRQUNBLElBQUEsSUFBQSxHQUFBO1FBQ0EsUUFBQTtVQUNBO1VBQ0EsU0FBQSxPQUFBO1lBQ0EsRUFBQSxRQUFBOztVQUVBLFNBQUEsT0FBQTtZQUNBLEtBQUEsTUFBQTtZQUNBLFFBQUEsSUFBQSxpQkFBQTtZQUNBLEVBQUEsT0FBQTs7O1FBR0EsT0FBQSxFQUFBOzs7TUFHQSxJQUFBLGVBQUEsU0FBQSxVQUFBOzs7OztRQUtBLE9BQUEsQ0FBQSxDQUFBLElBQUEsMkJBQUE7OztNQUdBLElBQUEsZ0JBQUEsU0FBQSxVQUFBO1FBQ0EsT0FBQSxDQUFBLENBQUEsY0FBQTs7O01BR0EsSUFBQSxnQkFBQSxTQUFBLFVBQUE7UUFDQSxJQUFBLElBQUEsYUFBQSxXQUFBO1VBQ0EsT0FBQSxTQUFBO2VBQ0EsSUFBQSxJQUFBLGNBQUEsV0FBQTtVQUNBLE9BQUEsU0FBQTtlQUNBO1VBQ0EsT0FBQSxTQUFBOzs7Ozs7Ozs7TUFTQSxRQUFBLFdBQUE7TUFDQSxRQUFBLGVBQUE7TUFDQSxRQUFBLFNBQUE7TUFDQSxRQUFBLE9BQUEsSUFBQTtNQUNBLFFBQUEsT0FBQTtNQUNBLFFBQUEsaUJBQUE7TUFDQSxRQUFBLGlCQUFBOztNQUVBLE9BQUE7Ozs7Ozs7TUFPQSxTQUFBLGVBQUEsTUFBQTtRQUNBLE9BQUEsQ0FBQSxLQUFBLFFBQUEsU0FBQSxNQUFBLEtBQUEsTUFBQSxXQUFBOzs7TUFHQSxTQUFBLGVBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7O1FBRUEsUUFBQSxRQUFBLFlBQUEsS0FBQSxLQUFBLE1BQUE7VUFDQSxPQUFBLFVBQUEsR0FBQTtZQUNBLEVBQUEsT0FBQTthQUNBLFNBQUEsWUFBQTtZQUNBLEVBQUE7OztRQUdBLE9BQUEsRUFBQTtPQUNBOztNQUVBLFNBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7UUFDQSxJQUFBLFdBQUE7VUFDQSxTQUFBLFNBQUEsT0FBQTtZQUNBLGVBQUEsTUFBQSxTQUFBLEtBQUEsTUFBQTtjQUNBLFdBQUE7Z0JBQ0EsRUFBQTs7Y0FFQSxTQUFBLEdBQUE7Z0JBQ0EsRUFBQSxPQUFBOzs7O1VBSUEsTUFBQSxTQUFBLEdBQUE7WUFDQSxFQUFBLE9BQUE7Ozs7UUFJQSxLQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO1FBQ0EsSUFBQSxhQUFBLEtBQUE7U0FDQSxLQUFBLFNBQUEsT0FBQTtVQUNBLFNBQUEsUUFBQTtXQUNBLFNBQUEsR0FBQTtVQUNBLFNBQUEsS0FBQTs7OztNQUlBLE9BQUEsRUFBQTtLQUNBOztJQUVBLFNBQUEsU0FBQSxNQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7TUFDQSxJQUFBLEtBQUEsSUFBQTtNQUNBLElBQUEsTUFBQSxVQUFBLEtBQUE7O01BRUEsS0FBQSxTQUFBLFNBQUE7TUFDQSxLQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO01BQ0EsY0FBQSxLQUFBLFFBQUE7O01BRUEsR0FBQSxhQUFBLFVBQUEsVUFBQTtRQUNBLEVBQUEsT0FBQTs7O01BR0EsRUFBQSxRQUFBLFFBQUEsWUFBQTtRQUNBLEdBQUE7OztNQUdBLElBQUEsY0FBQTtRQUNBLFNBQUEsU0FBQSxXQUFBO1VBQ0EsS0FBQSxTQUFBLFNBQUE7VUFDQSxJQUFBLFFBQUE7VUFDQSxPQUFBLGNBQUEsS0FBQTtVQUNBLEVBQUEsUUFBQTs7UUFFQSxNQUFBLFNBQUEsT0FBQTtVQUNBLEtBQUEsTUFBQTtVQUNBLEtBQUEsU0FBQSxTQUFBO1VBQ0EsUUFBQSxJQUFBLHlCQUFBO1VBQ0EsT0FBQSxjQUFBLEtBQUE7VUFDQSxFQUFBLE9BQUE7OztNQUdBLEdBQUEsU0FBQSxLQUFBLEtBQUEsVUFBQSxZQUFBLFNBQUEsWUFBQSxNQUFBOztNQUVBLE9BQUEsRUFBQTtLQUNBOztJQUVBLFNBQUEsT0FBQSxNQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7O01BRUEsS0FBQSxXQUFBLElBQUEsZ0JBQUEsS0FBQTtNQUNBLElBQUEsYUFBQSxLQUFBO09BQ0EsS0FBQSxTQUFBLE9BQUE7UUFDQSxNQUFBO1VBQ0EsVUFBQSxRQUFBO1lBQ0EsSUFBQSxXQUFBLEtBQUE7WUFDQSxLQUFBLFNBQUEsU0FBQTtZQUNBLEVBQUEsUUFBQTtZQUNBLFVBQUEsT0FBQTtZQUNBLEVBQUEsT0FBQTs7O1NBR0EsU0FBQSxPQUFBO1FBQ0EsS0FBQSxTQUFBLFNBQUE7UUFDQSxFQUFBLE9BQUE7Ozs7SUFJQSxPQUFBLEVBQUE7OztFQUdBLFNBQUEsYUFBQSxNQUFBO0lBQ0EsS0FBQSxPQUFBLEtBQUEsUUFBQSxJQUFBLFlBQUE7SUFDQSxLQUFBLE9BQUEsS0FBQSxRQUFBLElBQUEsWUFBQSxLQUFBO0lBQ0EsS0FBQSxTQUFBLElBQUEsY0FBQSxLQUFBOzs7OztJQUtBLElBQUEsQ0FBQSxPQUFBLFNBQUE7TUFDQSxJQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO01BQ0EsSUFBQSxJQUFBLGFBQUE7UUFDQSxLQUFBLFdBQUE7S0FDQTs7SUFFQSxPQUFBO0dBQ0E7O0NBRUE7O0FBRUEsU0FBQSxnQkFBQSxPQUFBO0VBQ0EsT0FBQSxTQUFBLE1BQUE7SUFDQSxPQUFBLE1BQUEsUUFBQSxNQUFBLE1BQUEsUUFBQTs7OztBQUlBLFNBQUEsZUFBQSxPQUFBO0VBQ0EsT0FBQSxTQUFBLE1BQUE7SUFDQSxPQUFBLE1BQUEsUUFBQSxNQUFBLE1BQUEsUUFBQTs7OztBQUlBLFNBQUEsZUFBQSxPQUFBO0VBQ0EsT0FBQSxTQUFBLE1BQUE7SUFDQSxPQUFBLENBQUEsTUFBQSxTQUFBLE1BQUEsTUFBQSxhQUFBLE1BQUEsTUFBQSxZQUFBOzs7O0FDcmJBLENBQUEsV0FBQTtDQUNBOzs7Q0FFQTtFQUNBLE9BQUEsMkJBQUE7RUFDQSxRQUFBLGNBQUE7Ozs7Ozs7O0VBUUEsU0FBQSxXQUFBLElBQUEsU0FBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxRQUFBO0lBQ0EsUUFBQSxVQUFBO0lBQ0EsUUFBQSxRQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxPQUFBLFNBQUEsT0FBQSxZQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7O01BRUEsSUFBQSxDQUFBLFFBQUEsVUFBQSxjQUFBO1FBQ0EsUUFBQSxNQUFBO1FBQ0EsRUFBQTthQUNBO1FBQ0EsVUFBQSxhQUFBLE1BQUEsU0FBQSxZQUFBO1VBQ0EsRUFBQTtXQUNBLE9BQUE7OztNQUdBLE9BQUEsRUFBQTtLQUNBOztJQUVBLFNBQUEsU0FBQSxTQUFBLE9BQUEsY0FBQTtNQUNBLElBQUEsSUFBQSxHQUFBOztNQUVBLElBQUEsQ0FBQSxRQUFBLFVBQUEsY0FBQTtRQUNBLElBQUEsUUFBQSxRQUFBLFVBQUE7VUFDQSxFQUFBLFFBQUE7ZUFDQTtVQUNBLEVBQUEsUUFBQTs7YUFFQTtRQUNBLFVBQUEsYUFBQSxRQUFBLFNBQUEsVUFBQSxhQUFBO1VBQ0EsRUFBQSxRQUFBO1dBQ0EsT0FBQTs7O01BR0EsT0FBQSxFQUFBO0tBQ0E7O0lBRUEsU0FBQSxPQUFBLFNBQUE7TUFDQSxJQUFBLElBQUEsR0FBQTtHQUNBLElBQUEsUUFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztHQUVBLElBQUEsT0FBQTtRQUNBLE1BQUEsZUFBQSxTQUFBLFVBQUEsVUFBQTtVQUNBLEVBQUEsUUFBQTtXQUNBLFVBQUEsT0FBQTtVQUNBLEVBQUEsT0FBQTs7YUFFQTtRQUNBLE1BQUE7OztNQUdBLE9BQUEsRUFBQTtLQUNBOzs7QUN2RUEsQ0FBQSxXQUFBO0NBQ0E7O0NBRUE7RUFDQSxPQUFBLDRCQUFBO0VBQ0EsUUFBQSxlQUFBLENBQUEsTUFBQSxXQUFBLG1CQUFBLGVBQUE7Ozs7Ozs7RUFPQSxTQUFBLFlBQUEsSUFBQSxTQUFBLFdBQUEsT0FBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSwyQkFBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEseUJBQUEsU0FBQTtNQUNBLElBQUEsSUFBQSxHQUFBO1FBQ0EsaUJBQUE7VUFDQSxPQUFBO1VBQ0EsU0FBQTtVQUNBLGFBQUE7VUFDQSxZQUFBO1VBQ0EsVUFBQTs7O01BR0EsaUJBQUEsUUFBQSxPQUFBLGdCQUFBOztNQUVBLFFBQUEsUUFBQSxTQUFBO1FBQ0EsVUFBQSxlQUFBO1FBQ0EsVUFBQSxlQUFBO1FBQ0Es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QUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7Ozs7O0FBS0EiLCJmaWxlIjoibmctbWV1bW9iaS11dGlscy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5zb2NpYWxTaGFyaW5nJywgW10pXG5cdC5mYWN0b3J5KCdtZXVTb2NpYWxTaGFyaW5nJywgWyckcScsICckd2luZG93JywgJ3N0cmlwdGFnc0ZpbHRlcicsICdicjJubEZpbHRlcicsICckbG9nJywgbWV1U29jaWFsU2hhcmluZ10pO1xuICBcbiAgLypcbiAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgaHR0cHM6Ly9naXRodWIuY29tL0VkZHlWZXJicnVnZ2VuL1NvY2lhbFNoYXJpbmctUGhvbmVHYXAtUGx1Z2luXG4gICovXG4gIFxuICBmdW5jdGlvbiBtZXVTb2NpYWxTaGFyaW5nKCRxLCAkd2luZG93LCBzdHJpcHRhZ3MsIGJyMm5sLCAkbG9nKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIHBvc3RmaXg6ICcnXG4gICAgfTtcbiAgICBcbiAgICBzZXJ2aWNlLnNoYXJlSXRlbSA9IHNoYXJlSXRlbTtcbiAgICBzZXJ2aWNlLnNoYXJlTWVkaWEgPSBzaGFyZU1lZGlhO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9uID0gc2V0T3B0aW9uO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9ucyA9IHNldE9wdGlvbnM7XG4gICAgc2VydmljZS5zaGFyZSA9IHNoYXJlO1xuICAgIHNlcnZpY2Uuc2hhcmVWaWFXaGF0c0FwcFRvUmVjZWl2ZXIgPSBzaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlcjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykge1xuICAgICAgYW5ndWxhci5leHRlbmQob3B0aW9ucywgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0T3B0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICBvcHRpb25zW25hbWVdID0gdmFsdWU7XG4gICAgfVxuXG5cdFx0ZnVuY3Rpb24gc2hhcmVWaWFXaGF0c0FwcFRvUmVjZWl2ZXIocmVjZWl2ZXIpIHtcbiAgICAgIHZhciBzb2NpYWwgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnNvY2lhbHNoYXJpbmc7XG5cdFx0ICBcbiAgICAgIHNvY2lhbC5zaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlcihyZWNlaXZlciwgJ01lc3NhZ2UgdmlhIFdoYXRzQXBwJywgbnVsbCAvKiBpbWcgKi8sIG51bGwgLyogdXJsICovLCBmdW5jdGlvbigpIHskbG9nLmRlYnVnKCdzaGFyZSBvaycpO30pO1xuXHRcdH1cbiAgICBcbiAgICBmdW5jdGlvbiBzaGFyZUl0ZW0oaXRlbSkge1xuXHRcdFx0XG5cdFx0XHR2YXIgcGFyYW1zID0ge1xuXHRcdFx0ICBtZXNzYWdlOiBpdGVtLmRlc2NyaXB0aW9uLFxuICAgICAgICBzdWJqZWN0OiBpdGVtLnRpdGxlLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIHVybDogaXRlbS5oYXNPd25Qcm9wZXJ0eSgnbGluaycpID8gaXRlbS5saW5rIDogbnVsbFxuXHRcdFx0fTtcblxuICAgICAgaWYgKGl0ZW0udGh1bWJuYWlscyAmJiBpdGVtLnRodW1ibmFpbHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRwYXJhbXMuZmlsZXMucHVzaChpdGVtLnRodW1ibmFpbHNbMF0udXJsKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNoYXJlKHBhcmFtcyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2hhcmVNZWRpYShtZWRpYSkge1xuXG5cdFx0XHR2YXIgcGFyYW1zID0ge1xuXHRcdFx0ICBtZXNzYWdlOiBtZWRpYS50aXRsZSxcbiAgICAgICAgc3ViamVjdDogbWVkaWEudGl0bGUsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgdXJsOiBtZWRpYS51cmxcblx0XHRcdH07XG5cdFx0XHRcblx0XHRcdC8vIElmIG1lZGlhIGlzIHNhdmVkIGxvY2FsbHkgKG1lZGlhLnBhdGgpIHRoZW4gc2hhcmUgaXRcblx0XHRcdC8vIEVsc2Ugc2hhcmUgaXRzIGxpbmsgKG1lZGlhLnVybClcblx0XHRcdC8vIENvdWxkbid0IHNoYXJlIHRvZ2V0aGVyIGxvY2FsIHBkZiBhbmQgbGlua1xuXHRcdFx0aWYgKG1lZGlhLmhhc093blByb3BlcnR5KCdmdWxsUGF0aCcpKSB7XG5cdFx0XHRcdHBhcmFtcy5maWxlcy5wdXNoKG1lZGlhLmZ1bGxQYXRoKTtcblx0XHRcdFx0cGFyYW1zLnVybCA9IG51bGw7XG5cdFx0XHR9IGVsc2UgaWYgKG1lZGlhLnRodW1ibmFpbHMgJiYgbWVkaWEudGh1bWJuYWlscy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHBhcmFtcy5maWxlcy5wdXNoKG1lZGlhLnRodW1ibmFpbHNbMF0udXJsKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmV0dXJuIHNoYXJlKHBhcmFtcyk7XG5cdFx0fVxuXHRcdFxuXHRcdGZ1bmN0aW9uIHNoYXJlKHBhcmFtcykge1xuICAgIC8qXG4gICAgICB0aGlzIGlzIHRoZSBjb21wbGV0ZSBsaXN0IG9mIGN1cnJlbnRseSBzdXBwb3J0ZWQgcGFyYW1zIHlvdSBjYW4gcGFzcyB0byB0aGUgcGx1Z2luIChhbGwgb3B0aW9uYWwpXG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbWVzc2FnZTogJ3NoYXJlIHRoaXMnLCAvLyBub3Qgc3VwcG9ydGVkIG9uIHNvbWUgYXBwcyAoRmFjZWJvb2ssIEluc3RhZ3JhbSlcbiAgICAgICAgc3ViamVjdDogJ3RoZSBzdWJqZWN0JywgLy8gZmkuIGZvciBlbWFpbFxuICAgICAgICBmaWxlczogWycnLCAnJ10sIC8vIGFuIGFycmF5IG9mIGZpbGVuYW1lcyBlaXRoZXIgbG9jYWxseSBvciByZW1vdGVseVxuICAgICAgICB1cmw6ICdodHRwczovL3d3dy53ZWJzaXRlLmNvbS9mb28vI2Jhcj9hPWInLFxuICAgICAgICBjaG9vc2VyVGl0bGU6ICdQaWNrIGFuIGFwcCcgLy8gQW5kcm9pZCBvbmx5LCB5b3UgY2FuIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNoYXJlIHNoZWV0IHRpdGxlXG4gICAgICB9XG4gICAgKi9cbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcdFx0XHRcbiAgICAgIHZhciBzb2NpYWwgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnNvY2lhbHNoYXJpbmc7XG4gICAgICBcbiAgICAgIC8vIElmIHBhcmFtcy5kZXNjcmlwdGlvbiBpcyBudWxsXG4gICAgXG5cdFx0XHRpZiAoc29jaWFsKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnBvc3RmaXgpIHtcbiAgXHRcdFx0XHRwYXJhbXMuc3ViamVjdCArPSBvcHRpb25zLnBvc3RmaXg7XG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICBwYXJhbXMubWVzc2FnZSA9IHBhcmFtcy5tZXNzYWdlICYmIHN0cmlwdGFncyhicjJubChwYXJhbXMubWVzc2FnZSkpO1xuICAgICAgICBwYXJhbXMuc3ViamVjdCA9IHBhcmFtcy5zdWJqZWN0ICYmIHN0cmlwdGFncyhicjJubChwYXJhbXMuc3ViamVjdCkpO1xuICAgICAgICB2YXIgY2Jfc2hhcmUgPSB7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKG1zZykge1xuICAgICAgICAgICAgZC5yZWplY3QobXNnKTtcbiAgICAgICAgICB9ICBcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRsb2cuZGVidWcoJ3NoYXJlV2l0aE9wdGlvbnMnKTtcbiAgICAgICAgJGxvZy5kZWJ1ZyhwYXJhbXMpO1xuICAgICAgICBzb2NpYWwuc2hhcmVXaXRoT3B0aW9ucyhwYXJhbXMsIGNiX3NoYXJlLnN1Y2Nlc3MsIGNiX3NoYXJlLmZhaWwpOyBcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHQgIGQucmVqZWN0KCdQbHVnaW4gc29jaWFsc2hhcmluZyBtaXNzaW5nJyk7XG5cdFx0XHR9XG4gICAgICBcbiAgICAgIHJldHVybiBkLnByb21pc2U7XG5cdFx0fVxuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuICBcblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMucGhvbmVDYWxsJywgW10pXG5cdC5mYWN0b3J5KCdwaG9uZUNhbGxDb3Jkb3ZhJywgcGhvbmVDYWxsQ29yZG92YSlcblx0LmZhY3RvcnkoJ3Bob25lQ2FsbCcsIHBob25lQ2FsbClcblx0LmZhY3RvcnkoJ21ldVBob25lQ2FsbCcsIG1ldVBob25lQ2FsbCk7XG4gIFxuICAvKlxuICAgIGluc3RhbGwgICA6ICAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgaHR0cHM6Ly9naXRodWIuY29tL1JvaGZvc2hvL0NvcmRvdmFDYWxsTnVtYmVyUGx1Z2luLmdpdFxuICBcbiAgICBIb3cgdG8gdXNlIGl0OiBcbiAgICBtZXVQaG9uZUNhbGwobnVtYmVyLCB0cnVlKVxuICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge30pXG4gICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7fSk7XG4gICovXG5cdFx0XG5cdGZ1bmN0aW9uIHBob25lQ2FsbENvcmRvdmEoJGxvZywgJHdpbmRvdykge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5jYWxsID0gY2FsbDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBjYWxsKG51bWJlciwgYnlwYXNzQXBwQ2hvb3Nlcikge1xuICAgICAgXG4gICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChieXBhc3NBcHBDaG9vc2VyKSkge1xuICAgICAgICBieXBhc3NBcHBDaG9vc2VyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFxuICAgICAgICB2YXIgY2JfY2FsbE51bWJlciA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhyZXN1bHQpO1xuICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcblx0XHRcdFx0dmFyIENhbGxOdW1iZXIgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLkNhbGxOdW1iZXI7XG4gICAgICAgIFxuICAgICAgICBpZiAoQ2FsbE51bWJlcikge1xuICAgICAgICAgIENhbGxOdW1iZXIuY2FsbE51bWJlcihjYl9jYWxsTnVtYmVyLnN1Y2Nlc3MsIGNiX2NhbGxOdW1iZXIuZmFpbCwgbnVtYmVyLCBieXBhc3NBcHBDaG9vc2VyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgQ29yZG92YUNhbGxOdW1iZXIgUGx1Z2luJyk7XG4gICAgICAgIH0gICAgICAgXG4gICAgICB9KTtcbiAgICB9XG5cdH1cbiAgXG5cdGZ1bmN0aW9uIHBob25lQ2FsbCgkbG9nLCAkd2luZG93KSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmNhbGwgPSBjYWxsO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIGZ1bmN0aW9uIGNhbGwobnVtYmVyLCBieXBhc3NBcHBDaG9vc2VyKSB7XG4gICAgICBcbiAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKGJ5cGFzc0FwcENob29zZXIpKSB7XG4gICAgICAgIGJ5cGFzc0FwcENob29zZXIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgcGFzc2VkTnVtYmVyID0gZW5jb2RlVVJJQ29tcG9uZW50KG51bWJlcik7XG4gICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbiA9ICd0ZWw6JyArIHBhc3NlZE51bWJlcjtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkbG9nLmRlYnVnKCdwaG9uZUNhbGwgY2F0Y2gnKTtcbiAgICAgICAgICAkbG9nLmRlYnVnKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXHR9XG4gIFxuXHRmdW5jdGlvbiBtZXVQaG9uZUNhbGwoJGluamVjdG9yLCAkd2luZG93KSB7XG5cblx0XHRpZiAoJHdpbmRvdy5jb3Jkb3ZhKSB7XG5cdFx0XHRyZXR1cm4gJGluamVjdG9yLmdldCgncGhvbmVDYWxsQ29yZG92YScpO1xuXHRcdH0gZWxzZSB7XG5cdFx0ICByZXR1cm4gJGluamVjdG9yLmdldCgncGhvbmVDYWxsJyk7XG5cdFx0fVxuXHR9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmxvYWRpbmcnLCBbXSlcblx0LmZhY3RvcnkoJ2xvYWRpbmdJbnRlcmNlcHRvcicsIGxvYWRpbmdJbnRlcmNlcHRvcik7XG5cdFxuXHRmdW5jdGlvbiBsb2FkaW5nSW50ZXJjZXB0b3IoJHEsICRyb290U2NvcGUsICRsb2cpIHtcblx0XHRcblx0XHR2YXIgbnVtTG9hZGluZ3MgPSAwO1xuXHRcdFxuXHRcdHJldHVybiB7XG5cdFx0XHRyZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgICAgaWYgKCFudW1Mb2FkaW5ncysrKSB7XG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOnN0YXJ0Jyk7XG4gICAgICAgIH1cblxuXHRcdFx0XHRyZXR1cm4gY29uZmlnIHx8ICRxLndoZW4oY29uZmlnKTtcblx0XHRcdH0sXG5cdFx0XHRyZXNwb25zZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0aWYgKCEoLS1udW1Mb2FkaW5ncykpIHtcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6c3RvcCcpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuXHRcdFx0fSxcblx0XHRcdHJlcXVlc3RFcnJvcjogZnVuY3Rpb24ocmVxdWVzdCkge1xuXHRcdFx0XHRpZiAoISgtLW51bUxvYWRpbmdzKSkge1xuXHRcdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpzdG9wJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gJHEucmVqZWN0KHJlcXVlc3QpO1xuXHRcdFx0fSxcblx0XHRcdHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdGlmICghKC0tbnVtTG9hZGluZ3MpKSB7XG5cdFx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOnN0b3AnKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmZpbGVzJywgWydzbHVnaWZpZXInXSlcbiAgLmNvbnN0YW50KCdNSU1FUycsIHtcbiAgICAnYXBwbGljYXRpb24vcGRmJzoge1xuICAgICAgY2xhc3M6ICdmYS1maWxlLXBkZi1vJyxcbiAgICAgIGxhYmVsOiAnVmlldycsXG4gICAgICBleHRlbnNpb246ICdwZGYnLFxuICAgICAgZG93bmxvYWQ6IHRydWVcbiAgICB9LFxuICAgICd0ZXh0L2h0bWwnOiB7XG4gICAgICBjbGFzczogJ2ZhLXJzcycsXG4gICAgICBsYWJlbDogJ09wZW4nLFxuICAgICAgZXh0ZW5zaW9uOiAnaHRtbCcsXG4gICAgICBkb3dubG9hZDogZmFsc2VcbiAgICB9LFxuICAgICdhcHBsaWNhdGlvbi92bmQueW91dHViZS52aWRlbytodG1sJzoge1xuICAgICAgY2xhc3M6ICdmYS15b3V0dWJlLXBsYXknLFxuICAgICAgb3BlbkNsYXNzOiAnZmEtcGxheScsXG4gICAgICBsYWJlbDogJ1BsYXknLFxuICAgICAgZXh0ZW5zaW9uOiAnaHRtbCcsXG4gICAgICBkb3dubG9hZDogZmFsc2VcbiAgICB9LFxuICAgICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtZXhjZWwtbycsXG4gICAgICBsYWJlbDogJ1ZpZXcnLFxuICAgICAgZXh0ZW5zaW9uOiAneGxzJyxcbiAgICAgIGRvd25sb2FkOiB0cnVlXG4gICAgfSxcbiAgICAnYXVkaW8vbXBlZyc6IHtcbiAgICAgIGNsYXNzOiAnZmEtZmlsZS1hdWRpby1vJyxcbiAgICAgIGxhYmVsOiAnUGxheScsXG4gICAgICBvcGVuQ2xhc3M6ICdmYS1wbGF5JyxcbiAgICAgIGV4dGVuc2lvbjogJ21wMycsXG4gICAgICBkb3dubG9hZDogdHJ1ZVxuICAgIH0sXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50Jzoge1xuICAgICAgY2xhc3M6ICdmYS1maWxlLXBvd2VycG9pbnQtbycsXG4gICAgICBsYWJlbDogJ1ZpZXcnLFxuICAgICAgZXh0ZW5zaW9uOiAncHB0JyxcbiAgICAgIGRvd25sb2FkOiB0cnVlLFxuICAgIH0sXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0Jzoge1xuICAgICAgY2xhc3M6ICdmYS1maWxlLWV4Y2VsLW8nLFxuICAgICAgbGFiZWw6ICdWaWV3JyxcbiAgICAgIGV4dGVuc2lvbjogJ3hscycsXG4gICAgICBkb3dubG9hZDogdHJ1ZVxuICAgIH1cbiAgfSlcbiAgLmZpbHRlcignbWVkaWFDbGlja0xhYmVsJywgbWVkaWFDbGlja0xhYmVsKVxuICAuZmlsdGVyKCdtZWRpYUljb25DbGFzcycsIG1lZGlhSWNvbkNsYXNzKVxuICAuZmlsdGVyKCdtZWRpYU9wZW5DbGFzcycsIG1lZGlhT3BlbkNsYXNzKSBcbiAgLnByb3ZpZGVyKCdtZXVGaWxlcycsIG1ldUZpbGVzKTsgXG4gICAgICAgIFxuICBmdW5jdGlvbiBtZXVGaWxlcygpIHtcbiAgICB2YXIgZmlsZVRyYW5zZmVycyA9IHt9O1xuICAgIHZhciBmaWxlcyA9IHt9O1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgbG9jYWxGb2xkZXI6ICdEb3dubG9hZHMnXG4gICAgfTtcbiAgICB2YXIgc3RhdHVzZXMgPSB7XG4gICAgICBkb3dubG9hZDogJ2Rvd25sb2FkJyxcbiAgICAgIGRvd25sb2FkaW5nOiAnZG93bmxvYWRpbmcnLFxuICAgICAgZG93bmxvYWRlZDogJ2Rvd25sb2FkZWQnXG4gICAgfTtcbiAgICBcbiAgICB0aGlzLnNldE9wdGlvbnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBhbmd1bGFyLmV4dGVuZChvcHRpb25zLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZXRPcHRpb24gPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgIH07XG5cbiAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbigkcSwgJGxvZywgJHdpbmRvdywgTUlNRVMsIFNsdWcpIHtcbiAgICAgIHZhciBhcGkgPSB7fTtcbiAgICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgKiAgQXBpIG1ldGhvZHMsIGF2YWlsYWJsZSBvbmx5IG9uIHRoZSBpbnNpZGUgdGhlIHNlcnZpY2VcbiAgICAgICovXG5cbiAgICAgIGFwaS5maWxlRXJyb3JIYW5kbGVyID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAvKlxuICAgICAgICBMaXN0IG9mIEVycm9ycyBjb3Jkb3ZhLXBsdWdpbi1maWxlXG4gICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9hcGFjaGUvY29yZG92YS1wbHVnaW4tZmlsZSNsaXN0LW9mLWVycm9yLWNvZGVzLWFuZC1tZWFuaW5nc1xuICAgICAgICBGb3IgdGhlIG1lYW5pbmcgSSByZWNvbW1lbmQgdG8gcmVhZCBodHRwczovL3dpY2cuZ2l0aHViLmlvL2VudHJpZXMtYXBpLyNjb21tb24tdHlwZXNcbiAgICAgICAgKi9cbiAgICAgICAgc3dpdGNoIChlLmNvZGUpIHtcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnUmVxdWVzdGVkIGZpbGUgY291bGQgbm90IGJlIGZvdW5kJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuU0VDVVJJVFlfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdTRUNVUklUWV9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5BQk9SVF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ0FCT1JUX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLk5PVF9SRUFEQUJMRV9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ05PVF9SRUFEQUJMRV9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5FTkNPRElOR19FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ01hbGZvcm1lZCBVUkknO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5OT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ05PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdJTlZBTElEX1NUQVRFX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLlNZTlRBWF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1NZTlRBWF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5JTlZBTElEX01PRElGSUNBVElPTl9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ0lOVkFMSURfTU9ESUZJQ0FUSU9OX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLlFVT1RBX0VYQ0VFREVEX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnUVVPVEFfRVhDRUVERURfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuVFlQRV9NSVNNQVRDSF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1RZUEVfTUlTTUFUQ0hfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuUEFUSF9FWElTVFNfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdQQVRIX0VYSVNUU19FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdVbmtub3duIEVycm9yJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAkbG9nLmRlYnVnKCdFcnJvcjogJyArIGUubWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5maWxlVHJhbnNmZXJFcnJvckhhbmRsZXIgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8qXG4gICAgICAgIEEgRmlsZVRyYW5zZmVyRXJyb3Igb2JqZWN0IGlzIHBhc3NlZCB0byBhbiBlcnJvciBjYWxsYmFjayB3aGVuIGFuIGVycm9yIG9jY3Vycy5cbiAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9jb3Jkb3ZhLXBsdWdpbi1maWxlLXRyYW5zZmVyI2ZpbGV0cmFuc2ZlcmVycm9yXG4gICAgICAgICovXG4gICAgICAgIHN3aXRjaCAoZS5jb2RlKSB7XG4gICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuRklMRV9OT1RfRk9VTkRfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdGSUxFX05PVF9GT1VORF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLklOVkFMSURfVVJMX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnSU5WQUxJRF9VUkxfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlVHJhbnNmZXJFcnJvci5DT05ORUNUSU9OX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnQ09OTkVDVElPTl9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLkFCT1JUX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnT3BlcmF0aW9uIGFib3J0ZWQnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLk5PVF9NT0RJRklFRF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ05PVF9NT0RJRklFRF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdVbmtub3duIEVycm9yJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAkbG9nLmRlYnVnKCdFcnJvcjogJyArIGUubWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH07XG5cbiAgICAgIGFwaS5nZXRGaWxlc0Zyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLypcbiAgICAgICAgQ2hlY2sgaWYgZmlsZXMgaXMgYWxyZWFkeSBsb2FkZWQgKGlmIG5vdCBpcyBlbXB0eSlcbiAgICAgICAgVE9ETzogaXMgbG9hZGluZyBsb2NhbFN0b3JhZ2VbJ2ZpbGVzXSBmb3IgZWFjaCBtZWRpYSwgc2hvdWxkIGJlIG9wdGltaXplZCB0byBvbmx5IGxvYWQgb25jZSBmb3IgYWxsXG4gICAgICAgICovXG4gICAgICAgIGlmICghT2JqZWN0LmtleXMoZmlsZXMpLmxlbmd0aCAgJiYgbG9jYWxTdG9yYWdlWydmaWxlcyddKSB7IFxuICAgICAgICAgIHZhciBlbnRyaWVzID0gYW5ndWxhci5mcm9tSnNvbihsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10pO1xuICAgICAgICAgIGZpbGVzID0gYXBpLmNoZWNrUmVwb3NpdG9yeUNvbnNpc3RlbmN5KGVudHJpZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWxlcztcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5nZXRGaWxlTmFtZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgdmFyIGV4dCA9IGZpbGUuZXh0ZW5zaW9uIHx8ICcnO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFleHQgJiYgTUlNRVNbZmlsZS50eXBlXSlcbiAgICAgICAgICBleHQgPSBNSU1FU1tmaWxlLnR5cGVdLmV4dGVuc2lvbjtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgdmFyIG5hbWUgPSBmaWxlLnRpdGxlIHx8ICcnO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgbmFtZSA9IG1kNShmaWxlLnVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmFtZSA9IFNsdWcuc2x1Z2lmeShuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5hbWUgKyAnLicgKyBleHQ7XG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuY2hlY2tSZXBvc2l0b3J5Q29uc2lzdGVuY3kgPSBmdW5jdGlvbihlbnRyaWVzKSB7XG4gICAgICAgIC8qXG4gICAgICAgIGlkIG11c3QgYmUgZXF1YWxzIHRvIGZpbGUucGF0aFxuICAgICAgICBhbmQgZnVsbFBhdGggY2FuIGJlIHVwZGF0ZWQgaWYgQXBwIGlzIHVwZGF0ZWQgKGlPUylcbiAgICAgICAgKi9cbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuICAgICAgICBPYmplY3Qua2V5cyhlbnRyaWVzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSxpbmRleCkge1xuICAgICAgICAgIG9ialtlbnRyaWVzW2tleV0ucGF0aF0gPSBlbnRyaWVzW2tleV07XG4gICAgICAgICAgb2JqW2VudHJpZXNba2V5XS5wYXRoXS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZW50cmllc1trZXldLnBhdGgpO1xuICAgICAgICB9KTtcbiAgICAgICAgbG9jYWxTdG9yYWdlWydmaWxlcyddID0gYW5ndWxhci50b0pzb24ob2JqKTtcblxuICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy8gUmV0dXJucyB0aGUgZnVsbCBhYnNvbHV0ZSBwYXRoIGZyb20gdGhlIHJvb3QgdG8gdGhlIEZpbGVFbnRyeVxuICAgICAgYXBpLmdldEZpbGVGdWxsUGF0aCA9IGZ1bmN0aW9uIChmaWxlUGF0aCkge1xuICAgICAgICB2YXIgZGlyZWN0b3J5ID0gbnVsbDtcbiAgICAgICAgaWYgKGRldmljZS5wbGF0Zm9ybSA9PSAnQW5kcm9pZCcpIHtcbiAgICAgICAgICBkaXJlY3RvcnkgPSBjb3Jkb3ZhLmZpbGUuZXh0ZXJuYWxEYXRhRGlyZWN0b3J5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpcmVjdG9yeSA9IGNvcmRvdmEuZmlsZS5kYXRhRGlyZWN0b3J5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaXJlY3RvcnkgKyBmaWxlUGF0aDtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5nZXRGaWxlUGF0aCA9IGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5sb2NhbEZvbGRlciArICcvJyArIGZpbGVOYW1lO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy9hZGQgZmlsZSB0byBsb2NhbHN0b3JhZ2VcbiAgICAgIGFwaS5hZGRGaWxlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICBmaWxlc1tmaWxlLnBhdGhdID0gZmlsZTtcbiAgICAgICAgbG9jYWxTdG9yYWdlWydmaWxlcyddID0gYW5ndWxhci50b0pzb24oZmlsZXMpO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy9yZW1vdmUgZmlsZSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgICAgYXBpLnJlbW92ZUZpbGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICBkZWxldGUgZmlsZXNbaWRdO1xuICAgICAgICBsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10gPSBhbmd1bGFyLnRvSnNvbihmaWxlcyk7XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvL2dldCBmaWxlcyBoYW5kbGVyXG4gICAgICBhcGkuZ2V0RmlsZUVudHJ5ID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuICAgICAgICAkd2luZG93LnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkwoXG4gICAgICAgICAgcGF0aCwgXG4gICAgICAgICAgZnVuY3Rpb24oZW50cnkpIHtcbiAgICAgICAgICAgIHEucmVzb2x2ZShlbnRyeSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhlcnJvcik7XG4gICAgICAgICAgICBlcnJvciA9IGFwaS5maWxlRXJyb3JIYW5kbGVyKGVycm9yKTtcbiAgICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuaXNEb3dubG9hZGVkID0gZnVuY3Rpb24oZmlsZVBhdGgpIHtcbiAgICAgICAgLypcbiAgICAgICAgVE9ETzogSWYgc3RhdHVzIGlzIGRvd25sb2FkZWQgYnV0IGxvY2FsIGZpbGUgaXMgbWlzc2luZyB0aGVuIHJldHVybiBGQUxTRVxuICAgICAgICBLZWVwIHJlY29yZCBvbiBsb2NhbHN0b3JhZ2UgdG8gYXBwZWFycyBhcyBmaWxlIGFscmVhZHkgZG93bmxvYWRlZCwgdXNlciBjYW4gcmUtZG93bmxvYWQgaWYgbmVlZGVkXG4gICAgICAgICovXG4gICAgICAgIHJldHVybiAhIWFwaS5nZXRGaWxlc0Zyb21Mb2NhbFN0b3JhZ2UoKVtmaWxlUGF0aF07XG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuaXNEb3dubG9hZGluZyA9IGZ1bmN0aW9uKGZpbGVQYXRoKSB7XG4gICAgICAgIHJldHVybiAhIWZpbGVUcmFuc2ZlcnNbZmlsZVBhdGhdOyAgICAgXG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuZ2V0RmlsZVN0YXR1cyA9IGZ1bmN0aW9uKGZpbGVQYXRoKSB7XG4gICAgICAgIGlmIChhcGkuaXNEb3dubG9hZGVkKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZGVkO1xuICAgICAgICB9IGVsc2UgaWYgKGFwaS5pc0Rvd25sb2FkaW5nKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZGluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc3RhdHVzZXMuZG93bmxvYWQ7IFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIFxuICAgICAgLyoqXG4gICAgICAqIFNlcnZpY2UgbWV0aG9kcywgdGhhdCBhcmUgcHVibGljIGFuZCBhdmFpbGFibGUgZm9yIGFueSByZXNvdXJjZVxuICAgICAgKi9cbiAgICAgIC8vIEZpbGUgYXZhaWxhYmxlIHN0YXR1c2VzLCBiZXN0IGZvciBkZWJ1ZyBhbmQgbWFpdGFpbiB0aGFuIGp1c3Qgc3RyaW5nLlxuICAgICAgXG4gICAgICBzZXJ2aWNlLmRvd25sb2FkID0gZG93bmxvYWQ7XG4gICAgICBzZXJ2aWNlLmRlY29yYXRlRmlsZSA9IGRlY29yYXRlRmlsZTtcbiAgICAgIHNlcnZpY2UucmVtb3ZlID0gcmVtb3ZlO1xuICAgICAgc2VydmljZS5saXN0ID0gYXBpLmdldEZpbGVzRnJvbUxvY2FsU3RvcmFnZTtcbiAgICAgIHNlcnZpY2Uub3BlbiA9IG9wZW47XG4gICAgICBzZXJ2aWNlLmlzRG93bmxvYWRhYmxlID0gaXNEb3dubG9hZGFibGU7XG4gICAgICBzZXJ2aWNlLm9wZW5GaWxlT3BlbmVyID0gb3BlbkZpbGVPcGVuZXI7XG4gICAgICBcbiAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgXG4gICAgICAvKlxuICAgICAgSW5zdGFsbDogY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLWZpbGUtb3BlbmVyMlxuICAgICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29yZG92YS1wbHVnaW4tZmlsZS1vcGVuZXIyXG4gICAgICAqL1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBpc0Rvd25sb2FkYWJsZShmaWxlKSB7XG4gICAgICAgIHJldHVybiAoZmlsZS50eXBlIGluIE1JTUVTKSA/IE1JTUVTW2ZpbGUudHlwZV0uZG93bmxvYWQgOiB0cnVlO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBvcGVuRmlsZU9wZW5lcih1cmksIHR5cGUpIHtcbiAgICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIGNvcmRvdmEucGx1Z2lucy5maWxlT3BlbmVyMi5vcGVuKHVyaSwgdHlwZSwge1xuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgICAgfSwgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcS5yZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIG9wZW4oZmlsZSkge1xuICAgICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG4gICAgICAgIHZhciBjYl9lbnRyeSA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgICAgb3BlbkZpbGVPcGVuZXIoZW50cnkudG9VUkwoKSwgZmlsZS50eXBlKS50aGVuKFxuICAgICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHEucmVqZWN0KGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgZmlsZS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5wYXRoKTtcbiAgICAgICAgYXBpLmdldEZpbGVFbnRyeShmaWxlLmZ1bGxQYXRoKVxuICAgICAgICAudGhlbihmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgIGNiX2VudHJ5LnN1Y2Nlc3MoZW50cnkpO1xuICAgICAgICB9LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgY2JfZW50cnkuZmFpbChlKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgICAgXG4gICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgIH07XG4gICAgICBcbiAgICBmdW5jdGlvbiBkb3dubG9hZChmaWxlKSB7XG4gICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG4gICAgICB2YXIgZnQgPSBuZXcgRmlsZVRyYW5zZmVyKCk7XG4gICAgICB2YXIgdXJpID0gZW5jb2RlVVJJKGZpbGUudXJsKTtcbiAgICAgICAgXG4gICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkaW5nO1xuICAgICAgZmlsZS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5wYXRoKTtcbiAgICAgIGZpbGVUcmFuc2ZlcnNbZmlsZS5wYXRoXSA9IGZ0O1xuXG4gICAgICBmdC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKHByb2dyZXNzKSB7XG4gICAgICAgIHEubm90aWZ5KHByb2dyZXNzKTtcbiAgICAgIH07XG5cbiAgICAgIHEucHJvbWlzZS5hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnQuYWJvcnQoKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBjYl9kb3dubG9hZCA9IHtcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZmlsZUVudHJ5KSB7XG4gICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZGVkO1xuICAgICAgICAgIGFwaS5hZGRGaWxlKGZpbGUpO1xuICAgICAgICAgIGRlbGV0ZSBmaWxlVHJhbnNmZXJzW2ZpbGUucGF0aF07XG4gICAgICAgICAgcS5yZXNvbHZlKGZpbGUpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsOiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICRsb2cuZGVidWcoZXJyb3IpO1xuICAgICAgICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWQ7XG4gICAgICAgICAgZXJyb3IgPSBhcGkuZmlsZVRyYW5zZmVyRXJyb3JIYW5kbGVyKGVycm9yKTtcbiAgICAgICAgICBkZWxldGUgZmlsZVRyYW5zZmVyc1tmaWxlLnBhdGhdO1xuICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGZ0LmRvd25sb2FkKHVyaSwgZmlsZS5mdWxsUGF0aCwgY2JfZG93bmxvYWQuc3VjY2VzcywgY2JfZG93bmxvYWQuZmFpbCwgZmFsc2UpO1xuICAgICAgICBcbiAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgfTtcbiAgICAgIFxuICAgIGZ1bmN0aW9uIHJlbW92ZShmaWxlKSB7XG4gICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIGZpbGUuZnVsbFBhdGggPSBhcGkuZ2V0RmlsZUZ1bGxQYXRoKGZpbGUucGF0aCk7XG4gICAgICBhcGkuZ2V0RmlsZUVudHJ5KGZpbGUuZnVsbFBhdGgpXG4gICAgICAudGhlbihmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICBlbnRyeS5yZW1vdmUoXG4gICAgICAgICAgZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgYXBpLnJlbW92ZUZpbGUoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWQ7XG4gICAgICAgICAgICBxLnJlc29sdmUoZmlsZSk7XG4gICAgICAgICAgfSxmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkO1xuICAgICAgICBxLnJlamVjdChlcnJvcik7XG4gICAgICB9XG4gICAgKTtcbiAgICAgICAgXG4gICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgfVxuICAgICAgXG4gIGZ1bmN0aW9uIGRlY29yYXRlRmlsZShmaWxlKSB7XG4gICAgZmlsZS5uYW1lID0gZmlsZS5uYW1lIHx8IGFwaS5nZXRGaWxlTmFtZShmaWxlKTtcbiAgICBmaWxlLnBhdGggPSBmaWxlLnBhdGggfHwgYXBpLmdldEZpbGVQYXRoKGZpbGUubmFtZSk7XG4gICAgZmlsZS5zdGF0dXMgPSBhcGkuZ2V0RmlsZVN0YXR1cyhmaWxlLnBhdGgpO1xuICAgICAgICBcbiAgICAvKlxuICAgIElmIGRldmljZSBub3QgZXhpc3RzIHRoZW4gYXBwIHJ1biBvbiBicm93c2VyXG4gICAgKi9cbiAgICBpZiAoIXR5cGVvZihkZXZpY2UpKSB7XG4gICAgICB2YXIgZnVsbFBhdGggPSBhcGkuZ2V0RmlsZUZ1bGxQYXRoKGZpbGUucGF0aCk7XG4gICAgICBpZiAoYXBpLmlzRG93bmxvYWRlZChmdWxsUGF0aCkpXG4gICAgICAgIGZpbGUuZnVsbFBhdGggPSBmdWxsUGF0aDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZpbGU7XG4gIH07XG59O1xufTtcbiAgXG5mdW5jdGlvbiBtZWRpYUNsaWNrTGFiZWwoTUlNRVMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gTUlNRVNbdHlwZV0gPyBNSU1FU1t0eXBlXS5sYWJlbCA6ICdPcGVuJztcbiAgfTtcbn1cblx0XG5mdW5jdGlvbiBtZWRpYUljb25DbGFzcyhNSU1FUykge1xuICByZXR1cm4gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiBNSU1FU1t0eXBlXSA/IE1JTUVTW3R5cGVdLmNsYXNzIDogJ2ZhLWV4dGVybmFsLWxpbmsnO1xuICB9O1xufVxuICBcbmZ1bmN0aW9uIG1lZGlhT3BlbkNsYXNzKE1JTUVTKSB7XG4gIHJldHVybiBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIChNSU1FU1t0eXBlXSAmJiBNSU1FU1t0eXBlXS5vcGVuQ2xhc3MgKT8gTUlNRVNbdHlwZV0ub3BlbkNsYXNzIDogJ2ZhLWV5ZSc7XG4gIH07XG59XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmRpYWxvZ3MnLCBbXSlcblx0LmZhY3RvcnkoJ21ldURpYWxvZ3MnLCBtZXVEaWFsb2dzKTtcbiAgXG4gIC8qXG4gICAgaW5zdGFsbCAgIDogICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBjb3Jkb3ZhLXBsdWdpbi1kaWFsb2dzIG5sLngtc2VydmljZXMucGx1Z2lucy50b2FzdFxuICAgIGxpbmsgICAgICA6ICAgICBodHRwczovL2dpdGh1Yi5jb20vYXBhY2hlL2NvcmRvdmEtcGx1Z2luLWRpYWxvZ3NcbiAgICBsaW5rICAgICAgOiAgICAgaHR0cHM6Ly9naXRodWIuY29tL0VkZHlWZXJicnVnZ2VuL1RvYXN0LVBob25lR2FwLVBsdWdpbiAgXG4gICovXG4gIFxuICBmdW5jdGlvbiBtZXVEaWFsb2dzKCRxLCAkd2luZG93KSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmFsZXJ0ID0gYWxlcnQ7XG4gICAgc2VydmljZS5jb25maXJtID0gY29uZmlybTtcbiAgICBzZXJ2aWNlLnRvYXN0ID0gdG9hc3Q7XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgZnVuY3Rpb24gYWxlcnQgKG1lc3NhZ2UsIHRpdGxlLCBidXR0b25OYW1lKSB7XG4gICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIGlmICghJHdpbmRvdy5uYXZpZ2F0b3Iubm90aWZpY2F0aW9uKSB7XG4gICAgICAgICR3aW5kb3cuYWxlcnQobWVzc2FnZSk7XG4gICAgICAgIHEucmVzb2x2ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmF2aWdhdG9yLm5vdGlmaWNhdGlvbi5hbGVydChtZXNzYWdlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcS5yZXNvbHZlKCk7XG4gICAgICAgIH0sIHRpdGxlLCBidXR0b25OYW1lKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICB9O1xuICAgIFxuICAgIGZ1bmN0aW9uIGNvbmZpcm0gKG1lc3NhZ2UsIHRpdGxlLCBidXR0b25MYWJlbHMpIHtcbiAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcblxuICAgICAgaWYgKCEkd2luZG93Lm5hdmlnYXRvci5ub3RpZmljYXRpb24pIHtcbiAgICAgICAgaWYgKCR3aW5kb3cuY29uZmlybShtZXNzYWdlKSkge1xuICAgICAgICAgIHEucmVzb2x2ZSgxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBxLnJlc29sdmUoMik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5hdmlnYXRvci5ub3RpZmljYXRpb24uY29uZmlybShtZXNzYWdlLCBmdW5jdGlvbiAoYnV0dG9uSW5kZXgpIHtcbiAgICAgICAgICBxLnJlc29sdmUoYnV0dG9uSW5kZXgpO1xuICAgICAgICB9LCB0aXRsZSwgYnV0dG9uTGFiZWxzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICB9O1xuICAgIFxuICAgIGZ1bmN0aW9uIHRvYXN0IChtZXNzYWdlKSB7XG4gICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG5cdFx0XHR2YXIgdG9hc3QgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnRvYXN0O1xuICAgICAgXG5cdFx0XHRpZiAodG9hc3QpIHtcbiAgICAgICAgdG9hc3Quc2hvd0xvbmdCb3R0b20obWVzc2FnZSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgcS5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgIH07XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuY2FsZW5kYXInLCBbXSlcblx0LmZhY3RvcnkoJ21ldUNhbGVuZGFyJywgWyckcScsICckd2luZG93JywgJ3N0cmlwdGFnc0ZpbHRlcicsICdicjJubEZpbHRlcicsIG1ldUNhbGVuZGFyXSk7XG4gIFxuICAvKlxuICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBodHRwczovL2dpdGh1Yi5jb20vRWRkeVZlcmJydWdnZW4vQ2FsZW5kYXItUGhvbmVHYXAtUGx1Z2luLmdpdFxuICAgIElmIHN0YXJ0IGFuZCBlbmRfZGF0ZSBlcXVhbCAwMDowMCB0aGVuIHRoZSBldmVudCBvY2N1cnMgYWxsIGRheSBsb25nXG4gICovXG4gIFxuICBmdW5jdGlvbiBtZXVDYWxlbmRhcigkcSwgJHdpbmRvdywgc3RyaXB0YWdzLCBicjJubCkge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5jcmVhdGVFdmVudEludGVyYWN0aXZlbHkgPSBjcmVhdGVFdmVudEludGVyYWN0aXZlbHk7XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgZnVuY3Rpb24gY3JlYXRlRXZlbnRJbnRlcmFjdGl2ZWx5KG9wdGlvbnMpIHtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKSxcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgICAgdGl0bGU6IG51bGwsXG4gICAgICAgICAgYWRkcmVzczogbnVsbCxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgc3RhcnRfZGF0ZTogbnVsbCxcbiAgICAgICAgICBlbmRfZGF0ZTogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICBkZWZhdWx0T3B0aW9ucyA9IGFuZ3VsYXIuZXh0ZW5kKGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgJHdpbmRvdy5wbHVnaW5zLmNhbGVuZGFyLmNyZWF0ZUV2ZW50SW50ZXJhY3RpdmVseShcbiAgICAgICAgc3RyaXB0YWdzKGRlZmF1bHRPcHRpb25zLnRpdGxlKSxcbiAgICAgICAgc3RyaXB0YWdzKGRlZmF1bHRPcHRpb25zLmFkZHJlc3MpLFxuICAgICAgICBzdHJpcHRhZ3MoYnIybmwoZGVmYXVsdE9wdGlvbnMuZGVzY3JpcHRpb24pKSxcbiAgICAgICAgbmV3IERhdGUoZGVmYXVsdE9wdGlvbnMuc3RhcnRfZGF0ZSAgKiAxMDAwKSxcbiAgICAgICAgbmV3IERhdGUoZGVmYXVsdE9wdGlvbnMuZW5kX2RhdGUgICogMTAwMCksXG4gICAgICAgIGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgZC5yZXNvbHZlKG1lc3NhZ2UpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuYXV0aGVudGljYXRpb24nLCBbXSlcbiAgLmZhY3RvcnkoJ21ldUF1dGhlbnRpY2F0aW9uJywgbWV1QXV0aGVudGljYXRpb24pO1xuICBcbiAgLypcbiAgSW5zcGlyZWQgYnkgSmFzb24gV2F0bW9yZSBCbG9nIFBvc3RcbiAgaHR0cDovL2phc29ud2F0bW9yZS5jb20vcG9zdC8yMDE0LzA1LzI2L2FuZ3VsYXJqcy1iYXNpYy1odHRwLWF1dGhlbnRpY2F0aW9uLWV4YW1wbGVcbiAgKi9cblxuICBmdW5jdGlvbiBtZXVBdXRoZW50aWNhdGlvbigkaHR0cCwgJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIHNlcnZpY2UuU2V0Q3JlZGVudGlhbHMgPSBmdW5jdGlvbiAoZGF0YSkgeyBcbiAgICAgIC8qXG4gICAgICAqICBkYXRhLnZpc2l0b3IgJiYgZGF0YS50b2tlblxuICAgICAgKi9cbiAgICAgICRyb290U2NvcGUuYXV0aCA9IGRhdGE7XG5cbiAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLVZpc2l0b3ItVG9rZW4nXSA9IGRhdGEudG9rZW47XG4gICAgICBsb2NhbFN0b3JhZ2UuZ2xvYmFscyA9IGFuZ3VsYXIudG9Kc29uKCRyb290U2NvcGUuYXV0aCk7XG4gICAgfTtcblxuICAgIHNlcnZpY2UuQ2xlYXJDcmVkZW50aWFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICRyb290U2NvcGUuYXV0aCA9IHt9O1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2F1dGgnKTtcbiAgICAgIGRlbGV0ZSAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1WaXNpdG9yLVRva2VuJ107XG4gICAgfTtcblxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuICBcblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuYW5hbHl0aWNzJywgW10pXG5cdC5mYWN0b3J5KCdnb29nbGVBbmFseXRpY3NDb3Jkb3ZhJywgZ29vZ2xlQW5hbHl0aWNzQ29yZG92YSlcblx0LmZhY3RvcnkoJ2dvb2dsZUFuYWx5dGljcycsIGdvb2dsZUFuYWx5dGljcylcbiAgLmZhY3RvcnkoJyRjb3Jkb3ZhR29vZ2xlQW5hbHl0aWNzJywgJGNvcmRvdmFHb29nbGVBbmFseXRpY3MpXG5cdC5mYWN0b3J5KCdtZXVBbmFseXRpY3MnLCBtZXVBbmFseXRpY3MpO1xuICBcbiAgLypcbiAgICBJbnNwaXJlZCBieSBuZ0NvcmRvdmFcbiAgICBXZSd2ZSBleHRyYWN0ZWQgb25seSByZXF1aXJlZCBtZXRob2RzIFxuICBcbiAgICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGh0dHBzOi8vZ2l0aHViLmNvbS9kYW53aWxzb24vZ29vZ2xlLWFuYWx5dGljcy1wbHVnaW4uZ2l0XG4gICovXG5cbiAgZnVuY3Rpb24gJGNvcmRvdmFHb29nbGVBbmFseXRpY3MoJHEsICR3aW5kb3csICRsb2cpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2Uuc3RhcnRUcmFja2VyV2l0aElkID0gc3RhcnRUcmFja2VyV2l0aElkO1xuICAgIHNlcnZpY2UuZGVidWdNb2RlID0gZGVidWdNb2RlO1xuICAgIHNlcnZpY2UudHJhY2tWaWV3ID0gdHJhY2tWaWV3O1xuICAgIHNlcnZpY2UudHJhY2tFdmVudCA9IHRyYWNrRXZlbnQ7XG4gICAgc2VydmljZS5zZXRVc2VySWQgPSBzZXRVc2VySWQ7XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICBmdW5jdGlvbiBzZXRVc2VySWQoaWQpIHtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGxvZy5kZWJ1ZygnU2V0IFVzZXIgSWQ6ICcgKyBpZCk7XG4gICAgICBcbiAgICAgICR3aW5kb3cuYW5hbHl0aWNzLnNldFVzZXJJZChpZCwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGQucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RhcnRUcmFja2VyV2l0aElkKGlkKSB7XG4gICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRsb2cuZGVidWcoJ1N0YXJ0IHRyYWNraW5nIEdBIElkOiAnICsgaWQpO1xuXG4gICAgICAkd2luZG93LmFuYWx5dGljcy5zdGFydFRyYWNrZXJXaXRoSWQoaWQsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBkLnJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRlYnVnTW9kZSgpIHtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJHdpbmRvdy5hbmFseXRpY3MuZGVidWdNb2RlKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBkLnJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBkLnJlamVjdCgpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdHJhY2tWaWV3KHNjcmVlbk5hbWUpIHtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgIFxuICAgICAgJGxvZy5kZWJ1ZygnVHJhY2sgVmlldzogJyArIHNjcmVlbk5hbWUpO1xuICAgICAgXG4gICAgICAkd2luZG93LmFuYWx5dGljcy50cmFja1ZpZXcoc2NyZWVuTmFtZSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGQucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdHJhY2tFdmVudChjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCwgdmFsdWUpIHtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgdmFyIGV2ID0gW2NhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZV07XG4gICAgICAkbG9nLmRlYnVnKCdUcmFjayBFdmVudDogJyArIGV2LnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICAkd2luZG93LmFuYWx5dGljcy50cmFja0V2ZW50KGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGQucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuICB9XG5cdFx0XG5cdGZ1bmN0aW9uIGdvb2dsZUFuYWx5dGljc0NvcmRvdmEoJGNvcmRvdmFHb29nbGVBbmFseXRpY3MsICRsb2cpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuaW5pdCA9IGluaXQ7XG4gICAgc2VydmljZS5kZWJ1Z01vZGUgPSAkY29yZG92YUdvb2dsZUFuYWx5dGljcy5kZWJ1Z01vZGU7XG4gICAgc2VydmljZS50cmFja1ZpZXcgPSAkY29yZG92YUdvb2dsZUFuYWx5dGljcy50cmFja1ZpZXc7XG4gICAgc2VydmljZS50cmFja0V2ZW50ID0gJGNvcmRvdmFHb29nbGVBbmFseXRpY3MudHJhY2tFdmVudDtcbiAgICBzZXJ2aWNlLnN0YXJ0VHJhY2tlcldpdGhJZCA9ICRjb3Jkb3ZhR29vZ2xlQW5hbHl0aWNzLnN0YXJ0VHJhY2tlcldpdGhJZDtcbiAgICBzZXJ2aWNlLnNldFVzZXJJZCA9ICRjb3Jkb3ZhR29vZ2xlQW5hbHl0aWNzLnNldFVzZXJJZDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBpbml0KHRyYWNrSWQpIHtcbiAgICAgICRjb3Jkb3ZhR29vZ2xlQW5hbHl0aWNzLnN0YXJ0VHJhY2tlcldpdGhJZCh0cmFja0lkKTtcbiAgICB9XG5cdH1cbiAgXG5cdGZ1bmN0aW9uIGdvb2dsZUFuYWx5dGljcygkbG9nLCAkcSkge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5pbml0ID0gaW5pdDtcbiAgICBzZXJ2aWNlLmRlYnVnTW9kZSA9IGRlYnVnTW9kZTtcbiAgICBzZXJ2aWNlLnRyYWNrVmlldyA9IHRyYWNrVmlldztcbiAgICBzZXJ2aWNlLnRyYWNrRXZlbnQgPSB0cmFja0V2ZW50O1xuICAgIHNlcnZpY2Uuc3RhcnRUcmFja2VyV2l0aElkICA9IHN0YXJ0VHJhY2tlcldpdGhJZDtcbiAgICBzZXJ2aWNlLnNldFVzZXJJZCA9IHNldFVzZXJJZDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBpbml0KHRyYWNrSWQpIHtcbiAgICAgICRsb2cuZGVidWcoJ0dvb2dsZSBBbmFseXRpY3MgdHJhY2sgSWQ6ICcgKyB0cmFja0lkKTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gZGVidWdNb2RlKCkge1xuICAgICAgJGxvZy5kZWJ1ZygnRW5hYmxlIERlYnVnJyk7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHRyYWNrVmlldyh0aXRsZSkge1xuICAgICAgJGxvZy5kZWJ1ZygnVHJhY2tpbmcgUGFnZTogJyArIHRpdGxlKTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gdHJhY2tFdmVudChjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCwgdmFsdWUpIHtcbiAgICAgICRsb2cuZGVidWcoJ1RyYWNraW5nIEV2ZW50OiAnICsgYWN0aW9uKTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gc3RhcnRUcmFja2VyV2l0aElkKGlkKSB7XG4gICAgICB2YXIgbXNnID0gJ1RyYWNraW5nIEdBIElkOiAnICsgaWQ7XG4gICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIGQucmVzb2x2ZShtc2cpO1xuXG4gICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBzZXRVc2VySWQoaWQpIHtcbiAgICAgICRsb2cuZGVidWcoJ1RyYWNraW5nIFVzZXI6ICcgKyBpZCk7XG4gICAgfVxuXHR9XG4gIFxuXHRmdW5jdGlvbiBtZXVBbmFseXRpY3MoJGluamVjdG9yLCAkd2luZG93KSB7XG5cblx0XHRpZiAoJHdpbmRvdy5jb3Jkb3ZhKSB7XG5cdFx0XHRyZXR1cm4gJGluamVjdG9yLmdldCgnZ29vZ2xlQW5hbHl0aWNzQ29yZG92YScpO1xuXHRcdH0gZWxzZSB7XG5cdFx0ICByZXR1cm4gJGluamVjdG9yLmdldCgnZ29vZ2xlQW5hbHl0aWNzJyk7XG5cdFx0fVxuXHR9XG59KSgpOyIsIi8qIGdsb2JhbCBhbmd1bGFyICovXG4vKiBlc2xpbnQgbm8tdW5kZWY6IFwiZXJyb3JcIiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuZmlsdGVycycsIFtdKVxuICAuZmlsdGVyKCdpc0VtcHR5JywgaXNFbXB0eSlcbiAgLmZpbHRlcignYnIybmwnLCBicjJubClcbiAgLmZpbHRlcignc3RyaXB0YWdzJywgc3RyaXB0YWdzKTtcblxuICBmdW5jdGlvbiBpc0VtcHR5KCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gIU9iamVjdC5rZXlzKG9iaikubGVuZ3RoO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBicjJubCgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoLzxiclxccypbXFwvXT8+L2dpLCAnXFxuJyk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0cmlwdGFncygpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiBhbmd1bGFyXG4gICAgICAgICAgLmVsZW1lbnQoJzxkaXYvPicpXG4gICAgICAgICAgLmh0bWwodGV4dClcbiAgICAgICAgICAudGV4dCgpO1xuICAgIH07XG4gIH1cbn0pKCk7XG4iLCIvKiBnbG9iYWwgYW5ndWxhciAqL1xuLyogZXNsaW50IG5vLXVuZGVmOiBcImVycm9yXCIgKi9cbi8qXG4gIFRPRE86IHNob3VsZCByZWxlYXNlIG1pbmlmaWVkICgubWluLmpzKSBhbmQgbm90ICguanMpXG4qL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMnLCBbXG4gICAgLy8nbmdNZXVtb2JpLlV0aWxzLmZpbGVzJyxcbiAgICAvLyduZ01ldW1vYmkuVXRpbHMuYXBpJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLmxvYWRpbmcnLFxuICAgIC8vJ25nTWV1bW9iaS5VdGlscy5jb25uZWN0aW9uJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLnBob25lQ2FsbCcsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5jYWxlbmRhcicsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5hbmFseXRpY3MnLFxuICAgICduZ01ldW1vYmkuVXRpbHMuc29jaWFsU2hhcmluZycsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5kaWFsb2dzJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLmZpbGVzJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLmF1dGhlbnRpY2F0aW9uJ1xuICAgIC8vJ25nTWV1bW9iaS5VdGlscy5maWx0ZXJzJ1xuICBdKTtcbiAgXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
