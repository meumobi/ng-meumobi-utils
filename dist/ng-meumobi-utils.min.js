(function() {
	'use strict';

	angular
	.module('ngMeumobi.Utils.socialSharing', [])
	.factory('meuSocialSharing', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', '$log', meuSocialSharing]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin
  */
  
  function meuSocialSharing($q, $window, striptags, br2nl, $log) {
    
    var service = {};
    var options = {
      postfix: ''
    };
    
    service.shareItem = shareItem;
    service.shareMedia = shareMedia;
    service.setOption = setOption;
    service.setOptions = setOptions;
    service.share = share;
    service.shareViaWhatsAppToReceiver = shareViaWhatsAppToReceiver;
    
    return service;

    function setOptions(options) {
      angular.extend(options, options);
    }

    function setOption(name, value) {
      options[name] = value;
    }

		function shareViaWhatsAppToReceiver(receiver) {
      var social = $window.plugins && $window.plugins.socialsharing;
		  
      social.shareViaWhatsAppToReceiver(receiver, 'Message via WhatsApp', null /* img */, null /* url */, function() {$log.debug('share ok');});
		}
    
    function shareItem(item) {
			
			var params = {
			  message: item.description,
        subject: item.title,
        files: [],
        url: item.hasOwnProperty('link') ? item.link : null
			};

      if (item.thumbnails && item.thumbnails.length > 0) {
				params.files.push(item.thumbnails[0].url);
			}

			return share(params);
		}

		function shareMedia(media) {

			var params = {
			  message: media.title,
        subject: media.title,
        files: [],
        url: media.url
			};
			
			// If media is saved locally (media.path) then share it
			// Else share its link (media.url)
			// Couldn't share together local pdf and link
			if (media.hasOwnProperty('fullPath')) {
				params.files.push(media.fullPath);
				params.url = null;
			} else if (media.thumbnails && media.thumbnails.length > 0) {
				params.files.push(media.thumbnails[0].url);
			}
			
			return share(params);
		}
		
		function share(params) {
    /*
      this is the complete list of currently supported params you can pass to the plugin (all optional)
      var options = {
        message: 'share this', // not supported on some apps (Facebook, Instagram)
        subject: 'the subject', // fi. for email
        files: ['', ''], // an array of filenames either locally or remotely
        url: 'https://www.website.com/foo/#bar?a=b',
        chooserTitle: 'Pick an app' // Android only, you can override the default share sheet title
      }
    */
      var d = $q.defer();			
      var social = $window.plugins && $window.plugins.socialsharing;
      
      // If params.description is null
    
			if (social) {
        if (options.postfix) {
  				params.subject += options.postfix;
        }
      
        params.message = params.message && striptags(br2nl(params.message));
        params.subject = params.subject && striptags(br2nl(params.subject));
        var cb_share = {
          success: function(result) {
            d.resolve(result);
          },
          fail: function(msg) {
            d.reject(msg);
          }  
        };
        
        $log.debug('shareWithOptions');
        $log.debug(params);
        social.shareWithOptions(params, cb_share.success, cb_share.fail); 
			} else {
			  d.reject('Plugin socialsharing missing');
			}
      
      return d.promise;
		}
  }
})();
(function() {
	'use strict';

  initPushwoosh.$inject = ["$log", "$window", "$document", "$exceptionHandler"];
	OneSignalImpl.$inject = ["$log", "$window", "$exceptionHandler", "$rootScope"];
	angular
	.module('ngMeumobi.Utils.push', [])
	
	.factory('pushwoosh', initPushwoosh)
	.factory('onesignal', OneSignalImpl);
  
  /*
    https://www.npmjs.com/package/pushwoosh-pgb-plugin
    http://docs.pushwoosh.com/docs/phonegap-build
  */
  function initPushwoosh($log, $window, $document, $exceptionHandler) {
        
    var service = {};
    
    service.config = config;
    service.register = register;
    
    return service;
    
    var googleProjectNumber;
    var applicationCode;
	
    function config(g, a) {
      googleProjectNumber = g;
      applicationCode = a;
    };
    
    // Initialize Pushwoosh. This will trigger all pending push notifications on start.
    function register(success, fail) {
      
      try {   
        var pushNotification = angular.isDefined($window.cordova) && $window.cordova.require('pushwoosh-cordova-plugin.PushNotification');
      
        if (pushNotification) {
          // Should be called before pushwoosh.onDeviceReady
          $document.on('push-notification', function(event) {
            var notification = event.notification;
            /*
            handle push open here
            notification.message
            notification.userData = {
              'category_id': ...,
              'item_id': ...
            }
            */ 
            $log.debug('event.notification');
            $log.debug(notification);
          });

          pushNotification.onDeviceReady({ 
            projectid: googleProjectNumber,
            pw_appid: applicationCode}
          );

          //register for push notifications
          pushNotification.registerDevice(
            function(status) {
              var pushIds = {};
              
              pushIds.token = status.pushToken;
              success(pushIds);
            }, 
            function(status) {
              throw new Error('Push: Can\'t register device');
              fail(status);
            }
          );
          //clear the app badge
          pushNotification.setApplicationIconBadgeNumber(0);
        } else {
          throw new Error('Missing Plugin: pushwoosh-cordova-plugin');
        }
      } catch (error) {
        $exceptionHandler(error);
      }
    };
  }
	
  /*
    https://www.npmjs.com/package/onesignal-cordova-plugin
    https://documentation.onesignal.com/docs/phonegap-sdk
  */
  
	function OneSignalImpl($log, $window, $exceptionHandler, $rootScope) {

    var service = {};
    
    service.config = config;
    service.register = register;
    
    return service;
    
    var googleProjectNumber;
		var appId;
	
		function config(g, a) {
			googleProjectNumber = g;
			appId = a;
		};
		
  /**
   * @ngdoc function
   * @name ngMeumobi.Utils.push.meuPush#setProvider
   * @methodOf ngMeumobi.Utils.push.meuPush
   *
   * @description
   * Sets current Push provider (by default 'pushwoosh').
   *
   * @param {string} provider name {'pushwoosh', 'onesignal'}.
   */
    
    function register(success, error) {
      try {
        var pushNotification = $window.plugins && $window.plugins.OneSignal;

        if (pushNotification) {
          $log.debug('Plugin OneSignal loaded');
        
          var iosSettings = {};
          iosSettings['kOSSettingsKeyAutoPrompt'] = true;
          iosSettings['kOSSettingsKeyInAppLaunchURL'] = false;
          
          var didReceiveRemoteNotificationCallBack = function(jsonData) {
            $rootScope.$emit('receive-notification', angular.toJson(jsonData));
          };
          var didOpenRemoteNotificationCallBack = function(jsonData) {
            $rootScope.$emit('open-notification', angular.toJson(jsonData));
          };

          pushNotification.startInit(appId)
          .handleNotificationReceived(didReceiveRemoteNotificationCallBack)
          .handleNotificationOpened(didOpenRemoteNotificationCallBack)
          .inFocusDisplaying(pushNotification.OSInFocusDisplayOption.None)
          .iOSSettings(iosSettings)
          .endInit();
          
          pushNotification.getIds(function(ids) {
            var pushIds = {};
            pushIds.token = ids.pushToken;
            pushIds.uuid = ids.userId;
            success(pushIds);
          });
          
          pushNotification.getTags(function(tags) {
            //alert('get Push Tags:\n' + angular.toJson(tags));
            $log.debug('Tags Received: ' + angular.toJson(tags));
          });
        } else {
          throw new Error('Missing Plugin: onesignal-cordova-plugin');
        }
      } catch (error) {
        $exceptionHandler(error);
      }
    };
	}
})();
(function() {
	'use strict';
  
	phoneCallCordova.$inject = ["$log", "$window", "$q"];
	phoneCall.$inject = ["$log", "$window", "$q"];
	meuPhoneCall.$inject = ["$injector", "$window"];
	angular
	.module('ngMeumobi.Utils.phoneCall', [])
	.factory('phoneCallCordova', phoneCallCordova)
	.factory('phoneCall', phoneCall)
	.factory('meuPhoneCall', meuPhoneCall);
  
  /*
    install   :     cordova plugin add https://github.com/Rohfosho/CordovaCallNumberPlugin.git
  
    npm install https://www.npmjs.com/package/call-number
  
    How to use it: 
    meuPhoneCall(number, true)
    .then(function(result) {})
    .catch(function(error) {});
  */
		
	function phoneCallCordova($log, $window, $q) {
    
    var service = {};
    
    service.call = call;
    
    return service;
    
    function call(number, bypassAppChooser) {
      
      if (angular.isUndefined(bypassAppChooser)) {
        bypassAppChooser = false;
      }
      
      return $q(function (resolve, reject) {
        
        var cb_callNumber = {
          success: function(result) {
            resolve(result);
          },
          fail: function(result) {
            $log.debug(result);
            reject(result);
          }
        };
        
				var CallNumber = $window.plugins && $window.plugins.CallNumber;
        
        if (CallNumber) {
          CallNumber.callNumber(cb_callNumber.success, cb_callNumber.fail, number, bypassAppChooser);
        } else {
          throw new Error('Missing CordovaCallNumber Plugin');
        }       
      });
    }
	}
  
	function phoneCall($log, $window, $q) {
    
    var service = {};
    
    service.call = call;
    
    return service;
    
    function call(number, bypassAppChooser) {
      
      if (angular.isUndefined(bypassAppChooser)) {
        bypassAppChooser = false;
      }
      
      return $q(function (resolve, reject) {
        var passedNumber = encodeURIComponent(number);
        $window.location = 'tel:' + passedNumber;
        resolve();
      });
    }
	}
  
	function meuPhoneCall($injector, $window) {

    var CallNumber = $window.plugins && $window.plugins.CallNumber;
    
		if ($window.cordova && CallNumber) {
			return $injector.get('phoneCallCordova');
		} else {
		  return $injector.get('phoneCall');
		}
	}
})();
(function() {
	'use strict';

	loadingInterceptor.$inject = ["$q", "$rootScope", "$log"];
	angular
	.module('ngMeumobi.Utils.loading', [])
	.factory('loadingInterceptor', loadingInterceptor);
	
	function loadingInterceptor($q, $rootScope, $log) {
		
		var numLoadings = 0;
		
		return {
			request: function(config) {
        if (!numLoadings++) {
          $rootScope.$broadcast('loading:start');
        }

				return config || $q.when(config);
			},
			response: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return response || $q.when(response);
			},
			requestError: function(request) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return $q.reject(request);
			},
			responseError: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}
				
				return $q.reject(response);
			}
		};
	}
})();

(function () {
  'use strict';
  
mediaClickLabel.$inject = ["MIMES"];
mediaIconClass.$inject = ["MIMES"];
mediaOpenClass.$inject = ["MIMES"];
  angular
  .module('ngMeumobi.Utils.files', ['slugifier'])
  .constant('MIMES', {
    'application/pdf': {
      class: 'fa-file-pdf-o',
      label: 'View',
      extension: 'pdf',
      download: true
    },
    'text/html': {
      class: 'fa-rss',
      label: 'Open',
      extension: 'html',
      download: false
    },
    'application/vnd.youtube.video+html': {
      class: 'fa-youtube-play',
      openClass: 'fa-play',
      label: 'Play',
      extension: 'html',
      download: false
    },
    'application/vnd.ms-excel': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    },
    'audio/mpeg': {
      class: 'fa-file-audio-o',
      label: 'Play',
      openClass: 'fa-play',
      extension: 'mp3',
      download: true
    },
    'application/vnd.ms-powerpoint': {
      class: 'fa-file-powerpoint-o',
      label: 'View',
      extension: 'ppt',
      download: true,
    },
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    }
  })
  .filter('mediaClickLabel', mediaClickLabel)
  .filter('mediaIconClass', mediaIconClass)
  .filter('mediaOpenClass', mediaOpenClass) 
  .provider('meuFiles', meuFiles); 
        
  function meuFiles() {
    var fileTransfers = {};
    var files = {};
    var options = {
      localFolder: 'Downloads'
    };
    var statuses = {
      download: 'download',
      downloading: 'downloading',
      downloaded: 'downloaded'
    };
    
    this.setOptions = function(options) {
      angular.extend(options, options);
    };

    this.setOption = function(name, value) {
      options[name] = value;
    };

    this.$get = ["$q", "$log", "$window", "MIMES", "Slug", function($q, $log, $window, MIMES, Slug) {
      var api = {};
      var service = {};
      
      /**
      *  Api methods, available only on the inside the service
      */

      api.fileErrorHandler = function(e) {
        /*
        List of Errors cordova-plugin-file
        https://github.com/apache/cordova-plugin-file#list-of-error-codes-and-meanings
        For the meaning I recommend to read https://wicg.github.io/entries-api/#common-types
        */
        switch (e.code) {
        case FileError.NOT_FOUND_ERR:
          e.message = 'Requested file could not be found';
          break;
        case FileError.SECURITY_ERR:
          e.message = 'SECURITY_ERR';
          break;
        case FileError.ABORT_ERR:
          e.message = 'ABORT_ERR';
          break;
        case FileError.NOT_READABLE_ERR:
          e.message = 'NOT_READABLE_ERR';
          break;
        case FileError.ENCODING_ERR:
          e.message = 'Malformed URI';
          break;
        case FileError.NO_MODIFICATION_ALLOWED_ERR:
          e.message = 'NO_MODIFICATION_ALLOWED_ERR';
          break;
        case FileError.INVALID_STATE_ERR:
          e.message = 'INVALID_STATE_ERR';
          break;
        case FileError.SYNTAX_ERR:
          e.message = 'SYNTAX_ERR';
          break;
        case FileError.INVALID_MODIFICATION_ERR:
          e.message = 'INVALID_MODIFICATION_ERR';
          break;
        case FileError.QUOTA_EXCEEDED_ERR:
          e.message = 'QUOTA_EXCEEDED_ERR';
          break;
        case FileError.TYPE_MISMATCH_ERR:
          e.message = 'TYPE_MISMATCH_ERR';
          break;
        case FileError.PATH_EXISTS_ERR:
          e.message = 'PATH_EXISTS_ERR';
          break;
        default:
          e.message = 'Unknown Error';
          break;
        }
        $log.debug('Error: ' + e.message);
        
        return e;
      };
      
      api.fileTransferErrorHandler = function(e) {
        /*
        A FileTransferError object is passed to an error callback when an error occurs.
        https://github.com/apache/cordova-plugin-file-transfer#filetransfererror
        */
        switch (e.code) {
        case FileTransferError.FILE_NOT_FOUND_ERR:
          e.message = 'FILE_NOT_FOUND_ERR';
          break;
        case FileTransferError.INVALID_URL_ERR:
          e.message = 'INVALID_URL_ERR';
          break;
        case FileTransferError.CONNECTION_ERR:
          e.message = 'CONNECTION_ERR';
          break;
        case FileTransferError.ABORT_ERR:
          e.message = 'Operation aborted';
          break;
        case FileTransferError.NOT_MODIFIED_ERR:
          e.message = 'NOT_MODIFIED_ERR';
          break;
        default:
          e.message = 'Unknown Error';
          break;
        }
        $log.debug('Error: ' + e.message);
        
        return e;
      };

      api.getFilesFromLocalStorage = function() {
        /*
        Check if files is already loaded (if not is empty)
        TODO: is loading localStorage['files] for each media, should be optimized to only load once for all
        */
        if (!Object.keys(files).length  && localStorage['files']) { 
          var entries = angular.fromJson(localStorage['files']);
          files = api.checkRepositoryConsistency(entries);
        }
        return files;
      };
      
      api.getFileName = function(file) {
        var ext = file.extension || '';
        
        if (!ext && MIMES[file.type])
          ext = MIMES[file.type].extension;
                
        var name = file.title || '';
        
        if (!name) {
          name = md5(file.url);
        } else {
          name = Slug.slugify(name);
        }
                          
        return name + '.' + ext;
      };
      
      api.checkRepositoryConsistency = function(entries) {
        /*
        id must be equals to file.path
        and fullPath can be updated if App is updated (iOS)
        */
        var obj = {};
        Object.keys(entries).forEach(function(key,index) {
          obj[entries[key].path] = entries[key];
          obj[entries[key].path].fullPath = api.getFileFullPath(entries[key].path);
        });
        localStorage['files'] = angular.toJson(obj);

        return obj;
      };
      
      // Returns the full absolute path from the root to the FileEntry
      api.getFileFullPath = function (filePath) {
        var directory = null;
        if (device.platform == 'Android') {
          directory = cordova.file.externalDataDirectory;
        } else {
          directory = cordova.file.dataDirectory;
        }
        return directory + filePath;
      };
      
      api.getFilePath = function (fileName) {
        return options.localFolder + '/' + fileName;
      };
      
      //add file to localstorage
      api.addFile = function(file) {
        files[file.path] = file;
        localStorage['files'] = angular.toJson(files);
      };
      
      //remove file from localstorage
      api.removeFile = function(id) {
        delete files[id];
        localStorage['files'] = angular.toJson(files);
      };
      
      //get files handler
      api.getFileEntry = function (path) {
        var q = $q.defer();
        $window.resolveLocalFileSystemURL(
          path, 
          function(entry) {
            q.resolve(entry);
          },
          function(error) {
            $log.debug(error);
            error = api.fileErrorHandler(error);
            q.reject(error);
          }
        );
        return q.promise;
      };
      
      api.isDownloaded = function(filePath) {
        /*
        TODO: If status is downloaded but local file is missing then return FALSE
        Keep record on localstorage to appears as file already downloaded, user can re-download if needed
        */
        return !!api.getFilesFromLocalStorage()[filePath];
      };
      
      api.isDownloading = function(filePath) {
        return !!fileTransfers[filePath];     
      };
      
      api.getFileStatus = function(filePath) {
        if (api.isDownloaded(filePath)) {
          return statuses.downloaded;
        } else if (api.isDownloading(filePath)) {
          return statuses.downloading;
        } else {
          return statuses.download; 
        }
      };
    
      /**
      * Service methods, that are public and available for any resource
      */
      // File available statuses, best for debug and maitain than just string.
      
      service.download = download;
      service.decorateFile = decorateFile;
      service.remove = remove;
      service.list = api.getFilesFromLocalStorage;
      service.open = open;
      service.isDownloadable = isDownloadable;
      service.openFileOpener = openFileOpener;
      
      return service;
      
      /*
      Install: cordova plugin add cordova-plugin-file-opener2
      https://www.npmjs.com/package/cordova-plugin-file-opener2
      */
      
      function isDownloadable(file) {
        return (file.type in MIMES) ? MIMES[file.type].download : true;
      }
      
      function openFileOpener(uri, type) {
        var q = $q.defer();

        cordova.plugins.fileOpener2.open(uri, type, {
          error: function (e) {
            q.reject(e);
          }, success: function () {
            q.resolve();
          }
        });
        return q.promise;
      };
      
      function open(file) {
        var q = $q.defer();
        var cb_entry = {
          success: function(entry) {
            openFileOpener(entry.toURL(), file.type).then(
              function() {
                q.resolve();
              },
              function(e) {
                q.reject(e);
              }
            );
          },
          fail: function(e) {
            q.reject(e);
          }
        };
        
        file.fullPath = api.getFileFullPath(file.path);
        api.getFileEntry(file.fullPath)
        .then(function(entry) {
          cb_entry.success(entry);
        }, function(e) {
          cb_entry.fail(e);
        }
      );
        
      return q.promise;
    };
      
    function download(file) {
      var q = $q.defer();
      var ft = new FileTransfer();
      var uri = encodeURI(file.url);
        
      file.status = statuses.downloading;
      file.fullPath = api.getFileFullPath(file.path);
      fileTransfers[file.path] = ft;

      ft.onprogress = function (progress) {
        q.notify(progress);
      };

      q.promise.abort = function () {
        ft.abort();
      };

      var cb_download = {
        success: function(fileEntry) {
          file.status = statuses.downloaded;
          api.addFile(file);
          delete fileTransfers[file.path];
          q.resolve(file);
        },
        fail: function(error) {
          $log.debug(error);
          file.status = statuses.download;
          error = api.fileTransferErrorHandler(error);
          delete fileTransfers[file.path];
          q.reject(error);
        }
      };
      ft.download(uri, file.fullPath, cb_download.success, cb_download.fail, false);
        
      return q.promise;
    };
      
    function remove(file) {
      var q = $q.defer();

      file.fullPath = api.getFileFullPath(file.path);
      api.getFileEntry(file.fullPath)
      .then(function(entry) {
        entry.remove(
          function (status) {
            api.removeFile(file.path);
            file.status = statuses.download;
            q.resolve(file);
          },function (error) {
            q.reject(error);
          }
        );
      }, function(error) {
        file.status = statuses.download;
        q.reject(error);
      }
    );
        
    return q.promise;
  }
      
  function decorateFile(file) {
    file.name = file.name || api.getFileName(file);
    file.path = file.path || api.getFilePath(file.name);
    file.status = api.getFileStatus(file.path);
        
    /*
    If device not exists then app run on browser
    */
    if (!typeof(device)) {
      var fullPath = api.getFileFullPath(file.path);
      if (api.isDownloaded(fullPath))
        file.fullPath = fullPath;
    };

    return file;
  };
}];
};
  
function mediaClickLabel(MIMES) {
  return function(type) {
    return MIMES[type] ? MIMES[type].label : 'Open';
  };
}
	
function mediaIconClass(MIMES) {
  return function(type) {
    return MIMES[type] ? MIMES[type].class : 'fa-external-link';
  };
}
  
function mediaOpenClass(MIMES) {
  return function(type) {
    return (MIMES[type] && MIMES[type].openClass )? MIMES[type].openClass : 'fa-eye';
  };
}
})();
(function() {
	'use strict';

  meuDialogs.$inject = ["$q", "$window"];
	angular
	.module('ngMeumobi.Utils.dialogs', [])
	.factory('meuDialogs', meuDialogs);
  
  /*
    install   :     cordova plugin add cordova-plugin-dialogs nl.x-services.plugins.toast
    link      :     https://github.com/apache/cordova-plugin-dialogs
    link      :     https://github.com/EddyVerbruggen/Toast-PhoneGap-Plugin  
  */
  
  function meuDialogs($q, $window) {
    
    var service = {};
    
    service.alert = alert;
    service.confirm = confirm;
    service.toast = toast;
    
    return service;
    
    function alert (message, title, buttonName) {
      var q = $q.defer();

      if (!$window.navigator.notification) {
        $window.alert(message);
        q.resolve();
      } else {
        navigator.notification.alert(message, function () {
          q.resolve();
        }, title, buttonName);
      }

      return q.promise;
    };
    
    function confirm (message, title, buttonLabels) {
      var q = $q.defer();

      if (!$window.navigator.notification) {
        if ($window.confirm(message)) {
          q.resolve(1);
        } else {
          q.resolve(2);
        }
      } else {
        navigator.notification.confirm(message, function (buttonIndex) {
          q.resolve(buttonIndex);
        }, title, buttonLabels);
      }

      return q.promise;
    };
    
    function toast (message) {
      var q = $q.defer();
			var toast = $window.plugins && $window.plugins.toast;
      
			if (toast) {
        toast.showLongBottom(message, function (response) {
          q.resolve(response);
        }, function (error) {
          q.reject(error);
        });
      } else {
        alert(message);
      }
      
      return q.promise;
    };
  }
})();
(function() {
	'use strict';
  
	meuDevice.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
	angular
	.module('ngMeumobi.Utils.device', [])
	.factory('meuDevice', meuDevice);
  
  /*
    npm install: 
      https://www.npmjs.com/package/cordova-plugin-device
      https://www.npmjs.com/package/cordova-plugin-uniquedeviceid
      https://www.npmjs.com/package/cordova-plugin-appversion
  
    install: cordova plugin add cordova-plugin-device cordova-plugin-uniquedeviceid cordova-plugin-appversion
  
    How to use it: 
      meuDevice.getUUID()
      .then(function(result) {})
      .catch(function(error) {});
  */
  
	function meuDevice($log, $window, $q, $exceptionHandler) {
    
    var service = {};
    
    service.getUUID = getUUID;
    service.getInformations = getInformations;
    service.getAppVersion = getAppVersion;
    
    return service;
    
    /*
      Return (String) Value
    */
    
    function getUUID() {
      
      return $q(function (resolve, reject) {
        
        var cb_uuid = {
          success: function(uuid) {
            resolve(uuid);
          },
          fail: function() {
            throw new Error('[CALLBACK FAILURE]: uniqueDeviceID.get');
          }
        };
        try {
          var uniqueDeviceID = $window.plugins && $window.plugins.uniqueDeviceID;
        
          if (uniqueDeviceID) {
            uniqueDeviceID.get(cb_uuid.success, cb_uuid.fail);
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-uniquedeviceid');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }
    
    /*
      Return Object {model: ..., platform: ..., platform_version: ..., manufacturer: ...}
    */
    
    function getInformations() {
                    
      return $q(function(resolve, reject) {
        var properties = {};
        
        try {
          /*eslint-disable angular/definedundefined */
          if (typeof device !== 'undefined') {
          /*eslint-enable angular/definedundefined */
    				properties.model = device.model;
    				properties.platform = device.platform;
    				properties.platform_version = device.version;
    				properties.manufacturer = device.manufacturer;
          } else {
    				// Running on Web Browser
    				properties.model = navigator.userAgent;
          }
          resolve(properties); 
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }     
      });
    }
    
    /*
      Return Object {app_version: ..., app_build: ...}
    */
    
    function getAppVersion() {
      
      return $q(function(resolve, reject) {
        var properties = {};
      
        try {
          /*eslint-disable angular/definedundefined */
          if (typeof AppVersion !== 'undefined') {
          /*eslint-enable angular/definedundefined */
    				properties.app_version = AppVersion.version;
    				properties.app_build = AppVersion.build;
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-appversion');
          }
          
          resolve(properties);
        } catch (e) {
          $exceptionHandler(e)
          reject(e);
        } 
      });
    }
	}
})();
(function() {
	'use strict';

	angular
	.module('ngMeumobi.Utils.calendar', [])
	.factory('meuCalendar', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', meuCalendar]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin.git
    If start and end_date equal 00:00 then the event occurs all day long
  */
  
  function meuCalendar($q, $window, striptags, br2nl) {
    
    var service = {};
    
    service.createEventInteractively = createEventInteractively;
    
    return service;
    
    function createEventInteractively(options) {
      var d = $q.defer(),
        defaultOptions = {
          title: null,
          address: null,
          description: '',
          start_date: null,
          end_date: null
        };

      defaultOptions = angular.extend(defaultOptions, options);

      $window.plugins.calendar.createEventInteractively(
        striptags(defaultOptions.title),
        striptags(defaultOptions.address),
        striptags(br2nl(defaultOptions.description)),
        new Date(defaultOptions.start_date  * 1000),
        new Date(defaultOptions.end_date  * 1000),
        function (message) {
          d.resolve(message);
        }, function (error) {
          d.reject(error);
        }
      );

      return d.promise;
    }
  }
})();
(function() {
  'use strict';
  
  meuAuthentication.$inject = ["$http", "$rootScope", "$timeout"];
  angular
  .module('ngMeumobi.Utils.authentication', [])
  .factory('meuAuthentication', meuAuthentication);
  
  /*
  Inspired by Jason Watmore Blog Post
  http://jasonwatmore.com/post/2014/05/26/angularjs-basic-http-authentication-example
  */

  function meuAuthentication($http, $rootScope, $timeout) {
    
    var service = {};
    service.SetCredentials = function (data) { 
      /*
      *  data.visitor && data.token
      */
      $rootScope.auth = data;

      $http.defaults.headers.common['X-Visitor-Token'] = data.token;
      localStorage.globals = angular.toJson($rootScope.auth);
    };

    service.ClearCredentials = function () {
      $rootScope.auth = {};
      localStorage.removeItem('auth');
      delete $http.defaults.headers.common['X-Visitor-Token'];
    };

    return service;
  }
})();
(function() {
	'use strict';
  
	googleAnalyticsCordova.$inject = ["$cordovaGoogleAnalytics", "$log"];
	googleAnalytics.$inject = ["$log", "$q"];
  $cordovaGoogleAnalytics.$inject = ["$q", "$window", "$log"];
	meuAnalytics.$inject = ["$injector", "$window"];
	angular
	.module('ngMeumobi.Utils.analytics', [])
	.factory('googleAnalyticsCordova', googleAnalyticsCordova)
	.factory('googleAnalytics', googleAnalytics)
  .factory('$cordovaGoogleAnalytics', $cordovaGoogleAnalytics)
	.factory('meuAnalytics', meuAnalytics);
  
  /*
    Inspired by ngCordova
    We've extracted only required methods 
  
    install   :     cordova plugin add https://github.com/danwilson/google-analytics-plugin.git
  */

  function $cordovaGoogleAnalytics($q, $window, $log) {
    
    var service = {};
    
    service.startTrackerWithId = startTrackerWithId;
    service.debugMode = debugMode;
    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.setUserId = setUserId;
    
    return service;

    function setUserId(id) {
      var d = $q.defer();

      $log.debug('Set User Id: ' + id);
      
      $window.analytics.setUserId(id, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }

    function startTrackerWithId(id) {
      var d = $q.defer();

      $log.debug('Start tracking GA Id: ' + id);

      $window.analytics.startTrackerWithId(id, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }

    function debugMode() {
      var d = $q.defer();

      $window.analytics.debugMode(function (response) {
        d.resolve(response);
      }, function () {
        d.reject();
      });

      return d.promise;
    }

    function trackView(screenName) {
      var d = $q.defer();
      
      $log.debug('Track View: ' + screenName);
      
      $window.analytics.trackView(screenName, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }

    function trackEvent(category, action, label, value) {
      var d = $q.defer();

      var ev = [category, action, label, value];
      $log.debug('Track Event: ' + ev.toString());
      
      $window.analytics.trackEvent(category, action, label, value, function (response) {
        d.resolve(response);
      }, function (error) {
        d.reject(error);
      });

      return d.promise;
    }
  }
		
	function googleAnalyticsCordova($cordovaGoogleAnalytics, $log) {
    
    var service = {};
    
    service.init = init;
    service.debugMode = $cordovaGoogleAnalytics.debugMode;
    service.trackView = $cordovaGoogleAnalytics.trackView;
    service.trackEvent = $cordovaGoogleAnalytics.trackEvent;
    service.startTrackerWithId = $cordovaGoogleAnalytics.startTrackerWithId;
    service.setUserId = $cordovaGoogleAnalytics.setUserId;
    
    return service;
    
    function init(trackId) {
      $cordovaGoogleAnalytics.startTrackerWithId(trackId);
    }
	}
  
	function googleAnalytics($log, $q) {
    
    var service = {};
    
    service.init = init;
    service.debugMode = debugMode;
    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.startTrackerWithId  = startTrackerWithId;
    service.setUserId = setUserId;
    
    return service;
    
    function init(trackId) {
      $log.debug('Google Analytics track Id: ' + trackId);
    }
    
    function debugMode() {
      $log.debug('Enable Debug');
    }
    
    function trackView(title) {
      $log.debug('Tracking Page: ' + title);
    }
    
    function trackEvent(category, action, label, value) {
      $log.debug('Tracking Event: ' + action);
    }
    
    function startTrackerWithId(id) {
      var msg = 'Tracking GA Id: ' + id;
      var d = $q.defer();

      d.resolve(msg);

      return d.promise;
    }
    
    function setUserId(id) {
      $log.debug('Tracking User: ' + id);
    }
	}
  
	function meuAnalytics($injector, $window) {

		if ($window.cordova) {
			return $injector.get('googleAnalyticsCordova');
		} else {
		  return $injector.get('googleAnalytics');
		}
	}
})();
/* global angular */
/* eslint no-undef: "error" */
(function () {
  'use strict';

  angular.module('ngMeumobi.Utils.filters', [])
  .filter('isEmpty', isEmpty)
  .filter('br2nl', br2nl)
  .filter('striptags', striptags);

  function isEmpty() {
    return function (obj) {
      return !Object.keys(obj).length;
    };
  }

  function br2nl() {
    return function (text) {
      return text.replace(/<br\s*[\/]?>/gi, '\n');
    };
  }

  function striptags() {
    return function (text) {
      return angular
          .element('<div/>')
          .html(text)
          .text();
    };
  }
})();

/* global angular */
/* eslint no-undef: "error" */
/*
  TODO: should release minified (.min.js) and not (.js)
*/
(function () {
  'use strict';

  angular.module('ngMeumobi.Utils', [
    //'ngMeumobi.Utils.api',
    'ngMeumobi.Utils.loading',
    //'ngMeumobi.Utils.connection',
    'ngMeumobi.Utils.phoneCall',
    'ngMeumobi.Utils.calendar',
    'ngMeumobi.Utils.analytics',
    'ngMeumobi.Utils.socialSharing',
    'ngMeumobi.Utils.dialogs',
    'ngMeumobi.Utils.files',
    'ngMeumobi.Utils.device',
    'ngMeumobi.Utils.authentication',
    'ngMeumobi.Utils.push'
  ]);
  
})();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNvY2lhbFNoYXJpbmcuanMiLCJQdXNoLmpzIiwiUGhvbmVDYWxsLmpzIiwiTG9hZGluZy5qcyIsIkZpbGVzLmpzIiwiRGlhbG9ncy5qcyIsIkRldmljZS5qcyIsIkNhbGVuZGFyLmpzIiwiQXV0aGVudGljYXRpb24uanMiLCJBbmFseXRpY3MuanMiLCJtZXUtZmlsdGVycy5qcyIsIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxDQUFBLFdBQUE7Q0FDQTs7Q0FFQTtFQUNBLE9BQUEsaUNBQUE7RUFDQSxRQUFBLG9CQUFBLENBQUEsTUFBQSxXQUFBLG1CQUFBLGVBQUEsUUFBQTs7Ozs7O0VBTUEsU0FBQSxpQkFBQSxJQUFBLFNBQUEsV0FBQSxPQUFBLE1BQUE7O0lBRUEsSUFBQSxVQUFBO0lBQ0EsSUFBQSxVQUFBO01BQ0EsU0FBQTs7O0lBR0EsUUFBQSxZQUFBO0lBQ0EsUUFBQSxhQUFBO0lBQ0EsUUFBQSxZQUFBO0lBQ0EsUUFBQSxhQUFBO0lBQ0EsUUFBQSxRQUFBO0lBQ0EsUUFBQSw2QkFBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEsV0FBQSxTQUFBO01BQ0EsUUFBQSxPQUFBLFNBQUE7OztJQUdBLFNBQUEsVUFBQSxNQUFBLE9BQUE7TUFDQSxRQUFBLFFBQUE7OztFQUdBLFNBQUEsMkJBQUEsVUFBQTtNQUNBLElBQUEsU0FBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztNQUVBLE9BQUEsMkJBQUEsVUFBQSx3QkFBQSxnQkFBQSxnQkFBQSxXQUFBLENBQUEsS0FBQSxNQUFBOzs7SUFHQSxTQUFBLFVBQUEsTUFBQTs7R0FFQSxJQUFBLFNBQUE7S0FDQSxTQUFBLEtBQUE7UUFDQSxTQUFBLEtBQUE7UUFDQSxPQUFBO1FBQ0EsS0FBQSxLQUFBLGVBQUEsVUFBQSxLQUFBLE9BQUE7OztNQUdBLElBQUEsS0FBQSxjQUFBLEtBQUEsV0FBQSxTQUFBLEdBQUE7SUFDQSxPQUFBLE1BQUEsS0FBQSxLQUFBLFdBQUEsR0FBQTs7O0dBR0EsT0FBQSxNQUFBOzs7RUFHQSxTQUFBLFdBQUEsT0FBQTs7R0FFQSxJQUFBLFNBQUE7S0FDQSxTQUFBLE1BQUE7UUFDQSxTQUFBLE1BQUE7UUFDQSxPQUFBO1FBQ0EsS0FBQSxNQUFBOzs7Ozs7R0FNQSxJQUFBLE1BQUEsZUFBQSxhQUFBO0lBQ0EsT0FBQSxNQUFBLEtBQUEsTUFBQTtJQUNBLE9BQUEsTUFBQTtVQUNBLElBQUEsTUFBQSxjQUFBLE1BQUEsV0FBQSxTQUFBLEdBQUE7SUFDQSxPQUFBLE1BQUEsS0FBQSxNQUFBLFdBQUEsR0FBQTs7O0dBR0EsT0FBQSxNQUFBOzs7RUFHQSxTQUFBLE1BQUEsUUFBQTs7Ozs7Ozs7Ozs7TUFXQSxJQUFBLElBQUEsR0FBQTtNQUNBLElBQUEsU0FBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOzs7O0dBSUEsSUFBQSxRQUFBO1FBQ0EsSUFBQSxRQUFBLFNBQUE7TUFDQSxPQUFBLFdBQUEsUUFBQTs7O1FBR0EsT0FBQSxVQUFBLE9BQUEsV0FBQSxVQUFBLE1BQUEsT0FBQTtRQUNBLE9BQUEsVUFBQSxPQUFBLFdBQUEsVUFBQSxNQUFBLE9BQUE7UUFDQSxJQUFBLFdBQUE7VUFDQSxTQUFBLFNBQUEsUUFBQTtZQUNBLEVBQUEsUUFBQTs7VUFFQSxNQUFBLFNBQUEsS0FBQTtZQUNBLEVBQUEsT0FBQTs7OztRQUlBLEtBQUEsTUFBQTtRQUNBLEtBQUEsTUFBQTtRQUNBLE9BQUEsaUJBQUEsUUFBQSxTQUFBLFNBQUEsU0FBQTtVQUNBO0tBQ0EsRUFBQSxPQUFBOzs7TUFHQSxPQUFBLEVBQUE7Ozs7QUN0SEEsQ0FBQSxXQUFBO0NBQ0E7Ozs7Q0FFQTtFQUNBLE9BQUEsd0JBQUE7O0VBRUEsUUFBQSxhQUFBO0VBQ0EsUUFBQSxhQUFBOzs7Ozs7RUFNQSxTQUFBLGNBQUEsTUFBQSxTQUFBLFdBQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsU0FBQTtJQUNBLFFBQUEsV0FBQTs7SUFFQSxPQUFBOztJQUVBLElBQUE7SUFDQSxJQUFBOztJQUVBLFNBQUEsT0FBQSxHQUFB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QUE7O01BRUEsSUFBQSxRQUFBLFlBQUEsbUJBQUE7UUFDQSxtQkFBQTs7O01BR0EsT0FBQSxHQUFBLFVBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQSxlQUFBLG1CQUFBO1FBQ0EsUUFBQSxXQUFBLFNBQUE7UUFDQTs7Ozs7Q0FLQSxTQUFBLGFBQUEsV0FBQSxTQUFBOztJQUVBLElBQUEsYUFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztFQUVBLElBQUEsUUFBQSxXQUFBLFlBQUE7R0FDQSxPQUFBLFVBQUEsSUFBQTtTQUNBO0lBQ0EsT0FBQSxVQUFBLElBQUE7Ozs7QUN0RkEsQ0FBQSxXQUFBO0NBQ0E7OztDQUVBO0VBQ0EsT0FBQSwyQkFBQTtFQUNBLFFBQUEsc0JBQUE7O0NBRUEsU0FBQSxtQkFBQSxJQUFBLFlBQUEsTUFBQTs7RUFFQSxJQUFBLGNBQUE7O0VBRUEsT0FBQTtHQUNBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQSxDQUFBLGVBQUE7VUFDQSxXQUFBLFdBQUE7OztJQUdBLE9BQUEsVUFBQSxHQUFBLEtBQUE7O0dBRUEsVUFBQSxTQUFBLFVBQUE7SUFDQSxJQUFBLEVBQUEsRUFBQSxjQUFBO0tBQ0EsV0FBQSxXQUFBOzs7SUFHQSxPQUFBLFlBQUEsR0FBQSxLQUFBOztHQUVBLGNBQUEsU0FBQSxTQUFBO0lBQ0EsSUFBQSxFQUFBLEVBQUEsY0FBQTtLQUNBLFdBQUEsV0FBQTs7O0lBR0EsT0FBQSxHQUFBLE9BQUE7O0dBRUEsZUFBQSxTQUFBLFVBQUE7SUFDQSxJQUFBLEVBQUEsRUFBQSxjQUFBO0tBQ0EsV0FBQSxXQUFBOzs7SUFHQSxPQUFBLEdBQUEsT0FBQTs7Ozs7O0FDdENBLENBQUEsWUFBQTtFQUNBOzs7OztFQUVBO0dBQ0EsT0FBQSx5QkFBQSxDQUFBO0dBQ0EsU0FBQSxTQUFBO0lBQ0EsbUJBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOztJQUVBLGFBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOztJQUVBLHNDQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxPQUFBO01BQ0EsV0FBQTtNQUNBLFVBQUE7O0lBRUEsNEJBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOztJQUVBLGNBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxXQUFBO01BQ0EsVUFBQTs7SUFFQSxpQ0FBQTtNQUNBLE9BQUE7TUFDQSxPQUFBO01BQ0EsV0FBQTtNQUNBLFVBQUE7O0lBRUEscUVBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOzs7R0FHQSxPQUFBLG1CQUFBO0dBQ0EsT0FBQSxrQkFBQTtHQUNBLE9BQUEsa0JBQUE7R0FDQSxTQUFBLFlBQUE7O0VBRUEsU0FBQSxXQUFBO0lBQ0EsSUFBQSxnQkFBQTtJQUNBLElBQUEsUUFBQTtJQUNBLElBQUEsVUFBQTtNQUNBLGFBQUE7O0lBRUEsSUFBQSxXQUFBO01BQ0EsVUFBQTtNQUNBLGFBQUE7TUFDQSxZQUFBOzs7SUFHQSxLQUFBLGFBQUEsU0FBQSxTQUFBO01BQ0EsUUFBQSxPQUFBLFNBQUE7OztJQUdBLEtBQUEsWUFBQSxTQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0lBR0EsS0FBQSxrREFBQSxTQUFBLElBQUEsTUFBQSxTQUFBLE9BQUEsTUFBQTtNQUNBLElBQUEsTUFBQTtNQUNBLElBQUEsVUFBQTs7Ozs7O01BTUEsSUFBQSxtQkFBQSxTQUFBLEdBQUE7Ozs7OztRQU1BLFFBQUEsRUFBQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7O1FBRUEsS0FBQSxNQUFBLFlBQUEsRUFBQTs7UUFFQSxPQUFBOzs7TUFHQSxJQUFBLDJCQUFBLFNBQUEsR0FBQTs7Ozs7UUFLQSxRQUFBLEVBQUE7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQTtVQUNBLEVBQUEsVUFBQTtVQUNBOztRQUVBLEtBQUEsTUFBQSxZQUFBLEVBQUE7O1FBRUEsT0FBQTs7O01BR0EsSUFBQSwyQkFBQSxXQUFBOzs7OztRQUtBLElBQUEsQ0FBQSxPQUFBLEtBQUEsT0FBQSxXQUFBLGFBQUEsVUFBQTtVQUNBLElBQUEsVUFBQSxRQUFBLFNBQUEsYUFBQTtVQUNBLFFBQUEsSUFBQSwyQkFBQTs7UUFFQSxPQUFBOzs7TUFHQSxJQUFBLGNBQUEsU0FBQSxNQUFBO1FBQ0EsSUFBQSxNQUFBLEtBQUEsYUFBQTs7UUFFQSxJQUFBLENBQUEsT0FBQSxNQUFBLEtBQUE7VUFDQSxNQUFBLE1BQUEsS0FBQSxNQUFBOztRQUVBLElBQUEsT0FBQSxLQUFBLFNBQUE7O1FBRUEsSUFBQSxDQUFBLE1BQUE7VUFDQSxPQUFBLElBQUEsS0FBQTtlQUNBO1VBQ0EsT0FBQSxLQUFBLFFBQUE7OztRQUdBLE9BQUEsT0FBQSxNQUFBOzs7TUFHQSxJQUFBLDZCQUFBLFNBQUEsU0FBQTs7Ozs7UUFLQSxJQUFBLE1BQUE7UUFDQSxPQUFBLEtBQUEsU0FBQSxRQUFBLFNBQUEsSUFBQSxPQUFBO1VBQ0EsSUFBQSxRQUFBLEtBQUEsUUFBQSxRQUFBO1VBQ0EsSUFBQSxRQUFBLEtBQUEsTUFBQSxXQUFBLElBQUEsZ0JBQUEsUUFBQSxLQUFBOztRQUVBLGFBQUEsV0FBQSxRQUFBLE9BQUE7O1FBRUEsT0FBQTs7OztNQUlBLElBQUEsa0JBQUEsVUFBQSxVQUFBO1FBQ0EsSUFBQSxZQUFBO1FBQ0EsSUFBQSxPQUFBLFlBQUEsV0FBQTtVQUNBLFlBQUEsUUFBQSxLQUFBO2VBQ0E7VUFDQSxZQUFBLFFBQUEsS0FBQTs7UUFFQSxPQUFBLFlBQUE7OztNQUdBLElBQUEsY0FBQSxVQUFBLFVBQUE7UUFDQSxPQUFBLFFBQUEsY0FBQSxNQUFBOzs7O01BSUEsSUFBQSxVQUFBLFNBQUEsTUFBQTtRQUNBLE1BQUEsS0FBQSxRQUFBO1FBQ0EsYUFBQSxXQUFBLFFBQUEsT0FBQTs7OztNQUlBLElBQUEsYUFBQSxTQUFBLElBQUE7UUFDQSxPQUFBLE1BQUE7UUFDQSxhQUFBLFdBQUEsUUFBQSxPQUFBOzs7O01BSUEsSUFBQSxlQUFBLFVBQUEsTUFBQTtRQUNBLElBQUEsSUFBQSxHQUFBO1FBQ0EsUUFBQTtVQUNBO1VBQ0EsU0FBQSxPQUFBO1lBQ0EsRUFBQSxRQUFBOztVQUVBLFNBQUEsT0FBQTtZQUNBLEtBQUEsTUFBQTtZQUNBLFFBQUEsSUFBQSxpQkFBQTtZQUNBLEVBQUEsT0FBQTs7O1FBR0EsT0FBQSxFQUFBOzs7TUFHQSxJQUFBLGVBQUEsU0FBQSxVQUFBOzs7OztRQUtBLE9BQUEsQ0FBQSxDQUFBLElBQUEsMkJBQUE7OztNQUdBLElBQUEsZ0JBQUEsU0FBQSxVQUFBO1FBQ0EsT0FBQSxDQUFBLENBQUEsY0FBQTs7O01BR0EsSUFBQSxnQkFBQSxTQUFBLFVBQUE7UUFDQSxJQUFBLElBQUEsYUFBQSxXQUFBO1VBQ0EsT0FBQSxTQUFBO2VBQ0EsSUFBQSxJQUFBLGNBQUEsV0FBQTtVQUNBLE9BQUEsU0FBQTtlQUNBO1VBQ0EsT0FBQSxTQUFBOzs7Ozs7Ozs7TUFTQSxRQUFBLFdBQUE7TUFDQSxRQUFBLGVBQUE7TUFDQSxRQUFBLFNBQUE7TUFDQSxRQUFBLE9BQUEsSUFBQTtNQUNBLFFBQUEsT0FBQTtNQUNBLFFBQUEsaUJBQUE7TUFDQSxRQUFBLGlCQUFBOztNQUVBLE9BQUE7Ozs7Ozs7TUFPQSxTQUFBLGVBQUEsTUFBQTtRQUNBLE9BQUEsQ0FBQSxLQUFBLFFBQUEsU0FBQSxNQUFBLEtBQUEsTUFBQSxXQUFBOzs7TUFHQSxTQUFBLGVBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7O1FBRUEsUUFBQSxRQUFBLFlBQUEsS0FBQSxLQUFBLE1BQUE7VUFDQSxPQUFBLFVBQUEsR0FBQTtZQUNBLEVBQUEsT0FBQTthQUNBLFNBQUEsWUFBQTtZQUNBLEVBQUE7OztRQUdBLE9BQUEsRUFBQTtPQUNBOztNQUVBLFNBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7UUFDQSxJQUFBLFdBQUE7VUFDQSxTQUFBLFNBQUEsT0FBQTtZQUNBLGVBQUEsTUFBQSxTQUFBLEtBQUEsTUFBQTtjQUNBLFdBQUE7Z0JBQ0EsRUFBQTs7Y0FFQSxTQUFBLEdBQUE7Z0JBQ0EsRUFBQSxPQUFBOzs7O1VBSUEsTUFBQSxTQUFBLEdBQUE7WUFDQSxFQUFBLE9BQUE7Ozs7UUFJQSxLQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO1FBQ0EsSUFBQSxhQUFBLEtBQUE7U0FDQSxLQUFBLFNBQUEsT0FBQTtVQUNBLFNBQUEsUUFBQTtXQUNBLFNBQUEsR0FBQTtVQUNBLFNBQUEsS0FBQTs7OztNQUlBLE9BQUEsRUFBQTtLQUNBOztJQUVBLFNBQUEsU0FBQSxNQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7TUFDQSxJQUFBLEtBQUEsSUFBQTtNQUNBLElBQUEsTUFBQSxVQUFBLEtBQUE7O01BRUEsS0FBQSxTQUFBLFNBQUE7TUFDQSxLQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO01BQ0EsY0FBQSxLQUFBLFFBQUE7O01BRUEsR0FBQSxhQUFBLFVBQUEsVUFBQTtRQUNBLEVBQUEsT0FBQTs7O01BR0EsRUFBQSxRQUFBLFFBQUEsWUFBQTtRQUNBLEdBQUE7OztNQUdBLElBQUEsY0FBQTtRQUNBLFNBQUEsU0FBQSxXQUFBO1VBQ0EsS0FBQSxTQUFBLFNBQUE7VUFDQSxJQUFBLFFBQUE7VUFDQSxPQUFBLGNBQUEsS0FBQTtVQUNBLEVBQUEsUUFBQTs7UUFFQSxNQUFBLFNBQUEsT0FBQTtVQUNBLEtBQUEsTUFBQTtVQUNBLEtBQUEsU0FBQSxTQUFBO1VBQ0EsUUFBQSxJQUFBLHlCQUFBO1VBQ0EsT0FBQSxjQUFBLEtBQUE7VUFDQSxFQUFBLE9BQUE7OztNQUdBLEdBQUEsU0FBQSxLQUFBLEtBQUEsVUFBQSxZQUFBLFNBQUEsWUFBQSxNQUFBOztNQUVBLE9BQUEsRUFBQTtLQUNBOztJQUVBLFNBQUEsT0FBQSxNQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7O01BRUEsS0FBQSxXQUFBLElBQUEsZ0JBQUEsS0FBQTtNQUNBLElBQUEsYUFBQSxLQUFBO09BQ0EsS0FBQSxTQUFBLE9BQUE7UUFDQSxNQUFBO1VBQ0EsVUFBQSxRQUFBO1lBQ0EsSUFBQSxXQUFBLEtBQUE7WUFDQSxLQUFBLFNBQUEsU0FBQTtZQUNBLEVBQUEsUUFBQTtZQUNBLFVBQUEsT0FBQTtZQUNBLEVBQUEsT0FBQTs7O1NBR0EsU0FBQSxPQUFBO1FBQ0EsS0FBQSxTQUFBLFNBQUE7UUFDQSxFQUFBLE9BQUE7Ozs7SUFJQSxPQUFBLEVBQUE7OztFQUdBLFNBQUEsYUFBQSxNQUFBO0lBQ0EsS0FBQSxPQUFBLEtBQUEsUUFBQSxJQUFBLFlBQUE7SUFDQSxLQUFBLE9BQUEsS0FBQSxRQUFBLElBQUEsWUFBQSxLQUFBO0lBQ0EsS0FBQSxTQUFBLElBQUEsY0FBQSxLQUFBOzs7OztJQUtBLElBQUEsQ0FBQSxPQUFBLFNBQUE7TUFDQSxJQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO01BQ0EsSUFBQSxJQUFBLGFBQUE7UUFDQSxLQUFBLFdBQUE7S0FDQTs7SUFFQSxPQUFBO0dBQ0E7O0NBRUE7O0FBRUEsU0FBQSxnQkFBQSxPQUFBO0VBQ0EsT0FBQSxTQUFBLE1BQUE7SUFDQSxPQUFBLE1BQUEsUUFBQSxNQUFBLE1BQUEsUUFBQTs7OztBQUlBLFNBQUEsZUFBQSxPQUFBO0VBQ0EsT0FBQSxTQUFBLE1BQUE7SUFDQSxPQUFBLE1BQUEsUUFBQSxNQUFBLE1BQUEsUUFBQTs7OztBQUlBLFNBQUEsZUFBQSxPQUFBO0VBQ0EsT0FBQSxTQUFBLE1BQUE7SUFDQSxPQUFBLENBQUEsTUFBQSxTQUFBLE1BQUEsTUFBQSxhQUFBLE1BQUEsTUFBQSxZQUFBOzs7O0FDcmJBLENBQUEsV0FBQTtDQUNBOzs7Q0FFQTtFQUNBLE9BQUEsMkJBQUE7RUFDQSxRQUFBLGNBQUE7Ozs7Ozs7O0VBUUEsU0FBQSxXQUFBLElBQUEsU0FBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxRQUFBO0lBQ0EsUUFBQSxVQUFBO0lBQ0EsUUFBQSxRQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxPQUFBLFNBQUEsT0FBQSxZQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7O01BRUEsSUFBQSxDQUFBLFFBQUEsVUFBQSxjQUFBO1FBQ0EsUUFBQSxNQUFBO1FBQ0EsRUFBQTthQUNBO1FBQ0EsVUFBQSxhQUFBLE1BQUEsU0FBQSxZQUFBO1VBQ0EsRUFBQTtXQUNBLE9BQUE7OztNQUdBLE9BQUEsRUFBQTtLQUNBOztJQUVBLFNBQUEsU0FBQSxTQUFBLE9BQUEsY0FBQTtNQUNBLElBQUEsSUFBQSxHQUFBOztNQUVBLElBQUEsQ0FBQSxRQUFBLFVBQUEsY0FBQTtRQUNBLElBQUEsUUFBQSxRQUFBLFVBQUE7VUFDQSxFQUFBLFFBQUE7ZUFDQTtVQUNBLEVBQUEsUUFBQTs7YUFFQTtRQUNBLFVBQUEsYUFBQSxRQUFBLFNBQUEsVUFBQSxhQUFBO1VBQ0EsRUFBQSxRQUFBO1dBQ0EsT0FBQTs7O01BR0EsT0FBQSxFQUFBO0tBQ0E7O0lBRUEsU0FBQSxPQUFBLFNBQUE7TUFDQSxJQUFBLElBQUEsR0FBQTtHQUNBLElBQUEsUUFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztHQUVBLElBQUEsT0FBQTtRQUNBLE1BQUEsZUFBQSxTQUFBLFVBQUEsVUFBQTtVQUNBLEVBQUEsUUFBQTtXQUNBLFVBQUEsT0FBQTtVQUNBLEVBQUEsT0FBQTs7YUFFQTtRQUNBLE1BQUE7OztNQUdBLE9BQUEsRUFBQTtLQUNBOzs7QUN2RUEsQ0FBQSxXQUFBO0NBQ0E7OztDQUVBO0VBQ0EsT0FBQSwwQkFBQTtFQUNBLFFBQUEsYUFBQTs7Ozs7Ozs7Ozs7Ozs7OztDQWdCQSxTQUFBLFVBQUEsTUFBQSxTQUFBLElBQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsVUFBQTtJQUNBLFFBQUEsa0JBQUE7SUFDQSxRQUFBLGdCQUFBOztJQUVBLE9BQUE7Ozs7OztJQU1BLFNBQUEsVUFBQTs7TUFFQSxPQUFBLEdBQUEsVUFBQSxTQUFBLFFBQUE7O1FBRUEsSUFBQSxVQUFBO1VBQ0EsU0FBQSxTQUFBLE1BQUE7WUFDQSxRQUFBOztVQUVBLE1BQUEsV0FBQTtZQUNBLE1BQUEsSUFBQSxNQUFBOzs7UUFHQSxJQUFBO1VBQ0EsSUFBQSxpQkFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztVQUVBLElBQUEsZ0JBQUE7WUFDQSxlQUFBLElBQUEsUUFBQSxTQUFBLFFBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7Ozs7Ozs7OztJQVNBLFNBQUEsa0JBQUE7O01BRUEsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQSxhQUFBOztRQUVBLElBQUE7O1VBRUEsSUFBQSxPQUFBLFdBQUEsYUFBQTs7UUFFQSxXQUFBLFFBQUEsT0FBQTtRQUNBLFdBQUEsV0FBQSxPQUFBO1FBQ0EsV0FBQSxtQkFBQSxPQUFBO1FBQ0EsV0FBQSxlQUFBLE9BQUE7aUJBQ0E7O1FBRUEsV0FBQSxRQUFBLFVBQUE7O1VBRUEsUUFBQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7Ozs7Ozs7O0lBU0EsU0FBQSxnQkFBQTs7TUFFQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBLGFBQUE7O1FBRUEsSUFBQTs7VUFFQSxJQUFBLE9BQUEsZUFBQSxhQUFBOztRQUVBLFdBQUEsY0FBQSxXQUFBO1FBQ0EsV0FBQSxZQUFBLFdBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7O1VBR0EsUUFBQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7Ozs7O0FDakhBLENBQUEsV0FBQTtDQUNBOztDQUVBO0VBQ0EsT0FBQSw0QkFBQTtFQUNBLFFBQUEsZUFBQSxDQUFBLE1BQUEsV0FBQSxtQkFBQSxlQUFBOzs7Ozs7O0VBT0EsU0FBQSxZQUFBLElBQUEsU0FBQSxXQUFBLE9BQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsMkJBQUE7O0lBRUEsT0FBQTs7SUFFQSxTQUFBLHlCQUFBLFNBQUE7TUFDQSxJQUFBLElBQUEsR0FBQTtRQUNBLGlCQUFBO1VBQ0EsT0FBQTtVQUNBLFNBQUE7VUFDQSxhQUFBO1VBQ0EsWUFBQTtVQUNBLFVBQUE7OztNQUdBLGlCQUFBLFFBQUEsT0FBQSxnQkFBQTs7TUFFQSxRQUFBLFFBQUEsU0FBQTtRQUNBLFVBQUEsZUFBQTtRQUNBLFVBQUEsZUFBQTtRQUNBLFVBQUEsTUFBQSxlQUFBO1FBQ0EsSUFBQSxLQUFBLGVBQUEsY0FBQTtRQUNBLElBQUEsS0FBQSxlQUFBLFlBQUE7UUFDQSxVQUFBLFNBQUE7VUFDQSxFQUFBLFFBQUE7V0FDQSxVQUFBLE9BQUE7VUFDQSxFQUFBLE9BQUE7Ozs7TUFJQSxPQUFBLEVBQUE7Ozs7QUM3Q0EsQ0FBQSxXQUFBO0VBQ0E7OztFQUVBO0dBQ0EsT0FBQSxrQ0FBQTtHQUNBLFFBQUEscUJBQUE7Ozs7Ozs7RUFPQSxTQUFBLGtCQUFBLE9BQUEsWUFBQSxVQUFBOztJQUVBLElBQUEsVUFBQTtJQUNBLFFBQUEsaUJBQUEsVUFBQSxNQUFBOzs7O01BSUEsV0FBQSxPQUFBOztNQUVBLE1BQUEsU0FBQSxRQUFBLE9BQUEscUJBQUEsS0FBQTtNQUNBLGFBQUEsVUFBQSxRQUFBLE9BQUEsV0FBQTs7O0lBR0EsUUFBQSxtQkFBQSxZQUFBO01BQ0EsV0FBQSxPQUFBO01BQ0EsYUFBQSxXQUFBO01BQ0EsT0FBQSxNQUFBLFNBQUEsUUFBQSxPQUFBOzs7SUFHQSxPQUFBOzs7QUMvQkEsQ0FBQSxXQUFBO0NBQ0E7Ozs7OztDQUVBO0VBQ0EsT0FBQSw2QkFBQTtFQUNBLFFBQUEsMEJBQUE7RUFDQSxRQUFBLG1CQUFBO0dBQ0EsUUFBQSwyQkFBQTtFQUNBLFFBQUEsZ0JBQUE7Ozs7Ozs7OztFQVNBLFNBQUEsd0JBQUEsSUFBQSxTQUFBLE1BQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEscUJBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFlBQUE7O0lBRUEsT0FBQTs7SUFFQSxTQUFBLFVBQUEsSUFBQTtNQUNBLElBQUEsSUFBQSxHQUFBOztNQUVBLEtBQUEsTUFBQSxrQkFBQTs7TUFFQSxRQUFBLFVBQUEsVUFBQSxJQUFBLFVBQUEsVUFBQTtRQUNBLEVBQUEsUUFBQTtTQUNBLFVBQUEsT0FBQTtRQUNBLEVBQUEsT0FBQTs7O01BR0EsT0FBQSxFQUFBOzs7SUFHQSxTQUFBLG1CQUFBLElBQUE7TUFDQSxJQUFBLElBQUEsR0FBQTs7TUFFQSxLQUFBLE1BQUEsMkJBQUE7O01BRUEsUUFBQSxVQUFBLG1CQUFBLElBQUEsVUFBQSxVQUFBO1FBQ0EsRUFBQSxRQUFBO1NBQ0EsVUFBQSxPQUFBO1FBQ0EsRUFBQSxPQUFBOzs7TUFHQSxPQUFBLEVBQUE7OztJQUdBLFNBQUEsWUFBQTtNQUNBLElBQUEsSUFBQSxHQUFBOztNQUVBLFFBQUEsVUFBQSxVQUFBLFVBQUEsVUFBQTtRQUNBLEVBQUEsUUFBQTtTQUNBLFlBQUE7UUFDQSxFQUFBOzs7TUFHQSxPQUFBLEVBQUE7OztJQUdBLFNBQUEsVUFBQSxZQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7O01BRUEsS0FBQSxNQUFBLGlCQUFBOztNQUVBLFFBQUEsVUFBQSxVQUFBLFlBQUEsVUFBQSxVQUFBO1FBQ0EsRUFBQSxRQUFBO1NBQ0EsVUFBQSxPQUFBO1FBQ0EsRUFBQSxPQUFBOzs7TUFHQSxPQUFBLEVBQUE7OztJQUdBLFNBQUEsV0FBQSxVQUFBLFFBQUEsT0FBQSxPQUFBO01BQ0EsSUFBQSxJQUFBLEdBQUE7O01BRUEsSUFBQSxLQUFBLENBQUEsVUFBQSxRQUFBLE9BQUE7TUFDQSxLQUFBLE1BQUEsa0JBQUEsR0FBQTs7TUFFQSxRQUFBLFVBQUEsV0FBQSxVQUFBLFFBQUEsT0FBQSxPQUFBLFVBQUEsVUFBQTtRQUNBLEVBQUEsUUFBQTtTQUNBLFVBQUEsT0FBQTtRQUNBLEVBQUEsT0FBQTs7O01BR0EsT0FBQSxFQUFBOzs7O0NBSUEsU0FBQSx1QkFBQSx5QkFBQSxNQUFBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLE9BQUE7SUFDQSxRQUFBLFlBQUEsd0JBQUE7SUFDQSxRQUFBLFlBQUEsd0JBQUE7SUFDQSxRQUFBLGFBQUEsd0JBQUE7SUFDQSxRQUFBLHFCQUFBLHdCQUFBO0lBQ0EsUUFBQSxZQUFBLHdCQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxLQUFBLFNBQUE7TUFDQSx3QkFBQSxtQkFBQTs7OztDQUlBLFNBQUEsZ0JBQUEsTUFBQSxJQUFBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLE9BQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLHNCQUFBO0lBQ0EsUUFBQSxZQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxLQUFBLFNBQUE7TUFDQSxLQUFBLE1BQUEsZ0NBQUE7OztJQUdBLFNBQUEsWUFBQTtNQUNBLEtBQUEsTUFBQTs7O0lBR0EsU0FBQSxVQUFBLE9BQUE7TUFDQSxLQUFBLE1BQUEsb0JBQUE7OztJQUdBLFNBQUEsV0FBQSxVQUFBLFFBQUEsT0FBQSxPQUFBO01BQ0EsS0FBQSxNQUFBLHFCQUFBOzs7SUFHQSxTQUFBLG1CQUFBLElBQUE7TUFDQSxJQUFBLE1BQUEscUJBQUE7TUFDQSxJQUFBLElBQUEsR0FBQTs7TUFFQSxFQUFBLFFBQUE7O01BRUEsT0FBQSxFQUFBOzs7SUFHQSxTQUFBLFVBQUEsSUFBQTtNQUNBLEtBQUEsTUFBQSxvQkFBQTs7OztDQUlBLFNBQUEsYUFBQSxXQUFBLFNBQUE7O0VBRUEsSUFBQSxRQUFBLFNBQUE7R0FDQSxPQUFBLFVBQUEsSUFBQTtTQUNBO0lBQ0EsT0FBQSxVQUFBLElBQUE7Ozs7OztBQ25LQSxDQUFBLFlBQUE7RUFDQTs7RUFFQSxRQUFBLE9BQUEsMkJBQUE7R0FDQSxPQUFBLFdBQUE7R0FDQSxPQUFBLFNBQUE7R0FDQSxPQUFBLGFBQUE7O0VBRUEsU0FBQSxVQUFBO0lBQ0EsT0FBQSxVQUFBLEtBQUE7TUFDQSxPQUFBLENBQUEsT0FBQSxLQUFBLEtBQUE7Ozs7RUFJQSxTQUFBLFFBQUE7SUFDQSxPQUFBLFVBQUEsTUFBQTtNQUNBLE9BQUEsS0FBQSxRQUFBLGtCQUFBOzs7O0VBSUEsU0FBQSxZQUFBO0lBQ0EsT0FBQSxVQUFBLE1BQUE7TUFDQSxPQUFBO1dBQ0EsUUFBQTtXQUNBLEtBQUE7V0FDQTs7Ozs7Ozs7OztBQ3RCQSxDQUFBLFlBQUE7RUFDQTs7RUFFQSxRQUFBLE9BQUEsbUJBQUE7O0lBRUE7O0lBRUE7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOzs7O0FBSUEiLCJmaWxlIjoibmctbWV1bW9iaS11dGlscy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5zb2NpYWxTaGFyaW5nJywgW10pXG5cdC5mYWN0b3J5KCdtZXVTb2NpYWxTaGFyaW5nJywgWyckcScsICckd2luZG93JywgJ3N0cmlwdGFnc0ZpbHRlcicsICdicjJubEZpbHRlcicsICckbG9nJywgbWV1U29jaWFsU2hhcmluZ10pO1xuICBcbiAgLypcbiAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgaHR0cHM6Ly9naXRodWIuY29tL0VkZHlWZXJicnVnZ2VuL1NvY2lhbFNoYXJpbmctUGhvbmVHYXAtUGx1Z2luXG4gICovXG4gIFxuICBmdW5jdGlvbiBtZXVTb2NpYWxTaGFyaW5nKCRxLCAkd2luZG93LCBzdHJpcHRhZ3MsIGJyMm5sLCAkbG9nKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIHBvc3RmaXg6ICcnXG4gICAgfTtcbiAgICBcbiAgICBzZXJ2aWNlLnNoYXJlSXRlbSA9IHNoYXJlSXRlbTtcbiAgICBzZXJ2aWNlLnNoYXJlTWVkaWEgPSBzaGFyZU1lZGlhO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9uID0gc2V0T3B0aW9uO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9ucyA9IHNldE9wdGlvbnM7XG4gICAgc2VydmljZS5zaGFyZSA9IHNoYXJlO1xuICAgIHNlcnZpY2Uuc2hhcmVWaWFXaGF0c0FwcFRvUmVjZWl2ZXIgPSBzaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlcjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykge1xuICAgICAgYW5ndWxhci5leHRlbmQob3B0aW9ucywgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0T3B0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICBvcHRpb25zW25hbWVdID0gdmFsdWU7XG4gICAgfVxuXG5cdFx0ZnVuY3Rpb24gc2hhcmVWaWFXaGF0c0FwcFRvUmVjZWl2ZXIocmVjZWl2ZXIpIHtcbiAgICAgIHZhciBzb2NpYWwgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnNvY2lhbHNoYXJpbmc7XG5cdFx0ICBcbiAgICAgIHNvY2lhbC5zaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlcihyZWNlaXZlciwgJ01lc3NhZ2UgdmlhIFdoYXRzQXBwJywgbnVsbCAvKiBpbWcgKi8sIG51bGwgLyogdXJsICovLCBmdW5jdGlvbigpIHskbG9nLmRlYnVnKCdzaGFyZSBvaycpO30pO1xuXHRcdH1cbiAgICBcbiAgICBmdW5jdGlvbiBzaGFyZUl0ZW0oaXRlbSkge1xuXHRcdFx0XG5cdFx0XHR2YXIgcGFyYW1zID0ge1xuXHRcdFx0ICBtZXNzYWdlOiBpdGVtLmRlc2NyaXB0aW9uLFxuICAgICAgICBzdWJqZWN0OiBpdGVtLnRpdGxlLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIHVybDogaXRlbS5oYXNPd25Qcm9wZXJ0eSgnbGluaycpID8gaXRlbS5saW5rIDogbnVsbFxuXHRcdFx0fTtcblxuICAgICAgaWYgKGl0ZW0udGh1bWJuYWlscyAmJiBpdGVtLnRodW1ibmFpbHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRwYXJhbXMuZmlsZXMucHVzaChpdGVtLnRodW1ibmFpbHNbMF0udXJsKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHNoYXJlKHBhcmFtcyk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gc2hhcmVNZWRpYShtZWRpYSkge1xuXG5cdFx0XHR2YXIgcGFyYW1zID0ge1xuXHRcdFx0ICBtZXNzYWdlOiBtZWRpYS50aXRsZSxcbiAgICAgICAgc3ViamVjdDogbWVkaWEudGl0bGUsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgdXJsOiBtZWRpYS51cmxcblx0XHRcdH07XG5cdFx0XHRcblx0XHRcdC8vIElmIG1lZGlhIGlzIHNhdmVkIGxvY2FsbHkgKG1lZGlhLnBhdGgpIHRoZW4gc2hhcmUgaXRcblx0XHRcdC8vIEVsc2Ugc2hhcmUgaXRzIGxpbmsgKG1lZGlhLnVybClcblx0XHRcdC8vIENvdWxkbid0IHNoYXJlIHRvZ2V0aGVyIGxvY2FsIHBkZiBhbmQgbGlua1xuXHRcdFx0aWYgKG1lZGlhLmhhc093blByb3BlcnR5KCdmdWxsUGF0aCcpKSB7XG5cdFx0XHRcdHBhcmFtcy5maWxlcy5wdXNoKG1lZGlhLmZ1bGxQYXRoKTtcblx0XHRcdFx0cGFyYW1zLnVybCA9IG51bGw7XG5cdFx0XHR9IGVsc2UgaWYgKG1lZGlhLnRodW1ibmFpbHMgJiYgbWVkaWEudGh1bWJuYWlscy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHBhcmFtcy5maWxlcy5wdXNoKG1lZGlhLnRodW1ibmFpbHNbMF0udXJsKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmV0dXJuIHNoYXJlKHBhcmFtcyk7XG5cdFx0fVxuXHRcdFxuXHRcdGZ1bmN0aW9uIHNoYXJlKHBhcmFtcykge1xuICAgIC8qXG4gICAgICB0aGlzIGlzIHRoZSBjb21wbGV0ZSBsaXN0IG9mIGN1cnJlbnRseSBzdXBwb3J0ZWQgcGFyYW1zIHlvdSBjYW4gcGFzcyB0byB0aGUgcGx1Z2luIChhbGwgb3B0aW9uYWwpXG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbWVzc2FnZTogJ3NoYXJlIHRoaXMnLCAvLyBub3Qgc3VwcG9ydGVkIG9uIHNvbWUgYXBwcyAoRmFjZWJvb2ssIEluc3RhZ3JhbSlcbiAgICAgICAgc3ViamVjdDogJ3RoZSBzdWJqZWN0JywgLy8gZmkuIGZvciBlbWFpbFxuICAgICAgICBmaWxlczogWycnLCAnJ10sIC8vIGFuIGFycmF5IG9mIGZpbGVuYW1lcyBlaXRoZXIgbG9jYWxseSBvciByZW1vdGVseVxuICAgICAgICB1cmw6ICdodHRwczovL3d3dy53ZWJzaXRlLmNvbS9mb28vI2Jhcj9hPWInLFxuICAgICAgICBjaG9vc2VyVGl0bGU6ICdQaWNrIGFuIGFwcCcgLy8gQW5kcm9pZCBvbmx5LCB5b3UgY2FuIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHNoYXJlIHNoZWV0IHRpdGxlXG4gICAgICB9XG4gICAgKi9cbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcdFx0XHRcbiAgICAgIHZhciBzb2NpYWwgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnNvY2lhbHNoYXJpbmc7XG4gICAgICBcbiAgICAgIC8vIElmIHBhcmFtcy5kZXNjcmlwdGlvbiBpcyBudWxsXG4gICAgXG5cdFx0XHRpZiAoc29jaWFsKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnBvc3RmaXgpIHtcbiAgXHRcdFx0XHRwYXJhbXMuc3ViamVjdCArPSBvcHRpb25zLnBvc3RmaXg7XG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICBwYXJhbXMubWVzc2FnZSA9IHBhcmFtcy5tZXNzYWdlICYmIHN0cmlwdGFncyhicjJubChwYXJhbXMubWVzc2FnZSkpO1xuICAgICAgICBwYXJhbXMuc3ViamVjdCA9IHBhcmFtcy5zdWJqZWN0ICYmIHN0cmlwdGFncyhicjJubChwYXJhbXMuc3ViamVjdCkpO1xuICAgICAgICB2YXIgY2Jfc2hhcmUgPSB7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKG1zZykge1xuICAgICAgICAgICAgZC5yZWplY3QobXNnKTtcbiAgICAgICAgICB9ICBcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRsb2cuZGVidWcoJ3NoYXJlV2l0aE9wdGlvbnMnKTtcbiAgICAgICAgJGxvZy5kZWJ1ZyhwYXJhbXMpO1xuICAgICAgICBzb2NpYWwuc2hhcmVXaXRoT3B0aW9ucyhwYXJhbXMsIGNiX3NoYXJlLnN1Y2Nlc3MsIGNiX3NoYXJlLmZhaWwpOyBcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHQgIGQucmVqZWN0KCdQbHVnaW4gc29jaWFsc2hhcmluZyBtaXNzaW5nJyk7XG5cdFx0XHR9XG4gICAgICBcbiAgICAgIHJldHVybiBkLnByb21pc2U7XG5cdFx0fVxuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLnB1c2gnLCBbXSlcblx0XG5cdC5mYWN0b3J5KCdwdXNod29vc2gnLCBpbml0UHVzaHdvb3NoKVxuXHQuZmFjdG9yeSgnb25lc2lnbmFsJywgT25lU2lnbmFsSW1wbCk7XG4gIFxuICAvKlxuICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3B1c2h3b29zaC1wZ2ItcGx1Z2luXG4gICAgaHR0cDovL2RvY3MucHVzaHdvb3NoLmNvbS9kb2NzL3Bob25lZ2FwLWJ1aWxkXG4gICovXG4gIGZ1bmN0aW9uIGluaXRQdXNod29vc2goJGxvZywgJHdpbmRvdywgJGRvY3VtZW50LCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgICAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuY29uZmlnID0gY29uZmlnO1xuICAgIHNlcnZpY2UucmVnaXN0ZXIgPSByZWdpc3RlcjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICB2YXIgZ29vZ2xlUHJvamVjdE51bWJlcjtcbiAgICB2YXIgYXBwbGljYXRpb25Db2RlO1xuXHRcbiAgICBmdW5jdGlvbiBjb25maWcoZywgYSkge1xuICAgICAgZ29vZ2xlUHJvamVjdE51bWJlciA9IGc7XG4gICAgICBhcHBsaWNhdGlvbkNvZGUgPSBhO1xuICAgIH07XG4gICAgXG4gICAgLy8gSW5pdGlhbGl6ZSBQdXNod29vc2guIFRoaXMgd2lsbCB0cmlnZ2VyIGFsbCBwZW5kaW5nIHB1c2ggbm90aWZpY2F0aW9ucyBvbiBzdGFydC5cbiAgICBmdW5jdGlvbiByZWdpc3RlcihzdWNjZXNzLCBmYWlsKSB7XG4gICAgICBcbiAgICAgIHRyeSB7ICAgXG4gICAgICAgIHZhciBwdXNoTm90aWZpY2F0aW9uID0gYW5ndWxhci5pc0RlZmluZWQoJHdpbmRvdy5jb3Jkb3ZhKSAmJiAkd2luZG93LmNvcmRvdmEucmVxdWlyZSgncHVzaHdvb3NoLWNvcmRvdmEtcGx1Z2luLlB1c2hOb3RpZmljYXRpb24nKTtcbiAgICAgIFxuICAgICAgICBpZiAocHVzaE5vdGlmaWNhdGlvbikge1xuICAgICAgICAgIC8vIFNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIHB1c2h3b29zaC5vbkRldmljZVJlYWR5XG4gICAgICAgICAgJGRvY3VtZW50Lm9uKCdwdXNoLW5vdGlmaWNhdGlvbicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgbm90aWZpY2F0aW9uID0gZXZlbnQubm90aWZpY2F0aW9uO1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgIGhhbmRsZSBwdXNoIG9wZW4gaGVyZVxuICAgICAgICAgICAgbm90aWZpY2F0aW9uLm1lc3NhZ2VcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbi51c2VyRGF0YSA9IHtcbiAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJzogLi4uLFxuICAgICAgICAgICAgICAnaXRlbV9pZCc6IC4uLlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKi8gXG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdldmVudC5ub3RpZmljYXRpb24nKTtcbiAgICAgICAgICAgICRsb2cuZGVidWcobm90aWZpY2F0aW9uKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24ub25EZXZpY2VSZWFkeSh7IFxuICAgICAgICAgICAgcHJvamVjdGlkOiBnb29nbGVQcm9qZWN0TnVtYmVyLFxuICAgICAgICAgICAgcHdfYXBwaWQ6IGFwcGxpY2F0aW9uQ29kZX1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy9yZWdpc3RlciBmb3IgcHVzaCBub3RpZmljYXRpb25zXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5yZWdpc3RlckRldmljZShcbiAgICAgICAgICAgIGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICB2YXIgcHVzaElkcyA9IHt9O1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgcHVzaElkcy50b2tlbiA9IHN0YXR1cy5wdXNoVG9rZW47XG4gICAgICAgICAgICAgIHN1Y2Nlc3MocHVzaElkcyk7XG4gICAgICAgICAgICB9LCBcbiAgICAgICAgICAgIGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1B1c2g6IENhblxcJ3QgcmVnaXN0ZXIgZGV2aWNlJyk7XG4gICAgICAgICAgICAgIGZhaWwoc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIC8vY2xlYXIgdGhlIGFwcCBiYWRnZVxuICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24uc2V0QXBwbGljYXRpb25JY29uQmFkZ2VOdW1iZXIoMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBsdWdpbjogcHVzaHdvb3NoLWNvcmRvdmEtcGx1Z2luJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICRleGNlcHRpb25IYW5kbGVyKGVycm9yKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cdFxuICAvKlxuICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL29uZXNpZ25hbC1jb3Jkb3ZhLXBsdWdpblxuICAgIGh0dHBzOi8vZG9jdW1lbnRhdGlvbi5vbmVzaWduYWwuY29tL2RvY3MvcGhvbmVnYXAtc2RrXG4gICovXG4gIFxuXHRmdW5jdGlvbiBPbmVTaWduYWxJbXBsKCRsb2csICR3aW5kb3csICRleGNlcHRpb25IYW5kbGVyLCAkcm9vdFNjb3BlKSB7XG5cbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuY29uZmlnID0gY29uZmlnO1xuICAgIHNlcnZpY2UucmVnaXN0ZXIgPSByZWdpc3RlcjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICB2YXIgZ29vZ2xlUHJvamVjdE51bWJlcjtcblx0XHR2YXIgYXBwSWQ7XG5cdFxuXHRcdGZ1bmN0aW9uIGNvbmZpZyhnLCBhKSB7XG5cdFx0XHRnb29nbGVQcm9qZWN0TnVtYmVyID0gZztcblx0XHRcdGFwcElkID0gYTtcblx0XHR9O1xuXHRcdFxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIG5nTWV1bW9iaS5VdGlscy5wdXNoLm1ldVB1c2gjc2V0UHJvdmlkZXJcbiAgICogQG1ldGhvZE9mIG5nTWV1bW9iaS5VdGlscy5wdXNoLm1ldVB1c2hcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFNldHMgY3VycmVudCBQdXNoIHByb3ZpZGVyIChieSBkZWZhdWx0ICdwdXNod29vc2gnKS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHByb3ZpZGVyIG5hbWUgeydwdXNod29vc2gnLCAnb25lc2lnbmFsJ30uXG4gICAqL1xuICAgIFxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgcHVzaE5vdGlmaWNhdGlvbiA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuT25lU2lnbmFsO1xuXG4gICAgICAgIGlmIChwdXNoTm90aWZpY2F0aW9uKSB7XG4gICAgICAgICAgJGxvZy5kZWJ1ZygnUGx1Z2luIE9uZVNpZ25hbCBsb2FkZWQnKTtcbiAgICAgICAgXG4gICAgICAgICAgdmFyIGlvc1NldHRpbmdzID0ge307XG4gICAgICAgICAgaW9zU2V0dGluZ3NbJ2tPU1NldHRpbmdzS2V5QXV0b1Byb21wdCddID0gdHJ1ZTtcbiAgICAgICAgICBpb3NTZXR0aW5nc1sna09TU2V0dGluZ3NLZXlJbkFwcExhdW5jaFVSTCddID0gZmFsc2U7XG4gICAgICAgICAgXG4gICAgICAgICAgdmFyIGRpZFJlY2VpdmVSZW1vdGVOb3RpZmljYXRpb25DYWxsQmFjayA9IGZ1bmN0aW9uKGpzb25EYXRhKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdyZWNlaXZlLW5vdGlmaWNhdGlvbicsIGFuZ3VsYXIudG9Kc29uKGpzb25EYXRhKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICB2YXIgZGlkT3BlblJlbW90ZU5vdGlmaWNhdGlvbkNhbGxCYWNrID0gZnVuY3Rpb24oanNvbkRhdGEpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ29wZW4tbm90aWZpY2F0aW9uJywgYW5ndWxhci50b0pzb24oanNvbkRhdGEpKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5zdGFydEluaXQoYXBwSWQpXG4gICAgICAgICAgLmhhbmRsZU5vdGlmaWNhdGlvblJlY2VpdmVkKGRpZFJlY2VpdmVSZW1vdGVOb3RpZmljYXRpb25DYWxsQmFjaylcbiAgICAgICAgICAuaGFuZGxlTm90aWZpY2F0aW9uT3BlbmVkKGRpZE9wZW5SZW1vdGVOb3RpZmljYXRpb25DYWxsQmFjaylcbiAgICAgICAgICAuaW5Gb2N1c0Rpc3BsYXlpbmcocHVzaE5vdGlmaWNhdGlvbi5PU0luRm9jdXNEaXNwbGF5T3B0aW9uLk5vbmUpXG4gICAgICAgICAgLmlPU1NldHRpbmdzKGlvc1NldHRpbmdzKVxuICAgICAgICAgIC5lbmRJbml0KCk7XG4gICAgICAgICAgXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5nZXRJZHMoZnVuY3Rpb24oaWRzKSB7XG4gICAgICAgICAgICB2YXIgcHVzaElkcyA9IHt9O1xuICAgICAgICAgICAgcHVzaElkcy50b2tlbiA9IGlkcy5wdXNoVG9rZW47XG4gICAgICAgICAgICBwdXNoSWRzLnV1aWQgPSBpZHMudXNlcklkO1xuICAgICAgICAgICAgc3VjY2VzcyhwdXNoSWRzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uLmdldFRhZ3MoZnVuY3Rpb24odGFncykge1xuICAgICAgICAgICAgLy9hbGVydCgnZ2V0IFB1c2ggVGFnczpcXG4nICsgYW5ndWxhci50b0pzb24odGFncykpO1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZygnVGFncyBSZWNlaXZlZDogJyArIGFuZ3VsYXIudG9Kc29uKHRhZ3MpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgUGx1Z2luOiBvbmVzaWduYWwtY29yZG92YS1wbHVnaW4nKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZXJyb3IpO1xuICAgICAgfVxuICAgIH07XG5cdH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG4gIFxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5waG9uZUNhbGwnLCBbXSlcblx0LmZhY3RvcnkoJ3Bob25lQ2FsbENvcmRvdmEnLCBwaG9uZUNhbGxDb3Jkb3ZhKVxuXHQuZmFjdG9yeSgncGhvbmVDYWxsJywgcGhvbmVDYWxsKVxuXHQuZmFjdG9yeSgnbWV1UGhvbmVDYWxsJywgbWV1UGhvbmVDYWxsKTtcbiAgXG4gIC8qXG4gICAgaW5zdGFsbCAgIDogICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBodHRwczovL2dpdGh1Yi5jb20vUm9oZm9zaG8vQ29yZG92YUNhbGxOdW1iZXJQbHVnaW4uZ2l0XG4gIFxuICAgIG5wbSBpbnN0YWxsIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NhbGwtbnVtYmVyXG4gIFxuICAgIEhvdyB0byB1c2UgaXQ6IFxuICAgIG1ldVBob25lQ2FsbChudW1iZXIsIHRydWUpXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7fSlcbiAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHt9KTtcbiAgKi9cblx0XHRcblx0ZnVuY3Rpb24gcGhvbmVDYWxsQ29yZG92YSgkbG9nLCAkd2luZG93LCAkcSkge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5jYWxsID0gY2FsbDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBjYWxsKG51bWJlciwgYnlwYXNzQXBwQ2hvb3Nlcikge1xuICAgICAgXG4gICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChieXBhc3NBcHBDaG9vc2VyKSkge1xuICAgICAgICBieXBhc3NBcHBDaG9vc2VyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFxuICAgICAgICB2YXIgY2JfY2FsbE51bWJlciA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhyZXN1bHQpO1xuICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcblx0XHRcdFx0dmFyIENhbGxOdW1iZXIgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLkNhbGxOdW1iZXI7XG4gICAgICAgIFxuICAgICAgICBpZiAoQ2FsbE51bWJlcikge1xuICAgICAgICAgIENhbGxOdW1iZXIuY2FsbE51bWJlcihjYl9jYWxsTnVtYmVyLnN1Y2Nlc3MsIGNiX2NhbGxOdW1iZXIuZmFpbCwgbnVtYmVyLCBieXBhc3NBcHBDaG9vc2VyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgQ29yZG92YUNhbGxOdW1iZXIgUGx1Z2luJyk7XG4gICAgICAgIH0gICAgICAgXG4gICAgICB9KTtcbiAgICB9XG5cdH1cbiAgXG5cdGZ1bmN0aW9uIHBob25lQ2FsbCgkbG9nLCAkd2luZG93LCAkcSkge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5jYWxsID0gY2FsbDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBjYWxsKG51bWJlciwgYnlwYXNzQXBwQ2hvb3Nlcikge1xuICAgICAgXG4gICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChieXBhc3NBcHBDaG9vc2VyKSkge1xuICAgICAgICBieXBhc3NBcHBDaG9vc2VyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHZhciBwYXNzZWROdW1iZXIgPSBlbmNvZGVVUklDb21wb25lbnQobnVtYmVyKTtcbiAgICAgICAgJHdpbmRvdy5sb2NhdGlvbiA9ICd0ZWw6JyArIHBhc3NlZE51bWJlcjtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXHR9XG4gIFxuXHRmdW5jdGlvbiBtZXVQaG9uZUNhbGwoJGluamVjdG9yLCAkd2luZG93KSB7XG5cbiAgICB2YXIgQ2FsbE51bWJlciA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuQ2FsbE51bWJlcjtcbiAgICBcblx0XHRpZiAoJHdpbmRvdy5jb3Jkb3ZhICYmIENhbGxOdW1iZXIpIHtcblx0XHRcdHJldHVybiAkaW5qZWN0b3IuZ2V0KCdwaG9uZUNhbGxDb3Jkb3ZhJyk7XG5cdFx0fSBlbHNlIHtcblx0XHQgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdwaG9uZUNhbGwnKTtcblx0XHR9XG5cdH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMubG9hZGluZycsIFtdKVxuXHQuZmFjdG9yeSgnbG9hZGluZ0ludGVyY2VwdG9yJywgbG9hZGluZ0ludGVyY2VwdG9yKTtcblx0XG5cdGZ1bmN0aW9uIGxvYWRpbmdJbnRlcmNlcHRvcigkcSwgJHJvb3RTY29wZSwgJGxvZykge1xuXHRcdFxuXHRcdHZhciBudW1Mb2FkaW5ncyA9IDA7XG5cdFx0XG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICBpZiAoIW51bUxvYWRpbmdzKyspIHtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6c3RhcnQnKTtcbiAgICAgICAgfVxuXG5cdFx0XHRcdHJldHVybiBjb25maWcgfHwgJHEud2hlbihjb25maWcpO1xuXHRcdFx0fSxcblx0XHRcdHJlc3BvbnNlOiBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRpZiAoISgtLW51bUxvYWRpbmdzKSkge1xuXHRcdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpzdG9wJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG5cdFx0XHR9LFxuXHRcdFx0cmVxdWVzdEVycm9yOiBmdW5jdGlvbihyZXF1ZXN0KSB7XG5cdFx0XHRcdGlmICghKC0tbnVtTG9hZGluZ3MpKSB7XG5cdFx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOnN0b3AnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiAkcS5yZWplY3QocmVxdWVzdCk7XG5cdFx0XHR9LFxuXHRcdFx0cmVzcG9uc2VFcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0aWYgKCEoLS1udW1Mb2FkaW5ncykpIHtcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6c3RvcCcpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcblx0XHRcdH1cblx0XHR9O1xuXHR9XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuZmlsZXMnLCBbJ3NsdWdpZmllciddKVxuICAuY29uc3RhbnQoJ01JTUVTJywge1xuICAgICdhcHBsaWNhdGlvbi9wZGYnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtcGRmLW8nLFxuICAgICAgbGFiZWw6ICdWaWV3JyxcbiAgICAgIGV4dGVuc2lvbjogJ3BkZicsXG4gICAgICBkb3dubG9hZDogdHJ1ZVxuICAgIH0sXG4gICAgJ3RleHQvaHRtbCc6IHtcbiAgICAgIGNsYXNzOiAnZmEtcnNzJyxcbiAgICAgIGxhYmVsOiAnT3BlbicsXG4gICAgICBleHRlbnNpb246ICdodG1sJyxcbiAgICAgIGRvd25sb2FkOiBmYWxzZVxuICAgIH0sXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC55b3V0dWJlLnZpZGVvK2h0bWwnOiB7XG4gICAgICBjbGFzczogJ2ZhLXlvdXR1YmUtcGxheScsXG4gICAgICBvcGVuQ2xhc3M6ICdmYS1wbGF5JyxcbiAgICAgIGxhYmVsOiAnUGxheScsXG4gICAgICBleHRlbnNpb246ICdodG1sJyxcbiAgICAgIGRvd25sb2FkOiBmYWxzZVxuICAgIH0sXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCc6IHtcbiAgICAgIGNsYXNzOiAnZmEtZmlsZS1leGNlbC1vJyxcbiAgICAgIGxhYmVsOiAnVmlldycsXG4gICAgICBleHRlbnNpb246ICd4bHMnLFxuICAgICAgZG93bmxvYWQ6IHRydWVcbiAgICB9LFxuICAgICdhdWRpby9tcGVnJzoge1xuICAgICAgY2xhc3M6ICdmYS1maWxlLWF1ZGlvLW8nLFxuICAgICAgbGFiZWw6ICdQbGF5JyxcbiAgICAgIG9wZW5DbGFzczogJ2ZhLXBsYXknLFxuICAgICAgZXh0ZW5zaW9uOiAnbXAzJyxcbiAgICAgIGRvd25sb2FkOiB0cnVlXG4gICAgfSxcbiAgICAnYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtcG93ZXJwb2ludC1vJyxcbiAgICAgIGxhYmVsOiAnVmlldycsXG4gICAgICBleHRlbnNpb246ICdwcHQnLFxuICAgICAgZG93bmxvYWQ6IHRydWUsXG4gICAgfSxcbiAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtZXhjZWwtbycsXG4gICAgICBsYWJlbDogJ1ZpZXcnLFxuICAgICAgZXh0ZW5zaW9uOiAneGxzJyxcbiAgICAgIGRvd25sb2FkOiB0cnVlXG4gICAgfVxuICB9KVxuICAuZmlsdGVyKCdtZWRpYUNsaWNrTGFiZWwnLCBtZWRpYUNsaWNrTGFiZWwpXG4gIC5maWx0ZXIoJ21lZGlhSWNvbkNsYXNzJywgbWVkaWFJY29uQ2xhc3MpXG4gIC5maWx0ZXIoJ21lZGlhT3BlbkNsYXNzJywgbWVkaWFPcGVuQ2xhc3MpIFxuICAucHJvdmlkZXIoJ21ldUZpbGVzJywgbWV1RmlsZXMpOyBcbiAgICAgICAgXG4gIGZ1bmN0aW9uIG1ldUZpbGVzKCkge1xuICAgIHZhciBmaWxlVHJhbnNmZXJzID0ge307XG4gICAgdmFyIGZpbGVzID0ge307XG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICBsb2NhbEZvbGRlcjogJ0Rvd25sb2FkcydcbiAgICB9O1xuICAgIHZhciBzdGF0dXNlcyA9IHtcbiAgICAgIGRvd25sb2FkOiAnZG93bmxvYWQnLFxuICAgICAgZG93bmxvYWRpbmc6ICdkb3dubG9hZGluZycsXG4gICAgICBkb3dubG9hZGVkOiAnZG93bmxvYWRlZCdcbiAgICB9O1xuICAgIFxuICAgIHRoaXMuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKG9wdGlvbnMsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICB0aGlzLnNldE9wdGlvbiA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICBvcHRpb25zW25hbWVdID0gdmFsdWU7XG4gICAgfTtcblxuICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uKCRxLCAkbG9nLCAkd2luZG93LCBNSU1FUywgU2x1Zykge1xuICAgICAgdmFyIGFwaSA9IHt9O1xuICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICAgIFxuICAgICAgLyoqXG4gICAgICAqICBBcGkgbWV0aG9kcywgYXZhaWxhYmxlIG9ubHkgb24gdGhlIGluc2lkZSB0aGUgc2VydmljZVxuICAgICAgKi9cblxuICAgICAgYXBpLmZpbGVFcnJvckhhbmRsZXIgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8qXG4gICAgICAgIExpc3Qgb2YgRXJyb3JzIGNvcmRvdmEtcGx1Z2luLWZpbGVcbiAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9jb3Jkb3ZhLXBsdWdpbi1maWxlI2xpc3Qtb2YtZXJyb3ItY29kZXMtYW5kLW1lYW5pbmdzXG4gICAgICAgIEZvciB0aGUgbWVhbmluZyBJIHJlY29tbWVuZCB0byByZWFkIGh0dHBzOi8vd2ljZy5naXRodWIuaW8vZW50cmllcy1hcGkvI2NvbW1vbi10eXBlc1xuICAgICAgICAqL1xuICAgICAgICBzd2l0Y2ggKGUuY29kZSkge1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5OT1RfRk9VTkRfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdSZXF1ZXN0ZWQgZmlsZSBjb3VsZCBub3QgYmUgZm91bmQnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5TRUNVUklUWV9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1NFQ1VSSVRZX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLkFCT1JUX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnQUJPUlRfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuTk9UX1JFQURBQkxFX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnTk9UX1JFQURBQkxFX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLkVOQ09ESU5HX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnTWFsZm9ybWVkIFVSSSc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLk5PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuSU5WQUxJRF9TVEFURV9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ0lOVkFMSURfU1RBVEVfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuU1lOVEFYX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnU1lOVEFYX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLklOVkFMSURfTU9ESUZJQ0FUSU9OX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuUVVPVEFfRVhDRUVERURfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdRVU9UQV9FWENFRURFRF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5UWVBFX01JU01BVENIX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnVFlQRV9NSVNNQVRDSF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5QQVRIX0VYSVNUU19FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1BBVEhfRVhJU1RTX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1Vua25vd24gRXJyb3InO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgICRsb2cuZGVidWcoJ0Vycm9yOiAnICsgZS5tZXNzYWdlKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBlO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgYXBpLmZpbGVUcmFuc2ZlckVycm9ySGFuZGxlciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLypcbiAgICAgICAgQSBGaWxlVHJhbnNmZXJFcnJvciBvYmplY3QgaXMgcGFzc2VkIHRvIGFuIGVycm9yIGNhbGxiYWNrIHdoZW4gYW4gZXJyb3Igb2NjdXJzLlxuICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYXBhY2hlL2NvcmRvdmEtcGx1Z2luLWZpbGUtdHJhbnNmZXIjZmlsZXRyYW5zZmVyZXJyb3JcbiAgICAgICAgKi9cbiAgICAgICAgc3dpdGNoIChlLmNvZGUpIHtcbiAgICAgICAgY2FzZSBGaWxlVHJhbnNmZXJFcnJvci5GSUxFX05PVF9GT1VORF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ0ZJTEVfTk9UX0ZPVU5EX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuSU5WQUxJRF9VUkxfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdJTlZBTElEX1VSTF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLkNPTk5FQ1RJT05fRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdDT05ORUNUSU9OX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuQUJPUlRfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdPcGVyYXRpb24gYWJvcnRlZCc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuTk9UX01PRElGSUVEX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnTk9UX01PRElGSUVEX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1Vua25vd24gRXJyb3InO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgICRsb2cuZGVidWcoJ0Vycm9yOiAnICsgZS5tZXNzYWdlKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBlO1xuICAgICAgfTtcblxuICAgICAgYXBpLmdldEZpbGVzRnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKlxuICAgICAgICBDaGVjayBpZiBmaWxlcyBpcyBhbHJlYWR5IGxvYWRlZCAoaWYgbm90IGlzIGVtcHR5KVxuICAgICAgICBUT0RPOiBpcyBsb2FkaW5nIGxvY2FsU3RvcmFnZVsnZmlsZXNdIGZvciBlYWNoIG1lZGlhLCBzaG91bGQgYmUgb3B0aW1pemVkIHRvIG9ubHkgbG9hZCBvbmNlIGZvciBhbGxcbiAgICAgICAgKi9cbiAgICAgICAgaWYgKCFPYmplY3Qua2V5cyhmaWxlcykubGVuZ3RoICAmJiBsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10pIHsgXG4gICAgICAgICAgdmFyIGVudHJpZXMgPSBhbmd1bGFyLmZyb21Kc29uKGxvY2FsU3RvcmFnZVsnZmlsZXMnXSk7XG4gICAgICAgICAgZmlsZXMgPSBhcGkuY2hlY2tSZXBvc2l0b3J5Q29uc2lzdGVuY3koZW50cmllcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbGVzO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgYXBpLmdldEZpbGVOYW1lID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICB2YXIgZXh0ID0gZmlsZS5leHRlbnNpb24gfHwgJyc7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWV4dCAmJiBNSU1FU1tmaWxlLnR5cGVdKVxuICAgICAgICAgIGV4dCA9IE1JTUVTW2ZpbGUudHlwZV0uZXh0ZW5zaW9uO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICB2YXIgbmFtZSA9IGZpbGUudGl0bGUgfHwgJyc7XG4gICAgICAgIFxuICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICBuYW1lID0gbWQ1KGZpbGUudXJsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuYW1lID0gU2x1Zy5zbHVnaWZ5KG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICByZXR1cm4gbmFtZSArICcuJyArIGV4dDtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5jaGVja1JlcG9zaXRvcnlDb25zaXN0ZW5jeSA9IGZ1bmN0aW9uKGVudHJpZXMpIHtcbiAgICAgICAgLypcbiAgICAgICAgaWQgbXVzdCBiZSBlcXVhbHMgdG8gZmlsZS5wYXRoXG4gICAgICAgIGFuZCBmdWxsUGF0aCBjYW4gYmUgdXBkYXRlZCBpZiBBcHAgaXMgdXBkYXRlZCAoaU9TKVxuICAgICAgICAqL1xuICAgICAgICB2YXIgb2JqID0ge307XG4gICAgICAgIE9iamVjdC5rZXlzKGVudHJpZXMpLmZvckVhY2goZnVuY3Rpb24oa2V5LGluZGV4KSB7XG4gICAgICAgICAgb2JqW2VudHJpZXNba2V5XS5wYXRoXSA9IGVudHJpZXNba2V5XTtcbiAgICAgICAgICBvYmpbZW50cmllc1trZXldLnBhdGhdLmZ1bGxQYXRoID0gYXBpLmdldEZpbGVGdWxsUGF0aChlbnRyaWVzW2tleV0ucGF0aCk7XG4gICAgICAgIH0pO1xuICAgICAgICBsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10gPSBhbmd1bGFyLnRvSnNvbihvYmopO1xuXG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBSZXR1cm5zIHRoZSBmdWxsIGFic29sdXRlIHBhdGggZnJvbSB0aGUgcm9vdCB0byB0aGUgRmlsZUVudHJ5XG4gICAgICBhcGkuZ2V0RmlsZUZ1bGxQYXRoID0gZnVuY3Rpb24gKGZpbGVQYXRoKSB7XG4gICAgICAgIHZhciBkaXJlY3RvcnkgPSBudWxsO1xuICAgICAgICBpZiAoZGV2aWNlLnBsYXRmb3JtID09ICdBbmRyb2lkJykge1xuICAgICAgICAgIGRpcmVjdG9yeSA9IGNvcmRvdmEuZmlsZS5leHRlcm5hbERhdGFEaXJlY3Rvcnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlyZWN0b3J5ID0gY29yZG92YS5maWxlLmRhdGFEaXJlY3Rvcnk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRpcmVjdG9yeSArIGZpbGVQYXRoO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgYXBpLmdldEZpbGVQYXRoID0gZnVuY3Rpb24gKGZpbGVOYW1lKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmxvY2FsRm9sZGVyICsgJy8nICsgZmlsZU5hbWU7XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvL2FkZCBmaWxlIHRvIGxvY2Fsc3RvcmFnZVxuICAgICAgYXBpLmFkZEZpbGUgPSBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgIGZpbGVzW2ZpbGUucGF0aF0gPSBmaWxlO1xuICAgICAgICBsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10gPSBhbmd1bGFyLnRvSnNvbihmaWxlcyk7XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvL3JlbW92ZSBmaWxlIGZyb20gbG9jYWxzdG9yYWdlXG4gICAgICBhcGkucmVtb3ZlRmlsZSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIGRlbGV0ZSBmaWxlc1tpZF07XG4gICAgICAgIGxvY2FsU3RvcmFnZVsnZmlsZXMnXSA9IGFuZ3VsYXIudG9Kc29uKGZpbGVzKTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vZ2V0IGZpbGVzIGhhbmRsZXJcbiAgICAgIGFwaS5nZXRGaWxlRW50cnkgPSBmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG4gICAgICAgICR3aW5kb3cucmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSTChcbiAgICAgICAgICBwYXRoLCBcbiAgICAgICAgICBmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgICAgcS5yZXNvbHZlKGVudHJ5KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKGVycm9yKTtcbiAgICAgICAgICAgIGVycm9yID0gYXBpLmZpbGVFcnJvckhhbmRsZXIoZXJyb3IpO1xuICAgICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5pc0Rvd25sb2FkZWQgPSBmdW5jdGlvbihmaWxlUGF0aCkge1xuICAgICAgICAvKlxuICAgICAgICBUT0RPOiBJZiBzdGF0dXMgaXMgZG93bmxvYWRlZCBidXQgbG9jYWwgZmlsZSBpcyBtaXNzaW5nIHRoZW4gcmV0dXJuIEZBTFNFXG4gICAgICAgIEtlZXAgcmVjb3JkIG9uIGxvY2Fsc3RvcmFnZSB0byBhcHBlYXJzIGFzIGZpbGUgYWxyZWFkeSBkb3dubG9hZGVkLCB1c2VyIGNhbiByZS1kb3dubG9hZCBpZiBuZWVkZWRcbiAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuICEhYXBpLmdldEZpbGVzRnJvbUxvY2FsU3RvcmFnZSgpW2ZpbGVQYXRoXTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5pc0Rvd25sb2FkaW5nID0gZnVuY3Rpb24oZmlsZVBhdGgpIHtcbiAgICAgICAgcmV0dXJuICEhZmlsZVRyYW5zZmVyc1tmaWxlUGF0aF07ICAgICBcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5nZXRGaWxlU3RhdHVzID0gZnVuY3Rpb24oZmlsZVBhdGgpIHtcbiAgICAgICAgaWYgKGFwaS5pc0Rvd25sb2FkZWQoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXR1c2VzLmRvd25sb2FkZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAoYXBpLmlzRG93bmxvYWRpbmcoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXR1c2VzLmRvd25sb2FkaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZDsgXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgXG4gICAgICAvKipcbiAgICAgICogU2VydmljZSBtZXRob2RzLCB0aGF0IGFyZSBwdWJsaWMgYW5kIGF2YWlsYWJsZSBmb3IgYW55IHJlc291cmNlXG4gICAgICAqL1xuICAgICAgLy8gRmlsZSBhdmFpbGFibGUgc3RhdHVzZXMsIGJlc3QgZm9yIGRlYnVnIGFuZCBtYWl0YWluIHRoYW4ganVzdCBzdHJpbmcuXG4gICAgICBcbiAgICAgIHNlcnZpY2UuZG93bmxvYWQgPSBkb3dubG9hZDtcbiAgICAgIHNlcnZpY2UuZGVjb3JhdGVGaWxlID0gZGVjb3JhdGVGaWxlO1xuICAgICAgc2VydmljZS5yZW1vdmUgPSByZW1vdmU7XG4gICAgICBzZXJ2aWNlLmxpc3QgPSBhcGkuZ2V0RmlsZXNGcm9tTG9jYWxTdG9yYWdlO1xuICAgICAgc2VydmljZS5vcGVuID0gb3BlbjtcbiAgICAgIHNlcnZpY2UuaXNEb3dubG9hZGFibGUgPSBpc0Rvd25sb2FkYWJsZTtcbiAgICAgIHNlcnZpY2Uub3BlbkZpbGVPcGVuZXIgPSBvcGVuRmlsZU9wZW5lcjtcbiAgICAgIFxuICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgICBcbiAgICAgIC8qXG4gICAgICBJbnN0YWxsOiBjb3Jkb3ZhIHBsdWdpbiBhZGQgY29yZG92YS1wbHVnaW4tZmlsZS1vcGVuZXIyXG4gICAgICBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9jb3Jkb3ZhLXBsdWdpbi1maWxlLW9wZW5lcjJcbiAgICAgICovXG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGlzRG93bmxvYWRhYmxlKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIChmaWxlLnR5cGUgaW4gTUlNRVMpID8gTUlNRVNbZmlsZS50eXBlXS5kb3dubG9hZCA6IHRydWU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIG9wZW5GaWxlT3BlbmVyKHVyaSwgdHlwZSkge1xuICAgICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgY29yZG92YS5wbHVnaW5zLmZpbGVPcGVuZXIyLm9wZW4odXJpLCB0eXBlLCB7XG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBxLnJlamVjdChlKTtcbiAgICAgICAgICB9LCBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgZnVuY3Rpb24gb3BlbihmaWxlKSB7XG4gICAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcbiAgICAgICAgdmFyIGNiX2VudHJ5ID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAgICAgICBvcGVuRmlsZU9wZW5lcihlbnRyeS50b1VSTCgpLCBmaWxlLnR5cGUpLnRoZW4oXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHEucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBxLnJlamVjdChlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBmaWxlLmZ1bGxQYXRoID0gYXBpLmdldEZpbGVGdWxsUGF0aChmaWxlLnBhdGgpO1xuICAgICAgICBhcGkuZ2V0RmlsZUVudHJ5KGZpbGUuZnVsbFBhdGgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAgICAgY2JfZW50cnkuc3VjY2VzcyhlbnRyeSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBjYl9lbnRyeS5mYWlsKGUpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgICBcbiAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgfTtcbiAgICAgIFxuICAgIGZ1bmN0aW9uIGRvd25sb2FkKGZpbGUpIHtcbiAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcbiAgICAgIHZhciBmdCA9IG5ldyBGaWxlVHJhbnNmZXIoKTtcbiAgICAgIHZhciB1cmkgPSBlbmNvZGVVUkkoZmlsZS51cmwpO1xuICAgICAgICBcbiAgICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWRpbmc7XG4gICAgICBmaWxlLmZ1bGxQYXRoID0gYXBpLmdldEZpbGVGdWxsUGF0aChmaWxlLnBhdGgpO1xuICAgICAgZmlsZVRyYW5zZmVyc1tmaWxlLnBhdGhdID0gZnQ7XG5cbiAgICAgIGZ0Lm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbiAocHJvZ3Jlc3MpIHtcbiAgICAgICAgcS5ub3RpZnkocHJvZ3Jlc3MpO1xuICAgICAgfTtcblxuICAgICAgcS5wcm9taXNlLmFib3J0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmdC5hYm9ydCgpO1xuICAgICAgfTtcblxuICAgICAgdmFyIGNiX2Rvd25sb2FkID0ge1xuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihmaWxlRW50cnkpIHtcbiAgICAgICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkZWQ7XG4gICAgICAgICAgYXBpLmFkZEZpbGUoZmlsZSk7XG4gICAgICAgICAgZGVsZXRlIGZpbGVUcmFuc2ZlcnNbZmlsZS5wYXRoXTtcbiAgICAgICAgICBxLnJlc29sdmUoZmlsZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWw6IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgJGxvZy5kZWJ1ZyhlcnJvcik7XG4gICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZDtcbiAgICAgICAgICBlcnJvciA9IGFwaS5maWxlVHJhbnNmZXJFcnJvckhhbmRsZXIoZXJyb3IpO1xuICAgICAgICAgIGRlbGV0ZSBmaWxlVHJhbnNmZXJzW2ZpbGUucGF0aF07XG4gICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZnQuZG93bmxvYWQodXJpLCBmaWxlLmZ1bGxQYXRoLCBjYl9kb3dubG9hZC5zdWNjZXNzLCBjYl9kb3dubG9hZC5mYWlsLCBmYWxzZSk7XG4gICAgICAgIFxuICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICB9O1xuICAgICAgXG4gICAgZnVuY3Rpb24gcmVtb3ZlKGZpbGUpIHtcbiAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcblxuICAgICAgZmlsZS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5wYXRoKTtcbiAgICAgIGFwaS5nZXRGaWxlRW50cnkoZmlsZS5mdWxsUGF0aClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAgIGVudHJ5LnJlbW92ZShcbiAgICAgICAgICBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICBhcGkucmVtb3ZlRmlsZShmaWxlLnBhdGgpO1xuICAgICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZDtcbiAgICAgICAgICAgIHEucmVzb2x2ZShmaWxlKTtcbiAgICAgICAgICB9LGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWQ7XG4gICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgIH1cbiAgICApO1xuICAgICAgICBcbiAgICByZXR1cm4gcS5wcm9taXNlO1xuICB9XG4gICAgICBcbiAgZnVuY3Rpb24gZGVjb3JhdGVGaWxlKGZpbGUpIHtcbiAgICBmaWxlLm5hbWUgPSBmaWxlLm5hbWUgfHwgYXBpLmdldEZpbGVOYW1lKGZpbGUpO1xuICAgIGZpbGUucGF0aCA9IGZpbGUucGF0aCB8fCBhcGkuZ2V0RmlsZVBhdGgoZmlsZS5uYW1lKTtcbiAgICBmaWxlLnN0YXR1cyA9IGFwaS5nZXRGaWxlU3RhdHVzKGZpbGUucGF0aCk7XG4gICAgICAgIFxuICAgIC8qXG4gICAgSWYgZGV2aWNlIG5vdCBleGlzdHMgdGhlbiBhcHAgcnVuIG9uIGJyb3dzZXJcbiAgICAqL1xuICAgIGlmICghdHlwZW9mKGRldmljZSkpIHtcbiAgICAgIHZhciBmdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5wYXRoKTtcbiAgICAgIGlmIChhcGkuaXNEb3dubG9hZGVkKGZ1bGxQYXRoKSlcbiAgICAgICAgZmlsZS5mdWxsUGF0aCA9IGZ1bGxQYXRoO1xuICAgIH07XG5cbiAgICByZXR1cm4gZmlsZTtcbiAgfTtcbn07XG59O1xuICBcbmZ1bmN0aW9uIG1lZGlhQ2xpY2tMYWJlbChNSU1FUykge1xuICByZXR1cm4gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiBNSU1FU1t0eXBlXSA/IE1JTUVTW3R5cGVdLmxhYmVsIDogJ09wZW4nO1xuICB9O1xufVxuXHRcbmZ1bmN0aW9uIG1lZGlhSWNvbkNsYXNzKE1JTUVTKSB7XG4gIHJldHVybiBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIE1JTUVTW3R5cGVdID8gTUlNRVNbdHlwZV0uY2xhc3MgOiAnZmEtZXh0ZXJuYWwtbGluayc7XG4gIH07XG59XG4gIFxuZnVuY3Rpb24gbWVkaWFPcGVuQ2xhc3MoTUlNRVMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gKE1JTUVTW3R5cGVdICYmIE1JTUVTW3R5cGVdLm9wZW5DbGFzcyApPyBNSU1FU1t0eXBlXS5vcGVuQ2xhc3MgOiAnZmEtZXllJztcbiAgfTtcbn1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuZGlhbG9ncycsIFtdKVxuXHQuZmFjdG9yeSgnbWV1RGlhbG9ncycsIG1ldURpYWxvZ3MpO1xuICBcbiAgLypcbiAgICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLWRpYWxvZ3MgbmwueC1zZXJ2aWNlcy5wbHVnaW5zLnRvYXN0XG4gICAgbGluayAgICAgIDogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9hcGFjaGUvY29yZG92YS1wbHVnaW4tZGlhbG9nc1xuICAgIGxpbmsgICAgICA6ICAgICBodHRwczovL2dpdGh1Yi5jb20vRWRkeVZlcmJydWdnZW4vVG9hc3QtUGhvbmVHYXAtUGx1Z2luICBcbiAgKi9cbiAgXG4gIGZ1bmN0aW9uIG1ldURpYWxvZ3MoJHEsICR3aW5kb3cpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuYWxlcnQgPSBhbGVydDtcbiAgICBzZXJ2aWNlLmNvbmZpcm0gPSBjb25maXJtO1xuICAgIHNlcnZpY2UudG9hc3QgPSB0b2FzdDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBhbGVydCAobWVzc2FnZSwgdGl0bGUsIGJ1dHRvbk5hbWUpIHtcbiAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcblxuICAgICAgaWYgKCEkd2luZG93Lm5hdmlnYXRvci5ub3RpZmljYXRpb24pIHtcbiAgICAgICAgJHdpbmRvdy5hbGVydChtZXNzYWdlKTtcbiAgICAgICAgcS5yZXNvbHZlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuYXZpZ2F0b3Iubm90aWZpY2F0aW9uLmFsZXJ0KG1lc3NhZ2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgfSwgdGl0bGUsIGJ1dHRvbk5hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gY29uZmlybSAobWVzc2FnZSwgdGl0bGUsIGJ1dHRvbkxhYmVscykge1xuICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuXG4gICAgICBpZiAoISR3aW5kb3cubmF2aWdhdG9yLm5vdGlmaWNhdGlvbikge1xuICAgICAgICBpZiAoJHdpbmRvdy5jb25maXJtKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgcS5yZXNvbHZlKDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHEucmVzb2x2ZSgyKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmF2aWdhdG9yLm5vdGlmaWNhdGlvbi5jb25maXJtKG1lc3NhZ2UsIGZ1bmN0aW9uIChidXR0b25JbmRleCkge1xuICAgICAgICAgIHEucmVzb2x2ZShidXR0b25JbmRleCk7XG4gICAgICAgIH0sIHRpdGxlLCBidXR0b25MYWJlbHMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gdG9hc3QgKG1lc3NhZ2UpIHtcbiAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcblx0XHRcdHZhciB0b2FzdCA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMudG9hc3Q7XG4gICAgICBcblx0XHRcdGlmICh0b2FzdCkge1xuICAgICAgICB0b2FzdC5zaG93TG9uZ0JvdHRvbShtZXNzYWdlLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICBxLnJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICBxLnJlamVjdChlcnJvcik7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWxlcnQobWVzc2FnZSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgfTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcbiAgXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmRldmljZScsIFtdKVxuXHQuZmFjdG9yeSgnbWV1RGV2aWNlJywgbWV1RGV2aWNlKTtcbiAgXG4gIC8qXG4gICAgbnBtIGluc3RhbGw6IFxuICAgICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29yZG92YS1wbHVnaW4tZGV2aWNlXG4gICAgICBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9jb3Jkb3ZhLXBsdWdpbi11bmlxdWVkZXZpY2VpZFxuICAgICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29yZG92YS1wbHVnaW4tYXBwdmVyc2lvblxuICBcbiAgICBpbnN0YWxsOiBjb3Jkb3ZhIHBsdWdpbiBhZGQgY29yZG92YS1wbHVnaW4tZGV2aWNlIGNvcmRvdmEtcGx1Z2luLXVuaXF1ZWRldmljZWlkIGNvcmRvdmEtcGx1Z2luLWFwcHZlcnNpb25cbiAgXG4gICAgSG93IHRvIHVzZSBpdDogXG4gICAgICBtZXVEZXZpY2UuZ2V0VVVJRCgpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHt9KVxuICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7fSk7XG4gICovXG4gIFxuXHRmdW5jdGlvbiBtZXVEZXZpY2UoJGxvZywgJHdpbmRvdywgJHEsICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmdldFVVSUQgPSBnZXRVVUlEO1xuICAgIHNlcnZpY2UuZ2V0SW5mb3JtYXRpb25zID0gZ2V0SW5mb3JtYXRpb25zO1xuICAgIHNlcnZpY2UuZ2V0QXBwVmVyc2lvbiA9IGdldEFwcFZlcnNpb247XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgLypcbiAgICAgIFJldHVybiAoU3RyaW5nKSBWYWx1ZVxuICAgICovXG4gICAgXG4gICAgZnVuY3Rpb24gZ2V0VVVJRCgpIHtcbiAgICAgIFxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgXG4gICAgICAgIHZhciBjYl91dWlkID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHV1aWQpIHtcbiAgICAgICAgICAgIHJlc29sdmUodXVpZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW0NBTExCQUNLIEZBSUxVUkVdOiB1bmlxdWVEZXZpY2VJRC5nZXQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIHVuaXF1ZURldmljZUlEID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy51bmlxdWVEZXZpY2VJRDtcbiAgICAgICAgXG4gICAgICAgICAgaWYgKHVuaXF1ZURldmljZUlEKSB7XG4gICAgICAgICAgICB1bmlxdWVEZXZpY2VJRC5nZXQoY2JfdXVpZC5zdWNjZXNzLCBjYl91dWlkLmZhaWwpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tQTFVHSU4gTUlTU0lOR106IGNvcmRvdmEtcGx1Z2luLXVuaXF1ZWRldmljZWlkJyk7XG4gICAgICAgICAgfSAgICAgIFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLypcbiAgICAgIFJldHVybiBPYmplY3Qge21vZGVsOiAuLi4sIHBsYXRmb3JtOiAuLi4sIHBsYXRmb3JtX3ZlcnNpb246IC4uLiwgbWFudWZhY3R1cmVyOiAuLi59XG4gICAgKi9cbiAgICBcbiAgICBmdW5jdGlvbiBnZXRJbmZvcm1hdGlvbnMoKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgcHJvcGVydGllcyA9IHt9O1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvKmVzbGludC1kaXNhYmxlIGFuZ3VsYXIvZGVmaW5lZHVuZGVmaW5lZCAqL1xuICAgICAgICAgIGlmICh0eXBlb2YgZGV2aWNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIC8qZXNsaW50LWVuYWJsZSBhbmd1bGFyL2RlZmluZWR1bmRlZmluZWQgKi9cbiAgICBcdFx0XHRcdHByb3BlcnRpZXMubW9kZWwgPSBkZXZpY2UubW9kZWw7XG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLnBsYXRmb3JtID0gZGV2aWNlLnBsYXRmb3JtO1xuICAgIFx0XHRcdFx0cHJvcGVydGllcy5wbGF0Zm9ybV92ZXJzaW9uID0gZGV2aWNlLnZlcnNpb247XG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLm1hbnVmYWN0dXJlciA9IGRldmljZS5tYW51ZmFjdHVyZXI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICBcdFx0XHRcdC8vIFJ1bm5pbmcgb24gV2ViIEJyb3dzZXJcbiAgICBcdFx0XHRcdHByb3BlcnRpZXMubW9kZWwgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXNvbHZlKHByb3BlcnRpZXMpOyBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSAgICAgXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLypcbiAgICAgIFJldHVybiBPYmplY3Qge2FwcF92ZXJzaW9uOiAuLi4sIGFwcF9idWlsZDogLi4ufVxuICAgICovXG4gICAgXG4gICAgZnVuY3Rpb24gZ2V0QXBwVmVyc2lvbigpIHtcbiAgICAgIFxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgcHJvcGVydGllcyA9IHt9O1xuICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLyplc2xpbnQtZGlzYWJsZSBhbmd1bGFyL2RlZmluZWR1bmRlZmluZWQgKi9cbiAgICAgICAgICBpZiAodHlwZW9mIEFwcFZlcnNpb24gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgLyplc2xpbnQtZW5hYmxlIGFuZ3VsYXIvZGVmaW5lZHVuZGVmaW5lZCAqL1xuICAgIFx0XHRcdFx0cHJvcGVydGllcy5hcHBfdmVyc2lvbiA9IEFwcFZlcnNpb24udmVyc2lvbjtcbiAgICBcdFx0XHRcdHByb3BlcnRpZXMuYXBwX2J1aWxkID0gQXBwVmVyc2lvbi5idWlsZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbUExVR0lOIE1JU1NJTkddOiBjb3Jkb3ZhLXBsdWdpbi1hcHB2ZXJzaW9uJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIHJlc29sdmUocHJvcGVydGllcyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKVxuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSBcbiAgICAgIH0pO1xuICAgIH1cblx0fVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5jYWxlbmRhcicsIFtdKVxuXHQuZmFjdG9yeSgnbWV1Q2FsZW5kYXInLCBbJyRxJywgJyR3aW5kb3cnLCAnc3RyaXB0YWdzRmlsdGVyJywgJ2JyMm5sRmlsdGVyJywgbWV1Q2FsZW5kYXJdKTtcbiAgXG4gIC8qXG4gICAgY29yZG92YSBwbHVnaW4gYWRkIGh0dHBzOi8vZ2l0aHViLmNvbS9FZGR5VmVyYnJ1Z2dlbi9DYWxlbmRhci1QaG9uZUdhcC1QbHVnaW4uZ2l0XG4gICAgSWYgc3RhcnQgYW5kIGVuZF9kYXRlIGVxdWFsIDAwOjAwIHRoZW4gdGhlIGV2ZW50IG9jY3VycyBhbGwgZGF5IGxvbmdcbiAgKi9cbiAgXG4gIGZ1bmN0aW9uIG1ldUNhbGVuZGFyKCRxLCAkd2luZG93LCBzdHJpcHRhZ3MsIGJyMm5sKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmNyZWF0ZUV2ZW50SW50ZXJhY3RpdmVseSA9IGNyZWF0ZUV2ZW50SW50ZXJhY3RpdmVseTtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBjcmVhdGVFdmVudEludGVyYWN0aXZlbHkob3B0aW9ucykge1xuICAgICAgdmFyIGQgPSAkcS5kZWZlcigpLFxuICAgICAgICBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgICB0aXRsZTogbnVsbCxcbiAgICAgICAgICBhZGRyZXNzOiBudWxsLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcbiAgICAgICAgICBzdGFydF9kYXRlOiBudWxsLFxuICAgICAgICAgIGVuZF9kYXRlOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgIGRlZmF1bHRPcHRpb25zID0gYW5ndWxhci5leHRlbmQoZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gICAgICAkd2luZG93LnBsdWdpbnMuY2FsZW5kYXIuY3JlYXRlRXZlbnRJbnRlcmFjdGl2ZWx5KFxuICAgICAgICBzdHJpcHRhZ3MoZGVmYXVsdE9wdGlvbnMudGl0bGUpLFxuICAgICAgICBzdHJpcHRhZ3MoZGVmYXVsdE9wdGlvbnMuYWRkcmVzcyksXG4gICAgICAgIHN0cmlwdGFncyhicjJubChkZWZhdWx0T3B0aW9ucy5kZXNjcmlwdGlvbikpLFxuICAgICAgICBuZXcgRGF0ZShkZWZhdWx0T3B0aW9ucy5zdGFydF9kYXRlICAqIDEwMDApLFxuICAgICAgICBuZXcgRGF0ZShkZWZhdWx0T3B0aW9ucy5lbmRfZGF0ZSAgKiAxMDAwKSxcbiAgICAgICAgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICBkLnJlc29sdmUobWVzc2FnZSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICB9XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIFxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5hdXRoZW50aWNhdGlvbicsIFtdKVxuICAuZmFjdG9yeSgnbWV1QXV0aGVudGljYXRpb24nLCBtZXVBdXRoZW50aWNhdGlvbik7XG4gIFxuICAvKlxuICBJbnNwaXJlZCBieSBKYXNvbiBXYXRtb3JlIEJsb2cgUG9zdFxuICBodHRwOi8vamFzb253YXRtb3JlLmNvbS9wb3N0LzIwMTQvMDUvMjYvYW5ndWxhcmpzLWJhc2ljLWh0dHAtYXV0aGVudGljYXRpb24tZXhhbXBsZVxuICAqL1xuXG4gIGZ1bmN0aW9uIG1ldUF1dGhlbnRpY2F0aW9uKCRodHRwLCAkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgc2VydmljZS5TZXRDcmVkZW50aWFscyA9IGZ1bmN0aW9uIChkYXRhKSB7IFxuICAgICAgLypcbiAgICAgICogIGRhdGEudmlzaXRvciAmJiBkYXRhLnRva2VuXG4gICAgICAqL1xuICAgICAgJHJvb3RTY29wZS5hdXRoID0gZGF0YTtcblxuICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtVmlzaXRvci1Ub2tlbiddID0gZGF0YS50b2tlbjtcbiAgICAgIGxvY2FsU3RvcmFnZS5nbG9iYWxzID0gYW5ndWxhci50b0pzb24oJHJvb3RTY29wZS5hdXRoKTtcbiAgICB9O1xuXG4gICAgc2VydmljZS5DbGVhckNyZWRlbnRpYWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgJHJvb3RTY29wZS5hdXRoID0ge307XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnYXV0aCcpO1xuICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLVZpc2l0b3ItVG9rZW4nXTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG4gIFxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5hbmFseXRpY3MnLCBbXSlcblx0LmZhY3RvcnkoJ2dvb2dsZUFuYWx5dGljc0NvcmRvdmEnLCBnb29nbGVBbmFseXRpY3NDb3Jkb3ZhKVxuXHQuZmFjdG9yeSgnZ29vZ2xlQW5hbHl0aWNzJywgZ29vZ2xlQW5hbHl0aWNzKVxuICAuZmFjdG9yeSgnJGNvcmRvdmFHb29nbGVBbmFseXRpY3MnLCAkY29yZG92YUdvb2dsZUFuYWx5dGljcylcblx0LmZhY3RvcnkoJ21ldUFuYWx5dGljcycsIG1ldUFuYWx5dGljcyk7XG4gIFxuICAvKlxuICAgIEluc3BpcmVkIGJ5IG5nQ29yZG92YVxuICAgIFdlJ3ZlIGV4dHJhY3RlZCBvbmx5IHJlcXVpcmVkIG1ldGhvZHMgXG4gIFxuICAgIGluc3RhbGwgICA6ICAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgaHR0cHM6Ly9naXRodWIuY29tL2RhbndpbHNvbi9nb29nbGUtYW5hbHl0aWNzLXBsdWdpbi5naXRcbiAgKi9cblxuICBmdW5jdGlvbiAkY29yZG92YUdvb2dsZUFuYWx5dGljcygkcSwgJHdpbmRvdywgJGxvZykge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5zdGFydFRyYWNrZXJXaXRoSWQgPSBzdGFydFRyYWNrZXJXaXRoSWQ7XG4gICAgc2VydmljZS5kZWJ1Z01vZGUgPSBkZWJ1Z01vZGU7XG4gICAgc2VydmljZS50cmFja1ZpZXcgPSB0cmFja1ZpZXc7XG4gICAgc2VydmljZS50cmFja0V2ZW50ID0gdHJhY2tFdmVudDtcbiAgICBzZXJ2aWNlLnNldFVzZXJJZCA9IHNldFVzZXJJZDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIGZ1bmN0aW9uIHNldFVzZXJJZChpZCkge1xuICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkbG9nLmRlYnVnKCdTZXQgVXNlciBJZDogJyArIGlkKTtcbiAgICAgIFxuICAgICAgJHdpbmRvdy5hbmFseXRpY3Muc2V0VXNlcklkKGlkLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgZC5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydFRyYWNrZXJXaXRoSWQoaWQpIHtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGxvZy5kZWJ1ZygnU3RhcnQgdHJhY2tpbmcgR0EgSWQ6ICcgKyBpZCk7XG5cbiAgICAgICR3aW5kb3cuYW5hbHl0aWNzLnN0YXJ0VHJhY2tlcldpdGhJZChpZCwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGQucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVidWdNb2RlKCkge1xuICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkd2luZG93LmFuYWx5dGljcy5kZWJ1Z01vZGUoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGQucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGQucmVqZWN0KCk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0cmFja1ZpZXcoc2NyZWVuTmFtZSkge1xuICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgXG4gICAgICAkbG9nLmRlYnVnKCdUcmFjayBWaWV3OiAnICsgc2NyZWVuTmFtZSk7XG4gICAgICBcbiAgICAgICR3aW5kb3cuYW5hbHl0aWNzLnRyYWNrVmlldyhzY3JlZW5OYW1lLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgZC5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0cmFja0V2ZW50KGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSkge1xuICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICB2YXIgZXYgPSBbY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlXTtcbiAgICAgICRsb2cuZGVidWcoJ1RyYWNrIEV2ZW50OiAnICsgZXYudG9TdHJpbmcoKSk7XG4gICAgICBcbiAgICAgICR3aW5kb3cuYW5hbHl0aWNzLnRyYWNrRXZlbnQoY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgZC5yZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICB9XG4gIH1cblx0XHRcblx0ZnVuY3Rpb24gZ29vZ2xlQW5hbHl0aWNzQ29yZG92YSgkY29yZG92YUdvb2dsZUFuYWx5dGljcywgJGxvZykge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5pbml0ID0gaW5pdDtcbiAgICBzZXJ2aWNlLmRlYnVnTW9kZSA9ICRjb3Jkb3ZhR29vZ2xlQW5hbHl0aWNzLmRlYnVnTW9kZTtcbiAgICBzZXJ2aWNlLnRyYWNrVmlldyA9ICRjb3Jkb3ZhR29vZ2xlQW5hbHl0aWNzLnRyYWNrVmlldztcbiAgICBzZXJ2aWNlLnRyYWNrRXZlbnQgPSAkY29yZG92YUdvb2dsZUFuYWx5dGljcy50cmFja0V2ZW50O1xuICAgIHNlcnZpY2Uuc3RhcnRUcmFja2VyV2l0aElkID0gJGNvcmRvdmFHb29nbGVBbmFseXRpY3Muc3RhcnRUcmFja2VyV2l0aElkO1xuICAgIHNlcnZpY2Uuc2V0VXNlcklkID0gJGNvcmRvdmFHb29nbGVBbmFseXRpY3Muc2V0VXNlcklkO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIGZ1bmN0aW9uIGluaXQodHJhY2tJZCkge1xuICAgICAgJGNvcmRvdmFHb29nbGVBbmFseXRpY3Muc3RhcnRUcmFja2VyV2l0aElkKHRyYWNrSWQpO1xuICAgIH1cblx0fVxuICBcblx0ZnVuY3Rpb24gZ29vZ2xlQW5hbHl0aWNzKCRsb2csICRxKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmluaXQgPSBpbml0O1xuICAgIHNlcnZpY2UuZGVidWdNb2RlID0gZGVidWdNb2RlO1xuICAgIHNlcnZpY2UudHJhY2tWaWV3ID0gdHJhY2tWaWV3O1xuICAgIHNlcnZpY2UudHJhY2tFdmVudCA9IHRyYWNrRXZlbnQ7XG4gICAgc2VydmljZS5zdGFydFRyYWNrZXJXaXRoSWQgID0gc3RhcnRUcmFja2VyV2l0aElkO1xuICAgIHNlcnZpY2Uuc2V0VXNlcklkID0gc2V0VXNlcklkO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIGZ1bmN0aW9uIGluaXQodHJhY2tJZCkge1xuICAgICAgJGxvZy5kZWJ1ZygnR29vZ2xlIEFuYWx5dGljcyB0cmFjayBJZDogJyArIHRyYWNrSWQpO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBkZWJ1Z01vZGUoKSB7XG4gICAgICAkbG9nLmRlYnVnKCdFbmFibGUgRGVidWcnKTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gdHJhY2tWaWV3KHRpdGxlKSB7XG4gICAgICAkbG9nLmRlYnVnKCdUcmFja2luZyBQYWdlOiAnICsgdGl0bGUpO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiB0cmFja0V2ZW50KGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSkge1xuICAgICAgJGxvZy5kZWJ1ZygnVHJhY2tpbmcgRXZlbnQ6ICcgKyBhY3Rpb24pO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBzdGFydFRyYWNrZXJXaXRoSWQoaWQpIHtcbiAgICAgIHZhciBtc2cgPSAnVHJhY2tpbmcgR0EgSWQ6ICcgKyBpZDtcbiAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgZC5yZXNvbHZlKG1zZyk7XG5cbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHNldFVzZXJJZChpZCkge1xuICAgICAgJGxvZy5kZWJ1ZygnVHJhY2tpbmcgVXNlcjogJyArIGlkKTtcbiAgICB9XG5cdH1cbiAgXG5cdGZ1bmN0aW9uIG1ldUFuYWx5dGljcygkaW5qZWN0b3IsICR3aW5kb3cpIHtcblxuXHRcdGlmICgkd2luZG93LmNvcmRvdmEpIHtcblx0XHRcdHJldHVybiAkaW5qZWN0b3IuZ2V0KCdnb29nbGVBbmFseXRpY3NDb3Jkb3ZhJyk7XG5cdFx0fSBlbHNlIHtcblx0XHQgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdnb29nbGVBbmFseXRpY3MnKTtcblx0XHR9XG5cdH1cbn0pKCk7IiwiLyogZ2xvYmFsIGFuZ3VsYXIgKi9cbi8qIGVzbGludCBuby11bmRlZjogXCJlcnJvclwiICovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5maWx0ZXJzJywgW10pXG4gIC5maWx0ZXIoJ2lzRW1wdHknLCBpc0VtcHR5KVxuICAuZmlsdGVyKCdicjJubCcsIGJyMm5sKVxuICAuZmlsdGVyKCdzdHJpcHRhZ3MnLCBzdHJpcHRhZ3MpO1xuXG4gIGZ1bmN0aW9uIGlzRW1wdHkoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiAhT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJyMm5sKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvPGJyXFxzKltcXC9dPz4vZ2ksICdcXG4nKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gc3RyaXB0YWdzKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXJcbiAgICAgICAgICAuZWxlbWVudCgnPGRpdi8+JylcbiAgICAgICAgICAuaHRtbCh0ZXh0KVxuICAgICAgICAgIC50ZXh0KCk7XG4gICAgfTtcbiAgfVxufSkoKTtcbiIsIi8qIGdsb2JhbCBhbmd1bGFyICovXG4vKiBlc2xpbnQgbm8tdW5kZWY6IFwiZXJyb3JcIiAqL1xuLypcbiAgVE9ETzogc2hvdWxkIHJlbGVhc2UgbWluaWZpZWQgKC5taW4uanMpIGFuZCBub3QgKC5qcylcbiovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscycsIFtcbiAgICAvLyduZ01ldW1vYmkuVXRpbHMuYXBpJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLmxvYWRpbmcnLFxuICAgIC8vJ25nTWV1bW9iaS5VdGlscy5jb25uZWN0aW9uJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLnBob25lQ2FsbCcsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5jYWxlbmRhcicsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5hbmFseXRpY3MnLFxuICAgICduZ01ldW1vYmkuVXRpbHMuc29jaWFsU2hhcmluZycsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5kaWFsb2dzJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLmZpbGVzJyxcbiAgICAnbmdNZXVtb2JpLlV0aWxzLmRldmljZScsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5hdXRoZW50aWNhdGlvbicsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5wdXNoJ1xuICBdKTtcbiAgXG59KSgpO1xuIl19
