(function() {
  'use strict';

  statusbar.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
  angular
  .module('ngMeumobi.Utils.statusbar', [])
  .factory('meuStatusbar', statusbar);
  
  /*
  install   :     cordova plugin add cordova-plugin-statusbar
  
  How to use it: 
    meuCordova.statusbar.call()
    .then(function(result) {})
    .catch(function(error) {});
  */
  
  function statusbar($q, $window, $log, $exceptionHandler) {
    
    var service = {};
    var options = {};
    
    service.setOption = setOption;
    service.setOptions = setOptions;
    service.call = call;
    
    return service;

    function setOptions(opt) {
      angular.extend(options, opt);
    }

    function setOption(name, value) {
      options[name] = value;
    }
    
    function call() {
      return $q(function(resolve, reject) {
        try {
          
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
  }
})();
(function() {
  'use strict';

  splashscreen.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
  angular
  .module('ngMeumobi.Cordova.splashscreen', [])
  .factory('meuSplashscreen', splashscreen);
  
  /*
  install   :     cordova plugin add cordova-plugin-splashscreen
  
  How to use it: 
  meuCordova.splashscreen.hide()
  .then(function() {})
  .catch(function() {});
  */
  
  function splashscreen($q, $window, $log, $exceptionHandler) {
    
    return {
      show: function() {
        return $q(function(resolve, reject) {
          try {
            if ($window.navigator.splashscreen) {
              $window.navigator.splashscreen.show();
              resolve();
            }
          } catch (e) {
            $exceptionHandler(e);
            reject(e);
          };
        });
      },
    
      hide: function() {
        return $q(function(resolve, reject) {
          try {
            if ($window.navigator.splashscreen) {
              $window.navigator.splashscreen.hide();
              resolve();
            }
          } catch (e) {
            $exceptionHandler(e);
            reject(e);
          };
        });
      }
    };
  }
})();
(function() {
  'use strict';

  spinnerDialog.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
  angular
  .module('ngMeumobi.Cordova.spinnerDialog', [])
  .factory('meuSpinnerDialog', spinnerDialog);
  
  /*
  install   :     cordova plugin add cordova-plugin-spinnerdialog
  
  How to use it: 
    meuSpinnerDialog.show()
    .then(function(result) {})
    .catch(function(error) {});
  */
  
  function spinnerDialog($q, $window, $log, $exceptionHandler) {
    
    var service = {};
    
    service.show = show;
    service.hide = hide;
    
    return service;

    function show() {
      return $q(function(resolve, reject) {
        try {
          var spinner = $window.plugins && $window.plugins.spinnerDialog;
        
          if (spinner) {
            spinner.show();
            resolve();
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-spinnerdialog');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    };
    
    function hide() {
      return $q(function(resolve, reject) {
        try {
          var spinner = $window.plugins && $window.plugins.spinnerDialog;
        
          if (spinner) {
            spinner.hide();
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-spinnerdialog');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    };
  }
})();
(function() {
	'use strict';

	angular
	.module('ngMeumobi.Cordova.socialSharing', [])
	.factory('meuSocialSharing', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', '$log', socialSharing]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin
  
  How to use it: 
    meuSocialSharing.shareItem()
    .then(function(result) {})
    .catch(function(error) {});
  
    meuSocialSharing.shareMedia()
  */
  
  function socialSharing($q, $window, striptags, br2nl, $log, $exceptionHandler) {
    
    var service = {};
    var options = {
      postfix: ''
    };
    
    service.shareItem = shareItem;
    service.shareMedia = shareMedia;
    service.setOption = setOption;
    service.setOptions = setOptions;
    service.share = share;
    service.shareViaWhatsAppToReceiver = shareViaWhatsAppToReceiver;
    
    return service;

    function setOptions(options) {
      angular.extend(options, opt);
    }

    function setOption(name, value) {
      options[name] = value;
    }

		function shareViaWhatsAppToReceiver(receiver) {
      var social = $window.plugins && $window.plugins.socialsharing;
		  
      social.shareViaWhatsAppToReceiver(receiver, 'Message via WhatsApp', null /* img */, null /* url */, function() {$log.debug('share ok');});
		}
    
    function shareItem(item) {
			
			var params = {
			  message: item.description,
        subject: item.title,
        files: [],
        url: item.hasOwnProperty('link') ? item.link : null
			};

      if (item.thumbnails && item.thumbnails.length > 0) {
				params.files.push(item.thumbnails[0].url);
			}

			return share(params);
		}

		function shareMedia(media) {

			var params = {
			  message: media.title,
        subject: media.title,
        files: [],
        url: media.url
			};
			
			// If media is saved locally (media.path) then share it
			// Else share its link (media.url)
			// Couldn't share together local pdf and link
			if (media.hasOwnProperty('fullPath')) {
				params.files.push(media.fullPath);
				params.url = null;
			} else if (media.thumbnails && media.thumbnails.length > 0) {
				params.files.push(media.thumbnails[0].url);
			}
			
			return share(params);
		}
		
		function share(params) {
    /*
      this is the complete list of currently supported params you can pass to the plugin (all optional)
      var options = {
        message: 'share this', // not supported on some apps (Facebook, Instagram)
        subject: 'the subject', // fi. for email
        files: ['', ''], // an array of filenames either locally or remotely
        url: 'https://www.website.com/foo/#bar?a=b',
        chooserTitle: 'Pick an app' // Android only, you can override the default share sheet title
      }
    */
      return $q(function(resolve, reject) {
        
        var cb_share = {
          success: function(result) {
            resolve(result);
          },
          fail: function(msg) {
            throw new Error('[CALLBACK FAILURE]: social.shareWithOptions');
          }  
        };
        
        try {
          var social = $window.plugins && $window.plugins.socialsharing;
    
    			if (social) {
            if (options.postfix) {
      				params.subject += options.postfix;
            }
      
            params.message = params.message && striptags(br2nl(params.message));
            params.subject = params.subject && striptags(br2nl(params.subject));

            social.shareWithOptions(params, cb_share.success, cb_share.fail); 
    			} else {
    			  throw new Error('[PLUGIN MISSING]: cordova-plugin-x-socialsharing');
    			}          
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
		}
  }
})();
(function() {
	'use strict';

  initPushwoosh.$inject = ["$log", "$window", "$document", "$exceptionHandler"];
	OneSignalImpl.$inject = ["$log", "$window", "$exceptionHandler", "$rootScope", "$q"];
	angular
	.module('ngMeumobi.Cordova.push', [])
	.factory('pushwoosh', initPushwoosh)
	.factory('onesignal', OneSignalImpl);
  
  /*
    https://www.npmjs.com/package/pushwoosh-pgb-plugin
    http://docs.pushwoosh.com/docs/phonegap-build
  */
  function initPushwoosh($log, $window, $document, $exceptionHandler) {
        
    var service = {};
    
    service.config = config;
    service.register = register;
    
    return service;
    
    var googleProjectNumber;
    var applicationCode;
	
    function config(g, a) {
      googleProjectNumber = g;
      applicationCode = a;
    };
    
    // Initialize Pushwoosh. This will trigger all pending push notifications on start.
    function register(success, fail) {
      
      try {   
        var pushNotification = angular.isDefined($window.cordova) && $window.cordova.require('pushwoosh-cordova-plugin.PushNotification');
      
        if (pushNotification) {
          // Should be called before pushwoosh.onDeviceReady
          $document.on('push-notification', function(event) {
            var notification = event.notification;
            /*
            handle push open here
            notification.message
            notification.userData = {
              'category_id': ...,
              'item_id': ...
            }
            */ 
            $log.debug('event.notification');
            $log.debug(notification);
          });

          pushNotification.onDeviceReady({ 
            projectid: googleProjectNumber,
            pw_appid: applicationCode}
          );

          //register for push notifications
          pushNotification.registerDevice(
            function(status) {
              var pushIds = {};
              
              pushIds.token = status.pushToken;
              success(pushIds);
            }, 
            function(status) {
              throw new Error('Push: Can\'t register device');
              fail(status);
            }
          );
          //clear the app badge
          pushNotification.setApplicationIconBadgeNumber(0);
        } else {
          throw new Error('Missing Plugin: pushwoosh-cordova-plugin');
        }
      } catch (error) {
        $exceptionHandler(error);
      }
    };
  }
	
  /*
    https://www.npmjs.com/package/onesignal-cordova-plugin
    https://documentation.onesignal.com/docs/phonegap-sdk
  */
  
	function OneSignalImpl($log, $window, $exceptionHandler, $rootScope, $q) {

    var service = {};
    
    service.config = config;
    service.register = register;
    service.sendTag = sendTag;
    service.setSubscription = setSubscription;
    
    return service;
    
    var googleProjectNumber;
		var appId;
	
		function config(g, a) {
			googleProjectNumber = g;
			appId = a;
		};
		
  /**
   * @ngdoc function
   * @name ngMeumobi.Utils.push.meuPush#setProvider
   * @methodOf ngMeumobi.Utils.push.meuPush
   *
   * @description
   * Sets current Push provider (by default 'pushwoosh').
   *
   * @param {string} provider name {'pushwoosh', 'onesignal'}.
   */
    
    function sendTag(key, value) {
      return $q(function(resolve, reject) {
        try {
          var pushNotification = $window.plugins && $window.plugins.OneSignal;
          
          if (pushNotification) {
            pushNotification.sendTag(key, value);
          } else {
            throw new Error('Missing Plugin: onesignal-cordova-plugin');
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
    
    function setSubscription(bool) {
      return $q(function(resolve, reject) {
        try {
          var pushNotification = $window.plugins && $window.plugins.OneSignal;
          
          if (pushNotification) {
            pushNotification.setSubscription(bool);
          } else {
            throw new Error('Missing Plugin: onesignal-cordova-plugin');
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
    
    function register(success, error) {
      try {
        var pushNotification = $window.plugins && $window.plugins.OneSignal;

        if (pushNotification) {
          $log.debug('Plugin OneSignal loaded');
        
          var iosSettings = {};
          iosSettings['kOSSettingsKeyAutoPrompt'] = true;
          iosSettings['kOSSettingsKeyInAppLaunchURL'] = false;
          
          var didReceiveRemoteNotificationCallBack = function(jsonData) {
            $rootScope.$emit('receive-notification', angular.toJson(jsonData));
          };
          var didOpenRemoteNotificationCallBack = function(jsonData) {
            $rootScope.$emit('open-notification', angular.toJson(jsonData));
          };
          
          // result.notification.payload.additionalData

          pushNotification.startInit(appId)
          .handleNotificationReceived(didReceiveRemoteNotificationCallBack)
          .handleNotificationOpened(didOpenRemoteNotificationCallBack)
          .inFocusDisplaying(pushNotification.OSInFocusDisplayOption.InAppAlert)
          .iOSSettings(iosSettings)
          .endInit();
          
          pushNotification.getIds(function(ids) {
            var pushIds = {};
            pushIds.token = ids.pushToken;
            pushIds.uuid = ids.userId;
            success(pushIds);
          });
          
          pushNotification.getTags(function(tags) {
            //alert('get Push Tags:\n' + angular.toJson(tags));
            $log.debug('Tags Received: ' + angular.toJson(tags));
          });
        } else {
          throw new Error('Missing Plugin: onesignal-cordova-plugin');
        }
      } catch (error) {
        $exceptionHandler(error);
      }
    };
	}
})();
(function () {
  'use strict';
  
mediaClickLabel.$inject = ["MIMES"];
mediaIconClass.$inject = ["MIMES"];
mediaOpenClass.$inject = ["MIMES"];
  angular
  .module('ngMeumobi.Cordova.files', ['slugifier'])
  .constant('MIMES', {
    'application/pdf': {
      class: 'fa-file-pdf-o',
      label: 'View',
      extension: 'pdf',
      download: true
    },
    'text/html': {
      class: 'fa-rss',
      label: 'Open',
      extension: 'html',
      download: false
    },
    'application/vnd.youtube.video+html': {
      class: 'fa-youtube-play',
      openClass: 'fa-play',
      label: 'Play',
      extension: 'html',
      download: false
    },
    'application/vnd.ms-excel': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    },
    'application/xlsx': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    },
    'audio/mpeg': {
      class: 'fa-file-audio-o',
      label: 'Play',
      openClass: 'fa-play',
      extension: 'mp3',
      download: true
    },
    'video/mp4': {
      class: 'fa-file-video-o',
      label: 'Play',
      openClass: 'fa-play',
      extension: 'mp4',
      download: true
    },
    'application/vnd.ms-powerpoint': {
      class: 'fa-file-powerpoint-o',
      label: 'View',
      extension: 'ppt',
      download: true,
    },
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': {
      class: 'fa-file-excel-o',
      label: 'View',
      extension: 'xls',
      download: true
    }
  })
  .filter('mediaClickLabel', mediaClickLabel)
  .filter('mediaIconClass', mediaIconClass)
  .filter('mediaOpenClass', mediaOpenClass) 
  .provider('meuFiles', files); 
        
  function files() {
    var fileTransfers = {};
    var files = {};
    var options = {
      localFolder: 'Downloads'
    };
    var statuses = {
      download: 'download',
      downloading: 'downloading',
      downloaded: 'downloaded'
    };
    
    this.setOptions = function(options) {
      angular.extend(options, opt);
    };

    this.setOption = function(name, value) {
      options[name] = value;
    };

    this.$get = ["$q", "$log", "$window", "MIMES", "Slug", function($q, $log, $window, MIMES, Slug) {
      var api = {};
      var service = {};
      
      /**
      *  Api methods, available only on the inside the service
      */

      api.fileErrorHandler = function(e) {
        /*
        List of Errors cordova-plugin-file
        https://github.com/apache/cordova-plugin-file#list-of-error-codes-and-meanings
        For the meaning I recommend to read https://wicg.github.io/entries-api/#common-types
        */
        switch (e.code) {
        case FileError.NOT_FOUND_ERR:
          e.message = 'Requested file could not be found';
          break;
        case FileError.SECURITY_ERR:
          e.message = 'SECURITY_ERR';
          break;
        case FileError.ABORT_ERR:
          e.message = 'ABORT_ERR';
          break;
        case FileError.NOT_READABLE_ERR:
          e.message = 'NOT_READABLE_ERR';
          break;
        case FileError.ENCODING_ERR:
          e.message = 'Malformed URI';
          break;
        case FileError.NO_MODIFICATION_ALLOWED_ERR:
          e.message = 'NO_MODIFICATION_ALLOWED_ERR';
          break;
        case FileError.INVALID_STATE_ERR:
          e.message = 'INVALID_STATE_ERR';
          break;
        case FileError.SYNTAX_ERR:
          e.message = 'SYNTAX_ERR';
          break;
        case FileError.INVALID_MODIFICATION_ERR:
          e.message = 'INVALID_MODIFICATION_ERR';
          break;
        case FileError.QUOTA_EXCEEDED_ERR:
          e.message = 'QUOTA_EXCEEDED_ERR';
          break;
        case FileError.TYPE_MISMATCH_ERR:
          e.message = 'TYPE_MISMATCH_ERR';
          break;
        case FileError.PATH_EXISTS_ERR:
          e.message = 'PATH_EXISTS_ERR';
          break;
        default:
          e.message = 'Unknown Error';
          break;
        }
        $log.debug('Error: ' + e.message);
        
        return e;
      };
      
      api.fileTransferErrorHandler = function(e) {
        /*
        A FileTransferError object is passed to an error callback when an error occurs.
        https://github.com/apache/cordova-plugin-file-transfer#filetransfererror
        */
        switch (e.code) {
        case FileTransferError.FILE_NOT_FOUND_ERR:
          e.message = 'FILE_NOT_FOUND_ERR';
          break;
        case FileTransferError.INVALID_URL_ERR:
          e.message = 'INVALID_URL_ERR';
          break;
        case FileTransferError.CONNECTION_ERR:
          e.message = 'CONNECTION_ERR';
          break;
        case FileTransferError.ABORT_ERR:
          e.message = 'Operation aborted';
          break;
        case FileTransferError.NOT_MODIFIED_ERR:
          e.message = 'NOT_MODIFIED_ERR';
          break;
        default:
          e.message = 'Unknown Error';
          break;
        }
        $log.debug('Error: ' + e.message);
        
        return e;
      };

      api.getFilesFromLocalStorage = function() {
        /*
        Check if files is already loaded (if not is empty)
        TODO: is loading localStorage['files] for each media, should be optimized to only load once for all
        */
        if (!Object.keys(files).length  && localStorage['files']) { 
          var entries = angular.fromJson(localStorage['files']);
          files = api.checkRepositoryConsistency(entries);
        }
        return files;
      };
      
      api.getFileName = function(file) {
        var ext = file.extension || '';
        
        if (!ext && MIMES[file.type])
          ext = MIMES[file.type].extension;
                
        var name = file.title || '';
        
        if (!name) {
          name = md5(file.url);
        } else {
          name = Slug.slugify(name);
        }
                          
        return name + '.' + ext;
      };
      
      api.checkRepositoryConsistency = function(entries) {
        /*
        id must be equals to file.path
        and fullPath can be updated if App is updated (iOS)
        */
        var obj = {};
        Object.keys(entries).forEach(function(key,index) {
          obj[entries[key].path] = entries[key];
          obj[entries[key].path].fullPath = api.getFileFullPath(entries[key].path);
        });
        localStorage['files'] = angular.toJson(obj);

        return obj;
      };
      
      // Returns the full absolute path from the root to the FileEntry
      api.getFileFullPath = function (fileName) {
        var rootPath = null;
        if (device.platform == 'Android') {
          rootPath = cordova.file.externalDataDirectory;
        } else {
          rootPath = cordova.file.dataDirectory;
        }
        return api
          .getDownloadDirEntry(rootPath, options.localFolder)
          .then((dirEntry) => dirEntry.nativeURL + fileName);
      };
      
      api.getFilePath = function (fileName) {
        return options.localFolder + '/' + fileName;
      };
      
      //add file to localstorage
      api.addFile = function(file) {
        files[file.path] = file;
        localStorage['files'] = angular.toJson(files);
      };
      
      //remove file from localstorage
      api.removeFile = function(id) {
        delete files[id];
        localStorage['files'] = angular.toJson(files);
      };
      
      //get files handler
      api.getFileEntry = function (path) {
        var q = $q.defer();
        $window.resolveLocalFileSystemURL(
          path, 
          function(entry) {
            q.resolve(entry);
          },
          function(error) {
            $log.debug(error);
            error = api.fileErrorHandler(error);
            q.reject(error);
          }
        );
        return q.promise;
      };
      
      api.isDownloaded = function(filePath) {
        /*
        TODO: If status is downloaded but local file is missing then return FALSE
        Keep record on localstorage to appears as file already downloaded, user can re-download if needed
        */
        return !!api.getFilesFromLocalStorage()[filePath];
      };
      
      api.isDownloading = function(filePath) {
        return !!fileTransfers[filePath];     
      };
      
      api.getFileStatus = function(filePath) {
        if (api.isDownloaded(filePath)) {
          return statuses.downloaded;
        } else if (api.isDownloading(filePath)) {
          return statuses.downloading;
        } else {
          return statuses.download; 
        }
      };
    
      /**
      * Service methods, that are public and available for any resource
      */
      // File available statuses, best for debug and maitain than just string.
      
      service.download = download;
      service.decorateFile = decorateFile;
      service.remove = remove;
      service.list = api.getFilesFromLocalStorage;
      service.open = open;
      service.isDownloadable = isDownloadable;
      service.openFileOpener = openFileOpener;
      
      return service;
      
      /*
      Install: cordova plugin add cordova-plugin-file-opener2
      https://www.npmjs.com/package/cordova-plugin-file-opener2
      */
      
      function isDownloadable(file) {
        return (file.type in MIMES) ? MIMES[file.type].download : true;
      }
      
      function openFileOpener(uri, type) {
        var q = $q.defer();

        cordova.plugins.fileOpener2.open(uri, type, {
          error: function (e) {
            q.reject(e);
          }, success: function () {
            q.resolve();
          }
        });
        return q.promise;
      };
      
      function open(file) {
        var q = $q.defer();
        var cb_entry = {
          success: function(entry) {
            openFileOpener(entry.toURL(), file.type).then(
              function() {
                q.resolve();
              },
              function(e) {
                q.reject(e);
              }
            );
          },
          fail: function(e) {
            q.reject(e);
          }
        };
        
        file.fullPath = api.getFileFullPath(file.path);
        api.getFileEntry(file.fullPath)
        .then(function(entry) {
          cb_entry.success(entry);
        }, function(e) {
          cb_entry.fail(e);
        }
      );
        
      return q.promise;
    };
      
    function download(file) {
      var q = $q.defer();
      var ft = new FileTransfer();
      var uri = encodeURI(file.url);
        
      file.status = statuses.downloading;
      file.fullPath = api.getFileFullPath(file.path);
      fileTransfers[file.path] = ft;

      ft.onprogress = function (progress) {
        q.notify(progress);
      };

      q.promise.abort = function () {
        ft.abort();
      };

      var cb_download = {
        success: function(fileEntry) {
          file.status = statuses.downloaded;
          api.addFile(file);
          delete fileTransfers[file.path];
          q.resolve(file);
        },
        fail: function(error) {
          $log.debug(error);
          file.status = statuses.download;
          error = api.fileTransferErrorHandler(error);
          delete fileTransfers[file.path];
          q.reject(error);
        }
      };
      ft.download(uri, file.fullPath, cb_download.success, cb_download.fail, false);
        
      return q.promise;
    };
      
    function remove(file) {
      var q = $q.defer();

      file.fullPath = api.getFileFullPath(file.path);
      api.getFileEntry(file.fullPath)
      .then(function(entry) {
        entry.remove(
          function (status) {
            api.removeFile(file.path);
            file.status = statuses.download;
            q.resolve(file);
          },function (error) {
            q.reject(error);
          }
        );
      }, function(error) {
        file.status = statuses.download;
        q.reject(error);
      }
    );
        
    return q.promise;
  }
      
  function decorateFile(file) {
    file.name = file.name || api.getFileName(file);
    file.path = file.path || api.getFilePath(file.name);
    file.status = api.getFileStatus(file.path);
        
    /*
    If device not exists then app run on browser
    */
    if (!typeof(device)) {
      var fullPath = api.getFileFullPath(file.path);
      if (api.isDownloaded(fullPath))
        file.fullPath = fullPath;
    };

    return file;
  };
}];
};
  
function mediaClickLabel(MIMES) {
  return function(type) {
    return MIMES[type] ? MIMES[type].label : 'Open';
  };
}
	
function mediaIconClass(MIMES) {
  return function(type) {
    return MIMES[type] ? MIMES[type].class : 'fa-external-link';
  };
}
  
function mediaOpenClass(MIMES) {
  return function(type) {
    return (MIMES[type] && MIMES[type].openClass )? MIMES[type].openClass : 'fa-eye';
  };
}
})();
(function() {
	'use strict';

  dialogs.$inject = ["$q", "$window", "$exceptionHandler"];
	angular
	.module('ngMeumobi.Cordova.dialogs', [])
	.factory('meuDialogs', dialogs);
  
  /*
    install   :     cordova plugin add cordova-plugin-dialogs nl.x-services.plugins.toast
    link      :     https://github.com/apache/cordova-plugin-dialogs
    link      :     https://github.com/EddyVerbruggen/Toast-PhoneGap-Plugin  
  */
  
  function dialogs($q, $window, $exceptionHandler) {
    
    var service = {};
    
    service.alert = alert;
    service.confirm = confirm;
    service.toast = toast;
    
    return service;
    
    function alert(message, title, buttonName) {
      var q = $q.defer();

      if (!$window.navigator.notification) {
        $window.alert(message);
        q.resolve();
      } else {
        navigator.notification.alert(message, function () {
          q.resolve();
        }, title, buttonName);
      }

      return q.promise;
    };
    
    /*
      
      buttonLabels: Array of strings specifying button labels. (Array) (Optional, defaults to [OK,Cancel])
    */
    function confirm(message, title, buttonLabels) {
      return $q(function(resolve, reject) {
        try {
          title = (angular.isDefined(title)) ? title : 'Confirm';

          if (!$window.navigator.notification) {
            if ($window.confirm(message)) {
              resolve(1);
            } else {
              resolve(2);
            }
          } else {
            navigator.notification.confirm(message, function (buttonIndex) {
              resolve(buttonIndex);
            }, title, buttonLabels);
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
    
    function toast(message) {
      return $q(function(resolve, reject) {
        try {
    			var toast = $window.plugins && $window.plugins.toast;
      
    			if (toast) {
            toast.showLongBottom(message, function (response) {
              resolve(response);
            }, function (error) {
              reject(error);
            });
          } else {
            alert(message);
          }          
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
  }
})();
(function() {
	'use strict';
  
	cdvDevice.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
	angular
	.module('ngMeumobi.Cordova.device', [])
	.factory('meuDevice', cdvDevice);
  
  /*
    npm install: 
      https://www.npmjs.com/package/cordova-plugin-device
      https://www.npmjs.com/package/cordova-plugin-uniquedeviceid
      https://www.npmjs.com/package/cordova-plugin-appversion
  
    install: cordova plugin add cordova-plugin-device cordova-plugin-uniquedeviceid cordova-plugin-appversion
  
    How to use it: 
      meuDevice.getUUID()
      .then(function(result) {})
      .catch(function(error) {});
  */
  
	function cdvDevice($log, $window, $q, $exceptionHandler) {
    
    var service = {};
    
    service.getUUID = getUUID;
    service.getInformations = getInformations;
    service.getAppVersion = getAppVersion;
    
    return service;
    
    /*
      Return (String) Value
    */
    
    function getUUID() {
      
      return $q(function (resolve, reject) {
        
        var cb_uuid = {
          success: function(uuid) {
            resolve(uuid);
          },
          fail: function() {
            throw new Error('[CALLBACK FAILURE]: uniqueDeviceID.get');
          }
        };
        try {
          var uniqueDeviceID = $window.plugins && $window.plugins.uniqueDeviceID;
        
          if (uniqueDeviceID) {
            uniqueDeviceID.get(cb_uuid.success, cb_uuid.fail);
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-uniquedeviceid');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }
    
    /*
      Return Object {model: ..., platform: ..., platform_version: ..., manufacturer: ...}
    */
    
    function getInformations() {
                    
      return $q(function(resolve, reject) {
        var properties = {};
        
        try {
          /*eslint-disable angular/definedundefined */
          if (typeof device !== 'undefined') {
          /*eslint-enable angular/definedundefined */
    				properties.model = device.model;
    				properties.platform = device.platform;
    				properties.platform_version = device.version;
    				properties.manufacturer = device.manufacturer;
          } else {
    				// Running on Web Browser
    				properties.model = navigator.userAgent;
          }
          resolve(properties); 
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }     
      });
    }
    
    /*
      Return Object {app_version: ..., app_build: ...}
    */
    
    function getAppVersion() {
      
      return $q(function(resolve, reject) {
        var properties = {};
      
        try {
          /*eslint-disable angular/definedundefined */
          if (typeof AppVersion !== 'undefined') {
          /*eslint-enable angular/definedundefined */
    				properties.app_version = AppVersion.version;
    				properties.app_build = AppVersion.build;
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-appversion');
          }
          
          resolve(properties);
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        } 
      });
    }
	}
})();
(function() {
  'use strict';
  
  callNumberCordova.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
  callNumber.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
  meuCallNumber.$inject = ["$injector", "$window"];
  angular
  .module('ngMeumobi.Cordova.callNumber', [])
  .factory('callNumberCordova', callNumberCordova)
  .factory('callNumber', callNumber)
  .factory('meuCallNumber', meuCallNumber);
  
  /*
  install   :     cordova plugin add https://github.com/Rohfosho/CordovaCallNumberPlugin.git
  
  npm install https://www.npmjs.com/package/call-number
  
  How to use it: 
  meuCordova.callNumber(number, true)
  .then(function(result) {})
  .catch(function(error) {});
  */
		
  function callNumberCordova($log, $window, $q, $exceptionHandler) {
    
    return function(number, bypassAppChooser) {
      
      return $q(function(resolve, reject) {
        try {
          if (angular.isUndefined(bypassAppChooser)) {
            bypassAppChooser = false;
          }
          var cb_callNumber = {
            success: function(result) {
              resolve(result);
            },
            fail: function(result) {
              $log.debug(result);
              reject(result);
            }
          };
      
          var CallNumber = $window.plugins && $window.plugins.CallNumber;
      
          if (CallNumber) {
            CallNumber.callNumber(cb_callNumber.success, cb_callNumber.fail, number, bypassAppChooser);
          } else {
            throw new Error('Missing CordovaCallNumber Plugin');
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
  }
  
  function callNumber($log, $window, $q, $exceptionHandler) {
    
    return function(number, bypassAppChooser) {
      return $q(function(resolve, reject) {
        try {
          if (angular.isUndefined(bypassAppChooser)) {
            bypassAppChooser = false;
          }
          var passedNumber = encodeURIComponent(number);
          $window.location = 'tel:' + passedNumber;
          resolve();
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
  }
  
  function meuCallNumber($injector, $window) {

    var CallNumber = $window.plugins && $window.plugins.CallNumber;
    
    if ($window.cordova && CallNumber) {
      return $injector.get('callNumberCordova');
    } else {
      return $injector.get('callNumber');
    }
  }
})();
(function() {
	'use strict';

	angular
	.module('ngMeumobi.Cordova.calendar', [])
	.factory('meuCalendar', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', calendar]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin.git
    If start and end_date equal 00:00 then the event occurs all day long
  */
  
  function calendar($q, $window, striptags, br2nl, $exceptionHandler) {
    
    var service = {};
    
    service.createEventInteractively = createEventInteractively;
    
    return service;
    
    function createEventInteractively(options) {
      var defaultOptions = {
        title: null,
        address: null,
        description: '',
        start_date: null,
        end_date: null
      };

      defaultOptions = angular.extend(defaultOptions, options);
      
      return $q(function(resolve, reject) {
        try {
          $window.plugins.calendar.createEventInteractively(
            striptags(defaultOptions.title),
            striptags(defaultOptions.address),
            striptags(br2nl(defaultOptions.description)),
            new Date(defaultOptions.start_date  * 1000),
            new Date(defaultOptions.end_date  * 1000),
            function (message) {
              resolve(message);
            }, function (e) {
              reject(e);
            }
          );
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
  }
})();
(function() {
	'use strict';
  
	googleAnalytics.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
	analytics.$inject = ["$injector", "$window"];
	angular
	.module('ngMeumobi.Cordova.analytics', [])
	.factory('googleAnalytics', googleAnalytics)
	.factory('meuAnalytics', analytics);

  function googleAnalytics($q, $window, $log, $exceptionHandler) {

    var service = {};
    
    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.startTrackerWithId  = startTrackerWithId;
    
    return service;
    
    function trackView(screenName) {
      return $q(function(resolve, reject) {
        try {
          $log.debug('Track View: ' + screenName);
          ga('set', {
            page: screenName,
            title: screenName
          });
          ga('send', 'pageview');
          resolve();
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
    
    function trackEvent(category, action, label, value) {
      return $q(function(resolve, reject) {
        try {
          var ev = [category, action, label, value];
          $log.debug('Track Event: ' + ev.toString());
          ga('send', 'event', {
            eventCategory: category,
            eventLabel: label,
            eventAction: action,
            eventValue: value
          });
          resolve();
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
    
    function startTrackerWithId(id) {
      return $q(function(resolve, reject) {
        try {
          $log.debug('Start tracking GA Id: ' + id);
          ga('create', {
            storage: 'none',
            trackingId: id,
            clientId: $window.localStorage.getItem('ga:clientId')
          });
          ga('set', {
            checkProtocolTask: null,
            checkStorageTask: null,
            transportUrl: 'https://www.google-analytics.com/collect'
          });
          ga(function (tracker) {
            if ( !$window.localStorage.getItem('ga:clientId') ) {
              $windowlocalStorage.setItem( 'ga:clientId', tracker.get('clientId') );
            }
          });
          resolve();
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
	}
  
	function analytics($injector, $window) {
		  return $injector.get('googleAnalytics');
	}
})();
(function() {
  'use strict';
  
  angular
  .module('ngMeumobi.Utils.localStorage', [])
  .factory('meuLocalStorage', localStorage);
  
  function localStorage() {
    
    var service = {};
    
    service.getObject = getObject;
    service.setObject = setObject;
    service.removeObject = removeObject;
    service.contains = contains;
    
    return service;
    
    function getObject(key) {
      return angular.fromJson(localStorage.getItem(key));
    };

    function setObject(key, value) {
      localStorage.setItem(key, angular.toJson(value));
    };

    function removeObject(key) {
      localStorage.removeItem(key);
    };

    function contains(key) {
      return localStorage.getItem(key) ? true : false;
    };
  }
})();
(function() {
  'use strict';

  httpWithFallback.$inject = ["$q", "$log", "$exceptionHandler", "$http"];
  angular
  .module('ngMeumobi.Utils.httpWithFallback', [])
  .factory('meuHttpWithFallback', httpWithFallback);
  
  function httpWithFallback($q, $log, $exceptionHandler, $http) {

    // Constructor function, using $http as prototype
    function HttpWithFallback() { }
    HttpWithFallback.prototype = $http;
    HttpWithFallback.prototype.constructor = HttpWithFallback;

    var httpWithFallback = new HttpWithFallback();

    var prepareStoredResponse = function(storedResponse) {
      // Data was successfully retrieved from local storage, resolve with status 200
      storedResponse = angular.fromJson(storedResponse);
      var headers = storedResponse.headers;
      storedResponse.headers = function() { return headers; };
      return storedResponse;
    };

    var makeRequest = function(url, config, deferred) {
      $http.get(url, config)
      .then(
        function(response) {
          $log.debug('[httpWithFallback]: then response success status:' + response.status);
          // Store in local storage when status === 200
          if (!response.config.dontStoreFallback && response.status === 200) {
            localStorage.setItem(url, angular.toJson({
              data: response.data,
              status: response.status,
              config: response.config,
              headers: response.headers(),
              isFallback: true
            }));
          }
          // Resolve with original response
          if (response.headers('etag') === response.config['If-None-Match'])
            response.unchanged = true;
          deferred.resolve(response);
        },
        function(response) {
          $log.debug('[httpWithFallback]: then response fail status:' + response.status);
          // Try to retrieve from local storage
          var storedResponse = localStorage.getItem(url);
          if (storedResponse) {
            return deferred.resolve(prepareStoredResponse(storedResponse));
          }

          // Try config.fallback
          if (response.config.fallback) {
            return deferred.resolve({
              data: config.fallback,
              status: response.status,
              headers: response.headers,
              config: response.config,
              isFallback: true
            });
          }

          // Reject with original error response
          return deferred.reject(response);
        }
      );

      // Decorate promise with success and error functions to be compatible with the promise returned by $http.get
      var promise = deferred.promise;

      promise.success = function(fn) {
        promise.then(function(response) {
          fn(response.data, response.status, response.headers, config, response.isFallback);
        });
        return promise;
      };

      promise.error = function(fn) {
        promise.then(null, function(response) {
          fn(response.data, response.status, response.headers, config);
        });
        return promise;
      };

      return promise;
    };
    /**
    * Override $http.get to catch the promise.error
    */
    httpWithFallback.get = function(url, config) {
      // Client doesn't support local storage
      if (!localStorage) {
        // If no fallback defined, just just $http.get
        if (!config.fallback) {
          return $http.get(url, config);
        }
        // Local storage won't be used
        config.dontStoreFallback = true;
      }

      // Delegate get to $http
      var deferred = $q.defer();
      var storedResponse = localStorage.getItem(url);

      if (storedResponse) {
        //second promise to update data after request
        var deferredRequest = $q.defer();
        storedResponse = prepareStoredResponse(storedResponse);
        var cache = storedResponse;          
        // If config is undefined, ie httpWithFallback.get(PATH)
        // config = typeof config !== 'undefined' ? config : {};
        config = angular.isDefined(config) ? config : {};         
        if (cache && cache.headers())
          config['If-None-Match'] = cache.headers().etag;
        storedResponse.promise = makeRequest(url, config, deferredRequest);
        deferred.resolve(storedResponse);
        return deferred.promise;
      }
      //don't have local, continue to request
      return makeRequest(url, config, deferred);
    };

    return httpWithFallback;
  };
})();
(function() {
	'use strict';

	loadingInterceptor.$inject = ["$q", "$rootScope", "$log"];
  errorInterceptor.$inject = ["$q", "$rootScope", "$log"];
	angular
	.module('ngMeumobi.Utils.httpInterceptors', [])
	.factory('meuLoadingInterceptor', loadingInterceptor)
  .factory('meuErrorInterceptor', errorInterceptor);
	
	function loadingInterceptor($q, $rootScope, $log) {
		
		var numLoadings = 0;
		
		return {
			request: function(config) {
        if (!numLoadings++) {
          $rootScope.$broadcast('loading:start');
        }

				return config || $q.when(config);
			},
			response: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return response || $q.when(response);
			},
			requestError: function(request) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return $q.reject(request);
			},
			responseError: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}
				
				return $q.reject(response);
			}
		};
	}
  
  function errorInterceptor($q, $rootScope, $log) {
    
  	return {
  		request: function(config) {
        
  			return config || $q.when(config);
  		},
  		requestError: function(request) {
        
  			return $q.reject(request);
  		},
  		response: function(response) {
        
  			return response || $q.when(response);
  		},
  		responseError: function(response) {
  			$log.debug('[API:errorInterceptor]: BEGIN');
        $log.debug('Response Status: ' + response.status);
  			$log.debug(response);
  			$log.debug('[API:errorInterceptor]: END');
  			if (response && response.status === -1) {} // Client timeout fired
        if (response && response.status === 0) {} // network offline or CORS error
  			if (response && response.status === 404) {}
  			if (response && response.status === 401) {
          $rootScope.$broadcast('error:401');
  			}
  			if (response && response.status === 408) {} // Server timed out waiting for the request.
  			if (response && response.status >= 500) {}
        
  			return $q.reject(response);
  		}
  	};
  }
})();
(function() {
	'use strict';
  
	deviceReady.$inject = ["$log", "$window"];
	angular
	.module('ngMeumobi.Utils.deviceReady', [])
	.factory('meuDeviceReady', deviceReady);
  
  /*
  
    How to use it: 
      meuDeviceReady(function() {
        ...
      });
  */
  
	function deviceReady($log, $window) {
		return function(done) {
			if (angular.isObject($window.cordova)) {
        /*eslint-disable angular/document-service */
        document.addEventListener('deviceready', function(event) {
					done();
				}, false);
        /*eslint-enable angular/document-service */
			} else {
				done();
			}
		};
	}
})();
(function() {
  'use strict';
  
  authentication.$inject = ["$http", "$rootScope", "$timeout"];
  angular
  .module('ngMeumobi.Utils.authentication', [])
  .factory('meuAuthentication', authentication);
  
  /*
  Inspired by Jason Watmore Blog Post
  http://jasonwatmore.com/post/2014/05/26/angularjs-basic-http-authentication-example
  */

  function authentication($http, $rootScope, $timeout) {
    
    var service = {};
    service.SetCredentials = function (data) { 
      /*
      *  data.visitor && data.token
      */
      $rootScope.auth = data;

      $http.defaults.headers.common['X-Visitor-Token'] = data.token;
      localStorage.globals = angular.toJson($rootScope.auth);
    };

    service.ClearCredentials = function () {
      $rootScope.auth = {};
      localStorage.removeItem('auth');
      delete $http.defaults.headers.common['X-Visitor-Token'];
    };

    return service;
  }
})();
(function(global) {
  'use strict';

  utils.$inject = ["meuLocalStorage", "meuDeviceReady", "meuLoadingInterceptor", "meuErrorInterceptor", "meuHttpWithFallback"];
  angular
  .module('ngMeumobi.Utils', [
    'ngMeumobi.Utils.localStorage',
    'ngMeumobi.Utils.deviceReady',
    'ngMeumobi.Utils.httpInterceptors',
    'ngMeumobi.Utils.authentication',
    'ngMeumobi.Utils.httpWithFallback'
  ])
  .factory('meuUtils', utils);
  
  function utils(
    meuLocalStorage,
    meuDeviceReady,
    meuLoadingInterceptor,
    meuErrorInterceptor,
    meuHttpWithFallback
  ) {
	
    var service = {};
	
    service.localStorage = meuLocalStorage;
    service.deviceReady = meuDeviceReady;
    service.loadingInterceptor = meuLoadingInterceptor;
    service.errorInterceptor = meuErrorInterceptor;
    service.httpWithFallback = meuHttpWithFallback;
      
    return service;
  }
})(this);

(function() {
  'use strict';

  cordova.$inject = ["meuAnalytics", "meuCalendar", "meuCallNumber", "meuDevice", "meuDialogs", "meuFiles", "meuSocialSharing", "meuSpinnerDialog", "meuSplashscreen"];
  angular
  .module('ngMeumobi.Cordova', [
    'ngMeumobi.Cordova.analytics',
    'ngMeumobi.Cordova.calendar',
    'ngMeumobi.Cordova.callNumber',
    'ngMeumobi.Cordova.device',
    'ngMeumobi.Cordova.dialogs',
    'ngMeumobi.Cordova.files',
    'ngMeumobi.Cordova.socialSharing',
    'ngMeumobi.Cordova.spinnerDialog',
    'ngMeumobi.Cordova.splashscreen',
    'ngMeumobi.Cordova.push'
  ])
  .factory('meuCordova', cordova);
  
  function cordova(
    meuAnalytics, 
    meuCalendar, 
    meuCallNumber, 
    meuDevice, 
    meuDialogs,
    meuFiles,
    meuSocialSharing,
    meuSpinnerDialog,
    meuSplashscreen
  ) {
	
    var service = {};
	
    service.analytics = meuAnalytics;
    service.calendar = meuCalendar;
    service.callNumber = meuCallNumber; 
    service.device = meuDevice;
    service.dialogs = meuDialogs;
    service.files = meuFiles;
    service.socialSharing = meuSocialSharing;
    service.spinnerDialog = meuSpinnerDialog;
    service.splashscreen = meuSplashscreen;
      
    return service;
  }
})();
(function() {
  'use strict';

  API.$inject = ["$rootScope", "$http", "$log", "$exceptionHandler", "meuHttpWithFallback"];
  angular
  .module('ngMeumobi.Utils')
  .provider('meuCloud', meuCloudProvider)
  .factory('meuAPI', API);
  
  function meuCloudProvider() {
    
    meuCloud.$inject = ["$q", "$window", "$log", "$exceptionHandler", "meuUtils", "meuAPI"];
    var options = {},
        data = {};
    
    this.setOptions = function(opt) {
      angular.extend(options, opt);
    };

    this.setOption = function(name, value) {
      options[name] = value;
    };
    
    this.$get = meuCloud;
    
    function meuCloud($q, $window, $log, $exceptionHandler, meuUtils, meuAPI) {
    
/*
  Helpers
*/
      var Helpers = {
        lookup: function(array) {
          var token = 'id';
          // Identify if it's an array of items (item._id) or category (category.id)
          if (array[0] && array[0].hasOwnProperty('_id'))
            token = '_id';
          return Helpers.lookupByToken(array, token);
        },
        lookupByToken: function(array, token) {
          var lookup = [];
          for (var i = 0, len = array.length; i < len; i++) {
              lookup[array[i][token]] = array[i];
          }
          return lookup;
        },
        isFreshResponse: function(response) {
          var isFallback = response.hasOwnProperty('isFallback') ? response.isFallback : null;
          var unchanged = response.hasOwnProperty('unchanged') ? response.unchanged : null;
        
          return !(unchanged || isFallback);
        },
        getCategoriesTree: function(categories) {
          var children = [];
          children[0] = [];
          for(var key in categories) {
            var parent_id = categories[key].parent_id != null ? categories[key].parent_id : 0;
            if (!children[parent_id])
              children[parent_id] = [];
            children[parent_id].push(categories[key]);
          }
          for(var key in categories) {
            var category = categories[key];
            category.children = [];
            if (children[category.id])
              category.children = children[category.id];
          }
          return children[0];
        }
      };

/****************************************************************/ 
    
      var service = {};

      service.helpers = Helpers;
      service.getCategory = getCategory;
      service.syncPerformance = syncPerformance;
      service.API = meuAPI;
      service.init = init;
      service.getSiteLogoUrl = getSiteLogoUrl;
      service.getSiteProperty = getSiteProperty;
      service.getAssetUrl = getAssetUrl;
    
      return service;
    
      /*
        meuCloud.API.Site.performance()
        .then(function(response) {
          updateData(response);
          if (response.promise)
            return response.promise;
        })
        // If response contains a promise, means is from cache and promise will sync w/ Server
        .then(function(response) {
          updateData(response)
        })
        .catch(function(e) {
          $exceptionHandler(e);
        })
      
      */
      
      function init() {
        if (options.hasOwnProperty('apiUrl'))
          meuAPI.Config.setProperty('apiUrl', options.apiUrl);
        if (options.hasOwnProperty('timeout'))
          meuAPI.Config.setProperty('timeout', options.timeout);
      }
           
      function getCategory(id) {
        try {
          var categories = Helpers.lookup(data.categories);
          if (categories.hasOwnProperty(id)) {
            return categories[id];
          } else {
            return null;
          }
        } catch (e) {
          $exceptionHandler(e);
        };
      }
  
      function getData(property) {
        try {
          return data[property]; 
        } catch (e) {
          $exceptionHandler(e);
          return {};
        }
      }
      
      function getSiteProperty(property) {
        try {
          return data.site[property]; 
        } catch (e) {
          $exceptionHandler(e);
          return {};
        }
      }
      
      function getCategories() {
        return getData('categories');
      }
  
      function setCategories(categories) {
        data.categories = categories;
      }
      
      function setSite(site) {
        data.site = site;
      }
      
      function setVisitor(visitor) {
        data.visitor = visitor;
      }
      
      function getVisitor() {
        return data.visitor;
      }
      
      function getSiteLogoUrl() {
        try {
          return options.cdnUrl + data.site.logo; 
        } catch (e) {
          $exceptionHandler(e);
          return null;
        } 
      }
      
      function getAssetUrl(path) {
        try {
          return options.cdnUrl + path; 
        } catch (e) {
          $exceptionHandler(e);
          return null;
        } 
      }
      
      function setBusiness(business) {
        data.business = business;
      }
      
      function syncPerformance(data) {
        return $q(function(resolve, reject) {
          try {
            setCategories(data.categories);
            setSite(data.site);
            setBusiness(data.business);
            resolve(data);
          } catch (e) {
            $exceptionHandler(e);
            reject(e);
          };
        });
      }
    }
  }
  
  function API($rootScope, $http, $log, $exceptionHandler, meuHttpWithFallback) {
  
    var config = {
      timeout: 10000
    };
        
    var convertJsonAsUriParameters = function(data) {
      var url = Object.keys(data).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]);
      }).join('&');
    
      return url;
    };

    var buildUrl = function(endp) {
      try {
        /*
          If config.domain is null then use domain empty
        config.domain !== null && config.domain != undefined
        */
        var domain = (config.domain) ? config.domain : '';
        
        return config.apiUrl + domain + endp; 
      } catch (e) {
        $exceptionHandler(e);
      }
    };

    var api = (function() {
      return {
        get: function(endp, obj) {
          angular.extend(obj, {timeout: config.timeout});
      
          return meuHttpWithFallback.get(buildUrl(endp), obj);
        },
        post: function(endp, obj) {          
          return $http({
            method: 'POST',
            timeout: config.timeout,
            url: buildUrl(endp),
            data: angular.toJson(obj),
            responseType: 'json',
            headers: {
              'Content-Type': 'application/json'
            }
          });
        },
        put: function(endp, obj) {          
          return $http({
            method: 'PUT',
            timeout: config.timeout,
            url: buildUrl(endp),
            data: angular.toJson(obj),
            responseType: 'json',
            headers: {
              'Content-Type': 'application/json'
            }
          });
        },
        del: function(endp, id) {
          return $http({
            method: 'DELETE',
            timeout: config.timeout,
            url: buildUrl(endp),
            responseType: 'json',
          });
        }
      };
    })();

    var app = {
      Categories: (function() {
        var path = '/categories/';
        return {
          query: function() {
            // TODO: Need to be tested
            return api.get(path, {});
          },
          items: function(category_id, config) {
            return api.get(path + category_id + '/items', config);
          }
        };
      })(),
      Items: (function() {
        var path = '/items/';
        return {
          latest: function() {
            return api.get(path + 'latest', {});
          },
          search: function(obj) {
            var url = path + 'search?' + convertJsonAsUriParameters(obj);
            return api.get(url, {});
          }
        };
      })(),
      Site: (function() {
        var path = '/performance';
        return {
          performance: function() {
            return api.get(path, {});
          }
        };
      })(),
      Login: (function() {
        var path = '/visitors/';
        return {
          signin: function(obj) {
            return api.post(path + 'login', obj);
          },
          get: function() {
            return api.get(path, {});
          },
          save: function(obj) {
            return api.put(path, obj);
          },
          // TODO: Need to be tested
          device: function(obj) {
            return api.post(path + 'devices', obj);
          },
          // TODO: Need to be tested
          update: function(obj) {
            return api.put(path + 'devices/' + obj.uuid);
          },
          reset: function(obj) {
            return api.post(path + 'forgot_password', obj);
          }
        };
      })(),
      Devices: (function() {
        var path = '/devices/';
        return {
          save: function(obj) {
            return api.put(path + obj.uuid, obj);
          } 
        };
      })(),
      Poll: (function() {
        var path = '/items/';
        return {
          submit: function(obj) {
            return api.post(path + obj.id + '/poll', obj.params);
          }
        };
      })(),
      Mail: (function() {
        var path = '/mail/';
        return {
          save: function(obj) {
            return api.post(path, obj);
          }
        };
      })(),
      Config: (function() {
        return {
          setProperties: function(prop) {
            angular.extend(config, prop);
          },
          getProperties: function() {
            return config;
          },
          setProperty: function(name, value) {
            config[name] = value;
          },
          getProperty: function(name) {
            return config[name];
          }
        };
      })()
    };
    
    return app;
  }
})();
/* global angular */
/* eslint no-undef: "error" */
(function () {
  'use strict';

  hrefToJS.$inject = ["$sce", "$sanitize"];
  angular.module('ngMeumobi.Utils.filters', ['ngSanitize'])
  .filter('isEmpty', isEmpty)
  .filter('br2nl', br2nl)
  .filter('striptags', striptags)
  .filter('bytesToSize', bytesToSize)
  .filter('hrefToJS', hrefToJS)
  .filter('capitalize', capitalize);

  function isEmpty() {
    return function (obj) {
      return !Object.keys(obj).length;
    };
  }

  function br2nl() {
    return function (text) {
      return text.replace(/<br\s*[\/]?>/gi, '\n');
    };
  }

  function striptags() {
    return function (text) {
      return angular
      .element('<div/>')
      .html(text)
      .text();
    };
  }
  
  function capitalize() {
    return function(input, scope) {
      if (input!=null)
      input = input.toLowerCase();
      return input.substring(0,1).toUpperCase()+input.substring(1);
    } 
  }
  
  function bytesToSize() {
    return function(bytes) {
      if (bytes == 0) return '0 Byte';
      var k = 1000;
      var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
      var i = Math.floor(Math.log(bytes) / Math.log(k));
      return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];
    }
  }

  function hrefToJS ($sce, $sanitize) {
    return function(text) {
      var regex = /href="([\S]+)"/g;
      var newString = $sanitize(text).replace(regex, "onClick=\"window.open('$1', '_blank', 'location=yes')\"");
      return $sce.trustAsHtml(newString);
    }
  }
})();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvcmRvdmEvU3RhdHVzYmFyLmpzIiwiQ29yZG92YS9TcGxhc2hzY3JlZW4uanMiLCJDb3Jkb3ZhL1NwaW5uZXJEaWFsb2cuanMiLCJDb3Jkb3ZhL1NvY2lhbFNoYXJpbmcuanMiLCJDb3Jkb3ZhL1B1c2guanMiLCJDb3Jkb3ZhL0ZpbGVzLmpzIiwiQ29yZG92YS9EaWFsb2dzLmpzIiwiQ29yZG92YS9EZXZpY2UuanMiLCJDb3Jkb3ZhL0NhbGxOdW1iZXIuanMiLCJDb3Jkb3ZhL0NhbGVuZGFyLmpzIiwiQ29yZG92YS9BbmFseXRpY3MuanMiLCJVdGlscy9Mb2NhbFN0b3JhZ2UuanMiLCJVdGlscy9IdHRwV2l0aEZhbGxiYWNrLmpzIiwiVXRpbHMvSHR0cEludGVyY2VwdG9ycy5qcyIsIlV0aWxzL0RldmljZVJlYWR5LmpzIiwiVXRpbHMvQXV0aGVudGljYXRpb24uanMiLCJVdGlscy5qcyIsIkNvcmRvdmEuanMiLCJDbG91ZC5qcyIsIm1ldS1maWx0ZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtFQUNBOzs7RUFFQTtHQUNBLE9BQUEsNkJBQUE7R0FDQSxRQUFBLGdCQUFBOzs7Ozs7Ozs7OztFQVdBLFNBQUEsVUFBQSxJQUFBLFNBQUEsTUFBQSxtQkFBQTs7SUFFQSxJQUFBLFVBQUE7SUFDQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxZQUFBO0lBQ0EsUUFBQSxhQUFBO0lBQ0EsUUFBQSxPQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxXQUFBLEtBQUE7TUFDQSxRQUFBLE9BQUEsU0FBQTs7O0lBR0EsU0FBQSxVQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0lBR0EsU0FBQSxPQUFBO01BQ0EsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7Ozs7QUMxQ0EsQ0FBQSxXQUFBO0VBQ0E7OztFQUVBO0dBQ0EsT0FBQSxrQ0FBQTtHQUNBLFFBQUEsbUJBQUE7Ozs7Ozs7Ozs7O0VBV0EsU0FBQSxhQUFBLElBQUEsU0FBQSxNQUFBLG1CQUFBOztJQUVBLE9BQUE7TUFDQSxNQUFBLFdBQUE7UUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7VUFDQSxJQUFBO1lBQ0EsSUFBQSxRQUFBLFVBQUEsY0FBQTtjQUNBLFFBQUEsVUFBQSxhQUFBO2NBQ0E7O1lBRUEsT0FBQSxHQUFBO1lBQ0Esa0JBQUE7WUFDQSxPQUFBO1dBQ0E7Ozs7TUFJQSxNQUFBLFdBQUE7UUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7VUFDQSxJQUFBO1lBQ0EsSUFBQSxRQUFBLFVBQUEsY0FBQTtjQUNBLFFBQUEsVUFBQSxhQUFBO2NBQ0E7O1lBRUEsT0FBQSxHQUFBO1lBQ0Esa0JBQUE7WUFDQSxPQUFBO1dBQ0E7Ozs7OztBQzNDQSxDQUFBLFdBQUE7RUFDQTs7O0VBRUE7R0FDQSxPQUFBLG1DQUFBO0dBQ0EsUUFBQSxvQkFBQTs7Ozs7Ozs7Ozs7RUFXQSxTQUFBLGNBQUEsSUFBQSxTQUFBLE1BQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsT0FBQTtJQUNBLFFBQUEsT0FBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEsT0FBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFVBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7VUFFQSxJQUFBLFNBQUE7WUFDQSxRQUFBO1lBQ0E7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7OztLQUdBOztJQUVBLFNBQUEsT0FBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFVBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7VUFFQSxJQUFBLFNBQUE7WUFDQSxRQUFBO2lCQUNBO1lBQ0EsTUFBQSxJQUFBLE1BQUE7O1VBRUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7S0FHQTs7O0FDMURBLENBQUEsV0FBQTtDQUNBOztDQUVBO0VBQ0EsT0FBQSxtQ0FBQTtFQUNBLFFBQUEsb0JBQUEsQ0FBQSxNQUFBLFdBQUEsbUJBQUEsZUFBQSxRQUFBOzs7Ozs7Ozs7Ozs7O0VBYUEsU0FBQSxjQUFBLElBQUEsU0FBQSxXQUFBLE9BQUEsTUFBQSxtQkFBQTs7SUFFQSxJQUFBLFVBQUE7SUFDQSxJQUFBLFVBQUE7TUFDQSxTQUFBOzs7SUFHQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFFBQUE7SUFDQSxRQUFBLDZCQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxXQUFBLFNBQUE7TUFDQSxRQUFBLE9BQUEsU0FBQTs7O0lBR0EsU0FBQSxVQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0VBR0EsU0FBQSwyQkFBQSxVQUFBO01BQ0EsSUFBQSxTQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O01BRUEsT0FBQSwyQkFBQSxVQUFBLHdCQUFBLGdCQUFBLGdCQUFBLFdBQUEsQ0FBQSxLQUFBLE1BQUE7OztJQUdBLFNBQUEsVUFBQSxNQUFBOztHQUVBLElBQUEsU0FBQTtLQUNBLFNBQUEsS0FBQTtRQUNBLFNBQUEsS0FBQTtRQUNBLE9BQUE7UUFDQSxLQUFBLEtBQUEsZUFBQSxVQUFBLEtBQUEsT0FBQTs7O01BR0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxXQUFBLFNBQUEsR0FBQTtJQUNBLE9BQUEsTUFBQSxLQUFBLEtBQUEsV0FBQSxHQUFBOzs7R0FHQSxPQUFBLE1BQUE7OztFQUdBLFNBQUEsV0FBQSxPQUFBOztHQUVBLElBQUEsU0FBQTtLQUNBLFNBQUEsTUFBQTtRQUNBLFNBQUEsTUFBQTtRQUNBLE9BQUE7UUFDQSxLQUFBLE1BQUE7Ozs7OztHQU1BLElBQUEsTUFBQSxlQUFBLGFBQUE7SUFDQSxPQUFBLE1BQUEsS0FBQSxNQUFBO0lBQ0EsT0FBQSxNQUFBO1VBQ0EsSUFBQSxNQUFBLGNBQUEsTUFBQSxXQUFBLFNBQUEsR0FBQTtJQUNBLE9BQUEsTUFBQSxLQUFBLE1BQUEsV0FBQSxHQUFBOzs7R0FHQSxPQUFBLE1BQUE7OztFQUdBLFNBQUEsTUFBQSxRQUFBOzs7Ozs7Ozs7OztNQVdBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTs7UUFFQSxJQUFBLFdBQUE7VUFDQSxTQUFBLFNBQUEsUUFBQTtZQUNBLFFBQUE7O1VBRUEsTUFBQSxTQUFBLEtBQUE7WUFDQSxNQUFBLElBQUEsTUFBQTs7OztRQUlBLElBQUE7VUFDQSxJQUFBLFNBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7T0FFQSxJQUFBLFFBQUE7WUFDQSxJQUFBLFFBQUEsU0FBQTtVQUNBLE9BQUEsV0FBQSxRQUFBOzs7WUFHQSxPQUFBLFVBQUEsT0FBQSxXQUFBLFVBQUEsTUFBQSxPQUFBO1lBQ0EsT0FBQSxVQUFBLE9BQUEsV0FBQSxVQUFBLE1BQUEsT0FBQTs7WUFFQSxPQUFBLGlCQUFBLFFBQUEsU0FBQSxTQUFBLFNBQUE7Y0FDQTtTQUNBLE1BQUEsSUFBQSxNQUFBOztVQUVBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOzs7OztBQzlIQSxDQUFBLFdBQUE7Q0FDQTs7OztDQUVBO0VBQ0EsT0FBQSwwQkFBQTtFQUNBLFFBQUEsYUFBQTtFQUNBLFFBQUEsYUFBQTs7Ozs7O0VBTUEsU0FBQSxjQUFBLE1BQUEsU0FBQSxXQUFBLG1CQUFBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLFNBQUE7SUFDQSxRQUFBLFdBQUE7O0lBRUEsT0FBQTs7SUFFQSxJQUFBO0lBQ0EsSUFBQTs7SUFFQSxTQUFBLE9BQUEsR0FBQSxHQUFBO01BQ0Esc0JBQUE7TUFDQSxrQkFBQTtLQUNBOzs7SUFHQSxTQUFBLFNBQUEsU0FBQSxNQUFBOztNQUVBLElBQUE7UUFDQSxJQUFBLG1CQUFBLFFBQUEsVUFBQSxRQUFBLFlBQUEsUUFBQSxRQUFBLFFBQUE7O1FBRUEsSUFBQSxrQkFBQTs7VUFFQSxVQUFBLEdBQUEscUJBQUEsU0FBQSxPQUFBO1lBQ0EsSUFBQSxlQUFBLE1BQUE7Ozs7Ozs7OztZQVNBLEtBQUEsTUFBQTtZQUNBLEtBQUEsTUFBQTs7O1VBR0EsaUJBQUEsY0FBQTtZQUNBLFdBQUE7WUFDQSxVQUFBOzs7O1VBSUEsaUJBQUE7WUFDQSxTQUFBLFFBQUE7Y0FDQSxJQUFBLFVBQUE7O2NBRUEsUUFBQSxRQUFBLE9BQUE7Y0FDQSxRQUFBOztZQUVBLFNBQUEsUUFBQTtjQUNBLE1BQUEsSUFBQSxNQUFBO2NBQ0EsS0FBQTs7OztVQUlBLGlCQUFBLDhCQUFBO2VBQ0E7VUFDQSxNQUFBLElBQUEsTUFBQTs7UUFFQSxPQUFBLE9BQUE7UUFDQSxrQkFBQTs7S0FFQTs7Ozs7Ozs7Q0FRQSxTQUFBLGNBQUEsTUFBQSxTQUFBLG1CQUFBLFlBQUEsSUFBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxTQUFBO0lBQ0EsUUFBQSxXQUFBO0lBQ0EsUUFBQSxVQUFBO0lBQ0EsUUFBQSxrQkFBQTs7SUFFQSxPQUFBOztJQUVBLElBQUE7RUFDQSxJQUFBOztFQUVBLFNBQUEsT0FBQSxHQUFBLEdBQUE7R0FDQSxzQkFBQTtHQUNBLFFBQUE7R0FDQTs7Ozs7Ozs7Ozs7OztJQWFBLFNBQUEsUUFBQSxLQUFBLE9BQUE7TUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBO1VBQ0EsSUFBQSxtQkFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztVQUVBLElBQUEsa0JBQUE7WUFDQSxpQkFBQSxRQUFBLEtBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7OztJQUlBLFNBQUEsZ0JBQUEsTUFBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLG1CQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O1VBRUEsSUFBQSxrQkFBQTtZQUNBLGlCQUFBLGdCQUFBO2lCQUNBO1lBQ0EsTUFBQSxJQUFBLE1BQUE7O1VBRUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBO1NBQ0E7Ozs7SUFJQSxTQUFBLFNBQUEsU0FBQSxPQUFBO01BQ0EsSUFBQTtRQUNBLElBQUEsbUJBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7UUFFQSxJQUFBLGtCQUFBO1VBQ0EsS0FBQSxNQUFBOztVQUVBLElBQUEsY0FBQTtVQUNBLFlBQUEsOEJBQUE7VUFDQSxZQUFBLGtDQUFBOztVQUVBLElBQUEsdUNBQUEsU0FBQSxVQUFBO1lBQ0EsV0FBQSxNQUFBLHdCQUFBLFFBQUEsT0FBQTs7VUFFQSxJQUFBLG9DQUFBLFNBQUEsVUFBQTtZQUNBLFdBQUEsTUFBQSxxQkFBQSxRQUFBLE9BQUE7Ozs7O1VBS0EsaUJBQUEsVUFBQTtXQUNBLDJCQUFBO1dBQ0EseUJBQUE7V0FDQSxrQkFBQSxpQkFBQSx1QkFBQTtXQUNBLFlBQUE7V0FDQTs7VUFFQSxpQkFBQSxPQUFBLFNBQUEsS0FBQTtZQUNBLElBQUEsVUFBQTtZQUNBLFFBQUEsUUFBQSxJQUFBO1lBQ0EsUUFBQSxPQUFBLElBQUE7WUFDQSxRQUFBOzs7VUFHQSxpQkFBQSxRQUFBLFNBQUEsTUFBQTs7WUFFQSxLQUFBLE1BQUEsb0JBQUEsUUFBQSxPQUFBOztlQUVBO1VBQ0EsTUFBQSxJQUFBLE1BQUE7O1FBRUEsT0FBQSxPQUFBO1FBQ0Esa0JBQUE7O0tBRUE7OztBQ2pNQSxDQUFBLFlBQUE7RUFDQTs7Ozs7RUFFQTtHQUNBLE9BQUEsMkJBQUEsQ0FBQTtHQUNBLFNBQUEsU0FBQTtJQUNBLG1CQUFBO01BQ0EsT0FBQTtNQUNBLE9BQUE7TUFDQSxXQUFBO01BQ0EsVUFBQTs7SUFFQSxhQUFBO01BQ0EsT0FBQTtNQUNBLE9BQUE7TUFDQSxXQUFBO01BQ0EsVUFBQTs7SUFFQSxzQ0FBQTtNQUNBLE9BQUE7TUFDQSxXQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOztJQUVBLDRCQUFBO01BQ0EsT0FBQTtNQUNBLE9BQUE7TUFDQSxXQUFBO01BQ0EsVUFBQTs7SUFFQSxvQkFBQTtNQUNBLE9BQUE7TUFDQSxPQUFBO01BQ0EsV0FBQTtNQUNBLFVBQUE7O0lBRUEsY0FBQTtNQUNBLE9BQUE7TUFDQSxPQUFBO01BQ0EsV0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOztJQUVBLGFBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxXQUFBO01BQ0EsVUFBQTs7SUFFQSxpQ0FBQTtNQUNBLE9BQUE7TUFDQSxPQUFBO01BQ0EsV0FBQTtNQUNBLFVBQUE7O0lBRUEscUVBQUE7TUFDQSxPQUFBO01BQ0EsT0FBQTtNQUNBLFdBQUE7TUFDQSxVQUFBOzs7R0FHQSxPQUFBLG1CQUFBO0dBQ0EsT0FBQSxrQkFBQTtHQUNBLE9BQUEsa0JBQUE7R0FDQSxTQUFBLFlBQUE7O0VBRUEsU0FBQSxRQUFBO0lBQ0EsSUFBQSxnQkFBQTtJQUNBLElBQUEsUUFBQTtJQUNBLElBQUEsVUFBQTtNQUNBLGFBQUE7O0lBRUEsSUFBQSxXQUFBO01BQ0EsVUFBQTtNQUNBLGFBQUE7TUFDQSxZQUFBOzs7SUFHQSxLQUFBLGFBQUEsU0FBQSxTQUFBO01BQ0EsUUFBQSxPQUFBLFNBQUE7OztJQUdBLEtBQUEsWUFBQSxTQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0lBR0EsS0FBQSxrREFBQSxTQUFBLElBQUEsTUFBQSxTQUFBLE9BQUEsTUFBQTtNQUNBLElBQUEsTUFBQTtNQUNBLElBQUEsVUFBQTs7Ozs7O01BTUEsSUFBQSxtQkFBQSxTQUFBLEdBQUE7Ozs7OztRQU1BLFFBQUEsRUFBQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBLEtBQUEsVUFBQTtVQUNBLEVBQUEsVUFBQTtVQUNBO1FBQ0EsS0FBQSxVQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLFVBQUE7VUFDQSxFQUFBLFVBQUE7VUFDQTtRQUNBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7O1FBRUEsS0FBQSxNQUFBLFlBQUEsRUFBQTs7UUFFQSxPQUFBOzs7TUFHQSxJQUFBLDJCQUFBLFNBQUEsR0FBQTs7Ozs7UUFLQSxRQUFBLEVBQUE7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQSxLQUFBLGtCQUFBO1VBQ0EsRUFBQSxVQUFBO1VBQ0E7UUFDQTtVQUNBLEVBQUEsVUFBQTtVQUNBOztRQUVBLEtBQUEsTUFBQSxZQUFBLEVBQUE7O1FBRUEsT0FBQTs7O01BR0EsSUFBQSwyQkFBQSxXQUFBOzs7OztRQUtBLElBQUEsQ0FBQSxPQUFBLEtBQUEsT0FBQSxXQUFBLGFBQUEsVUFBQTtVQUNBLElBQUEsVUFBQSxRQUFBLFNBQUEsYUFBQTtVQUNBLFFBQUEsSUFBQSwyQkFBQTs7UUFFQSxPQUFBOzs7TUFHQSxJQUFBLGNBQUEsU0FBQSxNQUFBO1FBQ0EsSUFBQSxNQUFBLEtBQUEsYUFBQTs7UUFFQSxJQUFBLENBQUEsT0FBQSxNQUFBLEtBQUE7VUFDQSxNQUFBLE1BQUEsS0FBQSxNQUFBOztRQUVBLElBQUEsT0FBQSxLQUFBLFNBQUE7O1FBRUEsSUFBQSxDQUFBLE1BQUE7VUFDQSxPQUFBLElBQUEsS0FBQTtlQUNBO1VBQ0EsT0FBQSxLQUFBLFFBQUE7OztRQUdBLE9BQUEsT0FBQSxNQUFBOzs7TUFHQSxJQUFBLDZCQUFBLFNBQUEsU0FBQTs7Ozs7UUFLQSxJQUFBLE1BQUE7UUFDQSxPQUFBLEtBQUEsU0FBQSxRQUFBLFNBQUEsSUFBQSxPQUFBO1VBQ0EsSUFBQSxRQUFBLEtBQUEsUUFBQSxRQUFBO1VBQ0EsSUFBQSxRQUFBLEtBQUEsTUFBQSxXQUFBLElBQUEsZ0JBQUEsUUFBQSxLQUFBOztRQUVBLGFBQUEsV0FBQSxRQUFBLE9BQUE7O1FBRUEsT0FBQTs7OztNQUlBLElBQUEsa0JBQUEsVUFBQSxVQUFBO1FBQ0EsSUFBQSxXQUFBO1FBQ0EsSUFBQSxPQUFBLFlBQUEsV0FBQTtVQUNBLFdBQUEsUUFBQSxLQUFBO2VBQ0E7VUFDQSxXQUFBLFFBQUEsS0FBQTs7UUFFQSxPQUFBO1dBQ0Esb0JBQUEsVUFBQSxRQUFBO1dBQ0EsS0FBQTs7O01BR0EsSUFBQSxjQUFBLFVBQUEsVUFBQTtRQUNBLE9BQUEsUUFBQSxjQUFBLE1BQUE7Ozs7TUFJQSxJQUFBLFVBQUEsU0FBQSxNQUFBO1FBQ0EsTUFBQSxLQUFBLFFBQUE7UUFDQSxhQUFBLFdBQUEsUUFBQSxPQUFBOzs7O01BSUEsSUFBQSxhQUFBLFNBQUEsSUFBQTtRQUNBLE9BQUEsTUFBQTtRQUNBLGFBQUEsV0FBQSxRQUFBLE9BQUE7Ozs7TUFJQSxJQUFBLGVBQUEsVUFBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7UUFDQSxRQUFBO1VBQ0E7VUFDQSxTQUFBLE9BQUE7WUFDQSxFQUFBLFFBQUE7O1VBRUEsU0FBQSxPQUFBO1lBQ0EsS0FBQSxNQUFBO1lBQ0EsUUFBQSxJQUFBLGlCQUFBO1lBQ0EsRUFBQSxPQUFBOzs7UUFHQSxPQUFBLEVBQUE7OztNQUdBLElBQUEsZUFBQSxTQUFBLFVBQUE7Ozs7O1FBS0EsT0FBQSxDQUFBLENBQUEsSUFBQSwyQkFBQTs7O01BR0EsSUFBQSxnQkFBQSxTQUFBLFVBQUE7UUFDQSxPQUFBLENBQUEsQ0FBQSxjQUFBOzs7TUFHQSxJQUFBLGdCQUFBLFNBQUEsVUFBQTtRQUNBLElBQUEsSUFBQSxhQUFBLFdBQUE7VUFDQSxPQUFBLFNBQUE7ZUFDQSxJQUFBLElBQUEsY0FBQSxXQUFBO1VBQ0EsT0FBQSxTQUFBO2VBQ0E7VUFDQSxPQUFBLFNBQUE7Ozs7Ozs7OztNQVNBLFFBQUEsV0FBQTtNQUNBLFFBQUEsZUFBQTtNQUNBLFFBQUEsU0FBQTtNQUNBLFFBQUEsT0FBQSxJQUFBO01BQ0EsUUFBQSxPQUFBO01BQ0EsUUFBQSxpQkFBQTtNQUNBLFFBQUEsaUJBQUE7O01BRUEsT0FBQTs7Ozs7OztNQU9BLFNBQUEsZUFBQSxNQUFBO1FBQ0EsT0FBQSxDQUFBLEtBQUEsUUFBQSxTQUFBLE1BQUEsS0FBQSxNQUFBLFdBQUE7OztNQUdBLFNBQUEsZUFBQSxLQUFBLE1BQUE7UUFDQSxJQUFBLElBQUEsR0FBQTs7UUFFQSxRQUFBLFFBQUEsWUFBQSxLQUFBLEtBQUEsTUFBQTtVQUNBLE9BQUEsVUFBQSxHQUFBO1lBQ0EsRUFBQSxPQUFBO2FBQ0EsU0FBQSxZQUFBO1lBQ0EsRUFBQTs7O1FBR0EsT0FBQSxFQUFBO09BQ0E7O01BRUEsU0FBQSxLQUFBLE1BQUE7UUFDQSxJQUFBLElBQUEsR0FBQTtRQUNBLElBQUEsV0FBQTtVQUNBLFNBQUEsU0FBQSxPQUFBO1lBQ0EsZUFBQSxNQUFBLFNBQUEsS0FBQSxNQUFBO2NBQ0EsV0FBQTtnQkFDQSxFQUFBOztjQUVBLFNBQUEsR0FBQTtnQkFDQSxFQUFBLE9BQUE7Ozs7VUFJQSxNQUFBLFNBQUEsR0FBQTtZQUNBLEVBQUEsT0FBQTs7OztRQUlBLEtBQUEsV0FBQSxJQUFBLGdCQUFBLEtBQUE7UUFDQSxJQUFBLGFBQUEsS0FBQTtTQUNBLEtBQUEsU0FBQSxPQUFBO1VBQ0EsU0FBQSxRQUFBO1dBQ0EsU0FBQSxHQUFBO1VBQ0EsU0FBQSxLQUFBOzs7O01BSUEsT0FBQSxFQUFBO0tBQ0E7O0lBRUEsU0FBQSxTQUFBLE1BQUE7TUFDQSxJQUFBLElBQUEsR0FBQTtNQUNBLElBQUEsS0FBQSxJQUFBO01BQ0EsSUFBQSxNQUFBLFVBQUEsS0FBQTs7TUFFQSxLQUFBLFNBQUEsU0FBQTtNQUNBLEtBQUEsV0FBQSxJQUFBLGdCQUFBLEtBQUE7TUFDQSxjQUFBLEtBQUEsUUFBQTs7TUFFQSxHQUFBLGFBQUEsVUFBQSxVQUFBO1FBQ0EsRUFBQSxPQUFBOzs7TUFHQSxFQUFBLFFBQUEsUUFBQSxZQUFBO1FBQ0EsR0FBQTs7O01BR0EsSUFBQSxjQUFBO1FBQ0EsU0FBQSxTQUFBLFdBQUE7VUFDQSxLQUFBLFNBQUEsU0FBQTtVQUNBLElBQUEsUUFBQTtVQUNBLE9BQUEsY0FBQSxLQUFBO1VBQ0EsRUFBQSxRQUFBOztRQUVBLE1BQUEsU0FBQSxPQUFBO1VBQ0EsS0FBQSxNQUFBO1VBQ0EsS0FBQSxTQUFBLFNBQUE7VUFDQSxRQUFBLElBQUEseUJBQUE7VUFDQSxPQUFBLGNBQUEsS0FBQTtVQUNBLEVBQUEsT0FBQTs7O01BR0EsR0FBQSxTQUFBLEtBQUEsS0FBQSxVQUFBLFlBQUEsU0FBQSxZQUFBLE1BQUE7O01BRUEsT0FBQSxFQUFBO0tBQ0E7O0lBRUEsU0FBQSxPQUFBLE1BQUE7TUFDQSxJQUFBLElBQUEsR0FBQTs7TUFFQSxLQUFBLFdBQUEsSUFBQSxnQkFBQSxLQUFBO01BQ0EsSUFBQSxhQUFBLEtBQUE7T0FDQSxLQUFBLFNBQUEsT0FBQTtRQUNBLE1BQUE7VUFDQSxVQUFBLFFBQUE7WUFDQSxJQUFBLFdBQUEsS0FBQTtZQUNBLEtBQUEsU0FBQSxTQUFBO1lBQ0EsRUFBQSxRQUFBO1lBQ0EsVUFBQSxPQUFBO1lBQ0EsRUFBQSxPQUFBOzs7U0FHQSxTQUFBLE9BQUE7UUFDQSxLQUFBLFNBQUEsU0FBQTtRQUNBLEVBQUEsT0FBQTs7OztJQUlBLE9BQUEsRUFBQTs7O0VBR0EsU0FBQSxhQUFBLE1BQUE7SUFDQSxLQUFBLE9BQUEsS0FBQSxRQUFBLElBQUEsWUFBQTtJQUNBLEtBQUEsT0FBQSxLQUFBLFFBQUEsSUFBQSxZQUFBLEtBQUE7SUFDQSxLQUFBLFNBQUEsSUFBQSxjQUFBLEtBQUE7Ozs7O0lBS0EsSUFBQSxDQUFBLE9BQUEsU0FBQTtNQUNBLElBQUEsV0FBQSxJQUFBLGdCQUFBLEtBQUE7TUFDQSxJQUFBLElBQUEsYUFBQTtRQUNBLEtBQUEsV0FBQTtLQUNBOztJQUVBLE9BQUE7R0FDQTs7Q0FFQTs7QUFFQSxTQUFBLGdCQUFBLE9BQUE7RUFDQSxPQUFBLFNBQUEsTUFBQTtJQUNBLE9BQUEsTUFBQSxRQUFBLE1BQUEsTUFBQSxRQUFBOzs7O0FBSUEsU0FBQSxlQUFBLE9BQUE7RUFDQSxPQUFBLFNBQUEsTUFBQTtJQUNBLE9BQUEsTUFBQSxRQUFBLE1BQUEsTUFBQSxRQUFBOzs7O0FBSUEsU0FBQSxlQUFBLE9BQUE7RUFDQSxPQUFBLFNBQUEsTUFBQTtJQUNBLE9BQUEsQ0FBQSxNQUFBLFNBQUEsTUFBQSxNQUFBLGFBQUEsTUFBQSxNQUFBLFlBQUE7Ozs7QUNwY0EsQ0FBQSxXQUFBO0NBQ0E7OztDQUVBO0VBQ0EsT0FBQSw2QkFBQTtFQUNBLFFBQUEsY0FBQTs7Ozs7Ozs7RUFRQSxTQUFBLFFBQUEsSUFBQSxTQUFBLG1CQUFBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLFFBQUE7SUFDQSxRQUFBLFVBQUE7SUFDQSxRQUFBLFFBQUE7O0lBRUEsT0FBQTs7SUFFQSxTQUFBLE1BQUEsU0FBQSxPQUFBLFlBQUE7TUFDQSxJQUFBLElBQUEsR0FBQTs7TUFFQSxJQUFBLENBQUEsUUFBQSxVQUFBLGNBQUE7UUFDQSxRQUFBLE1BQUE7UUFDQSxFQUFBO2FBQ0E7UUFDQSxVQUFBLGFBQUEsTUFBQSxTQUFBLFlBQUE7VUFDQSxFQUFBO1dBQ0EsT0FBQTs7O01BR0EsT0FBQSxFQUFBO0tBQ0E7Ozs7OztJQU1BLFNBQUEsUUFBQSxTQUFBLE9BQUEsY0FBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxRQUFBLENBQUEsUUFBQSxVQUFBLFVBQUEsUUFBQTs7VUFFQSxJQUFBLENBQUEsUUFBQSxVQUFBLGNBQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxVQUFBO2NBQ0EsUUFBQTttQkFDQTtjQUNBLFFBQUE7O2lCQUVBO1lBQ0EsVUFBQSxhQUFBLFFBQUEsU0FBQSxVQUFBLGFBQUE7Y0FDQSxRQUFBO2VBQ0EsT0FBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7S0FFQTs7SUFFQSxTQUFBLE1BQUEsU0FBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7T0FDQSxJQUFBLFFBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7T0FFQSxJQUFBLE9BQUE7WUFDQSxNQUFBLGVBQUEsU0FBQSxVQUFBLFVBQUE7Y0FDQSxRQUFBO2VBQ0EsVUFBQSxPQUFBO2NBQ0EsT0FBQTs7aUJBRUE7WUFDQSxNQUFBOztVQUVBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOztLQUVBOzs7QUNwRkEsQ0FBQSxXQUFBO0NBQ0E7OztDQUVBO0VBQ0EsT0FBQSw0QkFBQTtFQUNBLFFBQUEsYUFBQTs7Ozs7Ozs7Ozs7Ozs7OztDQWdCQSxTQUFBLFVBQUEsTUFBQSxTQUFBLElBQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsVUFBQTtJQUNBLFFBQUEsa0JBQUE7SUFDQSxRQUFBLGdCQUFBOztJQUVBLE9BQUE7Ozs7OztJQU1BLFNBQUEsVUFBQTs7TUFFQSxPQUFBLEdBQUEsVUFBQSxTQUFBLFFBQUE7O1FBRUEsSUFBQSxVQUFBO1VBQ0EsU0FBQSxTQUFBLE1BQUE7WUFDQSxRQUFBOztVQUVBLE1BQUEsV0FBQTtZQUNBLE1BQUEsSUFBQSxNQUFBOzs7UUFHQSxJQUFBO1VBQ0EsSUFBQSxpQkFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztVQUVBLElBQUEsZ0JBQUE7WUFDQSxlQUFBLElBQUEsUUFBQSxTQUFBLFFBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7Ozs7Ozs7OztJQVNBLFNBQUEsa0JBQUE7O01BRUEsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQSxhQUFBOztRQUVBLElBQUE7O1VBRUEsSUFBQSxPQUFBLFdBQUEsYUFBQTs7UUFFQSxXQUFBLFFBQUEsT0FBQTtRQUNBLFdBQUEsV0FBQSxPQUFBO1FBQ0EsV0FBQSxtQkFBQSxPQUFBO1FBQ0EsV0FBQSxlQUFBLE9BQUE7aUJBQ0E7O1FBRUEsV0FBQSxRQUFBLFVBQUE7O1VBRUEsUUFBQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7Ozs7Ozs7O0lBU0EsU0FBQSxnQkFBQTs7TUFFQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBLGFBQUE7O1FBRUEsSUFBQTs7VUFFQSxJQUFBLE9BQUEsZUFBQSxhQUFBOztRQUVBLFdBQUEsY0FBQSxXQUFBO1FBQ0EsV0FBQSxZQUFBLFdBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7O1VBR0EsUUFBQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7Ozs7O0FDakhBLENBQUEsV0FBQTtFQUNBOzs7OztFQUVBO0dBQ0EsT0FBQSxnQ0FBQTtHQUNBLFFBQUEscUJBQUE7R0FDQSxRQUFBLGNBQUE7R0FDQSxRQUFBLGlCQUFBOzs7Ozs7Ozs7Ozs7O0VBYUEsU0FBQSxrQkFBQSxNQUFBLFNBQUEsSUFBQSxtQkFBQTs7SUFFQSxPQUFBLFNBQUEsUUFBQSxrQkFBQTs7TUFFQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBO1VBQ0EsSUFBQSxRQUFBLFlBQUEsbUJBQUE7WUFDQSxtQkFBQTs7VUFFQSxJQUFBLGdCQUFBO1lBQ0EsU0FBQSxTQUFBLFFBQUE7Y0FDQSxRQUFBOztZQUVBLE1BQUEsU0FBQSxRQUFBO2NBQ0EsS0FBQSxNQUFBO2NBQ0EsT0FBQTs7OztVQUlBLElBQUEsYUFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztVQUVBLElBQUEsWUFBQTtZQUNBLFdBQUEsV0FBQSxjQUFBLFNBQUEsY0FBQSxNQUFBLFFBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7Ozs7RUFLQSxTQUFBLFdBQUEsTUFBQSxTQUFBLElBQUEsbUJBQUE7O0lBRUEsT0FBQSxTQUFBLFFBQUEsa0JBQUE7TUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBO1VBQ0EsSUFBQSxRQUFBLFlBQUEsbUJBQUE7WUFDQSxtQkFBQTs7VUFFQSxJQUFBLGVBQUEsbUJBQUE7VUFDQSxRQUFBLFdBQUEsU0FBQTtVQUNBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBO1NBQ0E7Ozs7O0VBS0EsU0FBQSxjQUFBLFdBQUEsU0FBQTs7SUFFQSxJQUFBLGFBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7SUFFQSxJQUFBLFFBQUEsV0FBQSxZQUFBO01BQ0EsT0FBQSxVQUFBLElBQUE7V0FDQTtNQUNBLE9BQUEsVUFBQSxJQUFBOzs7O0FDaEZBLENBQUEsV0FBQTtDQUNBOztDQUVBO0VBQ0EsT0FBQSw4QkFBQTtFQUNBLFFBQUEsZUFBQSxDQUFBLE1BQUEsV0FBQSxtQkFBQSxlQUFBOzs7Ozs7O0VBT0EsU0FBQSxTQUFBLElBQUEsU0FBQSxXQUFBLE9BQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsMkJBQUE7O0lBRUEsT0FBQTs7SUFFQSxTQUFBLHlCQUFBLFNBQUE7TUFDQSxJQUFBLGlCQUFBO1FBQ0EsT0FBQTtRQUNBLFNBQUE7UUFDQSxhQUFBO1FBQ0EsWUFBQTtRQUNBLFVBQUE7OztNQUdBLGlCQUFBLFFBQUEsT0FBQSxnQkFBQTs7TUFFQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBO1VBQ0EsUUFBQSxRQUFBLFNBQUE7WUFDQSxVQUFBLGVBQUE7WUFDQSxVQUFBLGVBQUE7WUFDQSxVQUFBLE1BQUEsZUFBQTtZQUNBLElBQUEsS0FBQSxlQUFBLGNBQUE7WUFDQSxJQUFBLEtBQUEsZUFBQSxZQUFBO1lBQ0EsVUFBQSxTQUFBO2NBQ0EsUUFBQTtlQUNBLFVBQUEsR0FBQTtjQUNBLE9BQUE7OztVQUdBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOzs7OztBQ2hEQSxDQUFBLFdBQUE7Q0FDQTs7OztDQUVBO0VBQ0EsT0FBQSwrQkFBQTtFQUNBLFFBQUEsbUJBQUE7RUFDQSxRQUFBLGdCQUFBOztFQUVBLFNBQUEsZ0JBQUEsSUFBQSxTQUFBLE1BQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsWUFBQTtJQUNBLFFBQUEsYUFBQTtJQUNBLFFBQUEsc0JBQUE7O0lBRUEsT0FBQTs7SUFFQSxTQUFBLFVBQUEsWUFBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxLQUFBLE1BQUEsaUJBQUE7VUFDQSxHQUFBLE9BQUE7WUFDQSxNQUFBO1lBQ0EsT0FBQTs7VUFFQSxHQUFBLFFBQUE7VUFDQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOzs7O0lBSUEsU0FBQSxXQUFBLFVBQUEsUUFBQSxPQUFBLE9BQUE7TUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBO1VBQ0EsSUFBQSxLQUFBLENBQUEsVUFBQSxRQUFBLE9BQUE7VUFDQSxLQUFBLE1BQUEsa0JBQUEsR0FBQTtVQUNBLEdBQUEsUUFBQSxTQUFBO1lBQ0EsZUFBQTtZQUNBLFlBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTs7VUFFQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOzs7O0lBSUEsU0FBQSxtQkFBQSxJQUFBO01BQ0EsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTtVQUNBLEtBQUEsTUFBQSwyQkFBQTtVQUNBLEdBQUEsVUFBQTtZQUNBLFNBQUE7WUFDQSxZQUFBO1lBQ0EsVUFBQSxRQUFBLGFBQUEsUUFBQTs7VUFFQSxHQUFBLE9BQUE7WUFDQSxtQkFBQTtZQUNBLGtCQUFBO1lBQ0EsY0FBQTs7VUFFQSxHQUFBLFVBQUEsU0FBQTtZQUNBLEtBQUEsQ0FBQSxRQUFBLGFBQUEsUUFBQSxpQkFBQTtjQUNBLG9CQUFBLFNBQUEsZUFBQSxRQUFBLElBQUE7OztVQUdBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBO1NBQ0E7Ozs7O0NBS0EsU0FBQSxVQUFBLFdBQUEsU0FBQTtJQUNBLE9BQUEsVUFBQSxJQUFBOzs7QUNuRkEsQ0FBQSxXQUFBO0VBQ0E7O0VBRUE7R0FDQSxPQUFBLGdDQUFBO0dBQ0EsUUFBQSxtQkFBQTs7RUFFQSxTQUFBLGVBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsWUFBQTtJQUNBLFFBQUEsWUFBQTtJQUNBLFFBQUEsZUFBQTtJQUNBLFFBQUEsV0FBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEsVUFBQSxLQUFBO01BQ0EsT0FBQSxRQUFBLFNBQUEsYUFBQSxRQUFBO0tBQ0E7O0lBRUEsU0FBQSxVQUFBLEtBQUEsT0FBQTtNQUNBLGFBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQTtLQUNBOztJQUVBLFNBQUEsYUFBQSxLQUFBO01BQ0EsYUFBQSxXQUFBO0tBQ0E7O0lBRUEsU0FBQSxTQUFBLEtBQUE7TUFDQSxPQUFBLGFBQUEsUUFBQSxPQUFBLE9BQUE7S0FDQTs7O0FDaENBLENBQUEsV0FBQTtFQUNBOzs7RUFFQTtHQUNBLE9BQUEsb0NBQUE7R0FDQSxRQUFBLHVCQUFBOztFQUVBLFNBQUEsaUJBQUEsSUFBQSxNQUFBLG1CQUFBLE9BQUE7OztJQUdBLFNBQUEsbUJBQUE7SUFDQSxpQkFBQSxZQUFBO0lBQ0EsaUJBQUEsVUFBQSxjQUFBOztJQUVBLElBQUEsbUJBQUEsSUFBQTs7SUFFQSxJQUFBLHdCQUFBLFNBQUEsZ0JBQUE7O01BRUEsaUJBQUEsUUFBQSxTQUFBO01BQ0EsSUFBQSxVQUFBLGVBQUE7TUFDQSxlQUFBLFVBQUEsV0FBQSxFQUFBLE9BQUE7TUFDQSxPQUFBOzs7SUFHQSxJQUFBLGNBQUEsU0FBQSxLQUFBLFFBQUEsVUFBQTtNQUNBLE1BQUEsSUFBQSxLQUFBO09BQ0E7UUFDQSxTQUFBLFVBQUE7VUFDQSxLQUFBLE1BQUEsc0RBQUEsU0FBQTs7VUFFQSxJQUFBLENBQUEsU0FBQSxPQUFBLHFCQUFBLFNBQUEsV0FBQSxLQUFBO1lBQ0EsYUFBQSxRQUFBLEtBQUEsUUFBQSxPQUFBO2NBQ0EsTUFBQSxTQUFBO2NBQ0EsUUFBQSxTQUFBO2NBQ0EsUUFBQSxTQUFBO2NBQ0EsU0FBQSxTQUFBO2NBQ0EsWUFBQTs7OztVQUlBLElBQUEsU0FBQSxRQUFBLFlBQUEsU0FBQSxPQUFBO1lBQ0EsU0FBQSxZQUFBO1VBQ0EsU0FBQSxRQUFBOztRQUVBLFNBQUEsVUFBQTtVQUNBLEtBQUEsTUFBQSxtREFBQSxTQUFBOztVQUVBLElBQUEsaUJBQUEsYUFBQSxRQUFBO1VBQ0EsSUFBQSxnQkFBQTtZQUNBLE9BQUEsU0FBQSxRQUFBLHNCQUFBOzs7O1VBSUEsSUFBQSxTQUFBLE9BQUEsVUFBQTtZQUNBLE9BQUEsU0FBQSxRQUFBO2NBQ0EsTUFBQSxPQUFBO2NBQ0EsUUFBQSxTQUFBO2NBQ0EsU0FBQSxTQUFBO2NBQ0EsUUFBQSxTQUFBO2NBQ0EsWUFBQTs7Ozs7VUFLQSxPQUFBLFNBQUEsT0FBQTs7Ozs7TUFLQSxJQUFBLFVBQUEsU0FBQTs7TUFFQSxRQUFBLFVBQUEsU0FBQSxJQUFBO1FBQ0EsUUFBQSxLQUFBLFNBQUEsVUFBQTtVQUNBLEdBQUEsU0FBQSxNQUFBLFNBQUEsUUFBQSxTQUFBLFNBQUEsUUFBQSxTQUFBOztRQUVBLE9BQUE7OztNQUdBLFFBQUEsUUFBQSxTQUFBLElBQUE7UUFDQSxRQUFBLEtBQUEsTUFBQSxTQUFBLFVBQUE7VUFDQSxHQUFBLFNBQUEsTUFBQSxTQUFBLFFBQUEsU0FBQSxTQUFBOztRQUVBLE9BQUE7OztNQUdBLE9BQUE7Ozs7O0lBS0EsaUJBQUEsTUFBQSxTQUFBLEtBQUEsUUFBQTs7TUFFQSxJQUFBLENBQUEsY0FBQTs7UUFFQSxJQUFBLENBQUEsT0FBQSxVQUFBO1VBQ0EsT0FBQSxNQUFBLElBQUEsS0FBQTs7O1FBR0EsT0FBQSxvQkFBQTs7OztNQUlBLElBQUEsV0FBQSxHQUFBO01BQ0EsSUFBQSxpQkFBQSxhQUFBLFFBQUE7O01BRUEsSUFBQSxnQkFBQTs7UUFFQSxJQUFBLGtCQUFBLEdBQUE7UUFDQSxpQkFBQSxzQkFBQTtRQUNBLElBQUEsUUFBQTs7O1FBR0EsU0FBQSxRQUFBLFVBQUEsVUFBQSxTQUFBO1FBQ0EsSUFBQSxTQUFBLE1BQUE7VUFDQSxPQUFBLG1CQUFBLE1BQUEsVUFBQTtRQUNBLGVBQUEsVUFBQSxZQUFBLEtBQUEsUUFBQTtRQUNBLFNBQUEsUUFBQTtRQUNBLE9BQUEsU0FBQTs7O01BR0EsT0FBQSxZQUFBLEtBQUEsUUFBQTs7O0lBR0EsT0FBQTtHQUNBOztBQzVIQSxDQUFBLFdBQUE7Q0FDQTs7OztDQUVBO0VBQ0EsT0FBQSxvQ0FBQTtFQUNBLFFBQUEseUJBQUE7R0FDQSxRQUFBLHVCQUFBOztDQUVBLFNBQUEsbUJBQUEsSUFBQSxZQUFBLE1BQUE7O0VBRUEsSUFBQSxjQUFBOztFQUVBLE9BQUE7R0FDQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUEsQ0FBQSxlQUFBO1VBQ0EsV0FBQSxXQUFBOzs7SUFHQSxPQUFBLFVBQUEsR0FBQSxLQUFBOztHQUVBLFVBQUEsU0FBQSxVQUFBO0lBQ0EsSUFBQSxFQUFBLEVBQUEsY0FBQTtLQUNBLFdBQUEsV0FBQTs7O0lBR0EsT0FBQSxZQUFBLEdBQUEsS0FBQTs7R0FFQSxjQUFBLFNBQUEsU0FBQTtJQUNBLElBQUEsRUFBQSxFQUFBLGNBQUE7S0FDQSxXQUFBLFdBQUE7OztJQUdBLE9BQUEsR0FBQSxPQUFBOztHQUVBLGVBQUEsU0FBQSxVQUFBO0lBQ0EsSUFBQSxFQUFBLEVBQUEsY0FBQTtLQUNBLFdBQUEsV0FBQTs7O0lBR0EsT0FBQSxHQUFBLE9BQUE7Ozs7O0VBS0EsU0FBQSxpQkFBQSxJQUFBLFlBQUEsTUFBQTs7R0FFQSxPQUFBO0lBQ0EsU0FBQSxTQUFBLFFBQUE7O0tBRUEsT0FBQSxVQUFBLEdBQUEsS0FBQTs7SUFFQSxjQUFBLFNBQUEsU0FBQTs7S0FFQSxPQUFBLEdBQUEsT0FBQTs7SUFFQSxVQUFBLFNBQUEsVUFBQTs7S0FFQSxPQUFBLFlBQUEsR0FBQSxLQUFBOztJQUVBLGVBQUEsU0FBQSxVQUFBO0tBQ0EsS0FBQSxNQUFBO1FBQ0EsS0FBQSxNQUFBLHNCQUFBLFNBQUE7S0FDQSxLQUFBLE1BQUE7S0FDQSxLQUFBLE1BQUE7S0FDQSxJQUFBLFlBQUEsU0FBQSxXQUFBLENBQUEsR0FBQTtRQUNBLElBQUEsWUFBQSxTQUFBLFdBQUEsR0FBQTtLQUNBLElBQUEsWUFBQSxTQUFBLFdBQUEsS0FBQTtLQUNBLElBQUEsWUFBQSxTQUFBLFdBQUEsS0FBQTtVQUNBLFdBQUEsV0FBQTs7S0FFQSxJQUFBLFlBQUEsU0FBQSxXQUFBLEtBQUE7S0FDQSxJQUFBLFlBQUEsU0FBQSxVQUFBLEtBQUE7O0tBRUEsT0FBQSxHQUFBLE9BQUE7Ozs7O0FDekVBLENBQUEsV0FBQTtDQUNBOzs7Q0FFQTtFQUNBLE9BQUEsK0JBQUE7RUFDQSxRQUFBLGtCQUFBOzs7Ozs7Ozs7O0NBVUEsU0FBQSxZQUFBLE1BQUEsU0FBQTtFQUNBLE9BQUEsU0FBQSxNQUFBO0dBQ0EsSUFBQSxRQUFBLFNBQUEsUUFBQSxVQUFBOztRQUVBLFNBQUEsaUJBQUEsZUFBQSxTQUFBLE9BQUE7S0FDQTtPQUNBOztVQUVBO0lBQ0E7Ozs7O0FDeEJBLENBQUEsV0FBQTtFQUNBOzs7RUFFQTtHQUNBLE9BQUEsa0NBQUE7R0FDQSxRQUFBLHFCQUFBOzs7Ozs7O0VBT0EsU0FBQSxlQUFBLE9BQUEsWUFBQSxVQUFBOztJQUVBLElBQUEsVUFBQTtJQUNBLFFBQUEsaUJBQUEsVUFBQSxNQUFBOzs7O01BSUEsV0FBQSxPQUFBOztNQUVBLE1BQUEsU0FBQSxRQUFBLE9BQUEscUJBQUEsS0FBQTtNQUNBLGFBQUEsVUFBQSxRQUFBLE9BQUEsV0FBQTs7O0lBR0EsUUFBQSxtQkFBQSxZQUFBO01BQ0EsV0FBQSxPQUFBO01BQ0EsYUFBQSxXQUFBO01BQ0EsT0FBQSxNQUFBLFNBQUEsUUFBQSxPQUFBOzs7SUFHQSxPQUFBOzs7QUMvQkEsQ0FBQSxTQUFBLFFBQUE7RUFDQTs7O0VBRUE7R0FDQSxPQUFBLG1CQUFBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTs7R0FFQSxRQUFBLFlBQUE7O0VBRUEsU0FBQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxlQUFBO0lBQ0EsUUFBQSxjQUFBO0lBQ0EsUUFBQSxxQkFBQTtJQUNBLFFBQUEsbUJBQUE7SUFDQSxRQUFBLG1CQUFBOztJQUVBLE9BQUE7O0dBRUE7O0FDL0JBLENBQUEsV0FBQTtFQUNBOzs7RUFFQTtHQUNBLE9BQUEscUJBQUE7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTs7R0FFQSxRQUFBLGNBQUE7O0VBRUEsU0FBQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLFlBQUE7SUFDQSxRQUFBLFdBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFNBQUE7SUFDQSxRQUFBLFVBQUE7SUFDQSxRQUFBLFFBQUE7SUFDQSxRQUFBLGdCQUFBO0lBQ0EsUUFBQSxnQkFBQTtJQUNBLFFBQUEsZUFBQTs7SUFFQSxPQUFBOzs7QUMxQ0EsQ0FBQSxXQUFBO0VBQ0E7OztFQUVBO0dBQ0EsT0FBQTtHQUNBLFNBQUEsWUFBQTtHQUNBLFFBQUEsVUFBQTs7RUFFQSxTQUFBLG1CQUFBOzs7SUFFQSxJQUFBLFVBQUE7UUFDQSxPQUFBOztJQUVBLEtBQUEsYUFBQSxTQUFBLEtBQUE7TUFDQSxRQUFBLE9BQUEsU0FBQTs7O0lBR0EsS0FBQSxZQUFBLFNBQUEsTUFBQSxPQUFBO01BQ0EsUUFBQSxRQUFBOzs7SUFHQSxLQUFBLE9BQUE7O0lBRUEsU0FBQSxTQUFBLElBQUEsU0FBQSxNQUFBLG1CQUFBLFVBQUEsUUFBQTs7Ozs7TUFLQSxJQUFBLFVBQUE7UUFDQSxRQUFBLFNBQUEsT0FBQTtVQUNBLElBQUEsUUFBQTs7VUFFQSxJQUFBLE1BQUEsTUFBQSxNQUFBLEdBQUEsZUFBQTtZQUNBLFFBQUE7VUFDQSxPQUFBLFFBQUEsY0FBQSxPQUFBOztRQUVBLGVBQUEsU0FBQSxPQUFBLE9BQUE7VUFDQSxJQUFBLFNBQUE7VUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLE1BQUEsTUFBQSxRQUFBLElBQUEsS0FBQSxLQUFBO2NBQ0EsT0FBQSxNQUFBLEdBQUEsVUFBQSxNQUFBOztVQUVBLE9BQUE7O1FBRUEsaUJBQUEsU0FBQSxVQUFBO1VBQ0EsSUFBQSxhQUFBLFNBQUEsZUFBQSxnQkFBQSxTQUFBLGFBQUE7VUFDQSxJQUFBLFlBQUEsU0FBQSxlQUFBLGVBQUEsU0FBQSxZQUFBOztVQUVBLE9BQUEsRUFBQSxhQUFBOztRQUVBLG1CQUFBLFNBQUEsWUFBQTtVQUNBLElBQUEsV0FBQTtVQUNBLFNBQUEsS0FBQTtVQUNBLElBQUEsSUFBQSxPQUFBLFlBQUE7WUFDQSxJQUFBLFlBQUEsV0FBQSxLQUFBLGFBQUEsT0FBQSxXQUFBLEtBQUEsWUFBQTtZQUNBLElBQUEsQ0FBQSxTQUFBO2NBQ0EsU0FBQSxhQUFBO1lBQ0EsU0FBQSxXQUFBLEtBQUEsV0FBQTs7VUFFQSxJQUFBLElBQUEsT0FBQSxZQUFBO1lBQ0EsSUFBQSxXQUFBLFdBQUE7WUFDQSxTQUFBLFdBQUE7WUFDQSxJQUFBLFNBQUEsU0FBQTtjQUNBLFNBQUEsV0FBQSxTQUFBLFNBQUE7O1VBRUEsT0FBQSxTQUFBOzs7Ozs7TUFNQSxJQUFBLFVBQUE7O01BRUEsUUFBQSxVQUFBO01BQ0EsUUFBQSxjQUFBO01BQ0EsUUFBQSxrQkFBQTtNQUNBLFFBQUEsTUFBQTtNQUNBLFFBQUEsT0FBQTtNQUNBLFFBQUEsaUJBQUE7TUFDQSxRQUFBLGtCQUFBO01BQ0EsUUFBQSxjQUFBOztNQUVBLE9BQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7TUFtQkEsU0FBQSxPQUFBO1FBQ0EsSUFBQSxRQUFBLGVBQUE7VUFDQSxPQUFBLE9BQUEsWUFBQSxVQUFBLFFBQUE7UUFDQSxJQUFBLFFBQUEsZUFBQTtVQUNBLE9BQUEsT0FBQSxZQUFBLFdBQUEsUUFBQTs7O01BR0EsU0FBQSxZQUFBLElBQUE7UUFDQSxJQUFBO1VBQ0EsSUFBQSxhQUFBLFFBQUEsT0FBQSxLQUFBO1VBQ0EsSUFBQSxXQUFBLGVBQUEsS0FBQTtZQUNBLE9BQUEsV0FBQTtpQkFDQTtZQUNBLE9BQUE7O1VBRUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7U0FDQTs7O01BR0EsU0FBQSxRQUFBLFVBQUE7UUFDQSxJQUFBO1VBQ0EsT0FBQSxLQUFBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7O01BSUEsU0FBQSxnQkFBQSxVQUFBO1FBQ0EsSUFBQTtVQUNBLE9BQUEsS0FBQSxLQUFBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7O01BSUEsU0FBQSxnQkFBQTtRQUNBLE9BQUEsUUFBQTs7O01BR0EsU0FBQSxjQUFBLFlBQUE7UUFDQSxLQUFBLGFBQUE7OztNQUdBLFNBQUEsUUFBQSxNQUFBO1FBQ0EsS0FBQSxPQUFBOzs7TUFHQSxTQUFBLFdBQUEsU0FBQTtRQUNBLEtBQUEsVUFBQTs7O01BR0EsU0FBQSxhQUFBO1FBQ0EsT0FBQSxLQUFBOzs7TUFHQSxTQUFBLGlCQUFBO1FBQ0EsSUFBQTtVQUNBLE9BQUEsUUFBQSxTQUFBLEtBQUEsS0FBQTtVQUNBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7OztNQUlBLFNBQUEsWUFBQSxNQUFBO1FBQ0EsSUFBQTtVQUNBLE9BQUEsUUFBQSxTQUFBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7O01BSUEsU0FBQSxZQUFBLFVBQUE7UUFDQSxLQUFBLFdBQUE7OztNQUdBLFNBQUEsZ0JBQUEsTUFBQTtRQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtVQUNBLElBQUE7WUFDQSxjQUFBLEtBQUE7WUFDQSxRQUFBLEtBQUE7WUFDQSxZQUFBLEtBQUE7WUFDQSxRQUFBO1lBQ0EsT0FBQSxHQUFBO1lBQ0Esa0JBQUE7WUFDQSxPQUFBO1dBQ0E7Ozs7OztFQU1BLFNBQUEsSUFBQSxZQUFBLE9BQUEsTUFBQSxtQkFBQSxxQkFBQTs7SUFFQSxJQUFBLFNBQUE7TUFDQSxTQUFBOzs7SUFHQSxJQUFBLDZCQUFBLFNBQUEsTUFBQTtNQUNBLElBQUEsTUFBQSxPQUFBLEtBQUEsTUFBQSxJQUFBLFNBQUEsR0FBQTtRQUNBLE9BQUEsbUJBQUEsS0FBQSxNQUFBLG1CQUFBLEtBQUE7U0FDQSxLQUFBOztNQUVBLE9BQUE7OztJQUdBLElBQUEsV0FBQSxTQUFBLE1BQUE7TUFDQSxJQUFBOzs7OztRQUtBLElBQUEsU0FBQSxDQUFBLE9BQUEsVUFBQSxPQUFBLFNBQUE7O1FBRUEsT0FBQSxPQUFBLFNBQUEsU0FBQTtRQUNBLE9BQUEsR0FBQTtRQUNBLGtCQUFBOzs7O0lBSUEsSUFBQSxNQUFBLENBQUEsV0FBQTtNQUNBLE9BQUE7UUFDQSxLQUFBLFNBQUEsTUFBQSxLQUFBO1VBQ0EsUUFBQSxPQUFBLEtBQUEsQ0FBQSxTQUFBLE9BQUE7O1VBRUEsT0FBQSxvQkFBQSxJQUFBLFNBQUEsT0FBQTs7UUFFQSxNQUFBLFNBQUEsTUFBQSxLQUFBO1VBQ0EsT0FBQSxNQUFBO1lBQ0EsUUFBQTtZQUNBLFNBQUEsT0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLE1BQUEsUUFBQSxPQUFBO1lBQ0EsY0FBQTtZQUNBLFNBQUE7Y0FDQSxnQkFBQTs7OztRQUlBLEtBQUEsU0FBQSxNQUFBLEtBQUE7VUFDQSxPQUFBLE1BQUE7WUFDQSxRQUFBO1lBQ0EsU0FBQSxPQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsTUFBQSxRQUFBLE9BQUE7WUFDQSxjQUFBO1lBQ0EsU0FBQTtjQUNBLGdCQUFBOzs7O1FBSUEsS0FBQSxTQUFBLE1BQUEsSUFBQTtVQUNBLE9BQUEsTUFBQTtZQUNBLFFBQUE7WUFDQSxTQUFBLE9BQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxjQUFBOzs7Ozs7SUFNQSxJQUFBLE1BQUE7TUFDQSxZQUFBLENBQUEsV0FBQTtRQUNBLElBQUEsT0FBQTtRQUNBLE9BQUE7VUFDQSxPQUFBLFdBQUE7O1lBRUEsT0FBQSxJQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLFNBQUEsYUFBQSxRQUFBO1lBQ0EsT0FBQSxJQUFBLElBQUEsT0FBQSxjQUFBLFVBQUE7Ozs7TUFJQSxPQUFBLENBQUEsV0FBQTtRQUNBLElBQUEsT0FBQTtRQUNBLE9BQUE7VUFDQSxRQUFBLFdBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxPQUFBLFVBQUE7O1VBRUEsUUFBQSxTQUFBLEtBQUE7WUFDQSxJQUFBLE1BQUEsT0FBQSxZQUFBLDJCQUFBO1lBQ0EsT0FBQSxJQUFBLElBQUEsS0FBQTs7OztNQUlBLE1BQUEsQ0FBQSxXQUFBO1FBQ0EsSUFBQSxPQUFBO1FBQ0EsT0FBQTtVQUNBLGFBQUEsV0FBQTtZQUNBLE9BQUEsSUFBQSxJQUFBLE1BQUE7Ozs7TUFJQSxPQUFBLENBQUEsV0FBQTtRQUNBLElBQUEsT0FBQTtRQUNBLE9BQUE7VUFDQSxRQUFBLFNBQUEsS0FBQTtZQUNBLE9BQUEsSUFBQSxLQUFBLE9BQUEsU0FBQTs7VUFFQSxLQUFBLFdBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxNQUFBOztVQUVBLE1BQUEsU0FBQSxLQUFBO1lBQ0EsT0FBQSxJQUFBLElBQUEsTUFBQTs7O1VBR0EsUUFBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsS0FBQSxPQUFBLFdBQUE7OztVQUdBLFFBQUEsU0FBQSxLQUFBO1lBQ0EsT0FBQSxJQUFBLElBQUEsT0FBQSxhQUFBLElBQUE7O1VBRUEsT0FBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsS0FBQSxPQUFBLG1CQUFBOzs7O01BSUEsU0FBQSxDQUFBLFdBQUE7UUFDQSxJQUFBLE9BQUE7UUFDQSxPQUFBO1VBQ0EsTUFBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxPQUFBLElBQUEsTUFBQTs7OztNQUlBLE1BQUEsQ0FBQSxXQUFBO1FBQ0EsSUFBQSxPQUFBO1FBQ0EsT0FBQTtVQUNBLFFBQUEsU0FBQSxLQUFBO1lBQ0EsT0FBQSxJQUFBLEtBQUEsT0FBQSxJQUFBLEtBQUEsU0FBQSxJQUFBOzs7O01BSUEsTUFBQSxDQUFBLFdBQUE7UUFDQSxJQUFBLE9BQUE7UUFDQSxPQUFBO1VBQ0EsTUFBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsS0FBQSxNQUFBOzs7O01BSUEsUUFBQSxDQUFBLFdBQUE7UUFDQSxPQUFBO1VBQ0EsZUFBQSxTQUFBLE1BQUE7WUFDQSxRQUFBLE9BQUEsUUFBQTs7VUFFQSxlQUFBLFdBQUE7WUFDQSxPQUFBOztVQUVBLGFBQUEsU0FBQSxNQUFBLE9BQUE7WUFDQSxPQUFBLFFBQUE7O1VBRUEsYUFBQSxTQUFBLE1BQUE7WUFDQSxPQUFBLE9BQUE7Ozs7OztJQU1BLE9BQUE7Ozs7O0FDNVdBLENBQUEsWUFBQTtFQUNBOzs7RUFFQSxRQUFBLE9BQUEsMkJBQUEsQ0FBQTtHQUNBLE9BQUEsV0FBQTtHQUNBLE9BQUEsU0FBQTtHQUNBLE9BQUEsYUFBQTtHQUNBLE9BQUEsZUFBQTtHQUNBLE9BQUEsWUFBQTtHQUNBLE9BQUEsY0FBQTs7RUFFQSxTQUFBLFVBQUE7SUFDQSxPQUFBLFVBQUEsS0FBQTtNQUNBLE9BQUEsQ0FBQSxPQUFBLEtBQUEsS0FBQTs7OztFQUlBLFNBQUEsUUFBQTtJQUNBLE9BQUEsVUFBQSxNQUFBO01BQ0EsT0FBQSxLQUFBLFFBQUEsa0JBQUE7Ozs7RUFJQSxTQUFBLFlBQUE7SUFDQSxPQUFBLFVBQUEsTUFBQTtNQUNBLE9BQUE7T0FDQSxRQUFBO09BQ0EsS0FBQTtPQUNBOzs7O0VBSUEsU0FBQSxhQUFBO0lBQ0EsT0FBQSxTQUFBLE9BQUEsT0FBQTtNQUNBLElBQUEsT0FBQTtNQUNBLFFBQUEsTUFBQTtNQUNBLE9BQUEsTUFBQSxVQUFBLEVBQUEsR0FBQSxjQUFBLE1BQUEsVUFBQTs7OztFQUlBLFNBQUEsY0FBQTtJQUNBLE9BQUEsU0FBQSxPQUFBO01BQ0EsSUFBQSxTQUFBLEdBQUEsT0FBQTtNQUNBLElBQUEsSUFBQTtNQUNBLElBQUEsUUFBQSxDQUFBLFNBQUEsTUFBQSxNQUFBLE1BQUEsTUFBQSxNQUFBLE1BQUEsTUFBQTtNQUNBLElBQUEsSUFBQSxLQUFBLE1BQUEsS0FBQSxJQUFBLFNBQUEsS0FBQSxJQUFBO01BQ0EsT0FBQSxDQUFBLFFBQUEsS0FBQSxJQUFBLEdBQUEsSUFBQSxZQUFBLEtBQUEsTUFBQSxNQUFBOzs7O0VBSUEsU0FBQSxVQUFBLE1BQUEsV0FBQTtJQUNBLE9BQUEsU0FBQSxNQUFBO01BQ0EsSUFBQSxRQUFBO01BQ0EsSUFBQSxZQUFBLFVBQUEsTUFBQSxRQUFBLE9BQUE7TUFDQSxPQUFBLEtBQUEsWUFBQTs7OztBQUlBIiwiZmlsZSI6Im5nLW1ldW1vYmktdXRpbHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMuc3RhdHVzYmFyJywgW10pXG4gIC5mYWN0b3J5KCdtZXVTdGF0dXNiYXInLCBzdGF0dXNiYXIpO1xuICBcbiAgLypcbiAgaW5zdGFsbCAgIDogICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBjb3Jkb3ZhLXBsdWdpbi1zdGF0dXNiYXJcbiAgXG4gIEhvdyB0byB1c2UgaXQ6IFxuICAgIG1ldUNvcmRvdmEuc3RhdHVzYmFyLmNhbGwoKVxuICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge30pXG4gICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7fSk7XG4gICovXG4gIFxuICBmdW5jdGlvbiBzdGF0dXNiYXIoJHEsICR3aW5kb3csICRsb2csICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICB2YXIgb3B0aW9ucyA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2Uuc2V0T3B0aW9uID0gc2V0T3B0aW9uO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9ucyA9IHNldE9wdGlvbnM7XG4gICAgc2VydmljZS5jYWxsID0gY2FsbDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0KSB7XG4gICAgICBhbmd1bGFyLmV4dGVuZChvcHRpb25zLCBvcHQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldE9wdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBjYWxsKCkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuc3BsYXNoc2NyZWVuJywgW10pXG4gIC5mYWN0b3J5KCdtZXVTcGxhc2hzY3JlZW4nLCBzcGxhc2hzY3JlZW4pO1xuICBcbiAgLypcbiAgaW5zdGFsbCAgIDogICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBjb3Jkb3ZhLXBsdWdpbi1zcGxhc2hzY3JlZW5cbiAgXG4gIEhvdyB0byB1c2UgaXQ6IFxuICBtZXVDb3Jkb3ZhLnNwbGFzaHNjcmVlbi5oaWRlKClcbiAgLnRoZW4oZnVuY3Rpb24oKSB7fSlcbiAgLmNhdGNoKGZ1bmN0aW9uKCkge30pO1xuICAqL1xuICBcbiAgZnVuY3Rpb24gc3BsYXNoc2NyZWVuKCRxLCAkd2luZG93LCAkbG9nLCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzaG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoJHdpbmRvdy5uYXZpZ2F0b3Iuc3BsYXNoc2NyZWVuKSB7XG4gICAgICAgICAgICAgICR3aW5kb3cubmF2aWdhdG9yLnNwbGFzaHNjcmVlbi5zaG93KCk7XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgXG4gICAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoJHdpbmRvdy5uYXZpZ2F0b3Iuc3BsYXNoc2NyZWVuKSB7XG4gICAgICAgICAgICAgICR3aW5kb3cubmF2aWdhdG9yLnNwbGFzaHNjcmVlbi5oaWRlKCk7XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuc3Bpbm5lckRpYWxvZycsIFtdKVxuICAuZmFjdG9yeSgnbWV1U3Bpbm5lckRpYWxvZycsIHNwaW5uZXJEaWFsb2cpO1xuICBcbiAgLypcbiAgaW5zdGFsbCAgIDogICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBjb3Jkb3ZhLXBsdWdpbi1zcGlubmVyZGlhbG9nXG4gIFxuICBIb3cgdG8gdXNlIGl0OiBcbiAgICBtZXVTcGlubmVyRGlhbG9nLnNob3coKVxuICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge30pXG4gICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7fSk7XG4gICovXG4gIFxuICBmdW5jdGlvbiBzcGlubmVyRGlhbG9nKCRxLCAkd2luZG93LCAkbG9nLCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5zaG93ID0gc2hvdztcbiAgICBzZXJ2aWNlLmhpZGUgPSBoaWRlO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgZnVuY3Rpb24gc2hvdygpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgc3Bpbm5lciA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuc3Bpbm5lckRpYWxvZztcbiAgICAgICAgXG4gICAgICAgICAgaWYgKHNwaW5uZXIpIHtcbiAgICAgICAgICAgIHNwaW5uZXIuc2hvdygpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tQTFVHSU4gTUlTU0lOR106IGNvcmRvdmEtcGx1Z2luLXNwaW5uZXJkaWFsb2cnKTtcbiAgICAgICAgICB9ICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gaGlkZSgpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgc3Bpbm5lciA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuc3Bpbm5lckRpYWxvZztcbiAgICAgICAgXG4gICAgICAgICAgaWYgKHNwaW5uZXIpIHtcbiAgICAgICAgICAgIHNwaW5uZXIuaGlkZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tQTFVHSU4gTUlTU0lOR106IGNvcmRvdmEtcGx1Z2luLXNwaW5uZXJkaWFsb2cnKTtcbiAgICAgICAgICB9ICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5zb2NpYWxTaGFyaW5nJywgW10pXG5cdC5mYWN0b3J5KCdtZXVTb2NpYWxTaGFyaW5nJywgWyckcScsICckd2luZG93JywgJ3N0cmlwdGFnc0ZpbHRlcicsICdicjJubEZpbHRlcicsICckbG9nJywgc29jaWFsU2hhcmluZ10pO1xuICBcbiAgLypcbiAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgaHR0cHM6Ly9naXRodWIuY29tL0VkZHlWZXJicnVnZ2VuL1NvY2lhbFNoYXJpbmctUGhvbmVHYXAtUGx1Z2luXG4gIFxuICBIb3cgdG8gdXNlIGl0OiBcbiAgICBtZXVTb2NpYWxTaGFyaW5nLnNoYXJlSXRlbSgpXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7fSlcbiAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHt9KTtcbiAgXG4gICAgbWV1U29jaWFsU2hhcmluZy5zaGFyZU1lZGlhKClcbiAgKi9cbiAgXG4gIGZ1bmN0aW9uIHNvY2lhbFNoYXJpbmcoJHEsICR3aW5kb3csIHN0cmlwdGFncywgYnIybmwsICRsb2csICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIHBvc3RmaXg6ICcnXG4gICAgfTtcbiAgICBcbiAgICBzZXJ2aWNlLnNoYXJlSXRlbSA9IHNoYXJlSXRlbTtcbiAgICBzZXJ2aWNlLnNoYXJlTWVkaWEgPSBzaGFyZU1lZGlhO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9uID0gc2V0T3B0aW9uO1xuICAgIHNlcnZpY2Uuc2V0T3B0aW9ucyA9IHNldE9wdGlvbnM7XG4gICAgc2VydmljZS5zaGFyZSA9IHNoYXJlO1xuICAgIHNlcnZpY2Uuc2hhcmVWaWFXaGF0c0FwcFRvUmVjZWl2ZXIgPSBzaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlcjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykge1xuICAgICAgYW5ndWxhci5leHRlbmQob3B0aW9ucywgb3B0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRPcHRpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgIG9wdGlvbnNbbmFtZV0gPSB2YWx1ZTtcbiAgICB9XG5cblx0XHRmdW5jdGlvbiBzaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlcihyZWNlaXZlcikge1xuICAgICAgdmFyIHNvY2lhbCA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuc29jaWFsc2hhcmluZztcblx0XHQgIFxuICAgICAgc29jaWFsLnNoYXJlVmlhV2hhdHNBcHBUb1JlY2VpdmVyKHJlY2VpdmVyLCAnTWVzc2FnZSB2aWEgV2hhdHNBcHAnLCBudWxsIC8qIGltZyAqLywgbnVsbCAvKiB1cmwgKi8sIGZ1bmN0aW9uKCkgeyRsb2cuZGVidWcoJ3NoYXJlIG9rJyk7fSk7XG5cdFx0fVxuICAgIFxuICAgIGZ1bmN0aW9uIHNoYXJlSXRlbShpdGVtKSB7XG5cdFx0XHRcblx0XHRcdHZhciBwYXJhbXMgPSB7XG5cdFx0XHQgIG1lc3NhZ2U6IGl0ZW0uZGVzY3JpcHRpb24sXG4gICAgICAgIHN1YmplY3Q6IGl0ZW0udGl0bGUsXG4gICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgdXJsOiBpdGVtLmhhc093blByb3BlcnR5KCdsaW5rJykgPyBpdGVtLmxpbmsgOiBudWxsXG5cdFx0XHR9O1xuXG4gICAgICBpZiAoaXRlbS50aHVtYm5haWxzICYmIGl0ZW0udGh1bWJuYWlscy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHBhcmFtcy5maWxlcy5wdXNoKGl0ZW0udGh1bWJuYWlsc1swXS51cmwpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc2hhcmUocGFyYW1zKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBzaGFyZU1lZGlhKG1lZGlhKSB7XG5cblx0XHRcdHZhciBwYXJhbXMgPSB7XG5cdFx0XHQgIG1lc3NhZ2U6IG1lZGlhLnRpdGxlLFxuICAgICAgICBzdWJqZWN0OiBtZWRpYS50aXRsZSxcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICB1cmw6IG1lZGlhLnVybFxuXHRcdFx0fTtcblx0XHRcdFxuXHRcdFx0Ly8gSWYgbWVkaWEgaXMgc2F2ZWQgbG9jYWxseSAobWVkaWEucGF0aCkgdGhlbiBzaGFyZSBpdFxuXHRcdFx0Ly8gRWxzZSBzaGFyZSBpdHMgbGluayAobWVkaWEudXJsKVxuXHRcdFx0Ly8gQ291bGRuJ3Qgc2hhcmUgdG9nZXRoZXIgbG9jYWwgcGRmIGFuZCBsaW5rXG5cdFx0XHRpZiAobWVkaWEuaGFzT3duUHJvcGVydHkoJ2Z1bGxQYXRoJykpIHtcblx0XHRcdFx0cGFyYW1zLmZpbGVzLnB1c2gobWVkaWEuZnVsbFBhdGgpO1xuXHRcdFx0XHRwYXJhbXMudXJsID0gbnVsbDtcblx0XHRcdH0gZWxzZSBpZiAobWVkaWEudGh1bWJuYWlscyAmJiBtZWRpYS50aHVtYm5haWxzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0cGFyYW1zLmZpbGVzLnB1c2gobWVkaWEudGh1bWJuYWlsc1swXS51cmwpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRyZXR1cm4gc2hhcmUocGFyYW1zKTtcblx0XHR9XG5cdFx0XG5cdFx0ZnVuY3Rpb24gc2hhcmUocGFyYW1zKSB7XG4gICAgLypcbiAgICAgIHRoaXMgaXMgdGhlIGNvbXBsZXRlIGxpc3Qgb2YgY3VycmVudGx5IHN1cHBvcnRlZCBwYXJhbXMgeW91IGNhbiBwYXNzIHRvIHRoZSBwbHVnaW4gKGFsbCBvcHRpb25hbClcbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBtZXNzYWdlOiAnc2hhcmUgdGhpcycsIC8vIG5vdCBzdXBwb3J0ZWQgb24gc29tZSBhcHBzIChGYWNlYm9vaywgSW5zdGFncmFtKVxuICAgICAgICBzdWJqZWN0OiAndGhlIHN1YmplY3QnLCAvLyBmaS4gZm9yIGVtYWlsXG4gICAgICAgIGZpbGVzOiBbJycsICcnXSwgLy8gYW4gYXJyYXkgb2YgZmlsZW5hbWVzIGVpdGhlciBsb2NhbGx5IG9yIHJlbW90ZWx5XG4gICAgICAgIHVybDogJ2h0dHBzOi8vd3d3LndlYnNpdGUuY29tL2Zvby8jYmFyP2E9YicsXG4gICAgICAgIGNob29zZXJUaXRsZTogJ1BpY2sgYW4gYXBwJyAvLyBBbmRyb2lkIG9ubHksIHlvdSBjYW4gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgc2hhcmUgc2hlZXQgdGl0bGVcbiAgICAgIH1cbiAgICAqL1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBcbiAgICAgICAgdmFyIGNiX3NoYXJlID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbDogZnVuY3Rpb24obXNnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tDQUxMQkFDSyBGQUlMVVJFXTogc29jaWFsLnNoYXJlV2l0aE9wdGlvbnMnKTtcbiAgICAgICAgICB9ICBcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIHNvY2lhbCA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuc29jaWFsc2hhcmluZztcbiAgICBcbiAgICBcdFx0XHRpZiAoc29jaWFsKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wb3N0Zml4KSB7XG4gICAgICBcdFx0XHRcdHBhcmFtcy5zdWJqZWN0ICs9IG9wdGlvbnMucG9zdGZpeDtcbiAgICAgICAgICAgIH1cbiAgICAgIFxuICAgICAgICAgICAgcGFyYW1zLm1lc3NhZ2UgPSBwYXJhbXMubWVzc2FnZSAmJiBzdHJpcHRhZ3MoYnIybmwocGFyYW1zLm1lc3NhZ2UpKTtcbiAgICAgICAgICAgIHBhcmFtcy5zdWJqZWN0ID0gcGFyYW1zLnN1YmplY3QgJiYgc3RyaXB0YWdzKGJyMm5sKHBhcmFtcy5zdWJqZWN0KSk7XG5cbiAgICAgICAgICAgIHNvY2lhbC5zaGFyZVdpdGhPcHRpb25zKHBhcmFtcywgY2Jfc2hhcmUuc3VjY2VzcywgY2Jfc2hhcmUuZmFpbCk7IFxuICAgIFx0XHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0ICB0aHJvdyBuZXcgRXJyb3IoJ1tQTFVHSU4gTUlTU0lOR106IGNvcmRvdmEtcGx1Z2luLXgtc29jaWFsc2hhcmluZycpO1xuICAgIFx0XHRcdH0gICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcblx0XHR9XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5wdXNoJywgW10pXG5cdC5mYWN0b3J5KCdwdXNod29vc2gnLCBpbml0UHVzaHdvb3NoKVxuXHQuZmFjdG9yeSgnb25lc2lnbmFsJywgT25lU2lnbmFsSW1wbCk7XG4gIFxuICAvKlxuICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3B1c2h3b29zaC1wZ2ItcGx1Z2luXG4gICAgaHR0cDovL2RvY3MucHVzaHdvb3NoLmNvbS9kb2NzL3Bob25lZ2FwLWJ1aWxkXG4gICovXG4gIGZ1bmN0aW9uIGluaXRQdXNod29vc2goJGxvZywgJHdpbmRvdywgJGRvY3VtZW50LCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgICAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuY29uZmlnID0gY29uZmlnO1xuICAgIHNlcnZpY2UucmVnaXN0ZXIgPSByZWdpc3RlcjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICB2YXIgZ29vZ2xlUHJvamVjdE51bWJlcjtcbiAgICB2YXIgYXBwbGljYXRpb25Db2RlO1xuXHRcbiAgICBmdW5jdGlvbiBjb25maWcoZywgYSkge1xuICAgICAgZ29vZ2xlUHJvamVjdE51bWJlciA9IGc7XG4gICAgICBhcHBsaWNhdGlvbkNvZGUgPSBhO1xuICAgIH07XG4gICAgXG4gICAgLy8gSW5pdGlhbGl6ZSBQdXNod29vc2guIFRoaXMgd2lsbCB0cmlnZ2VyIGFsbCBwZW5kaW5nIHB1c2ggbm90aWZpY2F0aW9ucyBvbiBzdGFydC5cbiAgICBmdW5jdGlvbiByZWdpc3RlcihzdWNjZXNzLCBmYWlsKSB7XG4gICAgICBcbiAgICAgIHRyeSB7ICAgXG4gICAgICAgIHZhciBwdXNoTm90aWZpY2F0aW9uID0gYW5ndWxhci5pc0RlZmluZWQoJHdpbmRvdy5jb3Jkb3ZhKSAmJiAkd2luZG93LmNvcmRvdmEucmVxdWlyZSgncHVzaHdvb3NoLWNvcmRvdmEtcGx1Z2luLlB1c2hOb3RpZmljYXRpb24nKTtcbiAgICAgIFxuICAgICAgICBpZiAocHVzaE5vdGlmaWNhdGlvbikge1xuICAgICAgICAgIC8vIFNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIHB1c2h3b29zaC5vbkRldmljZVJlYWR5XG4gICAgICAgICAgJGRvY3VtZW50Lm9uKCdwdXNoLW5vdGlmaWNhdGlvbicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgbm90aWZpY2F0aW9uID0gZXZlbnQubm90aWZpY2F0aW9uO1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgIGhhbmRsZSBwdXNoIG9wZW4gaGVyZVxuICAgICAgICAgICAgbm90aWZpY2F0aW9uLm1lc3NhZ2VcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbi51c2VyRGF0YSA9IHtcbiAgICAgICAgICAgICAgJ2NhdGVnb3J5X2lkJzogLi4uLFxuICAgICAgICAgICAgICAnaXRlbV9pZCc6IC4uLlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKi8gXG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdldmVudC5ub3RpZmljYXRpb24nKTtcbiAgICAgICAgICAgICRsb2cuZGVidWcobm90aWZpY2F0aW9uKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24ub25EZXZpY2VSZWFkeSh7IFxuICAgICAgICAgICAgcHJvamVjdGlkOiBnb29nbGVQcm9qZWN0TnVtYmVyLFxuICAgICAgICAgICAgcHdfYXBwaWQ6IGFwcGxpY2F0aW9uQ29kZX1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy9yZWdpc3RlciBmb3IgcHVzaCBub3RpZmljYXRpb25zXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5yZWdpc3RlckRldmljZShcbiAgICAgICAgICAgIGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICB2YXIgcHVzaElkcyA9IHt9O1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgcHVzaElkcy50b2tlbiA9IHN0YXR1cy5wdXNoVG9rZW47XG4gICAgICAgICAgICAgIHN1Y2Nlc3MocHVzaElkcyk7XG4gICAgICAgICAgICB9LCBcbiAgICAgICAgICAgIGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1B1c2g6IENhblxcJ3QgcmVnaXN0ZXIgZGV2aWNlJyk7XG4gICAgICAgICAgICAgIGZhaWwoc3RhdHVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIC8vY2xlYXIgdGhlIGFwcCBiYWRnZVxuICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24uc2V0QXBwbGljYXRpb25JY29uQmFkZ2VOdW1iZXIoMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBsdWdpbjogcHVzaHdvb3NoLWNvcmRvdmEtcGx1Z2luJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICRleGNlcHRpb25IYW5kbGVyKGVycm9yKTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cdFxuICAvKlxuICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL29uZXNpZ25hbC1jb3Jkb3ZhLXBsdWdpblxuICAgIGh0dHBzOi8vZG9jdW1lbnRhdGlvbi5vbmVzaWduYWwuY29tL2RvY3MvcGhvbmVnYXAtc2RrXG4gICovXG4gIFxuXHRmdW5jdGlvbiBPbmVTaWduYWxJbXBsKCRsb2csICR3aW5kb3csICRleGNlcHRpb25IYW5kbGVyLCAkcm9vdFNjb3BlLCAkcSkge1xuXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmNvbmZpZyA9IGNvbmZpZztcbiAgICBzZXJ2aWNlLnJlZ2lzdGVyID0gcmVnaXN0ZXI7XG4gICAgc2VydmljZS5zZW5kVGFnID0gc2VuZFRhZztcbiAgICBzZXJ2aWNlLnNldFN1YnNjcmlwdGlvbiA9IHNldFN1YnNjcmlwdGlvbjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICB2YXIgZ29vZ2xlUHJvamVjdE51bWJlcjtcblx0XHR2YXIgYXBwSWQ7XG5cdFxuXHRcdGZ1bmN0aW9uIGNvbmZpZyhnLCBhKSB7XG5cdFx0XHRnb29nbGVQcm9qZWN0TnVtYmVyID0gZztcblx0XHRcdGFwcElkID0gYTtcblx0XHR9O1xuXHRcdFxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIG5nTWV1bW9iaS5VdGlscy5wdXNoLm1ldVB1c2gjc2V0UHJvdmlkZXJcbiAgICogQG1ldGhvZE9mIG5nTWV1bW9iaS5VdGlscy5wdXNoLm1ldVB1c2hcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFNldHMgY3VycmVudCBQdXNoIHByb3ZpZGVyIChieSBkZWZhdWx0ICdwdXNod29vc2gnKS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHByb3ZpZGVyIG5hbWUgeydwdXNod29vc2gnLCAnb25lc2lnbmFsJ30uXG4gICAqL1xuICAgIFxuICAgIGZ1bmN0aW9uIHNlbmRUYWcoa2V5LCB2YWx1ZSkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBwdXNoTm90aWZpY2F0aW9uID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5PbmVTaWduYWw7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHB1c2hOb3RpZmljYXRpb24pIHtcbiAgICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24uc2VuZFRhZyhrZXksIHZhbHVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBsdWdpbjogb25lc2lnbmFsLWNvcmRvdmEtcGx1Z2luJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHNldFN1YnNjcmlwdGlvbihib29sKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIHB1c2hOb3RpZmljYXRpb24gPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLk9uZVNpZ25hbDtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAocHVzaE5vdGlmaWNhdGlvbikge1xuICAgICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5zZXRTdWJzY3JpcHRpb24oYm9vbCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBQbHVnaW46IG9uZXNpZ25hbC1jb3Jkb3ZhLXBsdWdpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiByZWdpc3RlcihzdWNjZXNzLCBlcnJvcikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIHB1c2hOb3RpZmljYXRpb24gPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLk9uZVNpZ25hbDtcblxuICAgICAgICBpZiAocHVzaE5vdGlmaWNhdGlvbikge1xuICAgICAgICAgICRsb2cuZGVidWcoJ1BsdWdpbiBPbmVTaWduYWwgbG9hZGVkJyk7XG4gICAgICAgIFxuICAgICAgICAgIHZhciBpb3NTZXR0aW5ncyA9IHt9O1xuICAgICAgICAgIGlvc1NldHRpbmdzWydrT1NTZXR0aW5nc0tleUF1dG9Qcm9tcHQnXSA9IHRydWU7XG4gICAgICAgICAgaW9zU2V0dGluZ3NbJ2tPU1NldHRpbmdzS2V5SW5BcHBMYXVuY2hVUkwnXSA9IGZhbHNlO1xuICAgICAgICAgIFxuICAgICAgICAgIHZhciBkaWRSZWNlaXZlUmVtb3RlTm90aWZpY2F0aW9uQ2FsbEJhY2sgPSBmdW5jdGlvbihqc29uRGF0YSkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgncmVjZWl2ZS1ub3RpZmljYXRpb24nLCBhbmd1bGFyLnRvSnNvbihqc29uRGF0YSkpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIGRpZE9wZW5SZW1vdGVOb3RpZmljYXRpb25DYWxsQmFjayA9IGZ1bmN0aW9uKGpzb25EYXRhKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdvcGVuLW5vdGlmaWNhdGlvbicsIGFuZ3VsYXIudG9Kc29uKGpzb25EYXRhKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyByZXN1bHQubm90aWZpY2F0aW9uLnBheWxvYWQuYWRkaXRpb25hbERhdGFcblxuICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24uc3RhcnRJbml0KGFwcElkKVxuICAgICAgICAgIC5oYW5kbGVOb3RpZmljYXRpb25SZWNlaXZlZChkaWRSZWNlaXZlUmVtb3RlTm90aWZpY2F0aW9uQ2FsbEJhY2spXG4gICAgICAgICAgLmhhbmRsZU5vdGlmaWNhdGlvbk9wZW5lZChkaWRPcGVuUmVtb3RlTm90aWZpY2F0aW9uQ2FsbEJhY2spXG4gICAgICAgICAgLmluRm9jdXNEaXNwbGF5aW5nKHB1c2hOb3RpZmljYXRpb24uT1NJbkZvY3VzRGlzcGxheU9wdGlvbi5JbkFwcEFsZXJ0KVxuICAgICAgICAgIC5pT1NTZXR0aW5ncyhpb3NTZXR0aW5ncylcbiAgICAgICAgICAuZW5kSW5pdCgpO1xuICAgICAgICAgIFxuICAgICAgICAgIHB1c2hOb3RpZmljYXRpb24uZ2V0SWRzKGZ1bmN0aW9uKGlkcykge1xuICAgICAgICAgICAgdmFyIHB1c2hJZHMgPSB7fTtcbiAgICAgICAgICAgIHB1c2hJZHMudG9rZW4gPSBpZHMucHVzaFRva2VuO1xuICAgICAgICAgICAgcHVzaElkcy51dWlkID0gaWRzLnVzZXJJZDtcbiAgICAgICAgICAgIHN1Y2Nlc3MocHVzaElkcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5nZXRUYWdzKGZ1bmN0aW9uKHRhZ3MpIHtcbiAgICAgICAgICAgIC8vYWxlcnQoJ2dldCBQdXNoIFRhZ3M6XFxuJyArIGFuZ3VsYXIudG9Kc29uKHRhZ3MpKTtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ1RhZ3MgUmVjZWl2ZWQ6ICcgKyBhbmd1bGFyLnRvSnNvbih0YWdzKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBsdWdpbjogb25lc2lnbmFsLWNvcmRvdmEtcGx1Z2luJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICRleGNlcHRpb25IYW5kbGVyKGVycm9yKTtcbiAgICAgIH1cbiAgICB9O1xuXHR9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuZmlsZXMnLCBbJ3NsdWdpZmllciddKVxuICAuY29uc3RhbnQoJ01JTUVTJywge1xuICAgICdhcHBsaWNhdGlvbi9wZGYnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtcGRmLW8nLFxuICAgICAgbGFiZWw6ICdWaWV3JyxcbiAgICAgIGV4dGVuc2lvbjogJ3BkZicsXG4gICAgICBkb3dubG9hZDogdHJ1ZVxuICAgIH0sXG4gICAgJ3RleHQvaHRtbCc6IHtcbiAgICAgIGNsYXNzOiAnZmEtcnNzJyxcbiAgICAgIGxhYmVsOiAnT3BlbicsXG4gICAgICBleHRlbnNpb246ICdodG1sJyxcbiAgICAgIGRvd25sb2FkOiBmYWxzZVxuICAgIH0sXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC55b3V0dWJlLnZpZGVvK2h0bWwnOiB7XG4gICAgICBjbGFzczogJ2ZhLXlvdXR1YmUtcGxheScsXG4gICAgICBvcGVuQ2xhc3M6ICdmYS1wbGF5JyxcbiAgICAgIGxhYmVsOiAnUGxheScsXG4gICAgICBleHRlbnNpb246ICdodG1sJyxcbiAgICAgIGRvd25sb2FkOiBmYWxzZVxuICAgIH0sXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCc6IHtcbiAgICAgIGNsYXNzOiAnZmEtZmlsZS1leGNlbC1vJyxcbiAgICAgIGxhYmVsOiAnVmlldycsXG4gICAgICBleHRlbnNpb246ICd4bHMnLFxuICAgICAgZG93bmxvYWQ6IHRydWVcbiAgICB9LFxuICAgICdhcHBsaWNhdGlvbi94bHN4Jzoge1xuICAgICAgY2xhc3M6ICdmYS1maWxlLWV4Y2VsLW8nLFxuICAgICAgbGFiZWw6ICdWaWV3JyxcbiAgICAgIGV4dGVuc2lvbjogJ3hscycsXG4gICAgICBkb3dubG9hZDogdHJ1ZVxuICAgIH0sXG4gICAgJ2F1ZGlvL21wZWcnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtYXVkaW8tbycsXG4gICAgICBsYWJlbDogJ1BsYXknLFxuICAgICAgb3BlbkNsYXNzOiAnZmEtcGxheScsXG4gICAgICBleHRlbnNpb246ICdtcDMnLFxuICAgICAgZG93bmxvYWQ6IHRydWVcbiAgICB9LFxuICAgICd2aWRlby9tcDQnOiB7XG4gICAgICBjbGFzczogJ2ZhLWZpbGUtdmlkZW8tbycsXG4gICAgICBsYWJlbDogJ1BsYXknLFxuICAgICAgb3BlbkNsYXNzOiAnZmEtcGxheScsXG4gICAgICBleHRlbnNpb246ICdtcDQnLFxuICAgICAgZG93bmxvYWQ6IHRydWVcbiAgICB9LFxuICAgICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCc6IHtcbiAgICAgIGNsYXNzOiAnZmEtZmlsZS1wb3dlcnBvaW50LW8nLFxuICAgICAgbGFiZWw6ICdWaWV3JyxcbiAgICAgIGV4dGVuc2lvbjogJ3BwdCcsXG4gICAgICBkb3dubG9hZDogdHJ1ZSxcbiAgICB9LFxuICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCc6IHtcbiAgICAgIGNsYXNzOiAnZmEtZmlsZS1leGNlbC1vJyxcbiAgICAgIGxhYmVsOiAnVmlldycsXG4gICAgICBleHRlbnNpb246ICd4bHMnLFxuICAgICAgZG93bmxvYWQ6IHRydWVcbiAgICB9XG4gIH0pXG4gIC5maWx0ZXIoJ21lZGlhQ2xpY2tMYWJlbCcsIG1lZGlhQ2xpY2tMYWJlbClcbiAgLmZpbHRlcignbWVkaWFJY29uQ2xhc3MnLCBtZWRpYUljb25DbGFzcylcbiAgLmZpbHRlcignbWVkaWFPcGVuQ2xhc3MnLCBtZWRpYU9wZW5DbGFzcykgXG4gIC5wcm92aWRlcignbWV1RmlsZXMnLCBmaWxlcyk7IFxuICAgICAgICBcbiAgZnVuY3Rpb24gZmlsZXMoKSB7XG4gICAgdmFyIGZpbGVUcmFuc2ZlcnMgPSB7fTtcbiAgICB2YXIgZmlsZXMgPSB7fTtcbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIGxvY2FsRm9sZGVyOiAnRG93bmxvYWRzJ1xuICAgIH07XG4gICAgdmFyIHN0YXR1c2VzID0ge1xuICAgICAgZG93bmxvYWQ6ICdkb3dubG9hZCcsXG4gICAgICBkb3dubG9hZGluZzogJ2Rvd25sb2FkaW5nJyxcbiAgICAgIGRvd25sb2FkZWQ6ICdkb3dubG9hZGVkJ1xuICAgIH07XG4gICAgXG4gICAgdGhpcy5zZXRPcHRpb25zID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgYW5ndWxhci5leHRlbmQob3B0aW9ucywgb3B0KTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZXRPcHRpb24gPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgIH07XG5cbiAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbigkcSwgJGxvZywgJHdpbmRvdywgTUlNRVMsIFNsdWcpIHtcbiAgICAgIHZhciBhcGkgPSB7fTtcbiAgICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgKiAgQXBpIG1ldGhvZHMsIGF2YWlsYWJsZSBvbmx5IG9uIHRoZSBpbnNpZGUgdGhlIHNlcnZpY2VcbiAgICAgICovXG5cbiAgICAgIGFwaS5maWxlRXJyb3JIYW5kbGVyID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAvKlxuICAgICAgICBMaXN0IG9mIEVycm9ycyBjb3Jkb3ZhLXBsdWdpbi1maWxlXG4gICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9hcGFjaGUvY29yZG92YS1wbHVnaW4tZmlsZSNsaXN0LW9mLWVycm9yLWNvZGVzLWFuZC1tZWFuaW5nc1xuICAgICAgICBGb3IgdGhlIG1lYW5pbmcgSSByZWNvbW1lbmQgdG8gcmVhZCBodHRwczovL3dpY2cuZ2l0aHViLmlvL2VudHJpZXMtYXBpLyNjb21tb24tdHlwZXNcbiAgICAgICAgKi9cbiAgICAgICAgc3dpdGNoIChlLmNvZGUpIHtcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnUmVxdWVzdGVkIGZpbGUgY291bGQgbm90IGJlIGZvdW5kJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuU0VDVVJJVFlfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdTRUNVUklUWV9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5BQk9SVF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ0FCT1JUX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLk5PVF9SRUFEQUJMRV9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ05PVF9SRUFEQUJMRV9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5FTkNPRElOR19FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ01hbGZvcm1lZCBVUkknO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5OT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ05PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdJTlZBTElEX1NUQVRFX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLlNZTlRBWF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1NZTlRBWF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVFcnJvci5JTlZBTElEX01PRElGSUNBVElPTl9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ0lOVkFMSURfTU9ESUZJQ0FUSU9OX0VSUic7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRmlsZUVycm9yLlFVT1RBX0VYQ0VFREVEX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnUVVPVEFfRVhDRUVERURfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuVFlQRV9NSVNNQVRDSF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ1RZUEVfTUlTTUFUQ0hfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlRXJyb3IuUEFUSF9FWElTVFNfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdQQVRIX0VYSVNUU19FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdVbmtub3duIEVycm9yJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAkbG9nLmRlYnVnKCdFcnJvcjogJyArIGUubWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5maWxlVHJhbnNmZXJFcnJvckhhbmRsZXIgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8qXG4gICAgICAgIEEgRmlsZVRyYW5zZmVyRXJyb3Igb2JqZWN0IGlzIHBhc3NlZCB0byBhbiBlcnJvciBjYWxsYmFjayB3aGVuIGFuIGVycm9yIG9jY3Vycy5cbiAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9jb3Jkb3ZhLXBsdWdpbi1maWxlLXRyYW5zZmVyI2ZpbGV0cmFuc2ZlcmVycm9yXG4gICAgICAgICovXG4gICAgICAgIHN3aXRjaCAoZS5jb2RlKSB7XG4gICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuRklMRV9OT1RfRk9VTkRfRVJSOlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdGSUxFX05PVF9GT1VORF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLklOVkFMSURfVVJMX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnSU5WQUxJRF9VUkxfRVJSJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBGaWxlVHJhbnNmZXJFcnJvci5DT05ORUNUSU9OX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnQ09OTkVDVElPTl9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLkFCT1JUX0VSUjpcbiAgICAgICAgICBlLm1lc3NhZ2UgPSAnT3BlcmF0aW9uIGFib3J0ZWQnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLk5PVF9NT0RJRklFRF9FUlI6XG4gICAgICAgICAgZS5tZXNzYWdlID0gJ05PVF9NT0RJRklFRF9FUlInO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGUubWVzc2FnZSA9ICdVbmtub3duIEVycm9yJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAkbG9nLmRlYnVnKCdFcnJvcjogJyArIGUubWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH07XG5cbiAgICAgIGFwaS5nZXRGaWxlc0Zyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLypcbiAgICAgICAgQ2hlY2sgaWYgZmlsZXMgaXMgYWxyZWFkeSBsb2FkZWQgKGlmIG5vdCBpcyBlbXB0eSlcbiAgICAgICAgVE9ETzogaXMgbG9hZGluZyBsb2NhbFN0b3JhZ2VbJ2ZpbGVzXSBmb3IgZWFjaCBtZWRpYSwgc2hvdWxkIGJlIG9wdGltaXplZCB0byBvbmx5IGxvYWQgb25jZSBmb3IgYWxsXG4gICAgICAgICovXG4gICAgICAgIGlmICghT2JqZWN0LmtleXMoZmlsZXMpLmxlbmd0aCAgJiYgbG9jYWxTdG9yYWdlWydmaWxlcyddKSB7IFxuICAgICAgICAgIHZhciBlbnRyaWVzID0gYW5ndWxhci5mcm9tSnNvbihsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10pO1xuICAgICAgICAgIGZpbGVzID0gYXBpLmNoZWNrUmVwb3NpdG9yeUNvbnNpc3RlbmN5KGVudHJpZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWxlcztcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5nZXRGaWxlTmFtZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgdmFyIGV4dCA9IGZpbGUuZXh0ZW5zaW9uIHx8ICcnO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFleHQgJiYgTUlNRVNbZmlsZS50eXBlXSlcbiAgICAgICAgICBleHQgPSBNSU1FU1tmaWxlLnR5cGVdLmV4dGVuc2lvbjtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgdmFyIG5hbWUgPSBmaWxlLnRpdGxlIHx8ICcnO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgbmFtZSA9IG1kNShmaWxlLnVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmFtZSA9IFNsdWcuc2x1Z2lmeShuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5hbWUgKyAnLicgKyBleHQ7XG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuY2hlY2tSZXBvc2l0b3J5Q29uc2lzdGVuY3kgPSBmdW5jdGlvbihlbnRyaWVzKSB7XG4gICAgICAgIC8qXG4gICAgICAgIGlkIG11c3QgYmUgZXF1YWxzIHRvIGZpbGUucGF0aFxuICAgICAgICBhbmQgZnVsbFBhdGggY2FuIGJlIHVwZGF0ZWQgaWYgQXBwIGlzIHVwZGF0ZWQgKGlPUylcbiAgICAgICAgKi9cbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuICAgICAgICBPYmplY3Qua2V5cyhlbnRyaWVzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSxpbmRleCkge1xuICAgICAgICAgIG9ialtlbnRyaWVzW2tleV0ucGF0aF0gPSBlbnRyaWVzW2tleV07XG4gICAgICAgICAgb2JqW2VudHJpZXNba2V5XS5wYXRoXS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZW50cmllc1trZXldLnBhdGgpO1xuICAgICAgICB9KTtcbiAgICAgICAgbG9jYWxTdG9yYWdlWydmaWxlcyddID0gYW5ndWxhci50b0pzb24ob2JqKTtcblxuICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy8gUmV0dXJucyB0aGUgZnVsbCBhYnNvbHV0ZSBwYXRoIGZyb20gdGhlIHJvb3QgdG8gdGhlIEZpbGVFbnRyeVxuICAgICAgYXBpLmdldEZpbGVGdWxsUGF0aCA9IGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICB2YXIgcm9vdFBhdGggPSBudWxsO1xuICAgICAgICBpZiAoZGV2aWNlLnBsYXRmb3JtID09ICdBbmRyb2lkJykge1xuICAgICAgICAgIHJvb3RQYXRoID0gY29yZG92YS5maWxlLmV4dGVybmFsRGF0YURpcmVjdG9yeTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByb290UGF0aCA9IGNvcmRvdmEuZmlsZS5kYXRhRGlyZWN0b3J5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcGlcbiAgICAgICAgICAuZ2V0RG93bmxvYWREaXJFbnRyeShyb290UGF0aCwgb3B0aW9ucy5sb2NhbEZvbGRlcilcbiAgICAgICAgICAudGhlbigoZGlyRW50cnkpID0+IGRpckVudHJ5Lm5hdGl2ZVVSTCArIGZpbGVOYW1lKTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGFwaS5nZXRGaWxlUGF0aCA9IGZ1bmN0aW9uIChmaWxlTmFtZSkge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5sb2NhbEZvbGRlciArICcvJyArIGZpbGVOYW1lO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy9hZGQgZmlsZSB0byBsb2NhbHN0b3JhZ2VcbiAgICAgIGFwaS5hZGRGaWxlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICBmaWxlc1tmaWxlLnBhdGhdID0gZmlsZTtcbiAgICAgICAgbG9jYWxTdG9yYWdlWydmaWxlcyddID0gYW5ndWxhci50b0pzb24oZmlsZXMpO1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy9yZW1vdmUgZmlsZSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgICAgYXBpLnJlbW92ZUZpbGUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICBkZWxldGUgZmlsZXNbaWRdO1xuICAgICAgICBsb2NhbFN0b3JhZ2VbJ2ZpbGVzJ10gPSBhbmd1bGFyLnRvSnNvbihmaWxlcyk7XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvL2dldCBmaWxlcyBoYW5kbGVyXG4gICAgICBhcGkuZ2V0RmlsZUVudHJ5ID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuICAgICAgICAkd2luZG93LnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkwoXG4gICAgICAgICAgcGF0aCwgXG4gICAgICAgICAgZnVuY3Rpb24oZW50cnkpIHtcbiAgICAgICAgICAgIHEucmVzb2x2ZShlbnRyeSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhlcnJvcik7XG4gICAgICAgICAgICBlcnJvciA9IGFwaS5maWxlRXJyb3JIYW5kbGVyKGVycm9yKTtcbiAgICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuaXNEb3dubG9hZGVkID0gZnVuY3Rpb24oZmlsZVBhdGgpIHtcbiAgICAgICAgLypcbiAgICAgICAgVE9ETzogSWYgc3RhdHVzIGlzIGRvd25sb2FkZWQgYnV0IGxvY2FsIGZpbGUgaXMgbWlzc2luZyB0aGVuIHJldHVybiBGQUxTRVxuICAgICAgICBLZWVwIHJlY29yZCBvbiBsb2NhbHN0b3JhZ2UgdG8gYXBwZWFycyBhcyBmaWxlIGFscmVhZHkgZG93bmxvYWRlZCwgdXNlciBjYW4gcmUtZG93bmxvYWQgaWYgbmVlZGVkXG4gICAgICAgICovXG4gICAgICAgIHJldHVybiAhIWFwaS5nZXRGaWxlc0Zyb21Mb2NhbFN0b3JhZ2UoKVtmaWxlUGF0aF07XG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuaXNEb3dubG9hZGluZyA9IGZ1bmN0aW9uKGZpbGVQYXRoKSB7XG4gICAgICAgIHJldHVybiAhIWZpbGVUcmFuc2ZlcnNbZmlsZVBhdGhdOyAgICAgXG4gICAgICB9O1xuICAgICAgXG4gICAgICBhcGkuZ2V0RmlsZVN0YXR1cyA9IGZ1bmN0aW9uKGZpbGVQYXRoKSB7XG4gICAgICAgIGlmIChhcGkuaXNEb3dubG9hZGVkKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZGVkO1xuICAgICAgICB9IGVsc2UgaWYgKGFwaS5pc0Rvd25sb2FkaW5nKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZGluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc3RhdHVzZXMuZG93bmxvYWQ7IFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIFxuICAgICAgLyoqXG4gICAgICAqIFNlcnZpY2UgbWV0aG9kcywgdGhhdCBhcmUgcHVibGljIGFuZCBhdmFpbGFibGUgZm9yIGFueSByZXNvdXJjZVxuICAgICAgKi9cbiAgICAgIC8vIEZpbGUgYXZhaWxhYmxlIHN0YXR1c2VzLCBiZXN0IGZvciBkZWJ1ZyBhbmQgbWFpdGFpbiB0aGFuIGp1c3Qgc3RyaW5nLlxuICAgICAgXG4gICAgICBzZXJ2aWNlLmRvd25sb2FkID0gZG93bmxvYWQ7XG4gICAgICBzZXJ2aWNlLmRlY29yYXRlRmlsZSA9IGRlY29yYXRlRmlsZTtcbiAgICAgIHNlcnZpY2UucmVtb3ZlID0gcmVtb3ZlO1xuICAgICAgc2VydmljZS5saXN0ID0gYXBpLmdldEZpbGVzRnJvbUxvY2FsU3RvcmFnZTtcbiAgICAgIHNlcnZpY2Uub3BlbiA9IG9wZW47XG4gICAgICBzZXJ2aWNlLmlzRG93bmxvYWRhYmxlID0gaXNEb3dubG9hZGFibGU7XG4gICAgICBzZXJ2aWNlLm9wZW5GaWxlT3BlbmVyID0gb3BlbkZpbGVPcGVuZXI7XG4gICAgICBcbiAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgXG4gICAgICAvKlxuICAgICAgSW5zdGFsbDogY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLWZpbGUtb3BlbmVyMlxuICAgICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29yZG92YS1wbHVnaW4tZmlsZS1vcGVuZXIyXG4gICAgICAqL1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBpc0Rvd25sb2FkYWJsZShmaWxlKSB7XG4gICAgICAgIHJldHVybiAoZmlsZS50eXBlIGluIE1JTUVTKSA/IE1JTUVTW2ZpbGUudHlwZV0uZG93bmxvYWQgOiB0cnVlO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBvcGVuRmlsZU9wZW5lcih1cmksIHR5cGUpIHtcbiAgICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIGNvcmRvdmEucGx1Z2lucy5maWxlT3BlbmVyMi5vcGVuKHVyaSwgdHlwZSwge1xuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgICAgfSwgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcS5yZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIG9wZW4oZmlsZSkge1xuICAgICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG4gICAgICAgIHZhciBjYl9lbnRyeSA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgICAgb3BlbkZpbGVPcGVuZXIoZW50cnkudG9VUkwoKSwgZmlsZS50eXBlKS50aGVuKFxuICAgICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHEucmVqZWN0KGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgZmlsZS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5wYXRoKTtcbiAgICAgICAgYXBpLmdldEZpbGVFbnRyeShmaWxlLmZ1bGxQYXRoKVxuICAgICAgICAudGhlbihmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICAgIGNiX2VudHJ5LnN1Y2Nlc3MoZW50cnkpO1xuICAgICAgICB9LCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgY2JfZW50cnkuZmFpbChlKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgICAgXG4gICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgIH07XG4gICAgICBcbiAgICBmdW5jdGlvbiBkb3dubG9hZChmaWxlKSB7XG4gICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG4gICAgICB2YXIgZnQgPSBuZXcgRmlsZVRyYW5zZmVyKCk7XG4gICAgICB2YXIgdXJpID0gZW5jb2RlVVJJKGZpbGUudXJsKTtcbiAgICAgICAgXG4gICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkaW5nO1xuICAgICAgZmlsZS5mdWxsUGF0aCA9IGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5wYXRoKTtcbiAgICAgIGZpbGVUcmFuc2ZlcnNbZmlsZS5wYXRoXSA9IGZ0O1xuXG4gICAgICBmdC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKHByb2dyZXNzKSB7XG4gICAgICAgIHEubm90aWZ5KHByb2dyZXNzKTtcbiAgICAgIH07XG5cbiAgICAgIHEucHJvbWlzZS5hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnQuYWJvcnQoKTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBjYl9kb3dubG9hZCA9IHtcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZmlsZUVudHJ5KSB7XG4gICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZGVkO1xuICAgICAgICAgIGFwaS5hZGRGaWxlKGZpbGUpO1xuICAgICAgICAgIGRlbGV0ZSBmaWxlVHJhbnNmZXJzW2ZpbGUucGF0aF07XG4gICAgICAgICAgcS5yZXNvbHZlKGZpbGUpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsOiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICRsb2cuZGVidWcoZXJyb3IpO1xuICAgICAgICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWQ7XG4gICAgICAgICAgZXJyb3IgPSBhcGkuZmlsZVRyYW5zZmVyRXJyb3JIYW5kbGVyKGVycm9yKTtcbiAgICAgICAgICBkZWxldGUgZmlsZVRyYW5zZmVyc1tmaWxlLnBhdGhdO1xuICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGZ0LmRvd25sb2FkKHVyaSwgZmlsZS5mdWxsUGF0aCwgY2JfZG93bmxvYWQuc3VjY2VzcywgY2JfZG93bmxvYWQuZmFpbCwgZmFsc2UpO1xuICAgICAgICBcbiAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgfTtcbiAgICAgIFxuICAgIGZ1bmN0aW9uIHJlbW92ZShmaWxlKSB7XG4gICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG5cbiAgICAgIGZpbGUuZnVsbFBhdGggPSBhcGkuZ2V0RmlsZUZ1bGxQYXRoKGZpbGUucGF0aCk7XG4gICAgICBhcGkuZ2V0RmlsZUVudHJ5KGZpbGUuZnVsbFBhdGgpXG4gICAgICAudGhlbihmdW5jdGlvbihlbnRyeSkge1xuICAgICAgICBlbnRyeS5yZW1vdmUoXG4gICAgICAgICAgZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgYXBpLnJlbW92ZUZpbGUoZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWQ7XG4gICAgICAgICAgICBxLnJlc29sdmUoZmlsZSk7XG4gICAgICAgICAgfSxmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkO1xuICAgICAgICBxLnJlamVjdChlcnJvcik7XG4gICAgICB9XG4gICAgKTtcbiAgICAgICAgXG4gICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgfVxuICAgICAgXG4gIGZ1bmN0aW9uIGRlY29yYXRlRmlsZShmaWxlKSB7XG4gICAgZmlsZS5uYW1lID0gZmlsZS5uYW1lIHx8IGFwaS5nZXRGaWxlTmFtZShmaWxlKTtcbiAgICBmaWxlLnBhdGggPSBmaWxlLnBhdGggfHwgYXBpLmdldEZpbGVQYXRoKGZpbGUubmFtZSk7XG4gICAgZmlsZS5zdGF0dXMgPSBhcGkuZ2V0RmlsZVN0YXR1cyhmaWxlLnBhdGgpO1xuICAgICAgICBcbiAgICAvKlxuICAgIElmIGRldmljZSBub3QgZXhpc3RzIHRoZW4gYXBwIHJ1biBvbiBicm93c2VyXG4gICAgKi9cbiAgICBpZiAoIXR5cGVvZihkZXZpY2UpKSB7XG4gICAgICB2YXIgZnVsbFBhdGggPSBhcGkuZ2V0RmlsZUZ1bGxQYXRoKGZpbGUucGF0aCk7XG4gICAgICBpZiAoYXBpLmlzRG93bmxvYWRlZChmdWxsUGF0aCkpXG4gICAgICAgIGZpbGUuZnVsbFBhdGggPSBmdWxsUGF0aDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZpbGU7XG4gIH07XG59O1xufTtcbiAgXG5mdW5jdGlvbiBtZWRpYUNsaWNrTGFiZWwoTUlNRVMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gTUlNRVNbdHlwZV0gPyBNSU1FU1t0eXBlXS5sYWJlbCA6ICdPcGVuJztcbiAgfTtcbn1cblx0XG5mdW5jdGlvbiBtZWRpYUljb25DbGFzcyhNSU1FUykge1xuICByZXR1cm4gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiBNSU1FU1t0eXBlXSA/IE1JTUVTW3R5cGVdLmNsYXNzIDogJ2ZhLWV4dGVybmFsLWxpbmsnO1xuICB9O1xufVxuICBcbmZ1bmN0aW9uIG1lZGlhT3BlbkNsYXNzKE1JTUVTKSB7XG4gIHJldHVybiBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIChNSU1FU1t0eXBlXSAmJiBNSU1FU1t0eXBlXS5vcGVuQ2xhc3MgKT8gTUlNRVNbdHlwZV0ub3BlbkNsYXNzIDogJ2ZhLWV5ZSc7XG4gIH07XG59XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuZGlhbG9ncycsIFtdKVxuXHQuZmFjdG9yeSgnbWV1RGlhbG9ncycsIGRpYWxvZ3MpO1xuICBcbiAgLypcbiAgICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLWRpYWxvZ3MgbmwueC1zZXJ2aWNlcy5wbHVnaW5zLnRvYXN0XG4gICAgbGluayAgICAgIDogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9hcGFjaGUvY29yZG92YS1wbHVnaW4tZGlhbG9nc1xuICAgIGxpbmsgICAgICA6ICAgICBodHRwczovL2dpdGh1Yi5jb20vRWRkeVZlcmJydWdnZW4vVG9hc3QtUGhvbmVHYXAtUGx1Z2luICBcbiAgKi9cbiAgXG4gIGZ1bmN0aW9uIGRpYWxvZ3MoJHEsICR3aW5kb3csICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmFsZXJ0ID0gYWxlcnQ7XG4gICAgc2VydmljZS5jb25maXJtID0gY29uZmlybTtcbiAgICBzZXJ2aWNlLnRvYXN0ID0gdG9hc3Q7XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgZnVuY3Rpb24gYWxlcnQobWVzc2FnZSwgdGl0bGUsIGJ1dHRvbk5hbWUpIHtcbiAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcblxuICAgICAgaWYgKCEkd2luZG93Lm5hdmlnYXRvci5ub3RpZmljYXRpb24pIHtcbiAgICAgICAgJHdpbmRvdy5hbGVydChtZXNzYWdlKTtcbiAgICAgICAgcS5yZXNvbHZlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuYXZpZ2F0b3Iubm90aWZpY2F0aW9uLmFsZXJ0KG1lc3NhZ2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgfSwgdGl0bGUsIGJ1dHRvbk5hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgIH07XG4gICAgXG4gICAgLypcbiAgICAgIFxuICAgICAgYnV0dG9uTGFiZWxzOiBBcnJheSBvZiBzdHJpbmdzIHNwZWNpZnlpbmcgYnV0dG9uIGxhYmVscy4gKEFycmF5KSAoT3B0aW9uYWwsIGRlZmF1bHRzIHRvIFtPSyxDYW5jZWxdKVxuICAgICovXG4gICAgZnVuY3Rpb24gY29uZmlybShtZXNzYWdlLCB0aXRsZSwgYnV0dG9uTGFiZWxzKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGl0bGUgPSAoYW5ndWxhci5pc0RlZmluZWQodGl0bGUpKSA/IHRpdGxlIDogJ0NvbmZpcm0nO1xuXG4gICAgICAgICAgaWYgKCEkd2luZG93Lm5hdmlnYXRvci5ub3RpZmljYXRpb24pIHtcbiAgICAgICAgICAgIGlmICgkd2luZG93LmNvbmZpcm0obWVzc2FnZSkpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlc29sdmUoMik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5hdmlnYXRvci5ub3RpZmljYXRpb24uY29uZmlybShtZXNzYWdlLCBmdW5jdGlvbiAoYnV0dG9uSW5kZXgpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShidXR0b25JbmRleCk7XG4gICAgICAgICAgICB9LCB0aXRsZSwgYnV0dG9uTGFiZWxzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIFxuICAgIGZ1bmN0aW9uIHRvYXN0KG1lc3NhZ2UpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICBcdFx0XHR2YXIgdG9hc3QgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnRvYXN0O1xuICAgICAgXG4gICAgXHRcdFx0aWYgKHRvYXN0KSB7XG4gICAgICAgICAgICB0b2FzdC5zaG93TG9uZ0JvdHRvbShtZXNzYWdlLCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbGVydChtZXNzYWdlKTtcbiAgICAgICAgICB9ICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcbiAgXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuZGV2aWNlJywgW10pXG5cdC5mYWN0b3J5KCdtZXVEZXZpY2UnLCBjZHZEZXZpY2UpO1xuICBcbiAgLypcbiAgICBucG0gaW5zdGFsbDogXG4gICAgICBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9jb3Jkb3ZhLXBsdWdpbi1kZXZpY2VcbiAgICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NvcmRvdmEtcGx1Z2luLXVuaXF1ZWRldmljZWlkXG4gICAgICBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9jb3Jkb3ZhLXBsdWdpbi1hcHB2ZXJzaW9uXG4gIFxuICAgIGluc3RhbGw6IGNvcmRvdmEgcGx1Z2luIGFkZCBjb3Jkb3ZhLXBsdWdpbi1kZXZpY2UgY29yZG92YS1wbHVnaW4tdW5pcXVlZGV2aWNlaWQgY29yZG92YS1wbHVnaW4tYXBwdmVyc2lvblxuICBcbiAgICBIb3cgdG8gdXNlIGl0OiBcbiAgICAgIG1ldURldmljZS5nZXRVVUlEKClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge30pXG4gICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHt9KTtcbiAgKi9cbiAgXG5cdGZ1bmN0aW9uIGNkdkRldmljZSgkbG9nLCAkd2luZG93LCAkcSwgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuZ2V0VVVJRCA9IGdldFVVSUQ7XG4gICAgc2VydmljZS5nZXRJbmZvcm1hdGlvbnMgPSBnZXRJbmZvcm1hdGlvbnM7XG4gICAgc2VydmljZS5nZXRBcHBWZXJzaW9uID0gZ2V0QXBwVmVyc2lvbjtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICAvKlxuICAgICAgUmV0dXJuIChTdHJpbmcpIFZhbHVlXG4gICAgKi9cbiAgICBcbiAgICBmdW5jdGlvbiBnZXRVVUlEKCkge1xuICAgICAgXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBcbiAgICAgICAgdmFyIGNiX3V1aWQgPSB7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24odXVpZCkge1xuICAgICAgICAgICAgcmVzb2x2ZSh1dWlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbQ0FMTEJBQ0sgRkFJTFVSRV06IHVuaXF1ZURldmljZUlELmdldCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgdW5pcXVlRGV2aWNlSUQgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLnVuaXF1ZURldmljZUlEO1xuICAgICAgICBcbiAgICAgICAgICBpZiAodW5pcXVlRGV2aWNlSUQpIHtcbiAgICAgICAgICAgIHVuaXF1ZURldmljZUlELmdldChjYl91dWlkLnN1Y2Nlc3MsIGNiX3V1aWQuZmFpbCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4tdW5pcXVlZGV2aWNlaWQnKTtcbiAgICAgICAgICB9ICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvKlxuICAgICAgUmV0dXJuIE9iamVjdCB7bW9kZWw6IC4uLiwgcGxhdGZvcm06IC4uLiwgcGxhdGZvcm1fdmVyc2lvbjogLi4uLCBtYW51ZmFjdHVyZXI6IC4uLn1cbiAgICAqL1xuICAgIFxuICAgIGZ1bmN0aW9uIGdldEluZm9ybWF0aW9ucygpIHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHZhciBwcm9wZXJ0aWVzID0ge307XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgIC8qZXNsaW50LWRpc2FibGUgYW5ndWxhci9kZWZpbmVkdW5kZWZpbmVkICovXG4gICAgICAgICAgaWYgKHR5cGVvZiBkZXZpY2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgLyplc2xpbnQtZW5hYmxlIGFuZ3VsYXIvZGVmaW5lZHVuZGVmaW5lZCAqL1xuICAgIFx0XHRcdFx0cHJvcGVydGllcy5tb2RlbCA9IGRldmljZS5tb2RlbDtcbiAgICBcdFx0XHRcdHByb3BlcnRpZXMucGxhdGZvcm0gPSBkZXZpY2UucGxhdGZvcm07XG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLnBsYXRmb3JtX3ZlcnNpb24gPSBkZXZpY2UudmVyc2lvbjtcbiAgICBcdFx0XHRcdHByb3BlcnRpZXMubWFudWZhY3R1cmVyID0gZGV2aWNlLm1hbnVmYWN0dXJlcjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgIFx0XHRcdFx0Ly8gUnVubmluZyBvbiBXZWIgQnJvd3NlclxuICAgIFx0XHRcdFx0cHJvcGVydGllcy5tb2RlbCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc29sdmUocHJvcGVydGllcyk7IFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9ICAgICBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvKlxuICAgICAgUmV0dXJuIE9iamVjdCB7YXBwX3ZlcnNpb246IC4uLiwgYXBwX2J1aWxkOiAuLi59XG4gICAgKi9cbiAgICBcbiAgICBmdW5jdGlvbiBnZXRBcHBWZXJzaW9uKCkge1xuICAgICAgXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHZhciBwcm9wZXJ0aWVzID0ge307XG4gICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvKmVzbGludC1kaXNhYmxlIGFuZ3VsYXIvZGVmaW5lZHVuZGVmaW5lZCAqL1xuICAgICAgICAgIGlmICh0eXBlb2YgQXBwVmVyc2lvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAvKmVzbGludC1lbmFibGUgYW5ndWxhci9kZWZpbmVkdW5kZWZpbmVkICovXG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLmFwcF92ZXJzaW9uID0gQXBwVmVyc2lvbi52ZXJzaW9uO1xuICAgIFx0XHRcdFx0cHJvcGVydGllcy5hcHBfYnVpbGQgPSBBcHBWZXJzaW9uLmJ1aWxkO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tQTFVHSU4gTUlTU0lOR106IGNvcmRvdmEtcGx1Z2luLWFwcHZlcnNpb24nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmVzb2x2ZShwcm9wZXJ0aWVzKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfSBcbiAgICAgIH0pO1xuICAgIH1cblx0fVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuY2FsbE51bWJlcicsIFtdKVxuICAuZmFjdG9yeSgnY2FsbE51bWJlckNvcmRvdmEnLCBjYWxsTnVtYmVyQ29yZG92YSlcbiAgLmZhY3RvcnkoJ2NhbGxOdW1iZXInLCBjYWxsTnVtYmVyKVxuICAuZmFjdG9yeSgnbWV1Q2FsbE51bWJlcicsIG1ldUNhbGxOdW1iZXIpO1xuICBcbiAgLypcbiAgaW5zdGFsbCAgIDogICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBodHRwczovL2dpdGh1Yi5jb20vUm9oZm9zaG8vQ29yZG92YUNhbGxOdW1iZXJQbHVnaW4uZ2l0XG4gIFxuICBucG0gaW5zdGFsbCBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9jYWxsLW51bWJlclxuICBcbiAgSG93IHRvIHVzZSBpdDogXG4gIG1ldUNvcmRvdmEuY2FsbE51bWJlcihudW1iZXIsIHRydWUpXG4gIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge30pXG4gIC5jYXRjaChmdW5jdGlvbihlcnJvcikge30pO1xuICAqL1xuXHRcdFxuICBmdW5jdGlvbiBjYWxsTnVtYmVyQ29yZG92YSgkbG9nLCAkd2luZG93LCAkcSwgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICByZXR1cm4gZnVuY3Rpb24obnVtYmVyLCBieXBhc3NBcHBDaG9vc2VyKSB7XG4gICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChieXBhc3NBcHBDaG9vc2VyKSkge1xuICAgICAgICAgICAgYnlwYXNzQXBwQ2hvb3NlciA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgY2JfY2FsbE51bWJlciA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmFpbDogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICAgICRsb2cuZGVidWcocmVzdWx0KTtcbiAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgIFxuICAgICAgICAgIHZhciBDYWxsTnVtYmVyID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5DYWxsTnVtYmVyO1xuICAgICAgXG4gICAgICAgICAgaWYgKENhbGxOdW1iZXIpIHtcbiAgICAgICAgICAgIENhbGxOdW1iZXIuY2FsbE51bWJlcihjYl9jYWxsTnVtYmVyLnN1Y2Nlc3MsIGNiX2NhbGxOdW1iZXIuZmFpbCwgbnVtYmVyLCBieXBhc3NBcHBDaG9vc2VyKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIENvcmRvdmFDYWxsTnVtYmVyIFBsdWdpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGNhbGxOdW1iZXIoJGxvZywgJHdpbmRvdywgJHEsICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgcmV0dXJuIGZ1bmN0aW9uKG51bWJlciwgYnlwYXNzQXBwQ2hvb3Nlcikge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKGJ5cGFzc0FwcENob29zZXIpKSB7XG4gICAgICAgICAgICBieXBhc3NBcHBDaG9vc2VyID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBwYXNzZWROdW1iZXIgPSBlbmNvZGVVUklDb21wb25lbnQobnVtYmVyKTtcbiAgICAgICAgICAkd2luZG93LmxvY2F0aW9uID0gJ3RlbDonICsgcGFzc2VkTnVtYmVyO1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIG1ldUNhbGxOdW1iZXIoJGluamVjdG9yLCAkd2luZG93KSB7XG5cbiAgICB2YXIgQ2FsbE51bWJlciA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuQ2FsbE51bWJlcjtcbiAgICBcbiAgICBpZiAoJHdpbmRvdy5jb3Jkb3ZhICYmIENhbGxOdW1iZXIpIHtcbiAgICAgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdjYWxsTnVtYmVyQ29yZG92YScpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJGluamVjdG9yLmdldCgnY2FsbE51bWJlcicpO1xuICAgIH1cbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5Db3Jkb3ZhLmNhbGVuZGFyJywgW10pXG5cdC5mYWN0b3J5KCdtZXVDYWxlbmRhcicsIFsnJHEnLCAnJHdpbmRvdycsICdzdHJpcHRhZ3NGaWx0ZXInLCAnYnIybmxGaWx0ZXInLCBjYWxlbmRhcl0pO1xuICBcbiAgLypcbiAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgaHR0cHM6Ly9naXRodWIuY29tL0VkZHlWZXJicnVnZ2VuL0NhbGVuZGFyLVBob25lR2FwLVBsdWdpbi5naXRcbiAgICBJZiBzdGFydCBhbmQgZW5kX2RhdGUgZXF1YWwgMDA6MDAgdGhlbiB0aGUgZXZlbnQgb2NjdXJzIGFsbCBkYXkgbG9uZ1xuICAqL1xuICBcbiAgZnVuY3Rpb24gY2FsZW5kYXIoJHEsICR3aW5kb3csIHN0cmlwdGFncywgYnIybmwsICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmNyZWF0ZUV2ZW50SW50ZXJhY3RpdmVseSA9IGNyZWF0ZUV2ZW50SW50ZXJhY3RpdmVseTtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBjcmVhdGVFdmVudEludGVyYWN0aXZlbHkob3B0aW9ucykge1xuICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICB0aXRsZTogbnVsbCxcbiAgICAgICAgYWRkcmVzczogbnVsbCxcbiAgICAgICAgZGVzY3JpcHRpb246ICcnLFxuICAgICAgICBzdGFydF9kYXRlOiBudWxsLFxuICAgICAgICBlbmRfZGF0ZTogbnVsbFxuICAgICAgfTtcblxuICAgICAgZGVmYXVsdE9wdGlvbnMgPSBhbmd1bGFyLmV4dGVuZChkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAkd2luZG93LnBsdWdpbnMuY2FsZW5kYXIuY3JlYXRlRXZlbnRJbnRlcmFjdGl2ZWx5KFxuICAgICAgICAgICAgc3RyaXB0YWdzKGRlZmF1bHRPcHRpb25zLnRpdGxlKSxcbiAgICAgICAgICAgIHN0cmlwdGFncyhkZWZhdWx0T3B0aW9ucy5hZGRyZXNzKSxcbiAgICAgICAgICAgIHN0cmlwdGFncyhicjJubChkZWZhdWx0T3B0aW9ucy5kZXNjcmlwdGlvbikpLFxuICAgICAgICAgICAgbmV3IERhdGUoZGVmYXVsdE9wdGlvbnMuc3RhcnRfZGF0ZSAgKiAxMDAwKSxcbiAgICAgICAgICAgIG5ldyBEYXRlKGRlZmF1bHRPcHRpb25zLmVuZF9kYXRlICAqIDEwMDApLFxuICAgICAgICAgICAgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuICBcblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5hbmFseXRpY3MnLCBbXSlcblx0LmZhY3RvcnkoJ2dvb2dsZUFuYWx5dGljcycsIGdvb2dsZUFuYWx5dGljcylcblx0LmZhY3RvcnkoJ21ldUFuYWx5dGljcycsIGFuYWx5dGljcyk7XG5cbiAgZnVuY3Rpb24gZ29vZ2xlQW5hbHl0aWNzKCRxLCAkd2luZG93LCAkbG9nLCAkZXhjZXB0aW9uSGFuZGxlcikge1xuXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLnRyYWNrVmlldyA9IHRyYWNrVmlldztcbiAgICBzZXJ2aWNlLnRyYWNrRXZlbnQgPSB0cmFja0V2ZW50O1xuICAgIHNlcnZpY2Uuc3RhcnRUcmFja2VyV2l0aElkICA9IHN0YXJ0VHJhY2tlcldpdGhJZDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiB0cmFja1ZpZXcoc2NyZWVuTmFtZSkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICRsb2cuZGVidWcoJ1RyYWNrIFZpZXc6ICcgKyBzY3JlZW5OYW1lKTtcbiAgICAgICAgICBnYSgnc2V0Jywge1xuICAgICAgICAgICAgcGFnZTogc2NyZWVuTmFtZSxcbiAgICAgICAgICAgIHRpdGxlOiBzY3JlZW5OYW1lXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZ2EoJ3NlbmQnLCAncGFnZXZpZXcnKTtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gdHJhY2tFdmVudChjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCwgdmFsdWUpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgZXYgPSBbY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlXTtcbiAgICAgICAgICAkbG9nLmRlYnVnKCdUcmFjayBFdmVudDogJyArIGV2LnRvU3RyaW5nKCkpO1xuICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50Jywge1xuICAgICAgICAgICAgZXZlbnRDYXRlZ29yeTogY2F0ZWdvcnksXG4gICAgICAgICAgICBldmVudExhYmVsOiBsYWJlbCxcbiAgICAgICAgICAgIGV2ZW50QWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgICBldmVudFZhbHVlOiB2YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBzdGFydFRyYWNrZXJXaXRoSWQoaWQpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAkbG9nLmRlYnVnKCdTdGFydCB0cmFja2luZyBHQSBJZDogJyArIGlkKTtcbiAgICAgICAgICBnYSgnY3JlYXRlJywge1xuICAgICAgICAgICAgc3RvcmFnZTogJ25vbmUnLFxuICAgICAgICAgICAgdHJhY2tpbmdJZDogaWQsXG4gICAgICAgICAgICBjbGllbnRJZDogJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ2E6Y2xpZW50SWQnKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGdhKCdzZXQnLCB7XG4gICAgICAgICAgICBjaGVja1Byb3RvY29sVGFzazogbnVsbCxcbiAgICAgICAgICAgIGNoZWNrU3RvcmFnZVRhc2s6IG51bGwsXG4gICAgICAgICAgICB0cmFuc3BvcnRVcmw6ICdodHRwczovL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9jb2xsZWN0J1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGdhKGZ1bmN0aW9uICh0cmFja2VyKSB7XG4gICAgICAgICAgICBpZiAoICEkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnYTpjbGllbnRJZCcpICkge1xuICAgICAgICAgICAgICAkd2luZG93bG9jYWxTdG9yYWdlLnNldEl0ZW0oICdnYTpjbGllbnRJZCcsIHRyYWNrZXIuZ2V0KCdjbGllbnRJZCcpICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuXHR9XG4gIFxuXHRmdW5jdGlvbiBhbmFseXRpY3MoJGluamVjdG9yLCAkd2luZG93KSB7XG5cdFx0ICByZXR1cm4gJGluamVjdG9yLmdldCgnZ29vZ2xlQW5hbHl0aWNzJyk7XG5cdH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIFxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5sb2NhbFN0b3JhZ2UnLCBbXSlcbiAgLmZhY3RvcnkoJ21ldUxvY2FsU3RvcmFnZScsIGxvY2FsU3RvcmFnZSk7XG4gIFxuICBmdW5jdGlvbiBsb2NhbFN0b3JhZ2UoKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLmdldE9iamVjdCA9IGdldE9iamVjdDtcbiAgICBzZXJ2aWNlLnNldE9iamVjdCA9IHNldE9iamVjdDtcbiAgICBzZXJ2aWNlLnJlbW92ZU9iamVjdCA9IHJlbW92ZU9iamVjdDtcbiAgICBzZXJ2aWNlLmNvbnRhaW5zID0gY29udGFpbnM7XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgZnVuY3Rpb24gZ2V0T2JqZWN0KGtleSkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXIuZnJvbUpzb24obG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHNldE9iamVjdChrZXksIHZhbHVlKSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIGFuZ3VsYXIudG9Kc29uKHZhbHVlKSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHJlbW92ZU9iamVjdChrZXkpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGNvbnRhaW5zKGtleSkge1xuICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgPyB0cnVlIDogZmFsc2U7XG4gICAgfTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5odHRwV2l0aEZhbGxiYWNrJywgW10pXG4gIC5mYWN0b3J5KCdtZXVIdHRwV2l0aEZhbGxiYWNrJywgaHR0cFdpdGhGYWxsYmFjayk7XG4gIFxuICBmdW5jdGlvbiBodHRwV2l0aEZhbGxiYWNrKCRxLCAkbG9nLCAkZXhjZXB0aW9uSGFuZGxlciwgJGh0dHApIHtcblxuICAgIC8vIENvbnN0cnVjdG9yIGZ1bmN0aW9uLCB1c2luZyAkaHR0cCBhcyBwcm90b3R5cGVcbiAgICBmdW5jdGlvbiBIdHRwV2l0aEZhbGxiYWNrKCkgeyB9XG4gICAgSHR0cFdpdGhGYWxsYmFjay5wcm90b3R5cGUgPSAkaHR0cDtcbiAgICBIdHRwV2l0aEZhbGxiYWNrLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEh0dHBXaXRoRmFsbGJhY2s7XG5cbiAgICB2YXIgaHR0cFdpdGhGYWxsYmFjayA9IG5ldyBIdHRwV2l0aEZhbGxiYWNrKCk7XG5cbiAgICB2YXIgcHJlcGFyZVN0b3JlZFJlc3BvbnNlID0gZnVuY3Rpb24oc3RvcmVkUmVzcG9uc2UpIHtcbiAgICAgIC8vIERhdGEgd2FzIHN1Y2Nlc3NmdWxseSByZXRyaWV2ZWQgZnJvbSBsb2NhbCBzdG9yYWdlLCByZXNvbHZlIHdpdGggc3RhdHVzIDIwMFxuICAgICAgc3RvcmVkUmVzcG9uc2UgPSBhbmd1bGFyLmZyb21Kc29uKHN0b3JlZFJlc3BvbnNlKTtcbiAgICAgIHZhciBoZWFkZXJzID0gc3RvcmVkUmVzcG9uc2UuaGVhZGVycztcbiAgICAgIHN0b3JlZFJlc3BvbnNlLmhlYWRlcnMgPSBmdW5jdGlvbigpIHsgcmV0dXJuIGhlYWRlcnM7IH07XG4gICAgICByZXR1cm4gc3RvcmVkUmVzcG9uc2U7XG4gICAgfTtcblxuICAgIHZhciBtYWtlUmVxdWVzdCA9IGZ1bmN0aW9uKHVybCwgY29uZmlnLCBkZWZlcnJlZCkge1xuICAgICAgJGh0dHAuZ2V0KHVybCwgY29uZmlnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgJGxvZy5kZWJ1ZygnW2h0dHBXaXRoRmFsbGJhY2tdOiB0aGVuIHJlc3BvbnNlIHN1Y2Nlc3Mgc3RhdHVzOicgKyByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICAgIC8vIFN0b3JlIGluIGxvY2FsIHN0b3JhZ2Ugd2hlbiBzdGF0dXMgPT09IDIwMFxuICAgICAgICAgIGlmICghcmVzcG9uc2UuY29uZmlnLmRvbnRTdG9yZUZhbGxiYWNrICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh1cmwsIGFuZ3VsYXIudG9Kc29uKHtcbiAgICAgICAgICAgICAgZGF0YTogcmVzcG9uc2UuZGF0YSxcbiAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgIGNvbmZpZzogcmVzcG9uc2UuY29uZmlnLFxuICAgICAgICAgICAgICBoZWFkZXJzOiByZXNwb25zZS5oZWFkZXJzKCksXG4gICAgICAgICAgICAgIGlzRmFsbGJhY2s6IHRydWVcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gUmVzb2x2ZSB3aXRoIG9yaWdpbmFsIHJlc3BvbnNlXG4gICAgICAgICAgaWYgKHJlc3BvbnNlLmhlYWRlcnMoJ2V0YWcnKSA9PT0gcmVzcG9uc2UuY29uZmlnWydJZi1Ob25lLU1hdGNoJ10pXG4gICAgICAgICAgICByZXNwb25zZS51bmNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICRsb2cuZGVidWcoJ1todHRwV2l0aEZhbGxiYWNrXTogdGhlbiByZXNwb25zZSBmYWlsIHN0YXR1czonICsgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgICAvLyBUcnkgdG8gcmV0cmlldmUgZnJvbSBsb2NhbCBzdG9yYWdlXG4gICAgICAgICAgdmFyIHN0b3JlZFJlc3BvbnNlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odXJsKTtcbiAgICAgICAgICBpZiAoc3RvcmVkUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHByZXBhcmVTdG9yZWRSZXNwb25zZShzdG9yZWRSZXNwb25zZSkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFRyeSBjb25maWcuZmFsbGJhY2tcbiAgICAgICAgICBpZiAocmVzcG9uc2UuY29uZmlnLmZhbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZSh7XG4gICAgICAgICAgICAgIGRhdGE6IGNvbmZpZy5mYWxsYmFjayxcbiAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlLmhlYWRlcnMsXG4gICAgICAgICAgICAgIGNvbmZpZzogcmVzcG9uc2UuY29uZmlnLFxuICAgICAgICAgICAgICBpc0ZhbGxiYWNrOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBSZWplY3Qgd2l0aCBvcmlnaW5hbCBlcnJvciByZXNwb25zZVxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAvLyBEZWNvcmF0ZSBwcm9taXNlIHdpdGggc3VjY2VzcyBhbmQgZXJyb3IgZnVuY3Rpb25zIHRvIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgcHJvbWlzZSByZXR1cm5lZCBieSAkaHR0cC5nZXRcbiAgICAgIHZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgcHJvbWlzZS5zdWNjZXNzID0gZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgZm4ocmVzcG9uc2UuZGF0YSwgcmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5oZWFkZXJzLCBjb25maWcsIHJlc3BvbnNlLmlzRmFsbGJhY2spO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICBwcm9taXNlLmVycm9yID0gZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgcHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgZm4ocmVzcG9uc2UuZGF0YSwgcmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5oZWFkZXJzLCBjb25maWcpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICogT3ZlcnJpZGUgJGh0dHAuZ2V0IHRvIGNhdGNoIHRoZSBwcm9taXNlLmVycm9yXG4gICAgKi9cbiAgICBodHRwV2l0aEZhbGxiYWNrLmdldCA9IGZ1bmN0aW9uKHVybCwgY29uZmlnKSB7XG4gICAgICAvLyBDbGllbnQgZG9lc24ndCBzdXBwb3J0IGxvY2FsIHN0b3JhZ2VcbiAgICAgIGlmICghbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIC8vIElmIG5vIGZhbGxiYWNrIGRlZmluZWQsIGp1c3QganVzdCAkaHR0cC5nZXRcbiAgICAgICAgaWYgKCFjb25maWcuZmFsbGJhY2spIHtcbiAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCwgY29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBMb2NhbCBzdG9yYWdlIHdvbid0IGJlIHVzZWRcbiAgICAgICAgY29uZmlnLmRvbnRTdG9yZUZhbGxiYWNrID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gRGVsZWdhdGUgZ2V0IHRvICRodHRwXG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgdmFyIHN0b3JlZFJlc3BvbnNlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odXJsKTtcblxuICAgICAgaWYgKHN0b3JlZFJlc3BvbnNlKSB7XG4gICAgICAgIC8vc2Vjb25kIHByb21pc2UgdG8gdXBkYXRlIGRhdGEgYWZ0ZXIgcmVxdWVzdFxuICAgICAgICB2YXIgZGVmZXJyZWRSZXF1ZXN0ID0gJHEuZGVmZXIoKTtcbiAgICAgICAgc3RvcmVkUmVzcG9uc2UgPSBwcmVwYXJlU3RvcmVkUmVzcG9uc2Uoc3RvcmVkUmVzcG9uc2UpO1xuICAgICAgICB2YXIgY2FjaGUgPSBzdG9yZWRSZXNwb25zZTsgICAgICAgICAgXG4gICAgICAgIC8vIElmIGNvbmZpZyBpcyB1bmRlZmluZWQsIGllIGh0dHBXaXRoRmFsbGJhY2suZ2V0KFBBVEgpXG4gICAgICAgIC8vIGNvbmZpZyA9IHR5cGVvZiBjb25maWcgIT09ICd1bmRlZmluZWQnID8gY29uZmlnIDoge307XG4gICAgICAgIGNvbmZpZyA9IGFuZ3VsYXIuaXNEZWZpbmVkKGNvbmZpZykgPyBjb25maWcgOiB7fTsgICAgICAgICBcbiAgICAgICAgaWYgKGNhY2hlICYmIGNhY2hlLmhlYWRlcnMoKSlcbiAgICAgICAgICBjb25maWdbJ0lmLU5vbmUtTWF0Y2gnXSA9IGNhY2hlLmhlYWRlcnMoKS5ldGFnO1xuICAgICAgICBzdG9yZWRSZXNwb25zZS5wcm9taXNlID0gbWFrZVJlcXVlc3QodXJsLCBjb25maWcsIGRlZmVycmVkUmVxdWVzdCk7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoc3RvcmVkUmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgIH1cbiAgICAgIC8vZG9uJ3QgaGF2ZSBsb2NhbCwgY29udGludWUgdG8gcmVxdWVzdFxuICAgICAgcmV0dXJuIG1ha2VSZXF1ZXN0KHVybCwgY29uZmlnLCBkZWZlcnJlZCk7XG4gICAgfTtcblxuICAgIHJldHVybiBodHRwV2l0aEZhbGxiYWNrO1xuICB9O1xufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5odHRwSW50ZXJjZXB0b3JzJywgW10pXG5cdC5mYWN0b3J5KCdtZXVMb2FkaW5nSW50ZXJjZXB0b3InLCBsb2FkaW5nSW50ZXJjZXB0b3IpXG4gIC5mYWN0b3J5KCdtZXVFcnJvckludGVyY2VwdG9yJywgZXJyb3JJbnRlcmNlcHRvcik7XG5cdFxuXHRmdW5jdGlvbiBsb2FkaW5nSW50ZXJjZXB0b3IoJHEsICRyb290U2NvcGUsICRsb2cpIHtcblx0XHRcblx0XHR2YXIgbnVtTG9hZGluZ3MgPSAwO1xuXHRcdFxuXHRcdHJldHVybiB7XG5cdFx0XHRyZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgICAgaWYgKCFudW1Mb2FkaW5ncysrKSB7XG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOnN0YXJ0Jyk7XG4gICAgICAgIH1cblxuXHRcdFx0XHRyZXR1cm4gY29uZmlnIHx8ICRxLndoZW4oY29uZmlnKTtcblx0XHRcdH0sXG5cdFx0XHRyZXNwb25zZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0aWYgKCEoLS1udW1Mb2FkaW5ncykpIHtcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6c3RvcCcpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuXHRcdFx0fSxcblx0XHRcdHJlcXVlc3RFcnJvcjogZnVuY3Rpb24ocmVxdWVzdCkge1xuXHRcdFx0XHRpZiAoISgtLW51bUxvYWRpbmdzKSkge1xuXHRcdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpzdG9wJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gJHEucmVqZWN0KHJlcXVlc3QpO1xuXHRcdFx0fSxcblx0XHRcdHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdGlmICghKC0tbnVtTG9hZGluZ3MpKSB7XG5cdFx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOnN0b3AnKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuICBcbiAgZnVuY3Rpb24gZXJyb3JJbnRlcmNlcHRvcigkcSwgJHJvb3RTY29wZSwgJGxvZykge1xuICAgIFxuICBcdHJldHVybiB7XG4gIFx0XHRyZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgICAgXG4gIFx0XHRcdHJldHVybiBjb25maWcgfHwgJHEud2hlbihjb25maWcpO1xuICBcdFx0fSxcbiAgXHRcdHJlcXVlc3RFcnJvcjogZnVuY3Rpb24ocmVxdWVzdCkge1xuICAgICAgICBcbiAgXHRcdFx0cmV0dXJuICRxLnJlamVjdChyZXF1ZXN0KTtcbiAgXHRcdH0sXG4gIFx0XHRyZXNwb25zZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgXG4gIFx0XHRcdHJldHVybiByZXNwb25zZSB8fCAkcS53aGVuKHJlc3BvbnNlKTtcbiAgXHRcdH0sXG4gIFx0XHRyZXNwb25zZUVycm9yOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICBcdFx0XHQkbG9nLmRlYnVnKCdbQVBJOmVycm9ySW50ZXJjZXB0b3JdOiBCRUdJTicpO1xuICAgICAgICAkbG9nLmRlYnVnKCdSZXNwb25zZSBTdGF0dXM6ICcgKyByZXNwb25zZS5zdGF0dXMpO1xuICBcdFx0XHQkbG9nLmRlYnVnKHJlc3BvbnNlKTtcbiAgXHRcdFx0JGxvZy5kZWJ1ZygnW0FQSTplcnJvckludGVyY2VwdG9yXTogRU5EJyk7XG4gIFx0XHRcdGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IC0xKSB7fSAvLyBDbGllbnQgdGltZW91dCBmaXJlZFxuICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSAwKSB7fSAvLyBuZXR3b3JrIG9mZmxpbmUgb3IgQ09SUyBlcnJvclxuICBcdFx0XHRpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHt9XG4gIFx0XHRcdGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXJyb3I6NDAxJyk7XG4gIFx0XHRcdH1cbiAgXHRcdFx0aWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA4KSB7fSAvLyBTZXJ2ZXIgdGltZWQgb3V0IHdhaXRpbmcgZm9yIHRoZSByZXF1ZXN0LlxuICBcdFx0XHRpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID49IDUwMCkge31cbiAgICAgICAgXG4gIFx0XHRcdHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpO1xuICBcdFx0fVxuICBcdH07XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG4gIFxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5kZXZpY2VSZWFkeScsIFtdKVxuXHQuZmFjdG9yeSgnbWV1RGV2aWNlUmVhZHknLCBkZXZpY2VSZWFkeSk7XG4gIFxuICAvKlxuICBcbiAgICBIb3cgdG8gdXNlIGl0OiBcbiAgICAgIG1ldURldmljZVJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAuLi5cbiAgICAgIH0pO1xuICAqL1xuICBcblx0ZnVuY3Rpb24gZGV2aWNlUmVhZHkoJGxvZywgJHdpbmRvdykge1xuXHRcdHJldHVybiBmdW5jdGlvbihkb25lKSB7XG5cdFx0XHRpZiAoYW5ndWxhci5pc09iamVjdCgkd2luZG93LmNvcmRvdmEpKSB7XG4gICAgICAgIC8qZXNsaW50LWRpc2FibGUgYW5ndWxhci9kb2N1bWVudC1zZXJ2aWNlICovXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZXJlYWR5JywgZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdFx0XHRkb25lKCk7XG5cdFx0XHRcdH0sIGZhbHNlKTtcbiAgICAgICAgLyplc2xpbnQtZW5hYmxlIGFuZ3VsYXIvZG9jdW1lbnQtc2VydmljZSAqL1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZG9uZSgpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIFxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5hdXRoZW50aWNhdGlvbicsIFtdKVxuICAuZmFjdG9yeSgnbWV1QXV0aGVudGljYXRpb24nLCBhdXRoZW50aWNhdGlvbik7XG4gIFxuICAvKlxuICBJbnNwaXJlZCBieSBKYXNvbiBXYXRtb3JlIEJsb2cgUG9zdFxuICBodHRwOi8vamFzb253YXRtb3JlLmNvbS9wb3N0LzIwMTQvMDUvMjYvYW5ndWxhcmpzLWJhc2ljLWh0dHAtYXV0aGVudGljYXRpb24tZXhhbXBsZVxuICAqL1xuXG4gIGZ1bmN0aW9uIGF1dGhlbnRpY2F0aW9uKCRodHRwLCAkcm9vdFNjb3BlLCAkdGltZW91dCkge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgc2VydmljZS5TZXRDcmVkZW50aWFscyA9IGZ1bmN0aW9uIChkYXRhKSB7IFxuICAgICAgLypcbiAgICAgICogIGRhdGEudmlzaXRvciAmJiBkYXRhLnRva2VuXG4gICAgICAqL1xuICAgICAgJHJvb3RTY29wZS5hdXRoID0gZGF0YTtcblxuICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtVmlzaXRvci1Ub2tlbiddID0gZGF0YS50b2tlbjtcbiAgICAgIGxvY2FsU3RvcmFnZS5nbG9iYWxzID0gYW5ndWxhci50b0pzb24oJHJvb3RTY29wZS5hdXRoKTtcbiAgICB9O1xuXG4gICAgc2VydmljZS5DbGVhckNyZWRlbnRpYWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgJHJvb3RTY29wZS5hdXRoID0ge307XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnYXV0aCcpO1xuICAgICAgZGVsZXRlICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLVZpc2l0b3ItVG9rZW4nXTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHNlcnZpY2U7XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKGdsb2JhbCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMnLCBbXG4gICAgJ25nTWV1bW9iaS5VdGlscy5sb2NhbFN0b3JhZ2UnLFxuICAgICduZ01ldW1vYmkuVXRpbHMuZGV2aWNlUmVhZHknLFxuICAgICduZ01ldW1vYmkuVXRpbHMuaHR0cEludGVyY2VwdG9ycycsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5hdXRoZW50aWNhdGlvbicsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5odHRwV2l0aEZhbGxiYWNrJ1xuICBdKVxuICAuZmFjdG9yeSgnbWV1VXRpbHMnLCB1dGlscyk7XG4gIFxuICBmdW5jdGlvbiB1dGlscyhcbiAgICBtZXVMb2NhbFN0b3JhZ2UsXG4gICAgbWV1RGV2aWNlUmVhZHksXG4gICAgbWV1TG9hZGluZ0ludGVyY2VwdG9yLFxuICAgIG1ldUVycm9ySW50ZXJjZXB0b3IsXG4gICAgbWV1SHR0cFdpdGhGYWxsYmFja1xuICApIHtcblx0XG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcblx0XG4gICAgc2VydmljZS5sb2NhbFN0b3JhZ2UgPSBtZXVMb2NhbFN0b3JhZ2U7XG4gICAgc2VydmljZS5kZXZpY2VSZWFkeSA9IG1ldURldmljZVJlYWR5O1xuICAgIHNlcnZpY2UubG9hZGluZ0ludGVyY2VwdG9yID0gbWV1TG9hZGluZ0ludGVyY2VwdG9yO1xuICAgIHNlcnZpY2UuZXJyb3JJbnRlcmNlcHRvciA9IG1ldUVycm9ySW50ZXJjZXB0b3I7XG4gICAgc2VydmljZS5odHRwV2l0aEZhbGxiYWNrID0gbWV1SHR0cFdpdGhGYWxsYmFjaztcbiAgICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSh0aGlzKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEnLCBbXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmFuYWx5dGljcycsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmNhbGVuZGFyJyxcbiAgICAnbmdNZXVtb2JpLkNvcmRvdmEuY2FsbE51bWJlcicsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmRldmljZScsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmRpYWxvZ3MnLFxuICAgICduZ01ldW1vYmkuQ29yZG92YS5maWxlcycsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLnNvY2lhbFNoYXJpbmcnLFxuICAgICduZ01ldW1vYmkuQ29yZG92YS5zcGlubmVyRGlhbG9nJyxcbiAgICAnbmdNZXVtb2JpLkNvcmRvdmEuc3BsYXNoc2NyZWVuJyxcbiAgICAnbmdNZXVtb2JpLkNvcmRvdmEucHVzaCdcbiAgXSlcbiAgLmZhY3RvcnkoJ21ldUNvcmRvdmEnLCBjb3Jkb3ZhKTtcbiAgXG4gIGZ1bmN0aW9uIGNvcmRvdmEoXG4gICAgbWV1QW5hbHl0aWNzLCBcbiAgICBtZXVDYWxlbmRhciwgXG4gICAgbWV1Q2FsbE51bWJlciwgXG4gICAgbWV1RGV2aWNlLCBcbiAgICBtZXVEaWFsb2dzLFxuICAgIG1ldUZpbGVzLFxuICAgIG1ldVNvY2lhbFNoYXJpbmcsXG4gICAgbWV1U3Bpbm5lckRpYWxvZyxcbiAgICBtZXVTcGxhc2hzY3JlZW5cbiAgKSB7XG5cdFxuICAgIHZhciBzZXJ2aWNlID0ge307XG5cdFxuICAgIHNlcnZpY2UuYW5hbHl0aWNzID0gbWV1QW5hbHl0aWNzO1xuICAgIHNlcnZpY2UuY2FsZW5kYXIgPSBtZXVDYWxlbmRhcjtcbiAgICBzZXJ2aWNlLmNhbGxOdW1iZXIgPSBtZXVDYWxsTnVtYmVyOyBcbiAgICBzZXJ2aWNlLmRldmljZSA9IG1ldURldmljZTtcbiAgICBzZXJ2aWNlLmRpYWxvZ3MgPSBtZXVEaWFsb2dzO1xuICAgIHNlcnZpY2UuZmlsZXMgPSBtZXVGaWxlcztcbiAgICBzZXJ2aWNlLnNvY2lhbFNoYXJpbmcgPSBtZXVTb2NpYWxTaGFyaW5nO1xuICAgIHNlcnZpY2Uuc3Bpbm5lckRpYWxvZyA9IG1ldVNwaW5uZXJEaWFsb2c7XG4gICAgc2VydmljZS5zcGxhc2hzY3JlZW4gPSBtZXVTcGxhc2hzY3JlZW47XG4gICAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscycpXG4gIC5wcm92aWRlcignbWV1Q2xvdWQnLCBtZXVDbG91ZFByb3ZpZGVyKVxuICAuZmFjdG9yeSgnbWV1QVBJJywgQVBJKTtcbiAgXG4gIGZ1bmN0aW9uIG1ldUNsb3VkUHJvdmlkZXIoKSB7XG4gICAgXG4gICAgdmFyIG9wdGlvbnMgPSB7fSxcbiAgICAgICAgZGF0YSA9IHt9O1xuICAgIFxuICAgIHRoaXMuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uKG9wdCkge1xuICAgICAgYW5ndWxhci5leHRlbmQob3B0aW9ucywgb3B0KTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZXRPcHRpb24gPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy4kZ2V0ID0gbWV1Q2xvdWQ7XG4gICAgXG4gICAgZnVuY3Rpb24gbWV1Q2xvdWQoJHEsICR3aW5kb3csICRsb2csICRleGNlcHRpb25IYW5kbGVyLCBtZXVVdGlscywgbWV1QVBJKSB7XG4gICAgXG4vKlxuICBIZWxwZXJzXG4qL1xuICAgICAgdmFyIEhlbHBlcnMgPSB7XG4gICAgICAgIGxvb2t1cDogZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgICB2YXIgdG9rZW4gPSAnaWQnO1xuICAgICAgICAgIC8vIElkZW50aWZ5IGlmIGl0J3MgYW4gYXJyYXkgb2YgaXRlbXMgKGl0ZW0uX2lkKSBvciBjYXRlZ29yeSAoY2F0ZWdvcnkuaWQpXG4gICAgICAgICAgaWYgKGFycmF5WzBdICYmIGFycmF5WzBdLmhhc093blByb3BlcnR5KCdfaWQnKSlcbiAgICAgICAgICAgIHRva2VuID0gJ19pZCc7XG4gICAgICAgICAgcmV0dXJuIEhlbHBlcnMubG9va3VwQnlUb2tlbihhcnJheSwgdG9rZW4pO1xuICAgICAgICB9LFxuICAgICAgICBsb29rdXBCeVRva2VuOiBmdW5jdGlvbihhcnJheSwgdG9rZW4pIHtcbiAgICAgICAgICB2YXIgbG9va3VwID0gW107XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgIGxvb2t1cFthcnJheVtpXVt0b2tlbl1dID0gYXJyYXlbaV07XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBsb29rdXA7XG4gICAgICAgIH0sXG4gICAgICAgIGlzRnJlc2hSZXNwb25zZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICB2YXIgaXNGYWxsYmFjayA9IHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdpc0ZhbGxiYWNrJykgPyByZXNwb25zZS5pc0ZhbGxiYWNrIDogbnVsbDtcbiAgICAgICAgICB2YXIgdW5jaGFuZ2VkID0gcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3VuY2hhbmdlZCcpID8gcmVzcG9uc2UudW5jaGFuZ2VkIDogbnVsbDtcbiAgICAgICAgXG4gICAgICAgICAgcmV0dXJuICEodW5jaGFuZ2VkIHx8IGlzRmFsbGJhY2spO1xuICAgICAgICB9LFxuICAgICAgICBnZXRDYXRlZ29yaWVzVHJlZTogZnVuY3Rpb24oY2F0ZWdvcmllcykge1xuICAgICAgICAgIHZhciBjaGlsZHJlbiA9IFtdO1xuICAgICAgICAgIGNoaWxkcmVuWzBdID0gW107XG4gICAgICAgICAgZm9yKHZhciBrZXkgaW4gY2F0ZWdvcmllcykge1xuICAgICAgICAgICAgdmFyIHBhcmVudF9pZCA9IGNhdGVnb3JpZXNba2V5XS5wYXJlbnRfaWQgIT0gbnVsbCA/IGNhdGVnb3JpZXNba2V5XS5wYXJlbnRfaWQgOiAwO1xuICAgICAgICAgICAgaWYgKCFjaGlsZHJlbltwYXJlbnRfaWRdKVxuICAgICAgICAgICAgICBjaGlsZHJlbltwYXJlbnRfaWRdID0gW107XG4gICAgICAgICAgICBjaGlsZHJlbltwYXJlbnRfaWRdLnB1c2goY2F0ZWdvcmllc1trZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yKHZhciBrZXkgaW4gY2F0ZWdvcmllcykge1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcmllc1trZXldO1xuICAgICAgICAgICAgY2F0ZWdvcnkuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgICAgIGlmIChjaGlsZHJlbltjYXRlZ29yeS5pZF0pXG4gICAgICAgICAgICAgIGNhdGVnb3J5LmNoaWxkcmVuID0gY2hpbGRyZW5bY2F0ZWdvcnkuaWRdO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY2hpbGRyZW5bMF07XG4gICAgICAgIH1cbiAgICAgIH07XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLyBcbiAgICBcbiAgICAgIHZhciBzZXJ2aWNlID0ge307XG5cbiAgICAgIHNlcnZpY2UuaGVscGVycyA9IEhlbHBlcnM7XG4gICAgICBzZXJ2aWNlLmdldENhdGVnb3J5ID0gZ2V0Q2F0ZWdvcnk7XG4gICAgICBzZXJ2aWNlLnN5bmNQZXJmb3JtYW5jZSA9IHN5bmNQZXJmb3JtYW5jZTtcbiAgICAgIHNlcnZpY2UuQVBJID0gbWV1QVBJO1xuICAgICAgc2VydmljZS5pbml0ID0gaW5pdDtcbiAgICAgIHNlcnZpY2UuZ2V0U2l0ZUxvZ29VcmwgPSBnZXRTaXRlTG9nb1VybDtcbiAgICAgIHNlcnZpY2UuZ2V0U2l0ZVByb3BlcnR5ID0gZ2V0U2l0ZVByb3BlcnR5O1xuICAgICAgc2VydmljZS5nZXRBc3NldFVybCA9IGdldEFzc2V0VXJsO1xuICAgIFxuICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgICAvKlxuICAgICAgICBtZXVDbG91ZC5BUEkuU2l0ZS5wZXJmb3JtYW5jZSgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgdXBkYXRlRGF0YShyZXNwb25zZSk7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlLnByb21pc2UpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucHJvbWlzZTtcbiAgICAgICAgfSlcbiAgICAgICAgLy8gSWYgcmVzcG9uc2UgY29udGFpbnMgYSBwcm9taXNlLCBtZWFucyBpcyBmcm9tIGNhY2hlIGFuZCBwcm9taXNlIHdpbGwgc3luYyB3LyBTZXJ2ZXJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICB1cGRhdGVEYXRhKHJlc3BvbnNlKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICB9KVxuICAgICAgXG4gICAgICAqL1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYXBpVXJsJykpXG4gICAgICAgICAgbWV1QVBJLkNvbmZpZy5zZXRQcm9wZXJ0eSgnYXBpVXJsJywgb3B0aW9ucy5hcGlVcmwpO1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgndGltZW91dCcpKVxuICAgICAgICAgIG1ldUFQSS5Db25maWcuc2V0UHJvcGVydHkoJ3RpbWVvdXQnLCBvcHRpb25zLnRpbWVvdXQpO1xuICAgICAgfVxuICAgICAgICAgICBcbiAgICAgIGZ1bmN0aW9uIGdldENhdGVnb3J5KGlkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIGNhdGVnb3JpZXMgPSBIZWxwZXJzLmxvb2t1cChkYXRhLmNhdGVnb3JpZXMpO1xuICAgICAgICAgIGlmIChjYXRlZ29yaWVzLmhhc093blByb3BlcnR5KGlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhdGVnb3JpZXNbaWRdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgXG4gICAgICBmdW5jdGlvbiBnZXREYXRhKHByb3BlcnR5KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGFbcHJvcGVydHldOyBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBnZXRTaXRlUHJvcGVydHkocHJvcGVydHkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gZGF0YS5zaXRlW3Byb3BlcnR5XTsgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gZ2V0Q2F0ZWdvcmllcygpIHtcbiAgICAgICAgcmV0dXJuIGdldERhdGEoJ2NhdGVnb3JpZXMnKTtcbiAgICAgIH1cbiAgXG4gICAgICBmdW5jdGlvbiBzZXRDYXRlZ29yaWVzKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgZGF0YS5jYXRlZ29yaWVzID0gY2F0ZWdvcmllcztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gc2V0U2l0ZShzaXRlKSB7XG4gICAgICAgIGRhdGEuc2l0ZSA9IHNpdGU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHNldFZpc2l0b3IodmlzaXRvcikge1xuICAgICAgICBkYXRhLnZpc2l0b3IgPSB2aXNpdG9yO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBnZXRWaXNpdG9yKCkge1xuICAgICAgICByZXR1cm4gZGF0YS52aXNpdG9yO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBnZXRTaXRlTG9nb1VybCgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5jZG5VcmwgKyBkYXRhLnNpdGUubG9nbzsgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gZ2V0QXNzZXRVcmwocGF0aCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmNkblVybCArIHBhdGg7IFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gXG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHNldEJ1c2luZXNzKGJ1c2luZXNzKSB7XG4gICAgICAgIGRhdGEuYnVzaW5lc3MgPSBidXNpbmVzcztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gc3luY1BlcmZvcm1hbmNlKGRhdGEpIHtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZXRDYXRlZ29yaWVzKGRhdGEuY2F0ZWdvcmllcyk7XG4gICAgICAgICAgICBzZXRTaXRlKGRhdGEuc2l0ZSk7XG4gICAgICAgICAgICBzZXRCdXNpbmVzcyhkYXRhLmJ1c2luZXNzKTtcbiAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICBmdW5jdGlvbiBBUEkoJHJvb3RTY29wZSwgJGh0dHAsICRsb2csICRleGNlcHRpb25IYW5kbGVyLCBtZXVIdHRwV2l0aEZhbGxiYWNrKSB7XG4gIFxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICB0aW1lb3V0OiAxMDAwMFxuICAgIH07XG4gICAgICAgIFxuICAgIHZhciBjb252ZXJ0SnNvbkFzVXJpUGFyYW1ldGVycyA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIHZhciB1cmwgPSBPYmplY3Qua2V5cyhkYXRhKS5tYXAoZnVuY3Rpb24oaykge1xuICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KGspICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGFba10pO1xuICAgICAgfSkuam9pbignJicpO1xuICAgIFxuICAgICAgcmV0dXJuIHVybDtcbiAgICB9O1xuXG4gICAgdmFyIGJ1aWxkVXJsID0gZnVuY3Rpb24oZW5kcCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLypcbiAgICAgICAgICBJZiBjb25maWcuZG9tYWluIGlzIG51bGwgdGhlbiB1c2UgZG9tYWluIGVtcHR5XG4gICAgICAgIGNvbmZpZy5kb21haW4gIT09IG51bGwgJiYgY29uZmlnLmRvbWFpbiAhPSB1bmRlZmluZWRcbiAgICAgICAgKi9cbiAgICAgICAgdmFyIGRvbWFpbiA9IChjb25maWcuZG9tYWluKSA/IGNvbmZpZy5kb21haW4gOiAnJztcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBjb25maWcuYXBpVXJsICsgZG9tYWluICsgZW5kcDsgXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgYXBpID0gKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbihlbmRwLCBvYmopIHtcbiAgICAgICAgICBhbmd1bGFyLmV4dGVuZChvYmosIHt0aW1lb3V0OiBjb25maWcudGltZW91dH0pO1xuICAgICAgXG4gICAgICAgICAgcmV0dXJuIG1ldUh0dHBXaXRoRmFsbGJhY2suZ2V0KGJ1aWxkVXJsKGVuZHApLCBvYmopO1xuICAgICAgICB9LFxuICAgICAgICBwb3N0OiBmdW5jdGlvbihlbmRwLCBvYmopIHsgICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdGltZW91dDogY29uZmlnLnRpbWVvdXQsXG4gICAgICAgICAgICB1cmw6IGJ1aWxkVXJsKGVuZHApLFxuICAgICAgICAgICAgZGF0YTogYW5ndWxhci50b0pzb24ob2JqKSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHB1dDogZnVuY3Rpb24oZW5kcCwgb2JqKSB7ICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAgdGltZW91dDogY29uZmlnLnRpbWVvdXQsXG4gICAgICAgICAgICB1cmw6IGJ1aWxkVXJsKGVuZHApLFxuICAgICAgICAgICAgZGF0YTogYW5ndWxhci50b0pzb24ob2JqKSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlbDogZnVuY3Rpb24oZW5kcCwgaWQpIHtcbiAgICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHRpbWVvdXQ6IGNvbmZpZy50aW1lb3V0LFxuICAgICAgICAgICAgdXJsOiBidWlsZFVybChlbmRwKSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pKCk7XG5cbiAgICB2YXIgYXBwID0ge1xuICAgICAgQ2F0ZWdvcmllczogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvY2F0ZWdvcmllcy8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHF1ZXJ5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IE5lZWQgdG8gYmUgdGVzdGVkXG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldChwYXRoLCB7fSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpdGVtczogZnVuY3Rpb24oY2F0ZWdvcnlfaWQsIGNvbmZpZykge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXQocGF0aCArIGNhdGVnb3J5X2lkICsgJy9pdGVtcycsIGNvbmZpZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkoKSxcbiAgICAgIEl0ZW1zOiAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYXRoID0gJy9pdGVtcy8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxhdGVzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldChwYXRoICsgJ2xhdGVzdCcsIHt9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaDogZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gcGF0aCArICdzZWFyY2g/JyArIGNvbnZlcnRKc29uQXNVcmlQYXJhbWV0ZXJzKG9iaik7XG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldCh1cmwsIHt9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgU2l0ZTogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvcGVyZm9ybWFuY2UnO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHBlcmZvcm1hbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkuZ2V0KHBhdGgsIHt9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgTG9naW46IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBhdGggPSAnL3Zpc2l0b3JzLyc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2lnbmluOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkucG9zdChwYXRoICsgJ2xvZ2luJywgb2JqKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldChwYXRoLCB7fSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzYXZlOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkucHV0KHBhdGgsIG9iaik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyBUT0RPOiBOZWVkIHRvIGJlIHRlc3RlZFxuICAgICAgICAgIGRldmljZTogZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLnBvc3QocGF0aCArICdkZXZpY2VzJywgb2JqKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIFRPRE86IE5lZWQgdG8gYmUgdGVzdGVkXG4gICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkucHV0KHBhdGggKyAnZGV2aWNlcy8nICsgb2JqLnV1aWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wb3N0KHBhdGggKyAnZm9yZ290X3Bhc3N3b3JkJywgb2JqKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgRGV2aWNlczogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvZGV2aWNlcy8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wdXQocGF0aCArIG9iai51dWlkLCBvYmopO1xuICAgICAgICAgIH0gXG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgUG9sbDogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvaXRlbXMvJztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWJtaXQ6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wb3N0KHBhdGggKyBvYmouaWQgKyAnL3BvbGwnLCBvYmoucGFyYW1zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgTWFpbDogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvbWFpbC8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wb3N0KHBhdGgsIG9iaik7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkoKSxcbiAgICAgIENvbmZpZzogKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNldFByb3BlcnRpZXM6IGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGNvbmZpZywgcHJvcCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXRQcm9wZXJ0eTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIGNvbmZpZ1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0UHJvcGVydHk6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWdbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkoKVxuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIGFwcDtcbiAgfVxufSkoKTsiLCIvKiBnbG9iYWwgYW5ndWxhciAqL1xuLyogZXNsaW50IG5vLXVuZGVmOiBcImVycm9yXCIgKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmZpbHRlcnMnLCBbJ25nU2FuaXRpemUnXSlcbiAgLmZpbHRlcignaXNFbXB0eScsIGlzRW1wdHkpXG4gIC5maWx0ZXIoJ2JyMm5sJywgYnIybmwpXG4gIC5maWx0ZXIoJ3N0cmlwdGFncycsIHN0cmlwdGFncylcbiAgLmZpbHRlcignYnl0ZXNUb1NpemUnLCBieXRlc1RvU2l6ZSlcbiAgLmZpbHRlcignaHJlZlRvSlMnLCBocmVmVG9KUylcbiAgLmZpbHRlcignY2FwaXRhbGl6ZScsIGNhcGl0YWxpemUpO1xuXG4gIGZ1bmN0aW9uIGlzRW1wdHkoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiAhT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJyMm5sKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvPGJyXFxzKltcXC9dPz4vZ2ksICdcXG4nKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gc3RyaXB0YWdzKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXJcbiAgICAgIC5lbGVtZW50KCc8ZGl2Lz4nKVxuICAgICAgLmh0bWwodGV4dClcbiAgICAgIC50ZXh0KCk7XG4gICAgfTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gY2FwaXRhbGl6ZSgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHNjb3BlKSB7XG4gICAgICBpZiAoaW5wdXQhPW51bGwpXG4gICAgICBpbnB1dCA9IGlucHV0LnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gaW5wdXQuc3Vic3RyaW5nKDAsMSkudG9VcHBlckNhc2UoKStpbnB1dC5zdWJzdHJpbmcoMSk7XG4gICAgfSBcbiAgfVxuICBcbiAgZnVuY3Rpb24gYnl0ZXNUb1NpemUoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGJ5dGVzKSB7XG4gICAgICBpZiAoYnl0ZXMgPT0gMCkgcmV0dXJuICcwIEJ5dGUnO1xuICAgICAgdmFyIGsgPSAxMDAwO1xuICAgICAgdmFyIHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQicsICdUQicsICdQQicsICdFQicsICdaQicsICdZQiddO1xuICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKE1hdGgubG9nKGJ5dGVzKSAvIE1hdGgubG9nKGspKTtcbiAgICAgIHJldHVybiAoYnl0ZXMgLyBNYXRoLnBvdyhrLCBpKSkudG9QcmVjaXNpb24oMykgKyAnICcgKyBzaXplc1tpXTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBocmVmVG9KUyAoJHNjZSwgJHNhbml0aXplKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHZhciByZWdleCA9IC9ocmVmPVwiKFtcXFNdKylcIi9nO1xuICAgICAgdmFyIG5ld1N0cmluZyA9ICRzYW5pdGl6ZSh0ZXh0KS5yZXBsYWNlKHJlZ2V4LCBcIm9uQ2xpY2s9XFxcIndpbmRvdy5vcGVuKCckMScsICdfYmxhbmsnLCAnbG9jYXRpb249eWVzJylcXFwiXCIpO1xuICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwobmV3U3RyaW5nKTtcbiAgICB9XG4gIH1cbn0pKCk7XG4iXX0=
