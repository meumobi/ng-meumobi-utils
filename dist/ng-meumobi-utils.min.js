(function() {
  'use strict';
  
  angular
  .module('ngMeumobi.Utils.localStorage', [])
  .factory('meuLocalStorage', localStorage);
  
  function localStorage() {
    
    var service = {};
    
    service.getObject = getObject;
    service.setObject = setObject;
    service.removeObject = removeObject;
    service.contains = contains;
    
    return service;
    
    function getObject(key) {
      return angular.fromJson(localStorage.getItem(key));
    };

    function setObject(key, value) {
      localStorage.setItem(key, angular.toJson(value));
    };

    function removeObject(key) {
      localStorage.removeItem(key);
    };

    function contains(key) {
      return localStorage.getItem(key) ? true : false;
    };
  }
})();
(function() {
  'use strict';

  httpWithFallback.$inject = ["$q", "$log", "$exceptionHandler", "$http"];
  angular
  .module('ngMeumobi.Utils.httpWithFallback', [])
  .factory('meuHttpWithFallback', httpWithFallback);
  
  function httpWithFallback($q, $log, $exceptionHandler, $http) {

    // Constructor function, using $http as prototype
    function HttpWithFallback() { }
    HttpWithFallback.prototype = $http;
    HttpWithFallback.prototype.constructor = HttpWithFallback;

    var httpWithFallback = new HttpWithFallback();

    var prepareStoredResponse = function(storedResponse) {
      // Data was successfully retrieved from local storage, resolve with status 200
      storedResponse = angular.fromJson(storedResponse);
      var headers = storedResponse.headers;
      storedResponse.headers = function() { return headers; };
      return storedResponse;
    };

    var makeRequest = function(url, config, deferred) {
      $http.get(url, config)
      .then(
        function(response) {
          $log.debug('[httpWithFallback]: then response success status:' + response.status);
          // Store in local storage when status === 200
          if (!response.config.dontStoreFallback && response.status === 200) {
            localStorage.setItem(url, angular.toJson({
              data: response.data,
              status: response.status,
              config: response.config,
              headers: response.headers(),
              isFallback: true
            }));
          }
          // Resolve with original response
          if (response.headers('etag') === response.config['If-None-Match'])
            response.unchanged = true;
          deferred.resolve(response);
        },
        function(response) {
          $log.debug('[httpWithFallback]: then response fail status:' + response.status);
          // Try to retrieve from local storage
          var storedResponse = localStorage.getItem(url);
          if (storedResponse) {
            return deferred.resolve(prepareStoredResponse(storedResponse));
          }

          // Try config.fallback
          if (response.config.fallback) {
            return deferred.resolve({
              data: config.fallback,
              status: response.status,
              headers: response.headers,
              config: response.config,
              isFallback: true
            });
          }

          // Reject with original error response
          return deferred.reject(response);
        }
      );

      // Decorate promise with success and error functions to be compatible with the promise returned by $http.get
      var promise = deferred.promise;

      promise.success = function(fn) {
        promise.then(function(response) {
          fn(response.data, response.status, response.headers, config, response.isFallback);
        });
        return promise;
      };

      promise.error = function(fn) {
        promise.then(null, function(response) {
          fn(response.data, response.status, response.headers, config);
        });
        return promise;
      };

      return promise;
    };
    /**
    * Override $http.get to catch the promise.error
    */
    httpWithFallback.get = function(url, config) {
      // Client doesn't support local storage
      if (!localStorage) {
        // If no fallback defined, just just $http.get
        if (!config.fallback) {
          return $http.get(url, config);
        }
        // Local storage won't be used
        config.dontStoreFallback = true;
      }

      // Delegate get to $http
      var deferred = $q.defer();
      var storedResponse = localStorage.getItem(url);

      if (storedResponse) {
        //second promise to update data after request
        var deferredRequest = $q.defer();
        storedResponse = prepareStoredResponse(storedResponse);
        var cache = storedResponse;          
        // If config is undefined, ie httpWithFallback.get(PATH)
        // config = typeof config !== 'undefined' ? config : {};
        config = angular.isDefined(config) ? config : {};         
        if (cache && cache.headers())
          config['If-None-Match'] = cache.headers().etag;
        storedResponse.promise = makeRequest(url, config, deferredRequest);
        deferred.resolve(storedResponse);
        return deferred.promise;
      }
      //don't have local, continue to request
      return makeRequest(url, config, deferred);
    };

    return httpWithFallback;
  };
})();
(function() {
	'use strict';

	loadingInterceptor.$inject = ["$q", "$rootScope", "$log"];
  errorInterceptor.$inject = ["$q", "$rootScope", "$log"];
	angular
	.module('ngMeumobi.Utils.httpInterceptors', [])
	.factory('meuLoadingInterceptor', loadingInterceptor)
  .factory('meuErrorInterceptor', errorInterceptor);
	
	function loadingInterceptor($q, $rootScope, $log) {
		
		var numLoadings = 0;
		
		return {
			request: function(config) {
        if (!numLoadings++) {
          $rootScope.$broadcast('loading:start');
        }

				return config || $q.when(config);
			},
			response: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return response || $q.when(response);
			},
			requestError: function(request) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}

				return $q.reject(request);
			},
			responseError: function(response) {
				if (!(--numLoadings)) {
					$rootScope.$broadcast('loading:stop');
				}
				
				return $q.reject(response);
			}
		};
	}
  
  function errorInterceptor($q, $rootScope, $log) {
    
  	return {
  		request: function(config) {
        
  			return config || $q.when(config);
  		},
  		requestError: function(request) {
        
  			return $q.reject(request);
  		},
  		response: function(response) {
        
  			return response || $q.when(response);
  		},
  		responseError: function(response) {
  			$log.debug('[API:errorInterceptor]: BEGIN');
        $log.debug('Response Status: ' + response.status);
  			$log.debug(response);
  			$log.debug('[API:errorInterceptor]: END');
  			if (response && response.status === -1) {} // Client timeout fired
        if (response && response.status === 0) {} // network offline or CORS error
  			if (response && response.status === 404) {}
  			if (response && response.status === 401) {
          $rootScope.$broadcast('error:401');
  			}
  			if (response && response.status === 408) {} // Server timed out waiting for the request.
  			if (response && response.status >= 500) {}
        
  			return $q.reject(response);
  		}
  	};
  }
})();
(function() {
	'use strict';
  
	deviceReady.$inject = ["$log", "$window"];
	angular
	.module('ngMeumobi.Utils.deviceReady', [])
	.factory('meuDeviceReady', deviceReady);
  
  /*
  
    How to use it: 
      meuDeviceReady(function() {
        ...
      });
  */
  
	function deviceReady($log, $window) {
		return function(done) {
			if (angular.isObject($window.cordova)) {
        /*eslint-disable angular/document-service */
        document.addEventListener('deviceready', function(event) {
					done();
				}, false);
        /*eslint-enable angular/document-service */
			} else {
				done();
			}
		};
	}
})();
(function() {
  'use strict';
  
  authentication.$inject = ["$http", "$rootScope", "$timeout"];
  angular
  .module('ngMeumobi.Utils.authentication', [])
  .factory('meuAuthentication', authentication);
  
  /*
  Inspired by Jason Watmore Blog Post
  http://jasonwatmore.com/post/2014/05/26/angularjs-basic-http-authentication-example
  */

  function authentication($http, $rootScope, $timeout) {
    
    var service = {};
    service.SetCredentials = function (data) { 
      /*
      *  data.visitor && data.token
      */
      $rootScope.auth = data;

      $http.defaults.headers.common['X-Visitor-Token'] = data.token;
      localStorage.globals = angular.toJson($rootScope.auth);
    };

    service.ClearCredentials = function () {
      $rootScope.auth = {};
      localStorage.removeItem('auth');
      delete $http.defaults.headers.common['X-Visitor-Token'];
    };

    return service;
  }
})();
(function() {
  'use strict';

  statusbar.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
  angular
  .module('ngMeumobi.Utils.statusbar', [])
  .factory('meuStatusbar', statusbar);
  
  /*
  install   :     cordova plugin add cordova-plugin-statusbar
  
  How to use it: 
    meuCordova.statusbar.call()
    .then(function(result) {})
    .catch(function(error) {});
  */
  
  function statusbar($q, $window, $log, $exceptionHandler) {
    
    var service = {};
    var options = {};
    
    service.setOption = setOption;
    service.setOptions = setOptions;
    service.call = call;
    
    return service;

    function setOptions(opt) {
      angular.extend(options, opt);
    }

    function setOption(name, value) {
      options[name] = value;
    }
    
    function call() {
      return $q(function(resolve, reject) {
        try {
          
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
  }
})();
(function() {
  'use strict';

  splashscreen.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
  angular
  .module('ngMeumobi.Cordova.splashscreen', [])
  .factory('meuSplashscreen', splashscreen);
  
  /*
  install   :     cordova plugin add cordova-plugin-splashscreen
  
  How to use it: 
  meuCordova.splashscreen.hide()
  .then(function() {})
  .catch(function() {});
  */
  
  function splashscreen($q, $window, $log, $exceptionHandler) {
    
    return {
      show: function() {
        return $q(function(resolve, reject) {
          try {
            if ($window.navigator.splashscreen) {
              $window.navigator.splashscreen.show();
              resolve();
            }
          } catch (e) {
            $exceptionHandler(e);
            reject(e);
          };
        });
      },
    
      hide: function() {
        return $q(function(resolve, reject) {
          try {
            if ($window.navigator.splashscreen) {
              $window.navigator.splashscreen.hide();
              resolve();
            }
          } catch (e) {
            $exceptionHandler(e);
            reject(e);
          };
        });
      }
    };
  }
})();
(function() {
  'use strict';

  spinnerDialog.$inject = ["$q", "$window", "$log", "$exceptionHandler"];
  angular
  .module('ngMeumobi.Cordova.spinnerDialog', [])
  .factory('meuSpinnerDialog', spinnerDialog);
  
  /*
  install   :     cordova plugin add cordova-plugin-spinnerdialog
  
  How to use it: 
    meuSpinnerDialog.show()
    .then(function(result) {})
    .catch(function(error) {});
  */
  
  function spinnerDialog($q, $window, $log, $exceptionHandler) {
    
    var service = {};
    
    service.show = show;
    service.hide = hide;
    
    return service;

    function show() {
      return $q(function(resolve, reject) {
        try {
          var spinner = $window.plugins && $window.plugins.spinnerDialog;
        
          if (spinner) {
            spinner.show();
            resolve();
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-spinnerdialog');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    };
    
    function hide() {
      return $q(function(resolve, reject) {
        try {
          var spinner = $window.plugins && $window.plugins.spinnerDialog;
        
          if (spinner) {
            spinner.hide();
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-spinnerdialog');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    };
  }
})();
(function() {
	'use strict';

	angular
	.module('ngMeumobi.Cordova.socialSharing', [])
	.factory('meuSocialSharing', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', '$log', socialSharing]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin
  
  How to use it: 
    meuSocialSharing.shareItem()
    .then(function(result) {})
    .catch(function(error) {});
  
    meuSocialSharing.shareMedia()
  */
  
  function socialSharing($q, $window, striptags, br2nl, $log, $exceptionHandler) {
    
    var service = {};
    var options = {
      postfix: ''
    };
    
    service.shareItem = shareItem;
    service.shareMedia = shareMedia;
    service.setOption = setOption;
    service.setOptions = setOptions;
    service.share = share;
    service.shareViaWhatsAppToReceiver = shareViaWhatsAppToReceiver;
    
    return service;

    function setOptions(options) {
      angular.extend(options, opt);
    }

    function setOption(name, value) {
      options[name] = value;
    }

		function shareViaWhatsAppToReceiver(receiver) {
      var social = $window.plugins && $window.plugins.socialsharing;
		  
      social.shareViaWhatsAppToReceiver(receiver, 'Message via WhatsApp', null /* img */, null /* url */, function() {$log.debug('share ok');});
		}
    
    function shareItem(item) {
			
			var params = {
			  message: item.description,
        subject: item.title,
        files: [],
        url: item.hasOwnProperty('link') ? item.link : null
			};

      if (item.thumbnails && item.thumbnails.length > 0) {
				params.files.push(item.thumbnails[0].url);
			}

			return share(params);
		}

		function shareMedia(media) {

			var params = {
			  message: media.title,
        subject: media.title,
        files: [],
        url: media.url
			};
			
			// If media is saved locally (media.path) then share it
			// Else share its link (media.url)
			// Couldn't share together local pdf and link
			if (media.hasOwnProperty('fullPath')) {
				params.files.push(media.fullPath);
				params.url = null;
			} else if (media.thumbnails && media.thumbnails.length > 0) {
				params.files.push(media.thumbnails[0].url);
			}
			
			return share(params);
		}
		
		function share(params) {
    /*
      this is the complete list of currently supported params you can pass to the plugin (all optional)
      var options = {
        message: 'share this', // not supported on some apps (Facebook, Instagram)
        subject: 'the subject', // fi. for email
        files: ['', ''], // an array of filenames either locally or remotely
        url: 'https://www.website.com/foo/#bar?a=b',
        chooserTitle: 'Pick an app' // Android only, you can override the default share sheet title
      }
    */
      return $q(function(resolve, reject) {
        
        var cb_share = {
          success: function(result) {
            resolve(result);
          },
          fail: function(msg) {
            throw new Error('[CALLBACK FAILURE]: social.shareWithOptions');
          }  
        };
        
        try {
          var social = $window.plugins && $window.plugins.socialsharing;
    
    			if (social) {
            if (options.postfix) {
      				params.subject += options.postfix;
            }
      
            params.message = params.message && striptags(br2nl(params.message));
            params.subject = params.subject && striptags(br2nl(params.subject));

            social.shareWithOptions(params, cb_share.success, cb_share.fail); 
    			} else {
    			  throw new Error('[PLUGIN MISSING]: cordova-plugin-x-socialsharing');
    			}          
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
		}
  }
})();
(function() {
	'use strict';

  initPushwoosh.$inject = ["$log", "$window", "$document", "$exceptionHandler"];
	OneSignalImpl.$inject = ["$log", "$window", "$exceptionHandler", "$rootScope", "$q"];
	angular
	.module('ngMeumobi.Cordova.push', [])
	.factory('pushwoosh', initPushwoosh)
	.factory('onesignal', OneSignalImpl);
  
  /*
    https://www.npmjs.com/package/pushwoosh-pgb-plugin
    http://docs.pushwoosh.com/docs/phonegap-build
  */
  function initPushwoosh($log, $window, $document, $exceptionHandler) {
        
    var service = {};
    
    service.config = config;
    service.register = register;
    
    return service;
    
    var googleProjectNumber;
    var applicationCode;
	
    function config(g, a) {
      googleProjectNumber = g;
      applicationCode = a;
    };
    
    // Initialize Pushwoosh. This will trigger all pending push notifications on start.
    function register(success, fail) {
      
      try {   
        var pushNotification = angular.isDefined($window.cordova) && $window.cordova.require('pushwoosh-cordova-plugin.PushNotification');
      
        if (pushNotification) {
          // Should be called before pushwoosh.onDeviceReady
          $document.on('push-notification', function(event) {
            var notification = event.notification;
            /*
            handle push open here
            notification.message
            notification.userData = {
              'category_id': ...,
              'item_id': ...
            }
            */ 
            $log.debug('event.notification');
            $log.debug(notification);
          });

          pushNotification.onDeviceReady({ 
            projectid: googleProjectNumber,
            pw_appid: applicationCode}
          );

          //register for push notifications
          pushNotification.registerDevice(
            function(status) {
              var pushIds = {};
              
              pushIds.token = status.pushToken;
              success(pushIds);
            }, 
            function(status) {
              throw new Error('Push: Can\'t register device');
              fail(status);
            }
          );
          //clear the app badge
          pushNotification.setApplicationIconBadgeNumber(0);
        } else {
          throw new Error('Missing Plugin: pushwoosh-cordova-plugin');
        }
      } catch (error) {
        $exceptionHandler(error);
      }
    };
  }
	
  /*
    https://www.npmjs.com/package/onesignal-cordova-plugin
    https://documentation.onesignal.com/docs/phonegap-sdk
  */
  
	function OneSignalImpl($log, $window, $exceptionHandler, $rootScope, $q) {

    var service = {};
    
    service.config = config;
    service.register = register;
    service.sendTag = sendTag;
    service.setSubscription = setSubscription;
    
    return service;
    
    var googleProjectNumber;
		var appId;
	
		function config(g, a) {
			googleProjectNumber = g;
			appId = a;
		};
		
  /**
   * @ngdoc function
   * @name ngMeumobi.Utils.push.meuPush#setProvider
   * @methodOf ngMeumobi.Utils.push.meuPush
   *
   * @description
   * Sets current Push provider (by default 'pushwoosh').
   *
   * @param {string} provider name {'pushwoosh', 'onesignal'}.
   */
    
    function sendTag(key, value) {
      return $q(function(resolve, reject) {
        try {
          var pushNotification = $window.plugins && $window.plugins.OneSignal;
          
          if (pushNotification) {
            pushNotification.sendTag(key, value);
          } else {
            throw new Error('Missing Plugin: onesignal-cordova-plugin');
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
    
    function setSubscription(bool) {
      return $q(function(resolve, reject) {
        try {
          var pushNotification = $window.plugins && $window.plugins.OneSignal;
          
          if (pushNotification) {
            pushNotification.setSubscription(bool);
          } else {
            throw new Error('Missing Plugin: onesignal-cordova-plugin');
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
    
    function register(success, error) {
      try {
        var pushNotification = $window.plugins && $window.plugins.OneSignal;

        if (pushNotification) {
          pushNotification.setAppId(appId);

          pushNotification.addPermissionObserver(function (stateChanges) {
            $log.debug(
              "Push permission state changed: " +
                JSON.stringify(stateChanges, null, 2)
            );
          });
          pushNotification.getDeviceState(function (stateChanges) {
            $log.debug(
              "OneSignal getDeviceState: " + JSON.stringify(stateChanges)
            );
            var pushIds = {};
            pushIds.token = stateChanges.pushToken;
            pushIds.uuid = stateChanges.userId;

            success(pushIds);
          });

          pushNotification.setNotificationOpenedHandler(function (jsonData) {
            $log.debug(
              "notificationOpenedCallback: " + JSON.stringify(jsonData)
            );
            $rootScope.$emit("open-notification", jsonData);
          });

          //Prompts the user for notification permissions.
          //    * Since this shows a generic native prompt, we recommend instead using an In-App Message to prompt for notification permission (See step 6) to better communicate to your users what notifications they will get.
          pushNotification.promptForPushNotificationsWithUserResponse(function (
            accepted
          ) {
            $log.debug("User accepted notifications: " + accepted);
          });
          
          pushNotification.getTags(function(tags) {
            //alert('get Push Tags:\n' + angular.toJson(tags));
            $log.debug('Tags Received: ' + angular.toJson(tags));
          });
        } else {
          throw new Error('Missing Plugin: onesignal-cordova-plugin');
        }
      } catch (error) {
        $exceptionHandler(error);
      }
    };
	}
})();
(function () {
  "use strict";

  mediaClickLabel.$inject = ["MIMES"];
  mediaIconClass.$inject = ["MIMES"];
  mediaOpenClass.$inject = ["MIMES"];
  angular
    .module("ngMeumobi.Cordova.files", ["slugifier"])
    .constant("MIMES", {
      "application/pdf": {
        class: "fa-file-pdf-o",
        label: "View",
        extension: "pdf",
        download: true,
      },
      "text/html": {
        class: "fa-rss",
        label: "Open",
        extension: "html",
        download: false,
      },
      "application/vnd.youtube.video+html": {
        class: "fa-youtube-play",
        openClass: "fa-play",
        label: "Play",
        extension: "html",
        download: false,
      },
      "application/vnd.ms-excel": {
        class: "fa-file-excel-o",
        label: "View",
        extension: "xls",
        download: true,
      },
      "application/xlsx": {
        class: "fa-file-excel-o",
        label: "View",
        extension: "xls",
        download: true,
      },
      "audio/mpeg": {
        class: "fa-file-audio-o",
        label: "Play",
        openClass: "fa-play",
        extension: "mp3",
        download: true,
      },
      "video/mp4": {
        class: "fa-file-video-o",
        label: "Play",
        openClass: "fa-play",
        extension: "mp4",
        download: true,
      },
      "application/vnd.ms-powerpoint": {
        class: "fa-file-powerpoint-o",
        label: "View",
        extension: "ppt",
        download: true,
      },
      "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet": {
        class: "fa-file-excel-o",
        label: "View",
        extension: "xls",
        download: true,
      },
    })
    .filter("mediaClickLabel", mediaClickLabel)
    .filter("mediaIconClass", mediaIconClass)
    .filter("mediaOpenClass", mediaOpenClass)
    .provider("meuFiles", files);

  function mediaClickLabel(MIMES) {
    return function (type) {
      return MIMES[type] ? MIMES[type].label : "Open";
    };
  }

  function mediaIconClass(MIMES) {
    return function (type) {
      return MIMES[type] ? MIMES[type].class : "fa-external-link";
    };
  }

  function mediaOpenClass(MIMES) {
    return function (type) {
      return MIMES[type] && MIMES[type].openClass
        ? MIMES[type].openClass
        : "fa-eye";
    };
  }
  function files() {
    var FileRepo = {};
    var fileTransfers = {},
      files = {},
      options = {
        localFolder: "Downloads",
      },
      statuses = {
        download: "download",
        downloading: "downloading",
        downloaded: "downloaded",
      };

    this.setOptions = function (options) {
      angular.extend(options, opt);
    };

    this.setOption = function (name, value) {
      options[name] = value;
    };

    this.$get = ["$q", "$log", "$window", "MIMES", "Slug", function ($q, $log, $window, MIMES, Slug) {
      FileRepo.$deferred = $q.defer();
      FileRepo.$promise = FileRepo.$deferred.promise;

      var api = {};
      var service = {};

      /**
       *  Api methods, available only on the inside the service
       */

      api.fileErrorHandler = function (e) {
        /*
        List of Errors cordova-plugin-file
        https://github.com/apache/cordova-plugin-file#list-of-error-codes-and-meanings
        For the meaning I recommend to read https://wicg.github.io/entries-api/#common-types
        */
        switch (e.code) {
          case FileError.NOT_FOUND_ERR:
            e.message = "Requested file could not be found";
            break;
          case FileError.SECURITY_ERR:
            e.message = "SECURITY_ERR";
            break;
          case FileError.ABORT_ERR:
            e.message = "ABORT_ERR";
            break;
          case FileError.NOT_READABLE_ERR:
            e.message = "NOT_READABLE_ERR";
            break;
          case FileError.ENCODING_ERR:
            e.message = "Malformed URI";
            break;
          case FileError.NO_MODIFICATION_ALLOWED_ERR:
            e.message = "NO_MODIFICATION_ALLOWED_ERR";
            break;
          case FileError.INVALID_STATE_ERR:
            e.message = "INVALID_STATE_ERR";
            break;
          case FileError.SYNTAX_ERR:
            e.message = "SYNTAX_ERR";
            break;
          case FileError.INVALID_MODIFICATION_ERR:
            e.message = "INVALID_MODIFICATION_ERR";
            break;
          case FileError.QUOTA_EXCEEDED_ERR:
            e.message = "QUOTA_EXCEEDED_ERR";
            break;
          case FileError.TYPE_MISMATCH_ERR:
            e.message = "TYPE_MISMATCH_ERR";
            break;
          case FileError.PATH_EXISTS_ERR:
            e.message = "PATH_EXISTS_ERR";
            break;
          default:
            e.message = "Unknown Error";
            break;
        }
        $log.error("Error: " + e.message);

        return e;
      };

      api.fileTransferErrorHandler = function (e) {
        /*
        A FileTransferError object is passed to an error callback when an error occurs.
        https://github.com/apache/cordova-plugin-file-transfer#filetransfererror
        */
        switch (e.code) {
          case FileTransferError.FILE_NOT_FOUND_ERR:
            e.message = "FILE_NOT_FOUND_ERR";
            break;
          case FileTransferError.INVALID_URL_ERR:
            e.message = "INVALID_URL_ERR";
            break;
          case FileTransferError.CONNECTION_ERR:
            e.message = "CONNECTION_ERR";
            break;
          case FileTransferError.ABORT_ERR:
            e.message = "Operation aborted";
            break;
          case FileTransferError.NOT_MODIFIED_ERR:
            e.message = "NOT_MODIFIED_ERR";
            break;
          default:
            e.message = "Unknown Error";
            break;
        }
        $log.error("Error: " + e.message);

        return e;
      };

      api.getFileName = function (file) {
        var ext = file.extension || "";

        if (!ext && MIMES[file.type]) ext = MIMES[file.type].extension;

        var name = file.title || "";

        if (!name) {
          name = md5(file.url);
        } else {
          name = Slug.slugify(name);
        }

        return name + "." + ext;
      };

      api.checkRepositoryConsistency = function () {
        /*
        id must be equals to file.path
        and fullPath can be updated if App is updated (iOS)
        */
        var obj = {};
        var entries = angular.fromJson(localStorage["files"]) || [];

        return Promise.all(
          Object.keys(entries).map((key) => {
            return api
              .getFileFullPath(entries[key].name)
              .then((fileFullPath) => {
                obj[entries[key].path] = entries[key];
                obj[entries[key].path].fullPath = fileFullPath;

                return api
                  .getFileEntry(fileFullPath)
                  .then((_) => {
                    obj[entries[key].path].status = statuses.downloaded;
                  })
                  .catch((_) => {
                    obj[entries[key].path].status = statuses.download;
                  });
              });
          })
        ).then((_) => {
          localStorage["files"] = angular.toJson(obj);
          return obj;
        });
      };

      api.getDownloadDirEntry = function (rootPath, dirName) {
        var q = $q.defer();
        $window.resolveLocalFileSystemURL(
          rootPath,
          function (rootEntry) {
            // Parameters passed to getDirectory create a new directory or return the directory if it already exists.
            rootEntry.getDirectory(
              dirName,
              { create: true, exclusive: false },
              function (dirEntry) {
                q.resolve(dirEntry);
              },
              function (error) {
                $log.error(error);
                error = api.fileErrorHandler(error);
                q.reject(error);
              }
            );
          },
          function (error) {
            $log.error(error);
            error = api.fileErrorHandler(error);
            q.reject(error);
          }
        );
        return q.promise;
      };

      // Returns the full absolute path from the root to the FileEntry
      api.getFileFullPath = function (fileName) {
        var rootPath = null;
        if (device.platform == "Android") {
          rootPath = cordova.file.externalDataDirectory;
        } else {
          rootPath = cordova.file.dataDirectory;
        }
        return api
          .getDownloadDirEntry(rootPath, options.localFolder)
          .then((dirEntry) => dirEntry.nativeURL + fileName);
      };

      api.getFilePath = function (fileName) {
        return options.localFolder + "/" + fileName;
      };

      //add file to localstorage
      api.addFile = function (file) {
        files[file.path] = file;
        localStorage["files"] = angular.toJson(files);
      };

      //remove file from localstorage
      api.removeFile = function (id) {
        delete files[id];
        localStorage["files"] = angular.toJson(files);
      };

      //get files handler
      api.getFileEntry = function (path) {
        var q = $q.defer();
        $window.resolveLocalFileSystemURL(
          path,
          function (entry) {
            q.resolve(entry);
          },
          function (error) {
            $log.error(error);
            error = api.fileErrorHandler(error);
            q.reject(error);
          }
        );
        return q.promise;
      };

      api.isDownloaded = function (filePath) {
        /*
        TODO: If status is downloaded but local file is missing then return FALSE
        Keep record on localstorage to appears as file already downloaded, user can re-download if needed
        */

        return files[filePath] && [filePath].status == statuses.downloaded;
      };

      api.isDownloading = function (filePath) {
        return !!fileTransfers[filePath];
      };

      api.getFileStatus = function (filePath) {
        if (api.isDownloaded(filePath)) {
          return statuses.downloaded;
        } else if (api.isDownloading(filePath)) {
          return statuses.downloading;
        } else {
          return statuses.download;
        }
      };

      /**
       * Service methods, that are public and available for any resource
       */
      // File available statuses, best for debug and maitain than just string.

      service.download = download;
      service.decorateFile = decorateFile;
      service.remove = remove;
      service.list = list;
      service.open = open;
      service.isDownloadable = isDownloadable;
      service.openFileOpener = openFileOpener;
      service.$init = $init;

      return service;

      /*
      Install: cordova plugin add cordova-plugin-file-opener2
      https://www.npmjs.com/package/cordova-plugin-file-opener2
      */

      function isDownloadable(file) {
        return file.type in MIMES ? MIMES[file.type].download : true;
      }

      function $init() {
        api.checkRepositoryConsistency().then((checkedFiles) => {
          files = checkedFiles;
          FileRepo.$deferred.resolve();
        });

        return FileRepo;
      }

      function list() {
        return FileRepo.$promise.then((_) => {
          return files;
        });
      }

      function openFileOpener(uri, type) {
        var q = $q.defer();

        cordova.plugins.fileOpener2.open(uri, type, {
          error: function (e) {
            q.reject(e);
          },
          success: function () {
            q.resolve();
          },
        });
        return q.promise;
      }

      function open(file) {
        var q = $q.defer();
        var cb_entry = {
          success: function (entry) {
            openFileOpener(entry.nativeURL, file.type).then(
              function () {
                q.resolve();
              },
              function (e) {
                q.reject(e);
              }
            );
          },
          fail: function (e) {
            q.reject(e);
          },
        };

        return api.getFileFullPath(file.name).then((fileFullPath) => {
          file.fullPath = fileFullPath;
          api.getFileEntry(file.fullPath).then(
            function (entry) {
              cb_entry.success(entry);
            },
            function (e) {
              cb_entry.fail(e);
            }
          );
          return q.promise;
        });
      }

      function download(file) {
        var q = $q.defer();
        var ft = new FileTransfer();
        var uri = encodeURI(file.url);

        file.status = statuses.downloading;
        fileTransfers[file.path] = ft;

        ft.onprogress = function (progress) {
          q.notify(progress);
        };

        q.promise.abort = function () {
          ft.abort();
        };

        var cb_download = {
          success: function (fileEntry) {
            file.status = statuses.downloaded;
            api.addFile(file);
            delete fileTransfers[file.path];
            q.resolve(file);
          },
          fail: function (error) {
            $log.error(error);
            file.status = statuses.download;
            error = api.fileTransferErrorHandler(error);
            delete fileTransfers[file.path];
            q.reject(error);
          },
        };
        return api.getFileFullPath(file.name).then((fileFullPath) => {
          file.fullPath = fileFullPath;
          ft.download(
            uri,
            file.fullPath,
            cb_download.success,
            cb_download.fail,
            false
          );

          return q.promise;
        });
      }

      function remove(file) {
        var q = $q.defer();

        var cb_remove = {
          success: function (status) {
            api.removeFile(file.path);
            file.status = statuses.download;
            q.resolve(file);
          },
          fail: function (error) {
            q.reject(error);
          },
        };

        return api.getFileFullPath(file.name).then((fileFullPath) => {
          file.fullPath = fileFullPath;
          api.getFileEntry(file.fullPath).then(
            function (entry) {
              entry.remove(cb_remove.success, cb_remove.fail);
            },
            function (error) {
              file.status = statuses.download;
              q.reject(error);
            }
          );

          return q.promise;
        });
      }

      function decorateFile(file) {
        return FileRepo.$promise.then((_) => {
          file.name = file.name || api.getFileName(file);
          file.path = file.path || api.getFilePath(file.name);
          if (files[file.path]) {
            return files[file.path];
          } else {
            file.status = api.getFileStatus(file.path);

            return api.getFileFullPath(file.name).then((fileFullPath) => {
              // If device not exists then app run on browser
              if (!typeof device) {
                if (api.isDownloaded(file.path)) file.fullPath = fileFullPath;
              }

              return file;
            });
          }
        });
      }
    }];
  }
})();

(function() {
	'use strict';

  dialogs.$inject = ["$q", "$window", "$exceptionHandler"];
	angular
	.module('ngMeumobi.Cordova.dialogs', [])
	.factory('meuDialogs', dialogs);
  
  /*
    install   :     cordova plugin add cordova-plugin-dialogs nl.x-services.plugins.toast
    link      :     https://github.com/apache/cordova-plugin-dialogs
    link      :     https://github.com/EddyVerbruggen/Toast-PhoneGap-Plugin  
  */
  
  function dialogs($q, $window, $exceptionHandler) {
    
    var service = {};
    
    service.alert = alert;
    service.confirm = confirm;
    service.toast = toast;
    
    return service;
    
    function alert(message, title, buttonName) {
      var q = $q.defer();

      if (!$window.navigator.notification) {
        $window.alert(message);
        q.resolve();
      } else {
        navigator.notification.alert(message, function () {
          q.resolve();
        }, title, buttonName);
      }

      return q.promise;
    };
    
    /*
      
      buttonLabels: Array of strings specifying button labels. (Array) (Optional, defaults to [OK,Cancel])
    */
    function confirm(message, title, buttonLabels) {
      return $q(function(resolve, reject) {
        try {
          title = (angular.isDefined(title)) ? title : 'Confirm';

          if (!$window.navigator.notification) {
            if ($window.confirm(message)) {
              resolve(1);
            } else {
              resolve(2);
            }
          } else {
            navigator.notification.confirm(message, function (buttonIndex) {
              resolve(buttonIndex);
            }, title, buttonLabels);
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
    
    function toast(message) {
      return $q(function(resolve, reject) {
        try {
    			var toast = $window.plugins && $window.plugins.toast;
      
    			if (toast) {
            toast.showLongBottom(message, function (response) {
              resolve(response);
            }, function (error) {
              reject(error);
            });
          } else {
            alert(message);
          }          
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
  }
})();
(function() {
	'use strict';
  
	cdvDevice.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
	angular
	.module('ngMeumobi.Cordova.device', [])
	.factory('meuDevice', cdvDevice);
  
  /*
    npm install: 
      https://www.npmjs.com/package/cordova-plugin-device
      https://www.npmjs.com/package/cordova-plugin-uniquedeviceid
      https://www.npmjs.com/package/cordova-plugin-appversion
  
    install: cordova plugin add cordova-plugin-device cordova-plugin-uniquedeviceid cordova-plugin-appversion
  
    How to use it: 
      meuDevice.getUUID()
      .then(function(result) {})
      .catch(function(error) {});
  */
  
	function cdvDevice($log, $window, $q, $exceptionHandler) {
    
    var service = {};
    
    service.getUUID = getUUID;
    service.getInformations = getInformations;
    service.getAppVersion = getAppVersion;
    
    return service;
    
    /*
      Return (String) Value
    */
    
    function getUUID() {
      
      return $q(function (resolve, reject) {
        
        var cb_uuid = {
          success: function(uuid) {
            resolve(uuid);
          },
          fail: function() {
            throw new Error('[CALLBACK FAILURE]: uniqueDeviceID.get');
          }
        };
        try {
          var uniqueDeviceID = $window.plugins && $window.plugins.uniqueDeviceID;
        
          if (uniqueDeviceID) {
            uniqueDeviceID.get(cb_uuid.success, cb_uuid.fail);
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-uniquedeviceid');
          }      
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }
    
    /*
      Return Object {model: ..., platform: ..., platform_version: ..., manufacturer: ...}
    */
    
    function getInformations() {
                    
      return $q(function(resolve, reject) {
        var properties = {};
        
        try {
          /*eslint-disable angular/definedundefined */
          if (typeof device !== 'undefined') {
          /*eslint-enable angular/definedundefined */
    				properties.model = device.model;
    				properties.platform = device.platform;
    				properties.platform_version = device.version;
    				properties.manufacturer = device.manufacturer;
          } else {
    				// Running on Web Browser
    				properties.model = navigator.userAgent;
          }
          resolve(properties); 
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }     
      });
    }
    
    /*
      Return Object {app_version: ..., app_build: ...}
    */
    
    function getAppVersion() {
      
      return $q(function(resolve, reject) {
        var properties = {};
      
        try {
          /*eslint-disable angular/definedundefined */
          if (typeof AppVersion !== 'undefined') {
          /*eslint-enable angular/definedundefined */
    				properties.app_version = AppVersion.version;
    				properties.app_build = AppVersion.build;
          } else {
            throw new Error('[PLUGIN MISSING]: cordova-plugin-appversion');
          }
          
          resolve(properties);
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        } 
      });
    }
	}
})();
(function() {
  'use strict';
  
  callNumberCordova.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
  callNumber.$inject = ["$log", "$window", "$q", "$exceptionHandler"];
  meuCallNumber.$inject = ["$injector", "$window"];
  angular
  .module('ngMeumobi.Cordova.callNumber', [])
  .factory('callNumberCordova', callNumberCordova)
  .factory('callNumber', callNumber)
  .factory('meuCallNumber', meuCallNumber);
  
  /*
  install   :     cordova plugin add https://github.com/Rohfosho/CordovaCallNumberPlugin.git
  
  npm install https://www.npmjs.com/package/call-number
  
  How to use it: 
  meuCordova.callNumber(number, true)
  .then(function(result) {})
  .catch(function(error) {});
  */
		
  function callNumberCordova($log, $window, $q, $exceptionHandler) {
    
    return function(number, bypassAppChooser) {
      
      return $q(function(resolve, reject) {
        try {
          if (angular.isUndefined(bypassAppChooser)) {
            bypassAppChooser = false;
          }
          var cb_callNumber = {
            success: function(result) {
              resolve(result);
            },
            fail: function(result) {
              $log.debug(result);
              reject(result);
            }
          };
      
          var CallNumber = $window.plugins && $window.plugins.CallNumber;
      
          if (CallNumber) {
            CallNumber.callNumber(cb_callNumber.success, cb_callNumber.fail, number, bypassAppChooser);
          } else {
            throw new Error('Missing CordovaCallNumber Plugin');
          }
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
  }
  
  function callNumber($log, $window, $q, $exceptionHandler) {
    
    return function(number, bypassAppChooser) {
      return $q(function(resolve, reject) {
        try {
          if (angular.isUndefined(bypassAppChooser)) {
            bypassAppChooser = false;
          }
          var passedNumber = encodeURIComponent(number);
          $window.location = 'tel:' + passedNumber;
          resolve();
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    };
  }
  
  function meuCallNumber($injector, $window) {

    var CallNumber = $window.plugins && $window.plugins.CallNumber;
    
    if ($window.cordova && CallNumber) {
      return $injector.get('callNumberCordova');
    } else {
      return $injector.get('callNumber');
    }
  }
})();
(function() {
	'use strict';

	angular
	.module('ngMeumobi.Cordova.calendar', [])
	.factory('meuCalendar', ['$q', '$window', 'striptagsFilter', 'br2nlFilter', calendar]);
  
  /*
    cordova plugin add https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin.git
    If start and end_date equal 00:00 then the event occurs all day long
  */
  
  function calendar($q, $window, striptags, br2nl, $exceptionHandler) {
    
    var service = {};
    
    service.createEventInteractively = createEventInteractively;
    
    return service;
    
    function createEventInteractively(options) {
      var defaultOptions = {
        title: null,
        address: null,
        description: '',
        start_date: null,
        end_date: null
      };

      defaultOptions = angular.extend(defaultOptions, options);
      
      return $q(function(resolve, reject) {
        try {
          $window.plugins.calendar.createEventInteractively(
            striptags(defaultOptions.title),
            striptags(defaultOptions.address),
            striptags(br2nl(defaultOptions.description)),
            new Date(defaultOptions.start_date  * 1000),
            new Date(defaultOptions.end_date  * 1000),
            function (message) {
              resolve(message);
            }, function (e) {
              reject(e);
            }
          );
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        };
      });
    }
  }
})();
(function() {
	'use strict';
  
  firebaseAnalytics.$inject = ["$q", "$log", "$exceptionHandler"];
  firebaseXAnalytics.$inject = ["$q", "$log", "$window", "$exceptionHandler"];
  analytics.$inject = ["$injector", "$window"];
	angular
    .module("ngMeumobi.Cordova.analytics", [])
    .factory("firebaseAnalytics", firebaseAnalytics)
    .factory("firebaseXAnalytics", firebaseXAnalytics)
    .factory("meuAnalytics", analytics);

  function firebaseAnalytics($q, $log, $exceptionHandler) {
    var service = {};

    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.events = {
      EVENT_SAVE: "irmobi_event_save",
      EMAIL_SEND: "irmobi_email_send",
      MEDIA_OPEN: "irmobi_media_open",
      MEDIA_DELETE: "irmobi_media_delete",
      MEDIA_DOWNLOAD: "irmobi_media_download",
      ITEM_SHARE: "irmobi_item_share",
      MEDIA_SHARE: "irmobi_media_share",
    };

    return service;

    function trackView(screenName) {
      return $q(function (resolve, reject) {
        try {
          var analytics = cordova.plugins.firebase.analytics;

          if (analytics) {
            return analytics
              .setCurrentScreen(screenName)
              .then((res) => {
                $log.debug("Track view: " + { name: screenName, result: res });
                resolve();
              })
              .catch((error) => {
                throw new Error("Failed to track view", {
                  cause: JSON.stringify(error),
                });
              });
          } else {
            throw new Error(
              "[PLUGIN MISSING]: cordova-plugin-firebase-analytics"
            );
          }
          // cordova.plugins.firebase.analytics.setCurrentScreen("User dashboard");
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }

    function trackEvent(name, params) {
      return $q(function (resolve, reject) {
        try {
          var analytics = cordova.plugins.firebase.analytics;

          if (analytics) {
            return analytics
              .logEvent(name, params)
              .then((res) => {
                $log.debug("Track event: ", {
                  name,
                  params,
                });
                resolve();
              })
              .catch((error) => {
                throw new Error("Failed to track event", {
                  cause: JSON.stringify(error),
                });
              });
          } else {
            throw new Error(
              "[PLUGIN MISSING]: cordova-plugin-firebase-analytics"
            );
          }
          // cordova.plugins.firebase.analytics.logEvent("my_event", {param1: "value1"});
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }
  }

  function firebaseXAnalytics($q, $log, $window, $exceptionHandler) {
    var service = {};

    service.trackView = trackView;
    service.trackEvent = trackEvent;
    service.events = {
      EVENT_SAVE: "irmobi_event_save",
      EMAIL_SEND: "irmobi_email_send",
      MEDIA_OPEN: "irmobi_media_open",
      MEDIA_DELETE: "irmobi_media_delete",
      MEDIA_DOWNLOAD: "irmobi_media_download",
      ITEM_SHARE: "irmobi_item_share",
      MEDIA_SHARE: "irmobi_media_share",
    };

    return service;

    function trackView(screenName) {
      return $q(function (resolve, reject) {
        try {
          var analytics = $window.FirebasePlugin;

          $log.debug($window);

          if (analytics) {
            FirebasePlugin.setScreenName(
              screenName,
              function () {
                $log.debug("Sent screen name: " + screenName);
                resolve();
              },
              function (error) {
                throw new Error("Failed to send screen name", {
                  cause: JSON.stringify(error),
                });
              }
            );
          } else {
            throw new Error(
              "[PLUGIN MISSING]: cordova-plugin-firebase-analytics"
            );
          }
          // cordova.plugins.firebase.analytics.setCurrentScreen("User dashboard");
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }

    function trackEvent(name, params) {
      return $q(function (resolve, reject) {
        try {
          var analytics = $window.FirebasePlugin;

          if (analytics) {
            FirebasePlugin.logEvent(
              name,
              params,
              function () {
                $log.debug("Track event: ", {
                  name,
                  params,
                });
                resolve();
              },
              function (error) {
                throw new Error("Failed to log event", {
                  cause: JSON.stringify(error),
                });
              }
            );
          } else {
            throw new Error(
              "[PLUGIN MISSING]: cordova-plugin-firebase-analytics"
            );
          }
          // cordova.plugins.firebase.analytics.logEvent("my_event", {param1: "value1"});
        } catch (e) {
          $exceptionHandler(e);
          reject(e);
        }
      });
    }
  }

  function analytics($injector, $window) {
    return $injector.get("firebaseAnalytics");
  }
})();
(function(global) {
  'use strict';

  utils.$inject = ["meuLocalStorage", "meuDeviceReady", "meuLoadingInterceptor", "meuErrorInterceptor", "meuHttpWithFallback"];
  angular
  .module('ngMeumobi.Utils', [
    'ngMeumobi.Utils.localStorage',
    'ngMeumobi.Utils.deviceReady',
    'ngMeumobi.Utils.httpInterceptors',
    'ngMeumobi.Utils.authentication',
    'ngMeumobi.Utils.httpWithFallback'
  ])
  .factory('meuUtils', utils);
  
  function utils(
    meuLocalStorage,
    meuDeviceReady,
    meuLoadingInterceptor,
    meuErrorInterceptor,
    meuHttpWithFallback
  ) {
	
    var service = {};
	
    service.localStorage = meuLocalStorage;
    service.deviceReady = meuDeviceReady;
    service.loadingInterceptor = meuLoadingInterceptor;
    service.errorInterceptor = meuErrorInterceptor;
    service.httpWithFallback = meuHttpWithFallback;
      
    return service;
  }
})(this);

(function() {
  'use strict';

  cordova.$inject = ["meuAnalytics", "meuCalendar", "meuCallNumber", "meuDevice", "meuDialogs", "meuFiles", "meuSocialSharing", "meuSpinnerDialog", "meuSplashscreen"];
  angular
  .module('ngMeumobi.Cordova', [
    'ngMeumobi.Cordova.analytics',
    'ngMeumobi.Cordova.calendar',
    'ngMeumobi.Cordova.callNumber',
    'ngMeumobi.Cordova.device',
    'ngMeumobi.Cordova.dialogs',
    'ngMeumobi.Cordova.files',
    'ngMeumobi.Cordova.socialSharing',
    'ngMeumobi.Cordova.spinnerDialog',
    'ngMeumobi.Cordova.splashscreen',
    'ngMeumobi.Cordova.push'
  ])
  .factory('meuCordova', cordova);
  
  function cordova(
    meuAnalytics, 
    meuCalendar, 
    meuCallNumber, 
    meuDevice, 
    meuDialogs,
    meuFiles,
    meuSocialSharing,
    meuSpinnerDialog,
    meuSplashscreen
  ) {
	
    var service = {};
	
    service.analytics = meuAnalytics;
    service.calendar = meuCalendar;
    service.callNumber = meuCallNumber; 
    service.device = meuDevice;
    service.dialogs = meuDialogs;
    service.files = meuFiles;
    service.socialSharing = meuSocialSharing;
    service.spinnerDialog = meuSpinnerDialog;
    service.splashscreen = meuSplashscreen;
      
    return service;
  }
})();
(function() {
  'use strict';

  API.$inject = ["$rootScope", "$http", "$log", "$exceptionHandler", "meuHttpWithFallback"];
  angular
  .module('ngMeumobi.Utils')
  .provider('meuCloud', meuCloudProvider)
  .factory('meuAPI', API);
  
  function meuCloudProvider() {
    
    meuCloud.$inject = ["$q", "$window", "$log", "$exceptionHandler", "meuUtils", "meuAPI"];
    var options = {},
        data = {};
    
    this.setOptions = function(opt) {
      angular.extend(options, opt);
    };

    this.setOption = function(name, value) {
      options[name] = value;
    };
    
    this.$get = meuCloud;
    
    function meuCloud($q, $window, $log, $exceptionHandler, meuUtils, meuAPI) {
    
/*
  Helpers
*/
      var Helpers = {
        lookup: function(array) {
          var token = 'id';
          // Identify if it's an array of items (item._id) or category (category.id)
          if (array[0] && array[0].hasOwnProperty('_id'))
            token = '_id';
          return Helpers.lookupByToken(array, token);
        },
        lookupByToken: function(array, token) {
          var lookup = [];
          for (var i = 0, len = array.length; i < len; i++) {
              lookup[array[i][token]] = array[i];
          }
          return lookup;
        },
        isFreshResponse: function(response) {
          var isFallback = response.hasOwnProperty('isFallback') ? response.isFallback : null;
          var unchanged = response.hasOwnProperty('unchanged') ? response.unchanged : null;
        
          return !(unchanged || isFallback);
        },
        getCategoriesTree: function(categories) {
          var children = [];
          children[0] = [];
          for(var key in categories) {
            var parent_id = categories[key].parent_id != null ? categories[key].parent_id : 0;
            if (!children[parent_id])
              children[parent_id] = [];
            children[parent_id].push(categories[key]);
          }
          for(var key in categories) {
            var category = categories[key];
            category.children = [];
            if (children[category.id])
              category.children = children[category.id];
          }
          return children[0];
        }
      };

/****************************************************************/ 
    
      var service = {};

      service.helpers = Helpers;
      service.getCategory = getCategory;
      service.syncPerformance = syncPerformance;
      service.API = meuAPI;
      service.init = init;
      service.getSiteLogoUrl = getSiteLogoUrl;
      service.getSiteProperty = getSiteProperty;
      service.getAssetUrl = getAssetUrl;
    
      return service;
    
      /*
        meuCloud.API.Site.performance()
        .then(function(response) {
          updateData(response);
          if (response.promise)
            return response.promise;
        })
        // If response contains a promise, means is from cache and promise will sync w/ Server
        .then(function(response) {
          updateData(response)
        })
        .catch(function(e) {
          $exceptionHandler(e);
        })
      
      */
      
      function init() {
        if (options.hasOwnProperty('apiUrl'))
          meuAPI.Config.setProperty('apiUrl', options.apiUrl);
        if (options.hasOwnProperty('timeout'))
          meuAPI.Config.setProperty('timeout', options.timeout);
      }
           
      function getCategory(id) {
        try {
          var categories = Helpers.lookup(data.categories);
          if (categories.hasOwnProperty(id)) {
            return categories[id];
          } else {
            return null;
          }
        } catch (e) {
          $exceptionHandler(e);
        };
      }
  
      function getData(property) {
        try {
          return data[property]; 
        } catch (e) {
          $exceptionHandler(e);
          return {};
        }
      }
      
      function getSiteProperty(property) {
        try {
          return data.site[property]; 
        } catch (e) {
          $exceptionHandler(e);
          return {};
        }
      }
      
      function getCategories() {
        return getData('categories');
      }
  
      function setCategories(categories) {
        data.categories = categories;
      }
      
      function setSite(site) {
        data.site = site;
      }
      
      function setVisitor(visitor) {
        data.visitor = visitor;
      }
      
      function getVisitor() {
        return data.visitor;
      }
      
      function getSiteLogoUrl() {
        try {
          return options.cdnUrl + data.site.logo; 
        } catch (e) {
          $exceptionHandler(e);
          return null;
        } 
      }
      
      function getAssetUrl(path) {
        try {
          return options.cdnUrl + path; 
        } catch (e) {
          $exceptionHandler(e);
          return null;
        } 
      }
      
      function setBusiness(business) {
        data.business = business;
      }
      
      function syncPerformance(data) {
        return $q(function(resolve, reject) {
          try {
            setCategories(data.categories);
            setSite(data.site);
            setBusiness(data.business);
            resolve(data);
          } catch (e) {
            $exceptionHandler(e);
            reject(e);
          };
        });
      }
    }
  }
  
  function API($rootScope, $http, $log, $exceptionHandler, meuHttpWithFallback) {
  
    var config = {
      timeout: 10000
    };
        
    var convertJsonAsUriParameters = function(data) {
      var url = Object.keys(data).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]);
      }).join('&');
    
      return url;
    };

    var buildUrl = function(endp) {
      try {
        /*
          If config.domain is null then use domain empty
        config.domain !== null && config.domain != undefined
        */
        var domain = (config.domain) ? config.domain : '';
        
        return config.apiUrl + domain + endp; 
      } catch (e) {
        $exceptionHandler(e);
      }
    };

    var api = (function() {
      return {
        get: function(endp, obj) {
          angular.extend(obj, {timeout: config.timeout});
      
          return meuHttpWithFallback.get(buildUrl(endp), obj);
        },
        post: function(endp, obj) {          
          return $http({
            method: 'POST',
            timeout: config.timeout,
            url: buildUrl(endp),
            data: angular.toJson(obj),
            responseType: 'json',
            headers: {
              'Content-Type': 'application/json'
            }
          });
        },
        put: function(endp, obj) {          
          return $http({
            method: 'PUT',
            timeout: config.timeout,
            url: buildUrl(endp),
            data: angular.toJson(obj),
            responseType: 'json',
            headers: {
              'Content-Type': 'application/json'
            }
          });
        },
        del: function(endp, id) {
          return $http({
            method: 'DELETE',
            timeout: config.timeout,
            url: buildUrl(endp),
            responseType: 'json',
          });
        }
      };
    })();

    var app = {
      Categories: (function() {
        var path = '/categories/';
        return {
          query: function() {
            // TODO: Need to be tested
            return api.get(path, {});
          },
          items: function(category_id, config) {
            return api.get(path + category_id + '/items', config);
          }
        };
      })(),
      Items: (function() {
        var path = '/items/';
        return {
          latest: function() {
            return api.get(path + 'latest', {});
          },
          search: function(obj) {
            var url = path + 'search?' + convertJsonAsUriParameters(obj);
            return api.get(url, {});
          }
        };
      })(),
      Site: (function() {
        var path = '/performance';
        return {
          performance: function() {
            return api.get(path, {});
          }
        };
      })(),
      Login: (function() {
        var path = '/visitors/';
        return {
          signin: function(obj) {
            return api.post(path + 'login', obj);
          },
          get: function() {
            return api.get(path, {});
          },
          save: function(obj) {
            return api.put(path, obj);
          },
          // TODO: Need to be tested
          device: function(obj) {
            return api.post(path + 'devices', obj);
          },
          // TODO: Need to be tested
          update: function(obj) {
            return api.put(path + 'devices/' + obj.uuid);
          },
          reset: function(obj) {
            return api.post(path + 'forgot_password', obj);
          }
        };
      })(),
      Devices: (function() {
        var path = '/devices/';
        return {
          save: function(obj) {
            return api.put(path + obj.uuid, obj);
          } 
        };
      })(),
      Poll: (function() {
        var path = '/items/';
        return {
          submit: function(obj) {
            return api.post(path + obj.id + '/poll', obj.params);
          }
        };
      })(),
      Mail: (function() {
        var path = '/mail/';
        return {
          save: function(obj) {
            return api.post(path, obj);
          }
        };
      })(),
      Config: (function() {
        return {
          setProperties: function(prop) {
            angular.extend(config, prop);
          },
          getProperties: function() {
            return config;
          },
          setProperty: function(name, value) {
            config[name] = value;
          },
          getProperty: function(name) {
            return config[name];
          }
        };
      })()
    };
    
    return app;
  }
})();
/* global angular */
/* eslint no-undef: "error" */
(function () {
  'use strict';

  hrefToJS.$inject = ["$sce", "$sanitize"];
  angular.module('ngMeumobi.Utils.filters', ['ngSanitize'])
  .filter('isEmpty', isEmpty)
  .filter('br2nl', br2nl)
  .filter('striptags', striptags)
  .filter('bytesToSize', bytesToSize)
  .filter('hrefToJS', hrefToJS)
  .filter('capitalize', capitalize);

  function isEmpty() {
    return function (obj) {
      return !Object.keys(obj).length;
    };
  }

  function br2nl() {
    return function (text) {
      return text.replace(/<br\s*[\/]?>/gi, '\n');
    };
  }

  function striptags() {
    return function (text) {
      return angular
      .element('<div/>')
      .html(text)
      .text();
    };
  }
  
  function capitalize() {
    return function(input, scope) {
      if (input!=null)
      input = input.toLowerCase();
      return input.substring(0,1).toUpperCase()+input.substring(1);
    } 
  }
  
  function bytesToSize() {
    return function(bytes) {
      if (bytes == 0) return '0 Byte';
      var k = 1000;
      var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
      var i = Math.floor(Math.log(bytes) / Math.log(k));
      return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];
    }
  }

  function hrefToJS ($sce, $sanitize) {
    return function(text) {
      var regex = /href="([\S]+)"/g;
      var newString = $sanitize(text).replace(regex, "onClick=\"window.open('$1', '_blank', 'location=yes')\"");
      return $sce.trustAsHtml(newString);
    }
  }
})();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlV0aWxzL0xvY2FsU3RvcmFnZS5qcyIsIlV0aWxzL0h0dHBXaXRoRmFsbGJhY2suanMiLCJVdGlscy9IdHRwSW50ZXJjZXB0b3JzLmpzIiwiVXRpbHMvRGV2aWNlUmVhZHkuanMiLCJVdGlscy9BdXRoZW50aWNhdGlvbi5qcyIsIkNvcmRvdmEvU3RhdHVzYmFyLmpzIiwiQ29yZG92YS9TcGxhc2hzY3JlZW4uanMiLCJDb3Jkb3ZhL1NwaW5uZXJEaWFsb2cuanMiLCJDb3Jkb3ZhL1NvY2lhbFNoYXJpbmcuanMiLCJDb3Jkb3ZhL1B1c2guanMiLCJDb3Jkb3ZhL0ZpbGVzLmpzIiwiQ29yZG92YS9EaWFsb2dzLmpzIiwiQ29yZG92YS9EZXZpY2UuanMiLCJDb3Jkb3ZhL0NhbGxOdW1iZXIuanMiLCJDb3Jkb3ZhL0NhbGVuZGFyLmpzIiwiQ29yZG92YS9BbmFseXRpY3MuanMiLCJVdGlscy5qcyIsIkNvcmRvdmEuanMiLCJDbG91ZC5qcyIsIm1ldS1maWx0ZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtFQUNBOztFQUVBO0dBQ0EsT0FBQSxnQ0FBQTtHQUNBLFFBQUEsbUJBQUE7O0VBRUEsU0FBQSxlQUFBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLFlBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGVBQUE7SUFDQSxRQUFBLFdBQUE7O0lBRUEsT0FBQTs7SUFFQSxTQUFBLFVBQUEsS0FBQTtNQUNBLE9BQUEsUUFBQSxTQUFBLGFBQUEsUUFBQTtLQUNBOztJQUVBLFNBQUEsVUFBQSxLQUFBLE9BQUE7TUFDQSxhQUFBLFFBQUEsS0FBQSxRQUFBLE9BQUE7S0FDQTs7SUFFQSxTQUFBLGFBQUEsS0FBQTtNQUNBLGFBQUEsV0FBQTtLQUNBOztJQUVBLFNBQUEsU0FBQSxLQUFBO01BQ0EsT0FBQSxhQUFBLFFBQUEsT0FBQSxPQUFBO0tBQ0E7OztBQ2hDQSxDQUFBLFdBQUE7RUFDQTs7O0VBRUE7R0FDQSxPQUFBLG9DQUFBO0dBQ0EsUUFBQSx1QkFBQTs7RUFFQSxTQUFBLGlCQUFBLElBQUEsTUFBQSxtQkFBQSxPQUFBOzs7SUFHQSxTQUFBLG1CQUFBO0lBQ0EsaUJBQUEsWUFBQTtJQUNBLGlCQUFBLFVBQUEsY0FBQTs7SUFFQSxJQUFBLG1CQUFBLElBQUE7O0lBRUEsSUFBQSx3QkFBQSxTQUFBLGdCQUFBOztNQUVBLGlCQUFBLFFBQUEsU0FBQTtNQUNBLElBQUEsVUFBQSxlQUFBO01BQ0EsZUFBQSxVQUFBLFdBQUEsRUFBQSxPQUFBO01BQ0EsT0FBQTs7O0lBR0EsSUFBQSxjQUFBLFNBQUEsS0FBQSxRQUFBLFVBQUE7TUFDQSxNQUFBLElBQUEsS0FBQTtPQUNBO1FBQ0EsU0FBQSxVQUFBO1VBQ0EsS0FBQSxNQUFBLHNEQUFBLFNBQUE7O1VBRUEsSUFBQSxDQUFBLFNBQUEsT0FBQSxxQkFBQSxTQUFBLFdBQUEsS0FBQTtZQUNBLGFBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQTtjQUNBLE1BQUEsU0FBQTtjQUNBLFFBQUEsU0FBQTtjQUNBLFFBQUEsU0FBQTtjQUNBLFNBQUEsU0FBQTtjQUNBLFlBQUE7Ozs7VUFJQSxJQUFBLFNBQUEsUUFBQSxZQUFBLFNBQUEsT0FBQTtZQUNBLFNBQUEsWUFBQTtVQUNBLFNBQUEsUUFBQTs7UUFFQSxTQUFBLFVBQUE7VUFDQSxLQUFBLE1BQUEsbURBQUEsU0FBQTs7VUFFQSxJQUFBLGlCQUFBLGFBQUEsUUFBQTtVQUNBLElBQUEsZ0JBQUE7WUFDQSxPQUFBLFNBQUEsUUFBQSxzQkFBQTs7OztVQUlBLElBQUEsU0FBQSxPQUFBLFVBQUE7WUFDQSxPQUFBLFNBQUEsUUFBQTtjQUNBLE1BQUEsT0FBQTtjQUNBLFFBQUEsU0FBQTtjQUNBLFNBQUEsU0FBQTtjQUNBLFFBQUEsU0FBQTtjQUNBLFlBQUE7Ozs7O1VBS0EsT0FBQSxTQUFBLE9BQUE7Ozs7O01BS0EsSUFBQSxVQUFBLFNBQUE7O01BRUEsUUFBQSxVQUFBLFNBQUEsSUFBQTtRQUNBLFFBQUEsS0FBQSxTQUFBLFVBQUE7VUFDQSxHQUFBLFNBQUEsTUFBQSxTQUFBLFFBQUEsU0FBQSxTQUFBLFFBQUEsU0FBQTs7UUFFQSxPQUFBOzs7TUFHQSxRQUFBLFFBQUEsU0FBQSxJQUFBO1FBQ0EsUUFBQSxLQUFBLE1BQUEsU0FBQSxVQUFBO1VBQ0EsR0FBQSxTQUFBLE1BQUEsU0FBQSxRQUFBLFNBQUEsU0FBQTs7UUFFQSxPQUFBOzs7TUFHQSxPQUFBOzs7OztJQUtBLGlCQUFBLE1BQUEsU0FBQSxLQUFBLFFBQUE7O01BRUEsSUFBQSxDQUFBLGNBQUE7O1FBRUEsSUFBQSxDQUFBLE9BQUEsVUFBQTtVQUNBLE9BQUEsTUFBQSxJQUFBLEtBQUE7OztRQUdBLE9BQUEsb0JBQUE7Ozs7TUFJQSxJQUFBLFdBQUEsR0FBQTtNQUNBLElBQUEsaUJBQUEsYUFBQSxRQUFBOztNQUVBLElBQUEsZ0JBQUE7O1FBRUEsSUFBQSxrQkFBQSxHQUFBO1FBQ0EsaUJBQUEsc0JBQUE7UUFDQSxJQUFBLFFBQUE7OztRQUdBLFNBQUEsUUFBQSxVQUFBLFVBQUEsU0FBQTtRQUNBLElBQUEsU0FBQSxNQUFBO1VBQ0EsT0FBQSxtQkFBQSxNQUFBLFVBQUE7UUFDQSxlQUFBLFVBQUEsWUFBQSxLQUFBLFFBQUE7UUFDQSxTQUFBLFFBQUE7UUFDQSxPQUFBLFNBQUE7OztNQUdBLE9BQUEsWUFBQSxLQUFBLFFBQUE7OztJQUdBLE9BQUE7R0FDQTs7QUM1SEEsQ0FBQSxXQUFBO0NBQ0E7Ozs7Q0FFQTtFQUNBLE9BQUEsb0NBQUE7RUFDQSxRQUFBLHlCQUFBO0dBQ0EsUUFBQSx1QkFBQTs7Q0FFQSxTQUFBLG1CQUFBLElBQUEsWUFBQSxNQUFBOztFQUVBLElBQUEsY0FBQTs7RUFFQSxPQUFBO0dBQ0EsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBLENBQUEsZUFBQTtVQUNBLFdBQUEsV0FBQTs7O0lBR0EsT0FBQSxVQUFBLEdBQUEsS0FBQTs7R0FFQSxVQUFBLFNBQUEsVUFBQTtJQUNBLElBQUEsRUFBQSxFQUFBLGNBQUE7S0FDQSxXQUFBLFdBQUE7OztJQUdBLE9BQUEsWUFBQSxHQUFBLEtBQUE7O0dBRUEsY0FBQSxTQUFBLFNBQUE7SUFDQSxJQUFBLEVBQUEsRUFBQSxjQUFBO0tBQ0EsV0FBQSxXQUFBOzs7SUFHQSxPQUFBLEdBQUEsT0FBQTs7R0FFQSxlQUFBLFNBQUEsVUFBQTtJQUNBLElBQUEsRUFBQSxFQUFBLGNBQUE7S0FDQSxXQUFBLFdBQUE7OztJQUdBLE9BQUEsR0FBQSxPQUFBOzs7OztFQUtBLFNBQUEsaUJBQUEsSUFBQSxZQUFBLE1BQUE7O0dBRUEsT0FBQTtJQUNBLFNBQUEsU0FBQSxRQUFBOztLQUVBLE9BQUEsVUFBQSxHQUFBLEtBQUE7O0lBRUEsY0FBQSxTQUFBLFNBQUE7O0tBRUEsT0FBQSxHQUFBLE9BQUE7O0lBRUEsVUFBQSxTQUFBLFVBQUE7O0tBRUEsT0FBQSxZQUFBLEdBQUEsS0FBQTs7SUFFQSxlQUFBLFNBQUEsVUFBQTtLQUNBLEtBQUEsTUFBQTtRQUNBLEtBQUEsTUFBQSxzQkFBQSxTQUFBO0tBQ0EsS0FBQSxNQUFBO0tBQ0EsS0FBQSxNQUFBO0tBQ0EsSUFBQSxZQUFBLFNBQUEsV0FBQSxDQUFBLEdBQUE7UUFDQSxJQUFBLFlBQUEsU0FBQSxXQUFBLEdBQUE7S0FDQSxJQUFBLFlBQUEsU0FBQSxXQUFBLEtBQUE7S0FDQSxJQUFBLFlBQUEsU0FBQSxXQUFBLEtBQUE7VUFDQSxXQUFBLFdBQUE7O0tBRUEsSUFBQSxZQUFBLFNBQUEsV0FBQSxLQUFBO0tBQ0EsSUFBQSxZQUFBLFNBQUEsVUFBQSxLQUFBOztLQUVBLE9BQUEsR0FBQSxPQUFBOzs7OztBQ3pFQSxDQUFBLFdBQUE7Q0FDQTs7O0NBRUE7RUFDQSxPQUFBLCtCQUFBO0VBQ0EsUUFBQSxrQkFBQTs7Ozs7Ozs7OztDQVVBLFNBQUEsWUFBQSxNQUFBLFNBQUE7RUFDQSxPQUFBLFNBQUEsTUFBQTtHQUNBLElBQUEsUUFBQSxTQUFBLFFBQUEsVUFBQTs7UUFFQSxTQUFBLGlCQUFBLGVBQUEsU0FBQSxPQUFBO0tBQ0E7T0FDQTs7VUFFQTtJQUNBOzs7OztBQ3hCQSxDQUFBLFdBQUE7RUFDQTs7O0VBRUE7R0FDQSxPQUFBLGtDQUFBO0dBQ0EsUUFBQSxxQkFBQTs7Ozs7OztFQU9BLFNBQUEsZUFBQSxPQUFBLFlBQUEsVUFBQTs7SUFFQSxJQUFBLFVBQUE7SUFDQSxRQUFBLGlCQUFBLFVBQUEsTUFBQTs7OztNQUlBLFdBQUEsT0FBQTs7TUFFQSxNQUFBLFNBQUEsUUFBQSxPQUFBLHFCQUFBLEtBQUE7TUFDQSxhQUFBLFVBQUEsUUFBQSxPQUFBLFdBQUE7OztJQUdBLFFBQUEsbUJBQUEsWUFBQTtNQUNBLFdBQUEsT0FBQTtNQUNBLGFBQUEsV0FBQTtNQUNBLE9BQUEsTUFBQSxTQUFBLFFBQUEsT0FBQTs7O0lBR0EsT0FBQTs7O0FDL0JBLENBQUEsV0FBQTtFQUNBOzs7RUFFQTtHQUNBLE9BQUEsNkJBQUE7R0FDQSxRQUFBLGdCQUFBOzs7Ozs7Ozs7OztFQVdBLFNBQUEsVUFBQSxJQUFBLFNBQUEsTUFBQSxtQkFBQTs7SUFFQSxJQUFBLFVBQUE7SUFDQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxZQUFBO0lBQ0EsUUFBQSxhQUFBO0lBQ0EsUUFBQSxPQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxXQUFBLEtBQUE7TUFDQSxRQUFBLE9BQUEsU0FBQTs7O0lBR0EsU0FBQSxVQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0lBR0EsU0FBQSxPQUFBO01BQ0EsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7Ozs7QUMxQ0EsQ0FBQSxXQUFBO0VBQ0E7OztFQUVBO0dBQ0EsT0FBQSxrQ0FBQTtHQUNBLFFBQUEsbUJBQUE7Ozs7Ozs7Ozs7O0VBV0EsU0FBQSxhQUFBLElBQUEsU0FBQSxNQUFBLG1CQUFBOztJQUVBLE9BQUE7TUFDQSxNQUFBLFdBQUE7UUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7VUFDQSxJQUFBO1lBQ0EsSUFBQSxRQUFBLFVBQUEsY0FBQTtjQUNBLFFBQUEsVUFBQSxhQUFBO2NBQ0E7O1lBRUEsT0FBQSxHQUFBO1lBQ0Esa0JBQUE7WUFDQSxPQUFBO1dBQ0E7Ozs7TUFJQSxNQUFBLFdBQUE7UUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7VUFDQSxJQUFBO1lBQ0EsSUFBQSxRQUFBLFVBQUEsY0FBQTtjQUNBLFFBQUEsVUFBQSxhQUFBO2NBQ0E7O1lBRUEsT0FBQSxHQUFBO1lBQ0Esa0JBQUE7WUFDQSxPQUFBO1dBQ0E7Ozs7OztBQzNDQSxDQUFBLFdBQUE7RUFDQTs7O0VBRUE7R0FDQSxPQUFBLG1DQUFBO0dBQ0EsUUFBQSxvQkFBQTs7Ozs7Ozs7Ozs7RUFXQSxTQUFBLGNBQUEsSUFBQSxTQUFBLE1BQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsT0FBQTtJQUNBLFFBQUEsT0FBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEsT0FBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFVBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7VUFFQSxJQUFBLFNBQUE7WUFDQSxRQUFBO1lBQ0E7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7OztLQUdBOztJQUVBLFNBQUEsT0FBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFVBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7VUFFQSxJQUFBLFNBQUE7WUFDQSxRQUFBO2lCQUNBO1lBQ0EsTUFBQSxJQUFBLE1BQUE7O1VBRUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7S0FHQTs7O0FDMURBLENBQUEsV0FBQTtDQUNBOztDQUVBO0VBQ0EsT0FBQSxtQ0FBQTtFQUNBLFFBQUEsb0JBQUEsQ0FBQSxNQUFBLFdBQUEsbUJBQUEsZUFBQSxRQUFBOzs7Ozs7Ozs7Ozs7O0VBYUEsU0FBQSxjQUFBLElBQUEsU0FBQSxXQUFBLE9BQUEsTUFBQSxtQkFBQTs7SUFFQSxJQUFBLFVBQUE7SUFDQSxJQUFBLFVBQUE7TUFDQSxTQUFBOzs7SUFHQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFFBQUE7SUFDQSxRQUFBLDZCQUFBOztJQUVBLE9BQUE7O0lBRUEsU0FBQSxXQUFBLFNBQUE7TUFDQSxRQUFBLE9BQUEsU0FBQTs7O0lBR0EsU0FBQSxVQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0VBR0EsU0FBQSwyQkFBQSxVQUFBO01BQ0EsSUFBQSxTQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O01BRUEsT0FBQSwyQkFBQSxVQUFBLHdCQUFBLGdCQUFBLGdCQUFBLFdBQUEsQ0FBQSxLQUFBLE1BQUE7OztJQUdBLFNBQUEsVUFBQSxNQUFBOztHQUVBLElBQUEsU0FBQTtLQUNBLFNBQUEsS0FBQTtRQUNBLFNBQUEsS0FBQTtRQUNBLE9BQUE7UUFDQSxLQUFBLEtBQUEsZUFBQSxVQUFBLEtBQUEsT0FBQTs7O01BR0EsSUFBQSxLQUFBLGNBQUEsS0FBQSxXQUFBLFNBQUEsR0FBQTtJQUNBLE9BQUEsTUFBQSxLQUFBLEtBQUEsV0FBQSxHQUFBOzs7R0FHQSxPQUFBLE1BQUE7OztFQUdBLFNBQUEsV0FBQSxPQUFBOztHQUVBLElBQUEsU0FBQTtLQUNBLFNBQUEsTUFBQTtRQUNBLFNBQUEsTUFBQTtRQUNBLE9BQUE7UUFDQSxLQUFBLE1BQUE7Ozs7OztHQU1BLElBQUEsTUFBQSxlQUFBLGFBQUE7SUFDQSxPQUFBLE1BQUEsS0FBQSxNQUFBO0lBQ0EsT0FBQSxNQUFBO1VBQ0EsSUFBQSxNQUFBLGNBQUEsTUFBQSxXQUFBLFNBQUEsR0FBQTtJQUNBLE9BQUEsTUFBQSxLQUFBLE1BQUEsV0FBQSxHQUFBOzs7R0FHQSxPQUFBLE1BQUE7OztFQUdBLFNBQUEsTUFBQSxRQUFBOzs7Ozs7Ozs7OztNQVdBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTs7UUFFQSxJQUFBLFdBQUE7VUFDQSxTQUFBLFNBQUEsUUFBQTtZQUNBLFFBQUE7O1VBRUEsTUFBQSxTQUFBLEtBQUE7WUFDQSxNQUFBLElBQUEsTUFBQTs7OztRQUlBLElBQUE7VUFDQSxJQUFBLFNBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7T0FFQSxJQUFBLFFBQUE7WUFDQSxJQUFBLFFBQUEsU0FBQTtVQUNBLE9BQUEsV0FBQSxRQUFBOzs7WUFHQSxPQUFBLFVBQUEsT0FBQSxXQUFBLFVBQUEsTUFBQSxPQUFBO1lBQ0EsT0FBQSxVQUFBLE9BQUEsV0FBQSxVQUFBLE1BQUEsT0FBQTs7WUFFQSxPQUFBLGlCQUFBLFFBQUEsU0FBQSxTQUFBLFNBQUE7Y0FDQTtTQUNBLE1BQUEsSUFBQSxNQUFBOztVQUVBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOzs7OztBQzlIQSxDQUFBLFdBQUE7Q0FDQTs7OztDQUVBO0VBQ0EsT0FBQSwwQkFBQTtFQUNBLFFBQUEsYUFBQTtFQUNBLFFBQUEsYUFBQTs7Ozs7O0VBTUEsU0FBQSxjQUFBLE1BQUEsU0FBQSxXQUFBLG1CQUFBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLFNBQUE7SUFDQSxRQUFBLFdBQUE7O0lBRUEsT0FBQTs7SUFFQSxJQUFBO0lBQ0EsSUFBQTs7SUFFQSxTQUFBLE9BQUEsR0FBQSxHQUFBO01BQ0Esc0JBQUE7TUFDQSxrQkFBQTtLQUNBOzs7SUFHQSxTQUFBLFNBQUEsU0FBQSxNQUFBOztNQUVBLElBQUE7UUFDQSxJQUFBLG1CQUFBLFFBQUEsVUFBQSxRQUFBLFlBQUEsUUFBQSxRQUFBLFFBQUE7O1FBRUEsSUFBQSxrQkFBQTs7VUFFQSxVQUFBLEdBQUEscUJBQUEsU0FBQSxPQUFBO1lBQ0EsSUFBQSxlQUFBLE1BQUE7Ozs7Ozs7OztZQVNBLEtBQUEsTUFBQTtZQUNBLEtBQUEsTUFBQTs7O1VBR0EsaUJBQUEsY0FBQTtZQUNBLFdBQUE7WUFDQSxVQUFBOzs7O1VBSUEsaUJBQUE7WUFDQSxTQUFBLFFBQUE7Y0FDQSxJQUFBLFVBQUE7O2NBRUEsUUFBQSxRQUFBLE9BQUE7Y0FDQSxRQUFBOztZQUVBLFNBQUEsUUFBQTtjQUNBLE1BQUEsSUFBQSxNQUFBO2NBQ0EsS0FBQTs7OztVQUlBLGlCQUFBLDhCQUFBO2VBQ0E7VUFDQSxNQUFBLElBQUEsTUFBQTs7UUFFQSxPQUFBLE9BQUE7UUFDQSxrQkFBQTs7S0FFQTs7Ozs7Ozs7Q0FRQSxTQUFBLGNBQUEsTUFBQSxTQUFBLG1CQUFBLFlBQUEsSUFBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxTQUFBO0lBQ0EsUUFBQSxXQUFBO0lBQ0EsUUFBQSxVQUFBO0lBQ0EsUUFBQSxrQkFBQTs7SUFFQSxPQUFBOztJQUVBLElBQUE7RUFDQSxJQUFBOztFQUVBLFNBQUEsT0FBQSxHQUFBLEdBQUE7R0FDQSxzQkFBQTtHQUNBLFFBQUE7R0FDQTs7Ozs7Ozs7Ozs7OztJQWFBLFNBQUEsUUFBQSxLQUFBLE9BQUE7TUFDQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBO1VBQ0EsSUFBQSxtQkFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztVQUVBLElBQUEsa0JBQUE7WUFDQSxpQkFBQSxRQUFBLEtBQUE7aUJBQ0E7WUFDQSxNQUFBLElBQUEsTUFBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7OztJQUlBLFNBQUEsZ0JBQUEsTUFBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLG1CQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O1VBRUEsSUFBQSxrQkFBQTtZQUNBLGlCQUFBLGdCQUFBO2lCQUNBO1lBQ0EsTUFBQSxJQUFBLE1BQUE7O1VBRUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBO1NBQ0E7Ozs7SUFJQSxTQUFBLFNBQUEsU0FBQSxPQUFBO01BQ0EsSUFBQTtRQUNBLElBQUEsbUJBQUEsUUFBQSxXQUFBLFFBQUEsUUFBQTs7UUFFQSxJQUFBLGtCQUFBO1VBQ0EsaUJBQUEsU0FBQTs7VUFFQSxpQkFBQSxzQkFBQSxVQUFBLGNBQUE7WUFDQSxLQUFBO2NBQ0E7Z0JBQ0EsS0FBQSxVQUFBLGNBQUEsTUFBQTs7O1VBR0EsaUJBQUEsZUFBQSxVQUFBLGNBQUE7WUFDQSxLQUFBO2NBQ0EsK0JBQUEsS0FBQSxVQUFBOztZQUVBLElBQUEsVUFBQTtZQUNBLFFBQUEsUUFBQSxhQUFBO1lBQ0EsUUFBQSxPQUFBLGFBQUE7O1lBRUEsUUFBQTs7O1VBR0EsaUJBQUEsNkJBQUEsVUFBQSxVQUFBO1lBQ0EsS0FBQTtjQUNBLGlDQUFBLEtBQUEsVUFBQTs7WUFFQSxXQUFBLE1BQUEscUJBQUE7Ozs7O1VBS0EsaUJBQUEsMkNBQUE7WUFDQTtZQUNBO1lBQ0EsS0FBQSxNQUFBLGtDQUFBOzs7VUFHQSxpQkFBQSxRQUFBLFNBQUEsTUFBQTs7WUFFQSxLQUFBLE1BQUEsb0JBQUEsUUFBQSxPQUFBOztlQUVBO1VBQ0EsTUFBQSxJQUFBLE1BQUE7O1FBRUEsT0FBQSxPQUFBO1FBQ0Esa0JBQUE7O0tBRUE7OztBQ3RNQSxDQUFBLFlBQUE7RUFDQTs7Ozs7RUFFQTtLQUNBLE9BQUEsMkJBQUEsQ0FBQTtLQUNBLFNBQUEsU0FBQTtNQUNBLG1CQUFBO1FBQ0EsT0FBQTtRQUNBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsVUFBQTs7TUFFQSxhQUFBO1FBQ0EsT0FBQTtRQUNBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsVUFBQTs7TUFFQSxzQ0FBQTtRQUNBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsT0FBQTtRQUNBLFdBQUE7UUFDQSxVQUFBOztNQUVBLDRCQUFBO1FBQ0EsT0FBQTtRQUNBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsVUFBQTs7TUFFQSxvQkFBQTtRQUNBLE9BQUE7UUFDQSxPQUFBO1FBQ0EsV0FBQTtRQUNBLFVBQUE7O01BRUEsY0FBQTtRQUNBLE9BQUE7UUFDQSxPQUFBO1FBQ0EsV0FBQTtRQUNBLFdBQUE7UUFDQSxVQUFBOztNQUVBLGFBQUE7UUFDQSxPQUFBO1FBQ0EsT0FBQTtRQUNBLFdBQUE7UUFDQSxXQUFBO1FBQ0EsVUFBQTs7TUFFQSxpQ0FBQTtRQUNBLE9BQUE7UUFDQSxPQUFBO1FBQ0EsV0FBQTtRQUNBLFVBQUE7O01BRUEscUVBQUE7UUFDQSxPQUFBO1FBQ0EsT0FBQTtRQUNBLFdBQUE7UUFDQSxVQUFBOzs7S0FHQSxPQUFBLG1CQUFBO0tBQ0EsT0FBQSxrQkFBQTtLQUNBLE9BQUEsa0JBQUE7S0FDQSxTQUFBLFlBQUE7O0VBRUEsU0FBQSxnQkFBQSxPQUFBO0lBQ0EsT0FBQSxVQUFBLE1BQUE7TUFDQSxPQUFBLE1BQUEsUUFBQSxNQUFBLE1BQUEsUUFBQTs7OztFQUlBLFNBQUEsZUFBQSxPQUFBO0lBQ0EsT0FBQSxVQUFBLE1BQUE7TUFDQSxPQUFBLE1BQUEsUUFBQSxNQUFBLE1BQUEsUUFBQTs7OztFQUlBLFNBQUEsZUFBQSxPQUFBO0lBQ0EsT0FBQSxVQUFBLE1BQUE7TUFDQSxPQUFBLE1BQUEsU0FBQSxNQUFBLE1BQUE7VUFDQSxNQUFBLE1BQUE7VUFDQTs7O0VBR0EsU0FBQSxRQUFBO0lBQ0EsSUFBQSxXQUFBO0lBQ0EsSUFBQSxnQkFBQTtNQUNBLFFBQUE7TUFDQSxVQUFBO1FBQ0EsYUFBQTs7TUFFQSxXQUFBO1FBQ0EsVUFBQTtRQUNBLGFBQUE7UUFDQSxZQUFBOzs7SUFHQSxLQUFBLGFBQUEsVUFBQSxTQUFBO01BQ0EsUUFBQSxPQUFBLFNBQUE7OztJQUdBLEtBQUEsWUFBQSxVQUFBLE1BQUEsT0FBQTtNQUNBLFFBQUEsUUFBQTs7O0lBR0EsS0FBQSxrREFBQSxVQUFBLElBQUEsTUFBQSxTQUFBLE9BQUEsTUFBQTtNQUNBLFNBQUEsWUFBQSxHQUFBO01BQ0EsU0FBQSxXQUFBLFNBQUEsVUFBQTs7TUFFQSxJQUFBLE1BQUE7TUFDQSxJQUFBLFVBQUE7Ozs7OztNQU1BLElBQUEsbUJBQUEsVUFBQSxHQUFBOzs7Ozs7UUFNQSxRQUFBLEVBQUE7VUFDQSxLQUFBLFVBQUE7WUFDQSxFQUFBLFVBQUE7WUFDQTtVQUNBLEtBQUEsVUFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxVQUFBO1lBQ0EsRUFBQSxVQUFBO1lBQ0E7VUFDQSxLQUFBLFVBQUE7WUFDQSxFQUFBLFVBQUE7WUFDQTtVQUNBLEtBQUEsVUFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxVQUFBO1lBQ0EsRUFBQSxVQUFBO1lBQ0E7VUFDQSxLQUFBLFVBQUE7WUFDQSxFQUFBLFVBQUE7WUFDQTtVQUNBLEtBQUEsVUFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxVQUFBO1lBQ0EsRUFBQSxVQUFBO1lBQ0E7VUFDQSxLQUFBLFVBQUE7WUFDQSxFQUFBLFVBQUE7WUFDQTtVQUNBLEtBQUEsVUFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxVQUFBO1lBQ0EsRUFBQSxVQUFBO1lBQ0E7VUFDQTtZQUNBLEVBQUEsVUFBQTtZQUNBOztRQUVBLEtBQUEsTUFBQSxZQUFBLEVBQUE7O1FBRUEsT0FBQTs7O01BR0EsSUFBQSwyQkFBQSxVQUFBLEdBQUE7Ozs7O1FBS0EsUUFBQSxFQUFBO1VBQ0EsS0FBQSxrQkFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxrQkFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxrQkFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxrQkFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0EsS0FBQSxrQkFBQTtZQUNBLEVBQUEsVUFBQTtZQUNBO1VBQ0E7WUFDQSxFQUFBLFVBQUE7WUFDQTs7UUFFQSxLQUFBLE1BQUEsWUFBQSxFQUFBOztRQUVBLE9BQUE7OztNQUdBLElBQUEsY0FBQSxVQUFBLE1BQUE7UUFDQSxJQUFBLE1BQUEsS0FBQSxhQUFBOztRQUVBLElBQUEsQ0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBLE1BQUEsTUFBQSxLQUFBLE1BQUE7O1FBRUEsSUFBQSxPQUFBLEtBQUEsU0FBQTs7UUFFQSxJQUFBLENBQUEsTUFBQTtVQUNBLE9BQUEsSUFBQSxLQUFBO2VBQ0E7VUFDQSxPQUFBLEtBQUEsUUFBQTs7O1FBR0EsT0FBQSxPQUFBLE1BQUE7OztNQUdBLElBQUEsNkJBQUEsWUFBQTs7Ozs7UUFLQSxJQUFBLE1BQUE7UUFDQSxJQUFBLFVBQUEsUUFBQSxTQUFBLGFBQUEsYUFBQTs7UUFFQSxPQUFBLFFBQUE7VUFDQSxPQUFBLEtBQUEsU0FBQSxJQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztVQWlCQSxLQUFBOzs7Ozs7TUFNQSxJQUFBLHNCQUFBLFVBQUEsVUFBQSxTQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7UUFDQSxRQUFBO1VBQ0E7VUFDQSxVQUFBLFdBQUE7O1lBRUEsVUFBQTtjQUNBO2NBQ0EsRUFBQSxRQUFBLE1BQUEsV0FBQTtjQUNBLFVBQUEsVUFBQTtnQkFDQSxFQUFBLFFBQUE7O2NBRUEsVUFBQSxPQUFBO2dCQUNBLEtBQUEsTUFBQTtnQkFDQSxRQUFBLElBQUEsaUJBQUE7Z0JBQ0EsRUFBQSxPQUFBOzs7O1VBSUEsVUFBQSxPQUFBO1lBQ0EsS0FBQSxNQUFBO1lBQ0EsUUFBQSxJQUFBLGlCQUFBO1lBQ0EsRUFBQSxPQUFBOzs7UUFHQSxPQUFBLEVBQUE7Ozs7TUFJQSxJQUFBLGtCQUFBLFVBQUEsVUFBQTtRQUNBLElBQUEsV0FBQTtRQUNBLElBQUEsT0FBQSxZQUFBLFdBQUE7VUFDQSxXQUFBLFFBQUEsS0FBQTtlQUNBO1VBQ0EsV0FBQSxRQUFBLEtBQUE7O1FBRUEsT0FBQTtXQUNBLG9CQUFBLFVBQUEsUUFBQTtXQUNBLEtBQUE7OztNQUdBLElBQUEsY0FBQSxVQUFBLFVBQUE7UUFDQSxPQUFBLFFBQUEsY0FBQSxNQUFBOzs7O01BSUEsSUFBQSxVQUFBLFVBQUEsTUFBQTtRQUNBLE1BQUEsS0FBQSxRQUFBO1FBQ0EsYUFBQSxXQUFBLFFBQUEsT0FBQTs7OztNQUlBLElBQUEsYUFBQSxVQUFBLElBQUE7UUFDQSxPQUFBLE1BQUE7UUFDQSxhQUFBLFdBQUEsUUFBQSxPQUFBOzs7O01BSUEsSUFBQSxlQUFBLFVBQUEsTUFBQTtRQUNBLElBQUEsSUFBQSxHQUFBO1FBQ0EsUUFBQTtVQUNBO1VBQ0EsVUFBQSxPQUFBO1lBQ0EsRUFBQSxRQUFBOztVQUVBLFVBQUEsT0FBQTtZQUNBLEtBQUEsTUFBQTtZQUNBLFFBQUEsSUFBQSxpQkFBQTtZQUNBLEVBQUEsT0FBQTs7O1FBR0EsT0FBQSxFQUFBOzs7TUFHQSxJQUFBLGVBQUEsVUFBQSxVQUFBOzs7Ozs7UUFNQSxPQUFBLE1BQUEsYUFBQSxDQUFBLFVBQUEsVUFBQSxTQUFBOzs7TUFHQSxJQUFBLGdCQUFBLFVBQUEsVUFBQTtRQUNBLE9BQUEsQ0FBQSxDQUFBLGNBQUE7OztNQUdBLElBQUEsZ0JBQUEsVUFBQSxVQUFBO1FBQ0EsSUFBQSxJQUFBLGFBQUEsV0FBQTtVQUNBLE9BQUEsU0FBQTtlQUNBLElBQUEsSUFBQSxjQUFBLFdBQUE7VUFDQSxPQUFBLFNBQUE7ZUFDQTtVQUNBLE9BQUEsU0FBQTs7Ozs7Ozs7O01BU0EsUUFBQSxXQUFBO01BQ0EsUUFBQSxlQUFBO01BQ0EsUUFBQSxTQUFBO01BQ0EsUUFBQSxPQUFBO01BQ0EsUUFBQSxPQUFBO01BQ0EsUUFBQSxpQkFBQTtNQUNBLFFBQUEsaUJBQUE7TUFDQSxRQUFBLFFBQUE7O01BRUEsT0FBQTs7Ozs7OztNQU9BLFNBQUEsZUFBQSxNQUFBO1FBQ0EsT0FBQSxLQUFBLFFBQUEsUUFBQSxNQUFBLEtBQUEsTUFBQSxXQUFBOzs7TUFHQSxTQUFBLFFBQUE7UUFDQSxJQUFBLDZCQUFBLEtBQUE7Ozs7O1FBS0EsT0FBQTs7O01BR0EsU0FBQSxPQUFBO1FBQ0EsT0FBQSxTQUFBLFNBQUEsS0FBQTs7Ozs7TUFLQSxTQUFBLGVBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7O1FBRUEsUUFBQSxRQUFBLFlBQUEsS0FBQSxLQUFBLE1BQUE7VUFDQSxPQUFBLFVBQUEsR0FBQTtZQUNBLEVBQUEsT0FBQTs7VUFFQSxTQUFBLFlBQUE7WUFDQSxFQUFBOzs7UUFHQSxPQUFBLEVBQUE7OztNQUdBLFNBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7UUFDQSxJQUFBLFdBQUE7VUFDQSxTQUFBLFVBQUEsT0FBQTtZQUNBLGVBQUEsTUFBQSxXQUFBLEtBQUEsTUFBQTtjQUNBLFlBQUE7Z0JBQ0EsRUFBQTs7Y0FFQSxVQUFBLEdBQUE7Z0JBQ0EsRUFBQSxPQUFBOzs7O1VBSUEsTUFBQSxVQUFBLEdBQUE7WUFDQSxFQUFBLE9BQUE7Ozs7UUFJQSxPQUFBLElBQUEsZ0JBQUEsS0FBQSxNQUFBLEtBQUE7Ozs7Ozs7Ozs7Ozs7O01BY0EsU0FBQSxTQUFBLE1BQUE7UUFDQSxJQUFBLElBQUEsR0FBQTtRQUNBLElBQUEsS0FBQSxJQUFBO1FBQ0EsSUFBQSxNQUFBLFVBQUEsS0FBQTs7UUFFQSxLQUFBLFNBQUEsU0FBQTtRQUNBLGNBQUEsS0FBQSxRQUFBOztRQUVBLEdBQUEsYUFBQSxVQUFBLFVBQUE7VUFDQSxFQUFBLE9BQUE7OztRQUdBLEVBQUEsUUFBQSxRQUFBLFlBQUE7VUFDQSxHQUFBOzs7UUFHQSxJQUFBLGNBQUE7VUFDQSxTQUFBLFVBQUEsV0FBQTtZQUNBLEtBQUEsU0FBQSxTQUFBO1lBQ0EsSUFBQSxRQUFBO1lBQ0EsT0FBQSxjQUFBLEtBQUE7WUFDQSxFQUFBLFFBQUE7O1VBRUEsTUFBQSxVQUFBLE9BQUE7WUFDQSxLQUFBLE1BQUE7WUFDQSxLQUFBLFNBQUEsU0FBQTtZQUNBLFFBQUEsSUFBQSx5QkFBQTtZQUNBLE9BQUEsY0FBQSxLQUFBO1lBQ0EsRUFBQSxPQUFBOzs7UUFHQSxPQUFBLElBQUEsZ0JBQUEsS0FBQSxNQUFBLEtBQUE7Ozs7Ozs7Ozs7Ozs7O01BY0EsU0FBQSxPQUFBLE1BQUE7UUFDQSxJQUFBLElBQUEsR0FBQTs7UUFFQSxJQUFBLFlBQUE7VUFDQSxTQUFBLFVBQUEsUUFBQTtZQUNBLElBQUEsV0FBQSxLQUFBO1lBQ0EsS0FBQSxTQUFBLFNBQUE7WUFDQSxFQUFBLFFBQUE7O1VBRUEsTUFBQSxVQUFBLE9BQUE7WUFDQSxFQUFBLE9BQUE7Ozs7UUFJQSxPQUFBLElBQUEsZ0JBQUEsS0FBQSxNQUFBLEtBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7TUFnQkEsU0FBQSxhQUFBLE1BQUE7UUFDQSxPQUFBLFNBQUEsU0FBQSxLQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzdmQSxDQUFBLFdBQUE7Q0FDQTs7O0NBRUE7RUFDQSxPQUFBLDZCQUFBO0VBQ0EsUUFBQSxjQUFBOzs7Ozs7OztFQVFBLFNBQUEsUUFBQSxJQUFBLFNBQUEsbUJBQUE7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsUUFBQTtJQUNBLFFBQUEsVUFBQTtJQUNBLFFBQUEsUUFBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEsTUFBQSxTQUFBLE9BQUEsWUFBQTtNQUNBLElBQUEsSUFBQSxHQUFBOztNQUVBLElBQUEsQ0FBQSxRQUFBLFVBQUEsY0FBQTtRQUNBLFFBQUEsTUFBQTtRQUNBLEVBQUE7YUFDQTtRQUNBLFVBQUEsYUFBQSxNQUFBLFNBQUEsWUFBQTtVQUNBLEVBQUE7V0FDQSxPQUFBOzs7TUFHQSxPQUFBLEVBQUE7S0FDQTs7Ozs7O0lBTUEsU0FBQSxRQUFBLFNBQUEsT0FBQSxjQUFBO01BQ0EsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTtVQUNBLFFBQUEsQ0FBQSxRQUFBLFVBQUEsVUFBQSxRQUFBOztVQUVBLElBQUEsQ0FBQSxRQUFBLFVBQUEsY0FBQTtZQUNBLElBQUEsUUFBQSxRQUFBLFVBQUE7Y0FDQSxRQUFBO21CQUNBO2NBQ0EsUUFBQTs7aUJBRUE7WUFDQSxVQUFBLGFBQUEsUUFBQSxTQUFBLFVBQUEsYUFBQTtjQUNBLFFBQUE7ZUFDQSxPQUFBOztVQUVBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOztLQUVBOztJQUVBLFNBQUEsTUFBQSxTQUFBO01BQ0EsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTtPQUNBLElBQUEsUUFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztPQUVBLElBQUEsT0FBQTtZQUNBLE1BQUEsZUFBQSxTQUFBLFVBQUEsVUFBQTtjQUNBLFFBQUE7ZUFDQSxVQUFBLE9BQUE7Y0FDQSxPQUFBOztpQkFFQTtZQUNBLE1BQUE7O1VBRUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBO1NBQ0E7O0tBRUE7OztBQ3BGQSxDQUFBLFdBQUE7Q0FDQTs7O0NBRUE7RUFDQSxPQUFBLDRCQUFBO0VBQ0EsUUFBQSxhQUFBOzs7Ozs7Ozs7Ozs7Ozs7O0NBZ0JBLFNBQUEsVUFBQSxNQUFBLFNBQUEsSUFBQSxtQkFBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSxVQUFBO0lBQ0EsUUFBQSxrQkFBQTtJQUNBLFFBQUEsZ0JBQUE7O0lBRUEsT0FBQTs7Ozs7O0lBTUEsU0FBQSxVQUFBOztNQUVBLE9BQUEsR0FBQSxVQUFBLFNBQUEsUUFBQTs7UUFFQSxJQUFBLFVBQUE7VUFDQSxTQUFBLFNBQUEsTUFBQTtZQUNBLFFBQUE7O1VBRUEsTUFBQSxXQUFBO1lBQ0EsTUFBQSxJQUFBLE1BQUE7OztRQUdBLElBQUE7VUFDQSxJQUFBLGlCQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O1VBRUEsSUFBQSxnQkFBQTtZQUNBLGVBQUEsSUFBQSxRQUFBLFNBQUEsUUFBQTtpQkFDQTtZQUNBLE1BQUEsSUFBQSxNQUFBOztVQUVBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7Ozs7Ozs7O0lBU0EsU0FBQSxrQkFBQTs7TUFFQSxPQUFBLEdBQUEsU0FBQSxTQUFBLFFBQUE7UUFDQSxJQUFBLGFBQUE7O1FBRUEsSUFBQTs7VUFFQSxJQUFBLE9BQUEsV0FBQSxhQUFBOztRQUVBLFdBQUEsUUFBQSxPQUFBO1FBQ0EsV0FBQSxXQUFBLE9BQUE7UUFDQSxXQUFBLG1CQUFBLE9BQUE7UUFDQSxXQUFBLGVBQUEsT0FBQTtpQkFDQTs7UUFFQSxXQUFBLFFBQUEsVUFBQTs7VUFFQSxRQUFBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7Ozs7Ozs7SUFTQSxTQUFBLGdCQUFBOztNQUVBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUEsYUFBQTs7UUFFQSxJQUFBOztVQUVBLElBQUEsT0FBQSxlQUFBLGFBQUE7O1FBRUEsV0FBQSxjQUFBLFdBQUE7UUFDQSxXQUFBLFlBQUEsV0FBQTtpQkFDQTtZQUNBLE1BQUEsSUFBQSxNQUFBOzs7VUFHQSxRQUFBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7Ozs7QUNqSEEsQ0FBQSxXQUFBO0VBQ0E7Ozs7O0VBRUE7R0FDQSxPQUFBLGdDQUFBO0dBQ0EsUUFBQSxxQkFBQTtHQUNBLFFBQUEsY0FBQTtHQUNBLFFBQUEsaUJBQUE7Ozs7Ozs7Ozs7Ozs7RUFhQSxTQUFBLGtCQUFBLE1BQUEsU0FBQSxJQUFBLG1CQUFBOztJQUVBLE9BQUEsU0FBQSxRQUFBLGtCQUFBOztNQUVBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFFBQUEsWUFBQSxtQkFBQTtZQUNBLG1CQUFBOztVQUVBLElBQUEsZ0JBQUE7WUFDQSxTQUFBLFNBQUEsUUFBQTtjQUNBLFFBQUE7O1lBRUEsTUFBQSxTQUFBLFFBQUE7Y0FDQSxLQUFBLE1BQUE7Y0FDQSxPQUFBOzs7O1VBSUEsSUFBQSxhQUFBLFFBQUEsV0FBQSxRQUFBLFFBQUE7O1VBRUEsSUFBQSxZQUFBO1lBQ0EsV0FBQSxXQUFBLGNBQUEsU0FBQSxjQUFBLE1BQUEsUUFBQTtpQkFDQTtZQUNBLE1BQUEsSUFBQSxNQUFBOztVQUVBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTtTQUNBOzs7OztFQUtBLFNBQUEsV0FBQSxNQUFBLFNBQUEsSUFBQSxtQkFBQTs7SUFFQSxPQUFBLFNBQUEsUUFBQSxrQkFBQTtNQUNBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFFBQUEsWUFBQSxtQkFBQTtZQUNBLG1CQUFBOztVQUVBLElBQUEsZUFBQSxtQkFBQTtVQUNBLFFBQUEsV0FBQSxTQUFBO1VBQ0E7VUFDQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7U0FDQTs7Ozs7RUFLQSxTQUFBLGNBQUEsV0FBQSxTQUFBOztJQUVBLElBQUEsYUFBQSxRQUFBLFdBQUEsUUFBQSxRQUFBOztJQUVBLElBQUEsUUFBQSxXQUFBLFlBQUE7TUFDQSxPQUFBLFVBQUEsSUFBQTtXQUNBO01BQ0EsT0FBQSxVQUFBLElBQUE7Ozs7QUNoRkEsQ0FBQSxXQUFBO0NBQ0E7O0NBRUE7RUFDQSxPQUFBLDhCQUFBO0VBQ0EsUUFBQSxlQUFBLENBQUEsTUFBQSxXQUFBLG1CQUFBLGVBQUE7Ozs7Ozs7RUFPQSxTQUFBLFNBQUEsSUFBQSxTQUFBLFdBQUEsT0FBQSxtQkFBQTs7SUFFQSxJQUFBLFVBQUE7O0lBRUEsUUFBQSwyQkFBQTs7SUFFQSxPQUFBOztJQUVBLFNBQUEseUJBQUEsU0FBQTtNQUNBLElBQUEsaUJBQUE7UUFDQSxPQUFBO1FBQ0EsU0FBQTtRQUNBLGFBQUE7UUFDQSxZQUFBO1FBQ0EsVUFBQTs7O01BR0EsaUJBQUEsUUFBQSxPQUFBLGdCQUFBOztNQUVBLE9BQUEsR0FBQSxTQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxRQUFBLFFBQUEsU0FBQTtZQUNBLFVBQUEsZUFBQTtZQUNBLFVBQUEsZUFBQTtZQUNBLFVBQUEsTUFBQSxlQUFBO1lBQ0EsSUFBQSxLQUFBLGVBQUEsY0FBQTtZQUNBLElBQUEsS0FBQSxlQUFBLFlBQUE7WUFDQSxVQUFBLFNBQUE7Y0FDQSxRQUFBO2VBQ0EsVUFBQSxHQUFBO2NBQ0EsT0FBQTs7O1VBR0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBO1NBQ0E7Ozs7O0FDaERBLENBQUEsV0FBQTtDQUNBOzs7OztDQUVBO0tBQ0EsT0FBQSwrQkFBQTtLQUNBLFFBQUEscUJBQUE7S0FDQSxRQUFBLHNCQUFBO0tBQ0EsUUFBQSxnQkFBQTs7RUFFQSxTQUFBLGtCQUFBLElBQUEsTUFBQSxtQkFBQTtJQUNBLElBQUEsVUFBQTs7SUFFQSxRQUFBLFlBQUE7SUFDQSxRQUFBLGFBQUE7SUFDQSxRQUFBLFNBQUE7TUFDQSxZQUFBO01BQ0EsWUFBQTtNQUNBLFlBQUE7TUFDQSxjQUFBO01BQ0EsZ0JBQUE7TUFDQSxZQUFBO01BQ0EsYUFBQTs7O0lBR0EsT0FBQTs7SUFFQSxTQUFBLFVBQUEsWUFBQTtNQUNBLE9BQUEsR0FBQSxVQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFlBQUEsUUFBQSxRQUFBLFNBQUE7O1VBRUEsSUFBQSxXQUFBO1lBQ0EsT0FBQTtlQUNBLGlCQUFBO2VBQ0EsS0FBQTs7OztlQUlBLE1BQUE7Ozs7O2lCQUtBO1lBQ0EsTUFBQSxJQUFBO2NBQ0E7Ozs7VUFJQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7Ozs7O0lBS0EsU0FBQSxXQUFBLE1BQUEsUUFBQTtNQUNBLE9BQUEsR0FBQSxVQUFBLFNBQUEsUUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLFlBQUEsUUFBQSxRQUFBLFNBQUE7O1VBRUEsSUFBQSxXQUFBO1lBQ0EsT0FBQTtlQUNBLFNBQUEsTUFBQTtlQUNBLEtBQUE7Ozs7Ozs7ZUFPQSxNQUFBOzs7OztpQkFLQTtZQUNBLE1BQUEsSUFBQTtjQUNBOzs7O1VBSUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7Ozs7RUFNQSxTQUFBLG1CQUFBLElBQUEsTUFBQSxTQUFBLG1CQUFBO0lBQ0EsSUFBQSxVQUFBOztJQUVBLFFBQUEsWUFBQTtJQUNBLFFBQUEsYUFBQTtJQUNBLFFBQUEsU0FBQTtNQUNBLFlBQUE7TUFDQSxZQUFBO01BQ0EsWUFBQTtNQUNBLGNBQUE7TUFDQSxnQkFBQTtNQUNBLFlBQUE7TUFDQSxhQUFBOzs7SUFHQSxPQUFBOztJQUVBLFNBQUEsVUFBQSxZQUFBO01BQ0EsT0FBQSxHQUFBLFVBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTtVQUNBLElBQUEsWUFBQSxRQUFBOztVQUVBLEtBQUEsTUFBQTs7VUFFQSxJQUFBLFdBQUE7WUFDQSxlQUFBO2NBQ0E7Y0FDQSxZQUFBO2dCQUNBLEtBQUEsTUFBQSx1QkFBQTtnQkFDQTs7Y0FFQSxVQUFBLE9BQUE7Z0JBQ0EsTUFBQSxJQUFBLE1BQUEsOEJBQUE7a0JBQ0EsT0FBQSxLQUFBLFVBQUE7Ozs7aUJBSUE7WUFDQSxNQUFBLElBQUE7Y0FDQTs7OztVQUlBLE9BQUEsR0FBQTtVQUNBLGtCQUFBO1VBQ0EsT0FBQTs7Ozs7SUFLQSxTQUFBLFdBQUEsTUFBQSxRQUFBO01BQ0EsT0FBQSxHQUFBLFVBQUEsU0FBQSxRQUFBO1FBQ0EsSUFBQTtVQUNBLElBQUEsWUFBQSxRQUFBOztVQUVBLElBQUEsV0FBQTtZQUNBLGVBQUE7Y0FDQTtjQUNBO2NBQ0EsWUFBQTtnQkFDQSxLQUFBLE1BQUEsaUJBQUE7a0JBQ0E7a0JBQ0E7O2dCQUVBOztjQUVBLFVBQUEsT0FBQTtnQkFDQSxNQUFBLElBQUEsTUFBQSx1QkFBQTtrQkFDQSxPQUFBLEtBQUEsVUFBQTs7OztpQkFJQTtZQUNBLE1BQUEsSUFBQTtjQUNBOzs7O1VBSUEsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7Ozs7RUFNQSxTQUFBLFVBQUEsV0FBQSxTQUFBO0lBQ0EsT0FBQSxVQUFBLElBQUE7OztBQ2pMQSxDQUFBLFNBQUEsUUFBQTtFQUNBOzs7RUFFQTtHQUNBLE9BQUEsbUJBQUE7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOztHQUVBLFFBQUEsWUFBQTs7RUFFQSxTQUFBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOztJQUVBLElBQUEsVUFBQTs7SUFFQSxRQUFBLGVBQUE7SUFDQSxRQUFBLGNBQUE7SUFDQSxRQUFBLHFCQUFBO0lBQ0EsUUFBQSxtQkFBQTtJQUNBLFFBQUEsbUJBQUE7O0lBRUEsT0FBQTs7R0FFQTs7QUMvQkEsQ0FBQSxXQUFBO0VBQ0E7OztFQUVBO0dBQ0EsT0FBQSxxQkFBQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOztHQUVBLFFBQUEsY0FBQTs7RUFFQSxTQUFBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7O0lBRUEsSUFBQSxVQUFBOztJQUVBLFFBQUEsWUFBQTtJQUNBLFFBQUEsV0FBQTtJQUNBLFFBQUEsYUFBQTtJQUNBLFFBQUEsU0FBQTtJQUNBLFFBQUEsVUFBQTtJQUNBLFFBQUEsUUFBQTtJQUNBLFFBQUEsZ0JBQUE7SUFDQSxRQUFBLGdCQUFBO0lBQ0EsUUFBQSxlQUFBOztJQUVBLE9BQUE7OztBQzFDQSxDQUFBLFdBQUE7RUFDQTs7O0VBRUE7R0FDQSxPQUFBO0dBQ0EsU0FBQSxZQUFBO0dBQ0EsUUFBQSxVQUFBOztFQUVBLFNBQUEsbUJBQUE7OztJQUVBLElBQUEsVUFBQTtRQUNBLE9BQUE7O0lBRUEsS0FBQSxhQUFBLFNBQUEsS0FBQTtNQUNBLFFBQUEsT0FBQSxTQUFBOzs7SUFHQSxLQUFBLFlBQUEsU0FBQSxNQUFBLE9BQUE7TUFDQSxRQUFBLFFBQUE7OztJQUdBLEtBQUEsT0FBQTs7SUFFQSxTQUFBLFNBQUEsSUFBQSxTQUFBLE1BQUEsbUJBQUEsVUFBQSxRQUFBOzs7OztNQUtBLElBQUEsVUFBQTtRQUNBLFFBQUEsU0FBQSxPQUFBO1VBQ0EsSUFBQSxRQUFBOztVQUVBLElBQUEsTUFBQSxNQUFBLE1BQUEsR0FBQSxlQUFBO1lBQ0EsUUFBQTtVQUNBLE9BQUEsUUFBQSxjQUFBLE9BQUE7O1FBRUEsZUFBQSxTQUFBLE9BQUEsT0FBQTtVQUNBLElBQUEsU0FBQTtVQUNBLEtBQUEsSUFBQSxJQUFBLEdBQUEsTUFBQSxNQUFBLFFBQUEsSUFBQSxLQUFBLEtBQUE7Y0FDQSxPQUFBLE1BQUEsR0FBQSxVQUFBLE1BQUE7O1VBRUEsT0FBQTs7UUFFQSxpQkFBQSxTQUFBLFVBQUE7VUFDQSxJQUFBLGFBQUEsU0FBQSxlQUFBLGdCQUFBLFNBQUEsYUFBQTtVQUNBLElBQUEsWUFBQSxTQUFBLGVBQUEsZUFBQSxTQUFBLFlBQUE7O1VBRUEsT0FBQSxFQUFBLGFBQUE7O1FBRUEsbUJBQUEsU0FBQSxZQUFBO1VBQ0EsSUFBQSxXQUFBO1VBQ0EsU0FBQSxLQUFBO1VBQ0EsSUFBQSxJQUFBLE9BQUEsWUFBQTtZQUNBLElBQUEsWUFBQSxXQUFBLEtBQUEsYUFBQSxPQUFBLFdBQUEsS0FBQSxZQUFBO1lBQ0EsSUFBQSxDQUFBLFNBQUE7Y0FDQSxTQUFBLGFBQUE7WUFDQSxTQUFBLFdBQUEsS0FBQSxXQUFBOztVQUVBLElBQUEsSUFBQSxPQUFBLFlBQUE7WUFDQSxJQUFBLFdBQUEsV0FBQTtZQUNBLFNBQUEsV0FBQTtZQUNBLElBQUEsU0FBQSxTQUFBO2NBQ0EsU0FBQSxXQUFBLFNBQUEsU0FBQTs7VUFFQSxPQUFBLFNBQUE7Ozs7OztNQU1BLElBQUEsVUFBQTs7TUFFQSxRQUFBLFVBQUE7TUFDQSxRQUFBLGNBQUE7TUFDQSxRQUFBLGtCQUFBO01BQ0EsUUFBQSxNQUFBO01BQ0EsUUFBQSxPQUFBO01BQ0EsUUFBQSxpQkFBQTtNQUNBLFFBQUEsa0JBQUE7TUFDQSxRQUFBLGNBQUE7O01BRUEsT0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztNQW1CQSxTQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsZUFBQTtVQUNBLE9BQUEsT0FBQSxZQUFBLFVBQUEsUUFBQTtRQUNBLElBQUEsUUFBQSxlQUFBO1VBQ0EsT0FBQSxPQUFBLFlBQUEsV0FBQSxRQUFBOzs7TUFHQSxTQUFBLFlBQUEsSUFBQTtRQUNBLElBQUE7VUFDQSxJQUFBLGFBQUEsUUFBQSxPQUFBLEtBQUE7VUFDQSxJQUFBLFdBQUEsZUFBQSxLQUFBO1lBQ0EsT0FBQSxXQUFBO2lCQUNBO1lBQ0EsT0FBQTs7VUFFQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtTQUNBOzs7TUFHQSxTQUFBLFFBQUEsVUFBQTtRQUNBLElBQUE7VUFDQSxPQUFBLEtBQUE7VUFDQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7Ozs7TUFJQSxTQUFBLGdCQUFBLFVBQUE7UUFDQSxJQUFBO1VBQ0EsT0FBQSxLQUFBLEtBQUE7VUFDQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7Ozs7TUFJQSxTQUFBLGdCQUFBO1FBQ0EsT0FBQSxRQUFBOzs7TUFHQSxTQUFBLGNBQUEsWUFBQTtRQUNBLEtBQUEsYUFBQTs7O01BR0EsU0FBQSxRQUFBLE1BQUE7UUFDQSxLQUFBLE9BQUE7OztNQUdBLFNBQUEsV0FBQSxTQUFBO1FBQ0EsS0FBQSxVQUFBOzs7TUFHQSxTQUFBLGFBQUE7UUFDQSxPQUFBLEtBQUE7OztNQUdBLFNBQUEsaUJBQUE7UUFDQSxJQUFBO1VBQ0EsT0FBQSxRQUFBLFNBQUEsS0FBQSxLQUFBO1VBQ0EsT0FBQSxHQUFBO1VBQ0Esa0JBQUE7VUFDQSxPQUFBOzs7O01BSUEsU0FBQSxZQUFBLE1BQUE7UUFDQSxJQUFBO1VBQ0EsT0FBQSxRQUFBLFNBQUE7VUFDQSxPQUFBLEdBQUE7VUFDQSxrQkFBQTtVQUNBLE9BQUE7Ozs7TUFJQSxTQUFBLFlBQUEsVUFBQTtRQUNBLEtBQUEsV0FBQTs7O01BR0EsU0FBQSxnQkFBQSxNQUFBO1FBQ0EsT0FBQSxHQUFBLFNBQUEsU0FBQSxRQUFBO1VBQ0EsSUFBQTtZQUNBLGNBQUEsS0FBQTtZQUNBLFFBQUEsS0FBQTtZQUNBLFlBQUEsS0FBQTtZQUNBLFFBQUE7WUFDQSxPQUFBLEdBQUE7WUFDQSxrQkFBQTtZQUNBLE9BQUE7V0FDQTs7Ozs7O0VBTUEsU0FBQSxJQUFBLFlBQUEsT0FBQSxNQUFBLG1CQUFBLHFCQUFBOztJQUVBLElBQUEsU0FBQTtNQUNBLFNBQUE7OztJQUdBLElBQUEsNkJBQUEsU0FBQSxNQUFBO01BQ0EsSUFBQSxNQUFBLE9BQUEsS0FBQSxNQUFBLElBQUEsU0FBQSxHQUFBO1FBQ0EsT0FBQSxtQkFBQSxLQUFBLE1BQUEsbUJBQUEsS0FBQTtTQUNBLEtBQUE7O01BRUEsT0FBQTs7O0lBR0EsSUFBQSxXQUFBLFNBQUEsTUFBQTtNQUNBLElBQUE7Ozs7O1FBS0EsSUFBQSxTQUFBLENBQUEsT0FBQSxVQUFBLE9BQUEsU0FBQTs7UUFFQSxPQUFBLE9BQUEsU0FBQSxTQUFBO1FBQ0EsT0FBQSxHQUFBO1FBQ0Esa0JBQUE7Ozs7SUFJQSxJQUFBLE1BQUEsQ0FBQSxXQUFBO01BQ0EsT0FBQTtRQUNBLEtBQUEsU0FBQSxNQUFBLEtBQUE7VUFDQSxRQUFBLE9BQUEsS0FBQSxDQUFBLFNBQUEsT0FBQTs7VUFFQSxPQUFBLG9CQUFBLElBQUEsU0FBQSxPQUFBOztRQUVBLE1BQUEsU0FBQSxNQUFBLEtBQUE7VUFDQSxPQUFBLE1BQUE7WUFDQSxRQUFBO1lBQ0EsU0FBQSxPQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsTUFBQSxRQUFBLE9BQUE7WUFDQSxjQUFBO1lBQ0EsU0FBQTtjQUNBLGdCQUFBOzs7O1FBSUEsS0FBQSxTQUFBLE1BQUEsS0FBQTtVQUNBLE9BQUEsTUFBQTtZQUNBLFFBQUE7WUFDQSxTQUFBLE9BQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxNQUFBLFFBQUEsT0FBQTtZQUNBLGNBQUE7WUFDQSxTQUFBO2NBQ0EsZ0JBQUE7Ozs7UUFJQSxLQUFBLFNBQUEsTUFBQSxJQUFBO1VBQ0EsT0FBQSxNQUFBO1lBQ0EsUUFBQTtZQUNBLFNBQUEsT0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLGNBQUE7Ozs7OztJQU1BLElBQUEsTUFBQTtNQUNBLFlBQUEsQ0FBQSxXQUFBO1FBQ0EsSUFBQSxPQUFBO1FBQ0EsT0FBQTtVQUNBLE9BQUEsV0FBQTs7WUFFQSxPQUFBLElBQUEsSUFBQSxNQUFBOztVQUVBLE9BQUEsU0FBQSxhQUFBLFFBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxPQUFBLGNBQUEsVUFBQTs7OztNQUlBLE9BQUEsQ0FBQSxXQUFBO1FBQ0EsSUFBQSxPQUFBO1FBQ0EsT0FBQTtVQUNBLFFBQUEsV0FBQTtZQUNBLE9BQUEsSUFBQSxJQUFBLE9BQUEsVUFBQTs7VUFFQSxRQUFBLFNBQUEsS0FBQTtZQUNBLElBQUEsTUFBQSxPQUFBLFlBQUEsMkJBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxLQUFBOzs7O01BSUEsTUFBQSxDQUFBLFdBQUE7UUFDQSxJQUFBLE9BQUE7UUFDQSxPQUFBO1VBQ0EsYUFBQSxXQUFBO1lBQ0EsT0FBQSxJQUFBLElBQUEsTUFBQTs7OztNQUlBLE9BQUEsQ0FBQSxXQUFBO1FBQ0EsSUFBQSxPQUFBO1FBQ0EsT0FBQTtVQUNBLFFBQUEsU0FBQSxLQUFBO1lBQ0EsT0FBQSxJQUFBLEtBQUEsT0FBQSxTQUFBOztVQUVBLEtBQUEsV0FBQTtZQUNBLE9BQUEsSUFBQSxJQUFBLE1BQUE7O1VBRUEsTUFBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxNQUFBOzs7VUFHQSxRQUFBLFNBQUEsS0FBQTtZQUNBLE9BQUEsSUFBQSxLQUFBLE9BQUEsV0FBQTs7O1VBR0EsUUFBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsSUFBQSxPQUFBLGFBQUEsSUFBQTs7VUFFQSxPQUFBLFNBQUEsS0FBQTtZQUNBLE9BQUEsSUFBQSxLQUFBLE9BQUEsbUJBQUE7Ozs7TUFJQSxTQUFBLENBQUEsV0FBQTtRQUNBLElBQUEsT0FBQTtRQUNBLE9BQUE7VUFDQSxNQUFBLFNBQUEsS0FBQTtZQUNBLE9BQUEsSUFBQSxJQUFBLE9BQUEsSUFBQSxNQUFBOzs7O01BSUEsTUFBQSxDQUFBLFdBQUE7UUFDQSxJQUFBLE9BQUE7UUFDQSxPQUFBO1VBQ0EsUUFBQSxTQUFBLEtBQUE7WUFDQSxPQUFBLElBQUEsS0FBQSxPQUFBLElBQUEsS0FBQSxTQUFBLElBQUE7Ozs7TUFJQSxNQUFBLENBQUEsV0FBQTtRQUNBLElBQUEsT0FBQTtRQUNBLE9BQUE7VUFDQSxNQUFBLFNBQUEsS0FBQTtZQUNBLE9BQUEsSUFBQSxLQUFBLE1BQUE7Ozs7TUFJQSxRQUFBLENBQUEsV0FBQTtRQUNBLE9BQUE7VUFDQSxlQUFBLFNBQUEsTUFBQTtZQUNBLFFBQUEsT0FBQSxRQUFBOztVQUVBLGVBQUEsV0FBQTtZQUNBLE9BQUE7O1VBRUEsYUFBQSxTQUFBLE1BQUEsT0FBQTtZQUNBLE9BQUEsUUFBQTs7VUFFQSxhQUFBLFNBQUEsTUFBQTtZQUNBLE9BQUEsT0FBQTs7Ozs7O0lBTUEsT0FBQTs7Ozs7QUM1V0EsQ0FBQSxZQUFBO0VBQ0E7OztFQUVBLFFBQUEsT0FBQSwyQkFBQSxDQUFBO0dBQ0EsT0FBQSxXQUFBO0dBQ0EsT0FBQSxTQUFBO0dBQ0EsT0FBQSxhQUFBO0dBQ0EsT0FBQSxlQUFBO0dBQ0EsT0FBQSxZQUFBO0dBQ0EsT0FBQSxjQUFBOztFQUVBLFNBQUEsVUFBQTtJQUNBLE9BQUEsVUFBQSxLQUFBO01BQ0EsT0FBQSxDQUFBLE9BQUEsS0FBQSxLQUFBOzs7O0VBSUEsU0FBQSxRQUFBO0lBQ0EsT0FBQSxVQUFBLE1BQUE7TUFDQSxPQUFBLEtBQUEsUUFBQSxrQkFBQTs7OztFQUlBLFNBQUEsWUFBQTtJQUNBLE9BQUEsVUFBQSxNQUFBO01BQ0EsT0FBQTtPQUNBLFFBQUE7T0FDQSxLQUFBO09BQ0E7Ozs7RUFJQSxTQUFBLGFBQUE7SUFDQSxPQUFBLFNBQUEsT0FBQSxPQUFBO01BQ0EsSUFBQSxPQUFBO01BQ0EsUUFBQSxNQUFBO01BQ0EsT0FBQSxNQUFBLFVBQUEsRUFBQSxHQUFBLGNBQUEsTUFBQSxVQUFBOzs7O0VBSUEsU0FBQSxjQUFBO0lBQ0EsT0FBQSxTQUFBLE9BQUE7TUFDQSxJQUFBLFNBQUEsR0FBQSxPQUFBO01BQ0EsSUFBQSxJQUFBO01BQ0EsSUFBQSxRQUFBLENBQUEsU0FBQSxNQUFBLE1BQUEsTUFBQSxNQUFBLE1BQUEsTUFBQSxNQUFBO01BQ0EsSUFBQSxJQUFBLEtBQUEsTUFBQSxLQUFBLElBQUEsU0FBQSxLQUFBLElBQUE7TUFDQSxPQUFBLENBQUEsUUFBQSxLQUFBLElBQUEsR0FBQSxJQUFBLFlBQUEsS0FBQSxNQUFBLE1BQUE7Ozs7RUFJQSxTQUFBLFVBQUEsTUFBQSxXQUFBO0lBQ0EsT0FBQSxTQUFBLE1BQUE7TUFDQSxJQUFBLFFBQUE7TUFDQSxJQUFBLFlBQUEsVUFBQSxNQUFBLFFBQUEsT0FBQTtNQUNBLE9BQUEsS0FBQSxZQUFBOzs7O0FBSUEiLCJmaWxlIjoibmctbWV1bW9iaS11dGlscy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmxvY2FsU3RvcmFnZScsIFtdKVxuICAuZmFjdG9yeSgnbWV1TG9jYWxTdG9yYWdlJywgbG9jYWxTdG9yYWdlKTtcbiAgXG4gIGZ1bmN0aW9uIGxvY2FsU3RvcmFnZSgpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuZ2V0T2JqZWN0ID0gZ2V0T2JqZWN0O1xuICAgIHNlcnZpY2Uuc2V0T2JqZWN0ID0gc2V0T2JqZWN0O1xuICAgIHNlcnZpY2UucmVtb3ZlT2JqZWN0ID0gcmVtb3ZlT2JqZWN0O1xuICAgIHNlcnZpY2UuY29udGFpbnMgPSBjb250YWlucztcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBnZXRPYmplY3Qoa2V5KSB7XG4gICAgICByZXR1cm4gYW5ndWxhci5mcm9tSnNvbihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc2V0T2JqZWN0KGtleSwgdmFsdWUpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgYW5ndWxhci50b0pzb24odmFsdWUpKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gcmVtb3ZlT2JqZWN0KGtleSkge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gY29udGFpbnMoa2V5KSB7XG4gICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSA/IHRydWUgOiBmYWxzZTtcbiAgICB9O1xuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmh0dHBXaXRoRmFsbGJhY2snLCBbXSlcbiAgLmZhY3RvcnkoJ21ldUh0dHBXaXRoRmFsbGJhY2snLCBodHRwV2l0aEZhbGxiYWNrKTtcbiAgXG4gIGZ1bmN0aW9uIGh0dHBXaXRoRmFsbGJhY2soJHEsICRsb2csICRleGNlcHRpb25IYW5kbGVyLCAkaHR0cCkge1xuXG4gICAgLy8gQ29uc3RydWN0b3IgZnVuY3Rpb24sIHVzaW5nICRodHRwIGFzIHByb3RvdHlwZVxuICAgIGZ1bmN0aW9uIEh0dHBXaXRoRmFsbGJhY2soKSB7IH1cbiAgICBIdHRwV2l0aEZhbGxiYWNrLnByb3RvdHlwZSA9ICRodHRwO1xuICAgIEh0dHBXaXRoRmFsbGJhY2sucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gSHR0cFdpdGhGYWxsYmFjaztcblxuICAgIHZhciBodHRwV2l0aEZhbGxiYWNrID0gbmV3IEh0dHBXaXRoRmFsbGJhY2soKTtcblxuICAgIHZhciBwcmVwYXJlU3RvcmVkUmVzcG9uc2UgPSBmdW5jdGlvbihzdG9yZWRSZXNwb25zZSkge1xuICAgICAgLy8gRGF0YSB3YXMgc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCBmcm9tIGxvY2FsIHN0b3JhZ2UsIHJlc29sdmUgd2l0aCBzdGF0dXMgMjAwXG4gICAgICBzdG9yZWRSZXNwb25zZSA9IGFuZ3VsYXIuZnJvbUpzb24oc3RvcmVkUmVzcG9uc2UpO1xuICAgICAgdmFyIGhlYWRlcnMgPSBzdG9yZWRSZXNwb25zZS5oZWFkZXJzO1xuICAgICAgc3RvcmVkUmVzcG9uc2UuaGVhZGVycyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gaGVhZGVyczsgfTtcbiAgICAgIHJldHVybiBzdG9yZWRSZXNwb25zZTtcbiAgICB9O1xuXG4gICAgdmFyIG1ha2VSZXF1ZXN0ID0gZnVuY3Rpb24odXJsLCBjb25maWcsIGRlZmVycmVkKSB7XG4gICAgICAkaHR0cC5nZXQodXJsLCBjb25maWcpXG4gICAgICAudGhlbihcbiAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAkbG9nLmRlYnVnKCdbaHR0cFdpdGhGYWxsYmFja106IHRoZW4gcmVzcG9uc2Ugc3VjY2VzcyBzdGF0dXM6JyArIHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgLy8gU3RvcmUgaW4gbG9jYWwgc3RvcmFnZSB3aGVuIHN0YXR1cyA9PT0gMjAwXG4gICAgICAgICAgaWYgKCFyZXNwb25zZS5jb25maWcuZG9udFN0b3JlRmFsbGJhY2sgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHVybCwgYW5ndWxhci50b0pzb24oe1xuICAgICAgICAgICAgICBkYXRhOiByZXNwb25zZS5kYXRhLFxuICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgY29uZmlnOiByZXNwb25zZS5jb25maWcsXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlLmhlYWRlcnMoKSxcbiAgICAgICAgICAgICAgaXNGYWxsYmFjazogdHJ1ZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBSZXNvbHZlIHdpdGggb3JpZ2luYWwgcmVzcG9uc2VcbiAgICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVycygnZXRhZycpID09PSByZXNwb25zZS5jb25maWdbJ0lmLU5vbmUtTWF0Y2gnXSlcbiAgICAgICAgICAgIHJlc3BvbnNlLnVuY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgJGxvZy5kZWJ1ZygnW2h0dHBXaXRoRmFsbGJhY2tdOiB0aGVuIHJlc3BvbnNlIGZhaWwgc3RhdHVzOicgKyByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICAgIC8vIFRyeSB0byByZXRyaWV2ZSBmcm9tIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgICB2YXIgc3RvcmVkUmVzcG9uc2UgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh1cmwpO1xuICAgICAgICAgIGlmIChzdG9yZWRSZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocHJlcGFyZVN0b3JlZFJlc3BvbnNlKHN0b3JlZFJlc3BvbnNlKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVHJ5IGNvbmZpZy5mYWxsYmFja1xuICAgICAgICAgIGlmIChyZXNwb25zZS5jb25maWcuZmFsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHtcbiAgICAgICAgICAgICAgZGF0YTogY29uZmlnLmZhbGxiYWNrLFxuICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgaGVhZGVyczogcmVzcG9uc2UuaGVhZGVycyxcbiAgICAgICAgICAgICAgY29uZmlnOiByZXNwb25zZS5jb25maWcsXG4gICAgICAgICAgICAgIGlzRmFsbGJhY2s6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFJlamVjdCB3aXRoIG9yaWdpbmFsIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vIERlY29yYXRlIHByb21pc2Ugd2l0aCBzdWNjZXNzIGFuZCBlcnJvciBmdW5jdGlvbnMgdG8gYmUgY29tcGF0aWJsZSB3aXRoIHRoZSBwcm9taXNlIHJldHVybmVkIGJ5ICRodHRwLmdldFxuICAgICAgdmFyIHByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICBwcm9taXNlLnN1Y2Nlc3MgPSBmdW5jdGlvbihmbikge1xuICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBmbihyZXNwb25zZS5kYXRhLCByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLmhlYWRlcnMsIGNvbmZpZywgcmVzcG9uc2UuaXNGYWxsYmFjayk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgIH07XG5cbiAgICAgIHByb21pc2UuZXJyb3IgPSBmdW5jdGlvbihmbikge1xuICAgICAgICBwcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBmbihyZXNwb25zZS5kYXRhLCByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLmhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBwcm9taXNlO1xuICAgIH07XG4gICAgLyoqXG4gICAgKiBPdmVycmlkZSAkaHR0cC5nZXQgdG8gY2F0Y2ggdGhlIHByb21pc2UuZXJyb3JcbiAgICAqL1xuICAgIGh0dHBXaXRoRmFsbGJhY2suZ2V0ID0gZnVuY3Rpb24odXJsLCBjb25maWcpIHtcbiAgICAgIC8vIENsaWVudCBkb2Vzbid0IHN1cHBvcnQgbG9jYWwgc3RvcmFnZVxuICAgICAgaWYgKCFsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgLy8gSWYgbm8gZmFsbGJhY2sgZGVmaW5lZCwganVzdCBqdXN0ICRodHRwLmdldFxuICAgICAgICBpZiAoIWNvbmZpZy5mYWxsYmFjaykge1xuICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsLCBjb25maWcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIExvY2FsIHN0b3JhZ2Ugd29uJ3QgYmUgdXNlZFxuICAgICAgICBjb25maWcuZG9udFN0b3JlRmFsbGJhY2sgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWxlZ2F0ZSBnZXQgdG8gJGh0dHBcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB2YXIgc3RvcmVkUmVzcG9uc2UgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh1cmwpO1xuXG4gICAgICBpZiAoc3RvcmVkUmVzcG9uc2UpIHtcbiAgICAgICAgLy9zZWNvbmQgcHJvbWlzZSB0byB1cGRhdGUgZGF0YSBhZnRlciByZXF1ZXN0XG4gICAgICAgIHZhciBkZWZlcnJlZFJlcXVlc3QgPSAkcS5kZWZlcigpO1xuICAgICAgICBzdG9yZWRSZXNwb25zZSA9IHByZXBhcmVTdG9yZWRSZXNwb25zZShzdG9yZWRSZXNwb25zZSk7XG4gICAgICAgIHZhciBjYWNoZSA9IHN0b3JlZFJlc3BvbnNlOyAgICAgICAgICBcbiAgICAgICAgLy8gSWYgY29uZmlnIGlzIHVuZGVmaW5lZCwgaWUgaHR0cFdpdGhGYWxsYmFjay5nZXQoUEFUSClcbiAgICAgICAgLy8gY29uZmlnID0gdHlwZW9mIGNvbmZpZyAhPT0gJ3VuZGVmaW5lZCcgPyBjb25maWcgOiB7fTtcbiAgICAgICAgY29uZmlnID0gYW5ndWxhci5pc0RlZmluZWQoY29uZmlnKSA/IGNvbmZpZyA6IHt9OyAgICAgICAgIFxuICAgICAgICBpZiAoY2FjaGUgJiYgY2FjaGUuaGVhZGVycygpKVxuICAgICAgICAgIGNvbmZpZ1snSWYtTm9uZS1NYXRjaCddID0gY2FjaGUuaGVhZGVycygpLmV0YWc7XG4gICAgICAgIHN0b3JlZFJlc3BvbnNlLnByb21pc2UgPSBtYWtlUmVxdWVzdCh1cmwsIGNvbmZpZywgZGVmZXJyZWRSZXF1ZXN0KTtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShzdG9yZWRSZXNwb25zZSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgfVxuICAgICAgLy9kb24ndCBoYXZlIGxvY2FsLCBjb250aW51ZSB0byByZXF1ZXN0XG4gICAgICByZXR1cm4gbWFrZVJlcXVlc3QodXJsLCBjb25maWcsIGRlZmVycmVkKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGh0dHBXaXRoRmFsbGJhY2s7XG4gIH07XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmh0dHBJbnRlcmNlcHRvcnMnLCBbXSlcblx0LmZhY3RvcnkoJ21ldUxvYWRpbmdJbnRlcmNlcHRvcicsIGxvYWRpbmdJbnRlcmNlcHRvcilcbiAgLmZhY3RvcnkoJ21ldUVycm9ySW50ZXJjZXB0b3InLCBlcnJvckludGVyY2VwdG9yKTtcblx0XG5cdGZ1bmN0aW9uIGxvYWRpbmdJbnRlcmNlcHRvcigkcSwgJHJvb3RTY29wZSwgJGxvZykge1xuXHRcdFxuXHRcdHZhciBudW1Mb2FkaW5ncyA9IDA7XG5cdFx0XG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICBpZiAoIW51bUxvYWRpbmdzKyspIHtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6c3RhcnQnKTtcbiAgICAgICAgfVxuXG5cdFx0XHRcdHJldHVybiBjb25maWcgfHwgJHEud2hlbihjb25maWcpO1xuXHRcdFx0fSxcblx0XHRcdHJlc3BvbnNlOiBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRpZiAoISgtLW51bUxvYWRpbmdzKSkge1xuXHRcdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpzdG9wJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG5cdFx0XHR9LFxuXHRcdFx0cmVxdWVzdEVycm9yOiBmdW5jdGlvbihyZXF1ZXN0KSB7XG5cdFx0XHRcdGlmICghKC0tbnVtTG9hZGluZ3MpKSB7XG5cdFx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOnN0b3AnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiAkcS5yZWplY3QocmVxdWVzdCk7XG5cdFx0XHR9LFxuXHRcdFx0cmVzcG9uc2VFcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0aWYgKCEoLS1udW1Mb2FkaW5ncykpIHtcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6c3RvcCcpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcblx0XHRcdH1cblx0XHR9O1xuXHR9XG4gIFxuICBmdW5jdGlvbiBlcnJvckludGVyY2VwdG9yKCRxLCAkcm9vdFNjb3BlLCAkbG9nKSB7XG4gICAgXG4gIFx0cmV0dXJuIHtcbiAgXHRcdHJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICBcbiAgXHRcdFx0cmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7XG4gIFx0XHR9LFxuICBcdFx0cmVxdWVzdEVycm9yOiBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICAgICAgIFxuICBcdFx0XHRyZXR1cm4gJHEucmVqZWN0KHJlcXVlc3QpO1xuICBcdFx0fSxcbiAgXHRcdHJlc3BvbnNlOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBcbiAgXHRcdFx0cmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuICBcdFx0fSxcbiAgXHRcdHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gIFx0XHRcdCRsb2cuZGVidWcoJ1tBUEk6ZXJyb3JJbnRlcmNlcHRvcl06IEJFR0lOJyk7XG4gICAgICAgICRsb2cuZGVidWcoJ1Jlc3BvbnNlIFN0YXR1czogJyArIHJlc3BvbnNlLnN0YXR1cyk7XG4gIFx0XHRcdCRsb2cuZGVidWcocmVzcG9uc2UpO1xuICBcdFx0XHQkbG9nLmRlYnVnKCdbQVBJOmVycm9ySW50ZXJjZXB0b3JdOiBFTkQnKTtcbiAgXHRcdFx0aWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gLTEpIHt9IC8vIENsaWVudCB0aW1lb3V0IGZpcmVkXG4gICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDApIHt9IC8vIG5ldHdvcmsgb2ZmbGluZSBvciBDT1JTIGVycm9yXG4gIFx0XHRcdGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge31cbiAgXHRcdFx0aWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdlcnJvcjo0MDEnKTtcbiAgXHRcdFx0fVxuICBcdFx0XHRpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDgpIHt9IC8vIFNlcnZlciB0aW1lZCBvdXQgd2FpdGluZyBmb3IgdGhlIHJlcXVlc3QuXG4gIFx0XHRcdGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXMgPj0gNTAwKSB7fVxuICAgICAgICBcbiAgXHRcdFx0cmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gIFx0XHR9XG4gIFx0fTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcbiAgXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmRldmljZVJlYWR5JywgW10pXG5cdC5mYWN0b3J5KCdtZXVEZXZpY2VSZWFkeScsIGRldmljZVJlYWR5KTtcbiAgXG4gIC8qXG4gIFxuICAgIEhvdyB0byB1c2UgaXQ6IFxuICAgICAgbWV1RGV2aWNlUmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgIC4uLlxuICAgICAgfSk7XG4gICovXG4gIFxuXHRmdW5jdGlvbiBkZXZpY2VSZWFkeSgkbG9nLCAkd2luZG93KSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcblx0XHRcdGlmIChhbmd1bGFyLmlzT2JqZWN0KCR3aW5kb3cuY29yZG92YSkpIHtcbiAgICAgICAgLyplc2xpbnQtZGlzYWJsZSBhbmd1bGFyL2RvY3VtZW50LXNlcnZpY2UgKi9cbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlcmVhZHknLCBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0XHRcdGRvbmUoKTtcblx0XHRcdFx0fSwgZmFsc2UpO1xuICAgICAgICAvKmVzbGludC1lbmFibGUgYW5ndWxhci9kb2N1bWVudC1zZXJ2aWNlICovXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRkb25lKCk7XG5cdFx0XHR9XG5cdFx0fTtcblx0fVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmF1dGhlbnRpY2F0aW9uJywgW10pXG4gIC5mYWN0b3J5KCdtZXVBdXRoZW50aWNhdGlvbicsIGF1dGhlbnRpY2F0aW9uKTtcbiAgXG4gIC8qXG4gIEluc3BpcmVkIGJ5IEphc29uIFdhdG1vcmUgQmxvZyBQb3N0XG4gIGh0dHA6Ly9qYXNvbndhdG1vcmUuY29tL3Bvc3QvMjAxNC8wNS8yNi9hbmd1bGFyanMtYmFzaWMtaHR0cC1hdXRoZW50aWNhdGlvbi1leGFtcGxlXG4gICovXG5cbiAgZnVuY3Rpb24gYXV0aGVudGljYXRpb24oJGh0dHAsICRyb290U2NvcGUsICR0aW1lb3V0KSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBzZXJ2aWNlLlNldENyZWRlbnRpYWxzID0gZnVuY3Rpb24gKGRhdGEpIHsgXG4gICAgICAvKlxuICAgICAgKiAgZGF0YS52aXNpdG9yICYmIGRhdGEudG9rZW5cbiAgICAgICovXG4gICAgICAkcm9vdFNjb3BlLmF1dGggPSBkYXRhO1xuXG4gICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1WaXNpdG9yLVRva2VuJ10gPSBkYXRhLnRva2VuO1xuICAgICAgbG9jYWxTdG9yYWdlLmdsb2JhbHMgPSBhbmd1bGFyLnRvSnNvbigkcm9vdFNjb3BlLmF1dGgpO1xuICAgIH07XG5cbiAgICBzZXJ2aWNlLkNsZWFyQ3JlZGVudGlhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAkcm9vdFNjb3BlLmF1dGggPSB7fTtcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdhdXRoJyk7XG4gICAgICBkZWxldGUgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ1gtVmlzaXRvci1Ub2tlbiddO1xuICAgIH07XG5cbiAgICByZXR1cm4gc2VydmljZTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscy5zdGF0dXNiYXInLCBbXSlcbiAgLmZhY3RvcnkoJ21ldVN0YXR1c2JhcicsIHN0YXR1c2Jhcik7XG4gIFxuICAvKlxuICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLXN0YXR1c2JhclxuICBcbiAgSG93IHRvIHVzZSBpdDogXG4gICAgbWV1Q29yZG92YS5zdGF0dXNiYXIuY2FsbCgpXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7fSlcbiAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHt9KTtcbiAgKi9cbiAgXG4gIGZ1bmN0aW9uIHN0YXR1c2JhcigkcSwgJHdpbmRvdywgJGxvZywgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIHZhciBvcHRpb25zID0ge307XG4gICAgXG4gICAgc2VydmljZS5zZXRPcHRpb24gPSBzZXRPcHRpb247XG4gICAgc2VydmljZS5zZXRPcHRpb25zID0gc2V0T3B0aW9ucztcbiAgICBzZXJ2aWNlLmNhbGwgPSBjYWxsO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHQpIHtcbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKG9wdGlvbnMsIG9wdCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0T3B0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICBvcHRpb25zW25hbWVdID0gdmFsdWU7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5zcGxhc2hzY3JlZW4nLCBbXSlcbiAgLmZhY3RvcnkoJ21ldVNwbGFzaHNjcmVlbicsIHNwbGFzaHNjcmVlbik7XG4gIFxuICAvKlxuICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLXNwbGFzaHNjcmVlblxuICBcbiAgSG93IHRvIHVzZSBpdDogXG4gIG1ldUNvcmRvdmEuc3BsYXNoc2NyZWVuLmhpZGUoKVxuICAudGhlbihmdW5jdGlvbigpIHt9KVxuICAuY2F0Y2goZnVuY3Rpb24oKSB7fSk7XG4gICovXG4gIFxuICBmdW5jdGlvbiBzcGxhc2hzY3JlZW4oJHEsICR3aW5kb3csICRsb2csICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci5zcGxhc2hzY3JlZW4pIHtcbiAgICAgICAgICAgICAgJHdpbmRvdy5uYXZpZ2F0b3Iuc3BsYXNoc2NyZWVuLnNob3coKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICBcbiAgICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci5zcGxhc2hzY3JlZW4pIHtcbiAgICAgICAgICAgICAgJHdpbmRvdy5uYXZpZ2F0b3Iuc3BsYXNoc2NyZWVuLmhpZGUoKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5zcGlubmVyRGlhbG9nJywgW10pXG4gIC5mYWN0b3J5KCdtZXVTcGlubmVyRGlhbG9nJywgc3Bpbm5lckRpYWxvZyk7XG4gIFxuICAvKlxuICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLXNwaW5uZXJkaWFsb2dcbiAgXG4gIEhvdyB0byB1c2UgaXQ6IFxuICAgIG1ldVNwaW5uZXJEaWFsb2cuc2hvdygpXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7fSlcbiAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHt9KTtcbiAgKi9cbiAgXG4gIGZ1bmN0aW9uIHNwaW5uZXJEaWFsb2coJHEsICR3aW5kb3csICRsb2csICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgXG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcbiAgICBcbiAgICBzZXJ2aWNlLnNob3cgPSBzaG93O1xuICAgIHNlcnZpY2UuaGlkZSA9IGhpZGU7XG4gICAgXG4gICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICBmdW5jdGlvbiBzaG93KCkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBzcGlubmVyID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5zcGlubmVyRGlhbG9nO1xuICAgICAgICBcbiAgICAgICAgICBpZiAoc3Bpbm5lcikge1xuICAgICAgICAgICAgc3Bpbm5lci5zaG93KCk7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4tc3Bpbm5lcmRpYWxvZycpO1xuICAgICAgICAgIH0gICAgICBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICBcbiAgICBmdW5jdGlvbiBoaWRlKCkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBzcGlubmVyID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5zcGlubmVyRGlhbG9nO1xuICAgICAgICBcbiAgICAgICAgICBpZiAoc3Bpbm5lcikge1xuICAgICAgICAgICAgc3Bpbm5lci5oaWRlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4tc3Bpbm5lcmRpYWxvZycpO1xuICAgICAgICAgIH0gICAgICBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5Db3Jkb3ZhLnNvY2lhbFNoYXJpbmcnLCBbXSlcblx0LmZhY3RvcnkoJ21ldVNvY2lhbFNoYXJpbmcnLCBbJyRxJywgJyR3aW5kb3cnLCAnc3RyaXB0YWdzRmlsdGVyJywgJ2JyMm5sRmlsdGVyJywgJyRsb2cnLCBzb2NpYWxTaGFyaW5nXSk7XG4gIFxuICAvKlxuICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBodHRwczovL2dpdGh1Yi5jb20vRWRkeVZlcmJydWdnZW4vU29jaWFsU2hhcmluZy1QaG9uZUdhcC1QbHVnaW5cbiAgXG4gIEhvdyB0byB1c2UgaXQ6IFxuICAgIG1ldVNvY2lhbFNoYXJpbmcuc2hhcmVJdGVtKClcbiAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHt9KVxuICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge30pO1xuICBcbiAgICBtZXVTb2NpYWxTaGFyaW5nLnNoYXJlTWVkaWEoKVxuICAqL1xuICBcbiAgZnVuY3Rpb24gc29jaWFsU2hhcmluZygkcSwgJHdpbmRvdywgc3RyaXB0YWdzLCBicjJubCwgJGxvZywgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgcG9zdGZpeDogJydcbiAgICB9O1xuICAgIFxuICAgIHNlcnZpY2Uuc2hhcmVJdGVtID0gc2hhcmVJdGVtO1xuICAgIHNlcnZpY2Uuc2hhcmVNZWRpYSA9IHNoYXJlTWVkaWE7XG4gICAgc2VydmljZS5zZXRPcHRpb24gPSBzZXRPcHRpb247XG4gICAgc2VydmljZS5zZXRPcHRpb25zID0gc2V0T3B0aW9ucztcbiAgICBzZXJ2aWNlLnNoYXJlID0gc2hhcmU7XG4gICAgc2VydmljZS5zaGFyZVZpYVdoYXRzQXBwVG9SZWNlaXZlciA9IHNoYXJlVmlhV2hhdHNBcHBUb1JlY2VpdmVyO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7XG4gICAgICBhbmd1bGFyLmV4dGVuZChvcHRpb25zLCBvcHQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldE9wdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgIH1cblxuXHRcdGZ1bmN0aW9uIHNoYXJlVmlhV2hhdHNBcHBUb1JlY2VpdmVyKHJlY2VpdmVyKSB7XG4gICAgICB2YXIgc29jaWFsID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5zb2NpYWxzaGFyaW5nO1xuXHRcdCAgXG4gICAgICBzb2NpYWwuc2hhcmVWaWFXaGF0c0FwcFRvUmVjZWl2ZXIocmVjZWl2ZXIsICdNZXNzYWdlIHZpYSBXaGF0c0FwcCcsIG51bGwgLyogaW1nICovLCBudWxsIC8qIHVybCAqLywgZnVuY3Rpb24oKSB7JGxvZy5kZWJ1Zygnc2hhcmUgb2snKTt9KTtcblx0XHR9XG4gICAgXG4gICAgZnVuY3Rpb24gc2hhcmVJdGVtKGl0ZW0pIHtcblx0XHRcdFxuXHRcdFx0dmFyIHBhcmFtcyA9IHtcblx0XHRcdCAgbWVzc2FnZTogaXRlbS5kZXNjcmlwdGlvbixcbiAgICAgICAgc3ViamVjdDogaXRlbS50aXRsZSxcbiAgICAgICAgZmlsZXM6IFtdLFxuICAgICAgICB1cmw6IGl0ZW0uaGFzT3duUHJvcGVydHkoJ2xpbmsnKSA/IGl0ZW0ubGluayA6IG51bGxcblx0XHRcdH07XG5cbiAgICAgIGlmIChpdGVtLnRodW1ibmFpbHMgJiYgaXRlbS50aHVtYm5haWxzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0cGFyYW1zLmZpbGVzLnB1c2goaXRlbS50aHVtYm5haWxzWzBdLnVybCk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBzaGFyZShwYXJhbXMpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNoYXJlTWVkaWEobWVkaWEpIHtcblxuXHRcdFx0dmFyIHBhcmFtcyA9IHtcblx0XHRcdCAgbWVzc2FnZTogbWVkaWEudGl0bGUsXG4gICAgICAgIHN1YmplY3Q6IG1lZGlhLnRpdGxlLFxuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIHVybDogbWVkaWEudXJsXG5cdFx0XHR9O1xuXHRcdFx0XG5cdFx0XHQvLyBJZiBtZWRpYSBpcyBzYXZlZCBsb2NhbGx5IChtZWRpYS5wYXRoKSB0aGVuIHNoYXJlIGl0XG5cdFx0XHQvLyBFbHNlIHNoYXJlIGl0cyBsaW5rIChtZWRpYS51cmwpXG5cdFx0XHQvLyBDb3VsZG4ndCBzaGFyZSB0b2dldGhlciBsb2NhbCBwZGYgYW5kIGxpbmtcblx0XHRcdGlmIChtZWRpYS5oYXNPd25Qcm9wZXJ0eSgnZnVsbFBhdGgnKSkge1xuXHRcdFx0XHRwYXJhbXMuZmlsZXMucHVzaChtZWRpYS5mdWxsUGF0aCk7XG5cdFx0XHRcdHBhcmFtcy51cmwgPSBudWxsO1xuXHRcdFx0fSBlbHNlIGlmIChtZWRpYS50aHVtYm5haWxzICYmIG1lZGlhLnRodW1ibmFpbHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRwYXJhbXMuZmlsZXMucHVzaChtZWRpYS50aHVtYm5haWxzWzBdLnVybCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHJldHVybiBzaGFyZShwYXJhbXMpO1xuXHRcdH1cblx0XHRcblx0XHRmdW5jdGlvbiBzaGFyZShwYXJhbXMpIHtcbiAgICAvKlxuICAgICAgdGhpcyBpcyB0aGUgY29tcGxldGUgbGlzdCBvZiBjdXJyZW50bHkgc3VwcG9ydGVkIHBhcmFtcyB5b3UgY2FuIHBhc3MgdG8gdGhlIHBsdWdpbiAoYWxsIG9wdGlvbmFsKVxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIG1lc3NhZ2U6ICdzaGFyZSB0aGlzJywgLy8gbm90IHN1cHBvcnRlZCBvbiBzb21lIGFwcHMgKEZhY2Vib29rLCBJbnN0YWdyYW0pXG4gICAgICAgIHN1YmplY3Q6ICd0aGUgc3ViamVjdCcsIC8vIGZpLiBmb3IgZW1haWxcbiAgICAgICAgZmlsZXM6IFsnJywgJyddLCAvLyBhbiBhcnJheSBvZiBmaWxlbmFtZXMgZWl0aGVyIGxvY2FsbHkgb3IgcmVtb3RlbHlcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly93d3cud2Vic2l0ZS5jb20vZm9vLyNiYXI/YT1iJyxcbiAgICAgICAgY2hvb3NlclRpdGxlOiAnUGljayBhbiBhcHAnIC8vIEFuZHJvaWQgb25seSwgeW91IGNhbiBvdmVycmlkZSB0aGUgZGVmYXVsdCBzaGFyZSBzaGVldCB0aXRsZVxuICAgICAgfVxuICAgICovXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFxuICAgICAgICB2YXIgY2Jfc2hhcmUgPSB7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsOiBmdW5jdGlvbihtc2cpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW0NBTExCQUNLIEZBSUxVUkVdOiBzb2NpYWwuc2hhcmVXaXRoT3B0aW9ucycpO1xuICAgICAgICAgIH0gIFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgc29jaWFsID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5zb2NpYWxzaGFyaW5nO1xuICAgIFxuICAgIFx0XHRcdGlmIChzb2NpYWwpIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnBvc3RmaXgpIHtcbiAgICAgIFx0XHRcdFx0cGFyYW1zLnN1YmplY3QgKz0gb3B0aW9ucy5wb3N0Zml4O1xuICAgICAgICAgICAgfVxuICAgICAgXG4gICAgICAgICAgICBwYXJhbXMubWVzc2FnZSA9IHBhcmFtcy5tZXNzYWdlICYmIHN0cmlwdGFncyhicjJubChwYXJhbXMubWVzc2FnZSkpO1xuICAgICAgICAgICAgcGFyYW1zLnN1YmplY3QgPSBwYXJhbXMuc3ViamVjdCAmJiBzdHJpcHRhZ3MoYnIybmwocGFyYW1zLnN1YmplY3QpKTtcblxuICAgICAgICAgICAgc29jaWFsLnNoYXJlV2l0aE9wdGlvbnMocGFyYW1zLCBjYl9zaGFyZS5zdWNjZXNzLCBjYl9zaGFyZS5mYWlsKTsgXG4gICAgXHRcdFx0fSBlbHNlIHtcbiAgICBcdFx0XHQgIHRocm93IG5ldyBFcnJvcignW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4teC1zb2NpYWxzaGFyaW5nJyk7XG4gICAgXHRcdFx0fSAgICAgICAgICBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXHRcdH1cbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdC5tb2R1bGUoJ25nTWV1bW9iaS5Db3Jkb3ZhLnB1c2gnLCBbXSlcblx0LmZhY3RvcnkoJ3B1c2h3b29zaCcsIGluaXRQdXNod29vc2gpXG5cdC5mYWN0b3J5KCdvbmVzaWduYWwnLCBPbmVTaWduYWxJbXBsKTtcbiAgXG4gIC8qXG4gICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHVzaHdvb3NoLXBnYi1wbHVnaW5cbiAgICBodHRwOi8vZG9jcy5wdXNod29vc2guY29tL2RvY3MvcGhvbmVnYXAtYnVpbGRcbiAgKi9cbiAgZnVuY3Rpb24gaW5pdFB1c2h3b29zaCgkbG9nLCAkd2luZG93LCAkZG9jdW1lbnQsICRleGNlcHRpb25IYW5kbGVyKSB7XG4gICAgICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5jb25maWcgPSBjb25maWc7XG4gICAgc2VydmljZS5yZWdpc3RlciA9IHJlZ2lzdGVyO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIHZhciBnb29nbGVQcm9qZWN0TnVtYmVyO1xuICAgIHZhciBhcHBsaWNhdGlvbkNvZGU7XG5cdFxuICAgIGZ1bmN0aW9uIGNvbmZpZyhnLCBhKSB7XG4gICAgICBnb29nbGVQcm9qZWN0TnVtYmVyID0gZztcbiAgICAgIGFwcGxpY2F0aW9uQ29kZSA9IGE7XG4gICAgfTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIFB1c2h3b29zaC4gVGhpcyB3aWxsIHRyaWdnZXIgYWxsIHBlbmRpbmcgcHVzaCBub3RpZmljYXRpb25zIG9uIHN0YXJ0LlxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKHN1Y2Nlc3MsIGZhaWwpIHtcbiAgICAgIFxuICAgICAgdHJ5IHsgICBcbiAgICAgICAgdmFyIHB1c2hOb3RpZmljYXRpb24gPSBhbmd1bGFyLmlzRGVmaW5lZCgkd2luZG93LmNvcmRvdmEpICYmICR3aW5kb3cuY29yZG92YS5yZXF1aXJlKCdwdXNod29vc2gtY29yZG92YS1wbHVnaW4uUHVzaE5vdGlmaWNhdGlvbicpO1xuICAgICAgXG4gICAgICAgIGlmIChwdXNoTm90aWZpY2F0aW9uKSB7XG4gICAgICAgICAgLy8gU2hvdWxkIGJlIGNhbGxlZCBiZWZvcmUgcHVzaHdvb3NoLm9uRGV2aWNlUmVhZHlcbiAgICAgICAgICAkZG9jdW1lbnQub24oJ3B1c2gtbm90aWZpY2F0aW9uJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBub3RpZmljYXRpb24gPSBldmVudC5ub3RpZmljYXRpb247XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgaGFuZGxlIHB1c2ggb3BlbiBoZXJlXG4gICAgICAgICAgICBub3RpZmljYXRpb24ubWVzc2FnZVxuICAgICAgICAgICAgbm90aWZpY2F0aW9uLnVzZXJEYXRhID0ge1xuICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnOiAuLi4sXG4gICAgICAgICAgICAgICdpdGVtX2lkJzogLi4uXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAqLyBcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ2V2ZW50Lm5vdGlmaWNhdGlvbicpO1xuICAgICAgICAgICAgJGxvZy5kZWJ1Zyhub3RpZmljYXRpb24pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5vbkRldmljZVJlYWR5KHsgXG4gICAgICAgICAgICBwcm9qZWN0aWQ6IGdvb2dsZVByb2plY3ROdW1iZXIsXG4gICAgICAgICAgICBwd19hcHBpZDogYXBwbGljYXRpb25Db2RlfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvL3JlZ2lzdGVyIGZvciBwdXNoIG5vdGlmaWNhdGlvbnNcbiAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uLnJlZ2lzdGVyRGV2aWNlKFxuICAgICAgICAgICAgZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICAgICAgICAgIHZhciBwdXNoSWRzID0ge307XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBwdXNoSWRzLnRva2VuID0gc3RhdHVzLnB1c2hUb2tlbjtcbiAgICAgICAgICAgICAgc3VjY2VzcyhwdXNoSWRzKTtcbiAgICAgICAgICAgIH0sIFxuICAgICAgICAgICAgZnVuY3Rpb24oc3RhdHVzKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUHVzaDogQ2FuXFwndCByZWdpc3RlciBkZXZpY2UnKTtcbiAgICAgICAgICAgICAgZmFpbChzdGF0dXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgICAgLy9jbGVhciB0aGUgYXBwIGJhZGdlXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5zZXRBcHBsaWNhdGlvbkljb25CYWRnZU51bWJlcigwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgUGx1Z2luOiBwdXNod29vc2gtY29yZG92YS1wbHVnaW4nKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZXJyb3IpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblx0XG4gIC8qXG4gICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvb25lc2lnbmFsLWNvcmRvdmEtcGx1Z2luXG4gICAgaHR0cHM6Ly9kb2N1bWVudGF0aW9uLm9uZXNpZ25hbC5jb20vZG9jcy9waG9uZWdhcC1zZGtcbiAgKi9cbiAgXG5cdGZ1bmN0aW9uIE9uZVNpZ25hbEltcGwoJGxvZywgJHdpbmRvdywgJGV4Y2VwdGlvbkhhbmRsZXIsICRyb290U2NvcGUsICRxKSB7XG5cbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuY29uZmlnID0gY29uZmlnO1xuICAgIHNlcnZpY2UucmVnaXN0ZXIgPSByZWdpc3RlcjtcbiAgICBzZXJ2aWNlLnNlbmRUYWcgPSBzZW5kVGFnO1xuICAgIHNlcnZpY2Uuc2V0U3Vic2NyaXB0aW9uID0gc2V0U3Vic2NyaXB0aW9uO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIHZhciBnb29nbGVQcm9qZWN0TnVtYmVyO1xuXHRcdHZhciBhcHBJZDtcblx0XG5cdFx0ZnVuY3Rpb24gY29uZmlnKGcsIGEpIHtcblx0XHRcdGdvb2dsZVByb2plY3ROdW1iZXIgPSBnO1xuXHRcdFx0YXBwSWQgPSBhO1xuXHRcdH07XG5cdFx0XG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgbmdNZXVtb2JpLlV0aWxzLnB1c2gubWV1UHVzaCNzZXRQcm92aWRlclxuICAgKiBAbWV0aG9kT2YgbmdNZXVtb2JpLlV0aWxzLnB1c2gubWV1UHVzaFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2V0cyBjdXJyZW50IFB1c2ggcHJvdmlkZXIgKGJ5IGRlZmF1bHQgJ3B1c2h3b29zaCcpLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvdmlkZXIgbmFtZSB7J3B1c2h3b29zaCcsICdvbmVzaWduYWwnfS5cbiAgICovXG4gICAgXG4gICAgZnVuY3Rpb24gc2VuZFRhZyhrZXksIHZhbHVlKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIHB1c2hOb3RpZmljYXRpb24gPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLk9uZVNpZ25hbDtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAocHVzaE5vdGlmaWNhdGlvbikge1xuICAgICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5zZW5kVGFnKGtleSwgdmFsdWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgUGx1Z2luOiBvbmVzaWduYWwtY29yZG92YS1wbHVnaW4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gc2V0U3Vic2NyaXB0aW9uKGJvb2wpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgcHVzaE5vdGlmaWNhdGlvbiA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuT25lU2lnbmFsO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChwdXNoTm90aWZpY2F0aW9uKSB7XG4gICAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uLnNldFN1YnNjcmlwdGlvbihib29sKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBsdWdpbjogb25lc2lnbmFsLWNvcmRvdmEtcGx1Z2luJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgcHVzaE5vdGlmaWNhdGlvbiA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMuT25lU2lnbmFsO1xuXG4gICAgICAgIGlmIChwdXNoTm90aWZpY2F0aW9uKSB7XG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5zZXRBcHBJZChhcHBJZCk7XG5cbiAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uLmFkZFBlcm1pc3Npb25PYnNlcnZlcihmdW5jdGlvbiAoc3RhdGVDaGFuZ2VzKSB7XG4gICAgICAgICAgICAkbG9nLmRlYnVnKFxuICAgICAgICAgICAgICBcIlB1c2ggcGVybWlzc2lvbiBzdGF0ZSBjaGFuZ2VkOiBcIiArXG4gICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoc3RhdGVDaGFuZ2VzLCBudWxsLCAyKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uLmdldERldmljZVN0YXRlKGZ1bmN0aW9uIChzdGF0ZUNoYW5nZXMpIHtcbiAgICAgICAgICAgICRsb2cuZGVidWcoXG4gICAgICAgICAgICAgIFwiT25lU2lnbmFsIGdldERldmljZVN0YXRlOiBcIiArIEpTT04uc3RyaW5naWZ5KHN0YXRlQ2hhbmdlcylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB2YXIgcHVzaElkcyA9IHt9O1xuICAgICAgICAgICAgcHVzaElkcy50b2tlbiA9IHN0YXRlQ2hhbmdlcy5wdXNoVG9rZW47XG4gICAgICAgICAgICBwdXNoSWRzLnV1aWQgPSBzdGF0ZUNoYW5nZXMudXNlcklkO1xuXG4gICAgICAgICAgICBzdWNjZXNzKHB1c2hJZHMpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5zZXROb3RpZmljYXRpb25PcGVuZWRIYW5kbGVyKGZ1bmN0aW9uIChqc29uRGF0YSkge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhcbiAgICAgICAgICAgICAgXCJub3RpZmljYXRpb25PcGVuZWRDYWxsYmFjazogXCIgKyBKU09OLnN0cmluZ2lmeShqc29uRGF0YSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KFwib3Blbi1ub3RpZmljYXRpb25cIiwganNvbkRhdGEpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy9Qcm9tcHRzIHRoZSB1c2VyIGZvciBub3RpZmljYXRpb24gcGVybWlzc2lvbnMuXG4gICAgICAgICAgLy8gICAgKiBTaW5jZSB0aGlzIHNob3dzIGEgZ2VuZXJpYyBuYXRpdmUgcHJvbXB0LCB3ZSByZWNvbW1lbmQgaW5zdGVhZCB1c2luZyBhbiBJbi1BcHAgTWVzc2FnZSB0byBwcm9tcHQgZm9yIG5vdGlmaWNhdGlvbiBwZXJtaXNzaW9uIChTZWUgc3RlcCA2KSB0byBiZXR0ZXIgY29tbXVuaWNhdGUgdG8geW91ciB1c2VycyB3aGF0IG5vdGlmaWNhdGlvbnMgdGhleSB3aWxsIGdldC5cbiAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uLnByb21wdEZvclB1c2hOb3RpZmljYXRpb25zV2l0aFVzZXJSZXNwb25zZShmdW5jdGlvbiAoXG4gICAgICAgICAgICBhY2NlcHRlZFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhcIlVzZXIgYWNjZXB0ZWQgbm90aWZpY2F0aW9uczogXCIgKyBhY2NlcHRlZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbi5nZXRUYWdzKGZ1bmN0aW9uKHRhZ3MpIHtcbiAgICAgICAgICAgIC8vYWxlcnQoJ2dldCBQdXNoIFRhZ3M6XFxuJyArIGFuZ3VsYXIudG9Kc29uKHRhZ3MpKTtcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ1RhZ3MgUmVjZWl2ZWQ6ICcgKyBhbmd1bGFyLnRvSnNvbih0YWdzKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFBsdWdpbjogb25lc2lnbmFsLWNvcmRvdmEtcGx1Z2luJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICRleGNlcHRpb25IYW5kbGVyKGVycm9yKTtcbiAgICAgIH1cbiAgICB9O1xuXHR9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKFwibmdNZXVtb2JpLkNvcmRvdmEuZmlsZXNcIiwgW1wic2x1Z2lmaWVyXCJdKVxuICAgIC5jb25zdGFudChcIk1JTUVTXCIsIHtcbiAgICAgIFwiYXBwbGljYXRpb24vcGRmXCI6IHtcbiAgICAgICAgY2xhc3M6IFwiZmEtZmlsZS1wZGYtb1wiLFxuICAgICAgICBsYWJlbDogXCJWaWV3XCIsXG4gICAgICAgIGV4dGVuc2lvbjogXCJwZGZcIixcbiAgICAgICAgZG93bmxvYWQ6IHRydWUsXG4gICAgICB9LFxuICAgICAgXCJ0ZXh0L2h0bWxcIjoge1xuICAgICAgICBjbGFzczogXCJmYS1yc3NcIixcbiAgICAgICAgbGFiZWw6IFwiT3BlblwiLFxuICAgICAgICBleHRlbnNpb246IFwiaHRtbFwiLFxuICAgICAgICBkb3dubG9hZDogZmFsc2UsXG4gICAgICB9LFxuICAgICAgXCJhcHBsaWNhdGlvbi92bmQueW91dHViZS52aWRlbytodG1sXCI6IHtcbiAgICAgICAgY2xhc3M6IFwiZmEteW91dHViZS1wbGF5XCIsXG4gICAgICAgIG9wZW5DbGFzczogXCJmYS1wbGF5XCIsXG4gICAgICAgIGxhYmVsOiBcIlBsYXlcIixcbiAgICAgICAgZXh0ZW5zaW9uOiBcImh0bWxcIixcbiAgICAgICAgZG93bmxvYWQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIFwiYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsXCI6IHtcbiAgICAgICAgY2xhc3M6IFwiZmEtZmlsZS1leGNlbC1vXCIsXG4gICAgICAgIGxhYmVsOiBcIlZpZXdcIixcbiAgICAgICAgZXh0ZW5zaW9uOiBcInhsc1wiLFxuICAgICAgICBkb3dubG9hZDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBcImFwcGxpY2F0aW9uL3hsc3hcIjoge1xuICAgICAgICBjbGFzczogXCJmYS1maWxlLWV4Y2VsLW9cIixcbiAgICAgICAgbGFiZWw6IFwiVmlld1wiLFxuICAgICAgICBleHRlbnNpb246IFwieGxzXCIsXG4gICAgICAgIGRvd25sb2FkOiB0cnVlLFxuICAgICAgfSxcbiAgICAgIFwiYXVkaW8vbXBlZ1wiOiB7XG4gICAgICAgIGNsYXNzOiBcImZhLWZpbGUtYXVkaW8tb1wiLFxuICAgICAgICBsYWJlbDogXCJQbGF5XCIsXG4gICAgICAgIG9wZW5DbGFzczogXCJmYS1wbGF5XCIsXG4gICAgICAgIGV4dGVuc2lvbjogXCJtcDNcIixcbiAgICAgICAgZG93bmxvYWQ6IHRydWUsXG4gICAgICB9LFxuICAgICAgXCJ2aWRlby9tcDRcIjoge1xuICAgICAgICBjbGFzczogXCJmYS1maWxlLXZpZGVvLW9cIixcbiAgICAgICAgbGFiZWw6IFwiUGxheVwiLFxuICAgICAgICBvcGVuQ2xhc3M6IFwiZmEtcGxheVwiLFxuICAgICAgICBleHRlbnNpb246IFwibXA0XCIsXG4gICAgICAgIGRvd25sb2FkOiB0cnVlLFxuICAgICAgfSxcbiAgICAgIFwiYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnRcIjoge1xuICAgICAgICBjbGFzczogXCJmYS1maWxlLXBvd2VycG9pbnQtb1wiLFxuICAgICAgICBsYWJlbDogXCJWaWV3XCIsXG4gICAgICAgIGV4dGVuc2lvbjogXCJwcHRcIixcbiAgICAgICAgZG93bmxvYWQ6IHRydWUsXG4gICAgICB9LFxuICAgICAgXCJhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldFwiOiB7XG4gICAgICAgIGNsYXNzOiBcImZhLWZpbGUtZXhjZWwtb1wiLFxuICAgICAgICBsYWJlbDogXCJWaWV3XCIsXG4gICAgICAgIGV4dGVuc2lvbjogXCJ4bHNcIixcbiAgICAgICAgZG93bmxvYWQ6IHRydWUsXG4gICAgICB9LFxuICAgIH0pXG4gICAgLmZpbHRlcihcIm1lZGlhQ2xpY2tMYWJlbFwiLCBtZWRpYUNsaWNrTGFiZWwpXG4gICAgLmZpbHRlcihcIm1lZGlhSWNvbkNsYXNzXCIsIG1lZGlhSWNvbkNsYXNzKVxuICAgIC5maWx0ZXIoXCJtZWRpYU9wZW5DbGFzc1wiLCBtZWRpYU9wZW5DbGFzcylcbiAgICAucHJvdmlkZXIoXCJtZXVGaWxlc1wiLCBmaWxlcyk7XG5cbiAgZnVuY3Rpb24gbWVkaWFDbGlja0xhYmVsKE1JTUVTKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gTUlNRVNbdHlwZV0gPyBNSU1FU1t0eXBlXS5sYWJlbCA6IFwiT3BlblwiO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBtZWRpYUljb25DbGFzcyhNSU1FUykge1xuICAgIHJldHVybiBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIE1JTUVTW3R5cGVdID8gTUlNRVNbdHlwZV0uY2xhc3MgOiBcImZhLWV4dGVybmFsLWxpbmtcIjtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gbWVkaWFPcGVuQ2xhc3MoTUlNRVMpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgIHJldHVybiBNSU1FU1t0eXBlXSAmJiBNSU1FU1t0eXBlXS5vcGVuQ2xhc3NcbiAgICAgICAgPyBNSU1FU1t0eXBlXS5vcGVuQ2xhc3NcbiAgICAgICAgOiBcImZhLWV5ZVwiO1xuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gZmlsZXMoKSB7XG4gICAgdmFyIEZpbGVSZXBvID0ge307XG4gICAgdmFyIGZpbGVUcmFuc2ZlcnMgPSB7fSxcbiAgICAgIGZpbGVzID0ge30sXG4gICAgICBvcHRpb25zID0ge1xuICAgICAgICBsb2NhbEZvbGRlcjogXCJEb3dubG9hZHNcIixcbiAgICAgIH0sXG4gICAgICBzdGF0dXNlcyA9IHtcbiAgICAgICAgZG93bmxvYWQ6IFwiZG93bmxvYWRcIixcbiAgICAgICAgZG93bmxvYWRpbmc6IFwiZG93bmxvYWRpbmdcIixcbiAgICAgICAgZG93bmxvYWRlZDogXCJkb3dubG9hZGVkXCIsXG4gICAgICB9O1xuXG4gICAgdGhpcy5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKG9wdGlvbnMsIG9wdCk7XG4gICAgfTtcblxuICAgIHRoaXMuc2V0T3B0aW9uID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICBvcHRpb25zW25hbWVdID0gdmFsdWU7XG4gICAgfTtcblxuICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uICgkcSwgJGxvZywgJHdpbmRvdywgTUlNRVMsIFNsdWcpIHtcbiAgICAgIEZpbGVSZXBvLiRkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICBGaWxlUmVwby4kcHJvbWlzZSA9IEZpbGVSZXBvLiRkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICB2YXIgYXBpID0ge307XG4gICAgICB2YXIgc2VydmljZSA9IHt9O1xuXG4gICAgICAvKipcbiAgICAgICAqICBBcGkgbWV0aG9kcywgYXZhaWxhYmxlIG9ubHkgb24gdGhlIGluc2lkZSB0aGUgc2VydmljZVxuICAgICAgICovXG5cbiAgICAgIGFwaS5maWxlRXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgLypcbiAgICAgICAgTGlzdCBvZiBFcnJvcnMgY29yZG92YS1wbHVnaW4tZmlsZVxuICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYXBhY2hlL2NvcmRvdmEtcGx1Z2luLWZpbGUjbGlzdC1vZi1lcnJvci1jb2Rlcy1hbmQtbWVhbmluZ3NcbiAgICAgICAgRm9yIHRoZSBtZWFuaW5nIEkgcmVjb21tZW5kIHRvIHJlYWQgaHR0cHM6Ly93aWNnLmdpdGh1Yi5pby9lbnRyaWVzLWFwaS8jY29tbW9uLXR5cGVzXG4gICAgICAgICovXG4gICAgICAgIHN3aXRjaCAoZS5jb2RlKSB7XG4gICAgICAgICAgY2FzZSBGaWxlRXJyb3IuTk9UX0ZPVU5EX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiUmVxdWVzdGVkIGZpbGUgY291bGQgbm90IGJlIGZvdW5kXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEZpbGVFcnJvci5TRUNVUklUWV9FUlI6XG4gICAgICAgICAgICBlLm1lc3NhZ2UgPSBcIlNFQ1VSSVRZX0VSUlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBGaWxlRXJyb3IuQUJPUlRfRVJSOlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJBQk9SVF9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZUVycm9yLk5PVF9SRUFEQUJMRV9FUlI6XG4gICAgICAgICAgICBlLm1lc3NhZ2UgPSBcIk5PVF9SRUFEQUJMRV9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZUVycm9yLkVOQ09ESU5HX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiTWFsZm9ybWVkIFVSSVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBGaWxlRXJyb3IuTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSOlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZUVycm9yLklOVkFMSURfU1RBVEVfRVJSOlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJJTlZBTElEX1NUQVRFX0VSUlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBGaWxlRXJyb3IuU1lOVEFYX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiU1lOVEFYX0VSUlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBGaWxlRXJyb3IuSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSOlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJJTlZBTElEX01PRElGSUNBVElPTl9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZUVycm9yLlFVT1RBX0VYQ0VFREVEX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiUVVPVEFfRVhDRUVERURfRVJSXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEZpbGVFcnJvci5UWVBFX01JU01BVENIX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiVFlQRV9NSVNNQVRDSF9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZUVycm9yLlBBVEhfRVhJU1RTX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiUEFUSF9FWElTVFNfRVJSXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJVbmtub3duIEVycm9yXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAkbG9nLmVycm9yKFwiRXJyb3I6IFwiICsgZS5tZXNzYWdlKTtcblxuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH07XG5cbiAgICAgIGFwaS5maWxlVHJhbnNmZXJFcnJvckhhbmRsZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAvKlxuICAgICAgICBBIEZpbGVUcmFuc2ZlckVycm9yIG9iamVjdCBpcyBwYXNzZWQgdG8gYW4gZXJyb3IgY2FsbGJhY2sgd2hlbiBhbiBlcnJvciBvY2N1cnMuXG4gICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9hcGFjaGUvY29yZG92YS1wbHVnaW4tZmlsZS10cmFuc2ZlciNmaWxldHJhbnNmZXJlcnJvclxuICAgICAgICAqL1xuICAgICAgICBzd2l0Y2ggKGUuY29kZSkge1xuICAgICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuRklMRV9OT1RfRk9VTkRfRVJSOlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJGSUxFX05PVF9GT1VORF9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuSU5WQUxJRF9VUkxfRVJSOlxuICAgICAgICAgICAgZS5tZXNzYWdlID0gXCJJTlZBTElEX1VSTF9FUlJcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuQ09OTkVDVElPTl9FUlI6XG4gICAgICAgICAgICBlLm1lc3NhZ2UgPSBcIkNPTk5FQ1RJT05fRVJSXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEZpbGVUcmFuc2ZlckVycm9yLkFCT1JUX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiT3BlcmF0aW9uIGFib3J0ZWRcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgRmlsZVRyYW5zZmVyRXJyb3IuTk9UX01PRElGSUVEX0VSUjpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiTk9UX01PRElGSUVEX0VSUlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGUubWVzc2FnZSA9IFwiVW5rbm93biBFcnJvclwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgJGxvZy5lcnJvcihcIkVycm9yOiBcIiArIGUubWVzc2FnZSk7XG5cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgICB9O1xuXG4gICAgICBhcGkuZ2V0RmlsZU5hbWUgPSBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgICB2YXIgZXh0ID0gZmlsZS5leHRlbnNpb24gfHwgXCJcIjtcblxuICAgICAgICBpZiAoIWV4dCAmJiBNSU1FU1tmaWxlLnR5cGVdKSBleHQgPSBNSU1FU1tmaWxlLnR5cGVdLmV4dGVuc2lvbjtcblxuICAgICAgICB2YXIgbmFtZSA9IGZpbGUudGl0bGUgfHwgXCJcIjtcblxuICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICBuYW1lID0gbWQ1KGZpbGUudXJsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuYW1lID0gU2x1Zy5zbHVnaWZ5KG5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5hbWUgKyBcIi5cIiArIGV4dDtcbiAgICAgIH07XG5cbiAgICAgIGFwaS5jaGVja1JlcG9zaXRvcnlDb25zaXN0ZW5jeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLypcbiAgICAgICAgaWQgbXVzdCBiZSBlcXVhbHMgdG8gZmlsZS5wYXRoXG4gICAgICAgIGFuZCBmdWxsUGF0aCBjYW4gYmUgdXBkYXRlZCBpZiBBcHAgaXMgdXBkYXRlZCAoaU9TKVxuICAgICAgICAqL1xuICAgICAgICB2YXIgb2JqID0ge307XG4gICAgICAgIHZhciBlbnRyaWVzID0gYW5ndWxhci5mcm9tSnNvbihsb2NhbFN0b3JhZ2VbXCJmaWxlc1wiXSkgfHwgW107XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgICAgIE9iamVjdC5rZXlzKGVudHJpZXMpLm1hcCgoa2V5KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYXBpXG4gICAgICAgICAgICAgIC5nZXRGaWxlRnVsbFBhdGgoZW50cmllc1trZXldLm5hbWUpXG4gICAgICAgICAgICAgIC50aGVuKChmaWxlRnVsbFBhdGgpID0+IHtcbiAgICAgICAgICAgICAgICBvYmpbZW50cmllc1trZXldLnBhdGhdID0gZW50cmllc1trZXldO1xuICAgICAgICAgICAgICAgIG9ialtlbnRyaWVzW2tleV0ucGF0aF0uZnVsbFBhdGggPSBmaWxlRnVsbFBhdGg7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYXBpXG4gICAgICAgICAgICAgICAgICAuZ2V0RmlsZUVudHJ5KGZpbGVGdWxsUGF0aClcbiAgICAgICAgICAgICAgICAgIC50aGVuKChfKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG9ialtlbnRyaWVzW2tleV0ucGF0aF0uc3RhdHVzID0gc3RhdHVzZXMuZG93bmxvYWRlZDtcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAuY2F0Y2goKF8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb2JqW2VudHJpZXNba2V5XS5wYXRoXS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZDtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICApLnRoZW4oKF8pID0+IHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2VbXCJmaWxlc1wiXSA9IGFuZ3VsYXIudG9Kc29uKG9iaik7XG4gICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBhcGkuZ2V0RG93bmxvYWREaXJFbnRyeSA9IGZ1bmN0aW9uIChyb290UGF0aCwgZGlyTmFtZSkge1xuICAgICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG4gICAgICAgICR3aW5kb3cucmVzb2x2ZUxvY2FsRmlsZVN5c3RlbVVSTChcbiAgICAgICAgICByb290UGF0aCxcbiAgICAgICAgICBmdW5jdGlvbiAocm9vdEVudHJ5KSB7XG4gICAgICAgICAgICAvLyBQYXJhbWV0ZXJzIHBhc3NlZCB0byBnZXREaXJlY3RvcnkgY3JlYXRlIGEgbmV3IGRpcmVjdG9yeSBvciByZXR1cm4gdGhlIGRpcmVjdG9yeSBpZiBpdCBhbHJlYWR5IGV4aXN0cy5cbiAgICAgICAgICAgIHJvb3RFbnRyeS5nZXREaXJlY3RvcnkoXG4gICAgICAgICAgICAgIGRpck5hbWUsXG4gICAgICAgICAgICAgIHsgY3JlYXRlOiB0cnVlLCBleGNsdXNpdmU6IGZhbHNlIH0sXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIChkaXJFbnRyeSkge1xuICAgICAgICAgICAgICAgIHEucmVzb2x2ZShkaXJFbnRyeSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIGVycm9yID0gYXBpLmZpbGVFcnJvckhhbmRsZXIoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgJGxvZy5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICBlcnJvciA9IGFwaS5maWxlRXJyb3JIYW5kbGVyKGVycm9yKTtcbiAgICAgICAgICAgIHEucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICAvLyBSZXR1cm5zIHRoZSBmdWxsIGFic29sdXRlIHBhdGggZnJvbSB0aGUgcm9vdCB0byB0aGUgRmlsZUVudHJ5XG4gICAgICBhcGkuZ2V0RmlsZUZ1bGxQYXRoID0gZnVuY3Rpb24gKGZpbGVOYW1lKSB7XG4gICAgICAgIHZhciByb290UGF0aCA9IG51bGw7XG4gICAgICAgIGlmIChkZXZpY2UucGxhdGZvcm0gPT0gXCJBbmRyb2lkXCIpIHtcbiAgICAgICAgICByb290UGF0aCA9IGNvcmRvdmEuZmlsZS5leHRlcm5hbERhdGFEaXJlY3Rvcnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcm9vdFBhdGggPSBjb3Jkb3ZhLmZpbGUuZGF0YURpcmVjdG9yeTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXBpXG4gICAgICAgICAgLmdldERvd25sb2FkRGlyRW50cnkocm9vdFBhdGgsIG9wdGlvbnMubG9jYWxGb2xkZXIpXG4gICAgICAgICAgLnRoZW4oKGRpckVudHJ5KSA9PiBkaXJFbnRyeS5uYXRpdmVVUkwgKyBmaWxlTmFtZSk7XG4gICAgICB9O1xuXG4gICAgICBhcGkuZ2V0RmlsZVBhdGggPSBmdW5jdGlvbiAoZmlsZU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMubG9jYWxGb2xkZXIgKyBcIi9cIiArIGZpbGVOYW1lO1xuICAgICAgfTtcblxuICAgICAgLy9hZGQgZmlsZSB0byBsb2NhbHN0b3JhZ2VcbiAgICAgIGFwaS5hZGRGaWxlID0gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgZmlsZXNbZmlsZS5wYXRoXSA9IGZpbGU7XG4gICAgICAgIGxvY2FsU3RvcmFnZVtcImZpbGVzXCJdID0gYW5ndWxhci50b0pzb24oZmlsZXMpO1xuICAgICAgfTtcblxuICAgICAgLy9yZW1vdmUgZmlsZSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgICAgYXBpLnJlbW92ZUZpbGUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgZGVsZXRlIGZpbGVzW2lkXTtcbiAgICAgICAgbG9jYWxTdG9yYWdlW1wiZmlsZXNcIl0gPSBhbmd1bGFyLnRvSnNvbihmaWxlcyk7XG4gICAgICB9O1xuXG4gICAgICAvL2dldCBmaWxlcyBoYW5kbGVyXG4gICAgICBhcGkuZ2V0RmlsZUVudHJ5ID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuICAgICAgICAkd2luZG93LnJlc29sdmVMb2NhbEZpbGVTeXN0ZW1VUkwoXG4gICAgICAgICAgcGF0aCxcbiAgICAgICAgICBmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgIHEucmVzb2x2ZShlbnRyeSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgZXJyb3IgPSBhcGkuZmlsZUVycm9ySGFuZGxlcihlcnJvcik7XG4gICAgICAgICAgICBxLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgICAgfTtcblxuICAgICAgYXBpLmlzRG93bmxvYWRlZCA9IGZ1bmN0aW9uIChmaWxlUGF0aCkge1xuICAgICAgICAvKlxuICAgICAgICBUT0RPOiBJZiBzdGF0dXMgaXMgZG93bmxvYWRlZCBidXQgbG9jYWwgZmlsZSBpcyBtaXNzaW5nIHRoZW4gcmV0dXJuIEZBTFNFXG4gICAgICAgIEtlZXAgcmVjb3JkIG9uIGxvY2Fsc3RvcmFnZSB0byBhcHBlYXJzIGFzIGZpbGUgYWxyZWFkeSBkb3dubG9hZGVkLCB1c2VyIGNhbiByZS1kb3dubG9hZCBpZiBuZWVkZWRcbiAgICAgICAgKi9cblxuICAgICAgICByZXR1cm4gZmlsZXNbZmlsZVBhdGhdICYmIFtmaWxlUGF0aF0uc3RhdHVzID09IHN0YXR1c2VzLmRvd25sb2FkZWQ7XG4gICAgICB9O1xuXG4gICAgICBhcGkuaXNEb3dubG9hZGluZyA9IGZ1bmN0aW9uIChmaWxlUGF0aCkge1xuICAgICAgICByZXR1cm4gISFmaWxlVHJhbnNmZXJzW2ZpbGVQYXRoXTtcbiAgICAgIH07XG5cbiAgICAgIGFwaS5nZXRGaWxlU3RhdHVzID0gZnVuY3Rpb24gKGZpbGVQYXRoKSB7XG4gICAgICAgIGlmIChhcGkuaXNEb3dubG9hZGVkKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZGVkO1xuICAgICAgICB9IGVsc2UgaWYgKGFwaS5pc0Rvd25sb2FkaW5nKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHJldHVybiBzdGF0dXNlcy5kb3dubG9hZGluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc3RhdHVzZXMuZG93bmxvYWQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogU2VydmljZSBtZXRob2RzLCB0aGF0IGFyZSBwdWJsaWMgYW5kIGF2YWlsYWJsZSBmb3IgYW55IHJlc291cmNlXG4gICAgICAgKi9cbiAgICAgIC8vIEZpbGUgYXZhaWxhYmxlIHN0YXR1c2VzLCBiZXN0IGZvciBkZWJ1ZyBhbmQgbWFpdGFpbiB0aGFuIGp1c3Qgc3RyaW5nLlxuXG4gICAgICBzZXJ2aWNlLmRvd25sb2FkID0gZG93bmxvYWQ7XG4gICAgICBzZXJ2aWNlLmRlY29yYXRlRmlsZSA9IGRlY29yYXRlRmlsZTtcbiAgICAgIHNlcnZpY2UucmVtb3ZlID0gcmVtb3ZlO1xuICAgICAgc2VydmljZS5saXN0ID0gbGlzdDtcbiAgICAgIHNlcnZpY2Uub3BlbiA9IG9wZW47XG4gICAgICBzZXJ2aWNlLmlzRG93bmxvYWRhYmxlID0gaXNEb3dubG9hZGFibGU7XG4gICAgICBzZXJ2aWNlLm9wZW5GaWxlT3BlbmVyID0gb3BlbkZpbGVPcGVuZXI7XG4gICAgICBzZXJ2aWNlLiRpbml0ID0gJGluaXQ7XG5cbiAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAvKlxuICAgICAgSW5zdGFsbDogY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLWZpbGUtb3BlbmVyMlxuICAgICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29yZG92YS1wbHVnaW4tZmlsZS1vcGVuZXIyXG4gICAgICAqL1xuXG4gICAgICBmdW5jdGlvbiBpc0Rvd25sb2FkYWJsZShmaWxlKSB7XG4gICAgICAgIHJldHVybiBmaWxlLnR5cGUgaW4gTUlNRVMgPyBNSU1FU1tmaWxlLnR5cGVdLmRvd25sb2FkIDogdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gJGluaXQoKSB7XG4gICAgICAgIGFwaS5jaGVja1JlcG9zaXRvcnlDb25zaXN0ZW5jeSgpLnRoZW4oKGNoZWNrZWRGaWxlcykgPT4ge1xuICAgICAgICAgIGZpbGVzID0gY2hlY2tlZEZpbGVzO1xuICAgICAgICAgIEZpbGVSZXBvLiRkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBGaWxlUmVwbztcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gbGlzdCgpIHtcbiAgICAgICAgcmV0dXJuIEZpbGVSZXBvLiRwcm9taXNlLnRoZW4oKF8pID0+IHtcbiAgICAgICAgICByZXR1cm4gZmlsZXM7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvcGVuRmlsZU9wZW5lcih1cmksIHR5cGUpIHtcbiAgICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIGNvcmRvdmEucGx1Z2lucy5maWxlT3BlbmVyMi5vcGVuKHVyaSwgdHlwZSwge1xuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcS5yZWplY3QoZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHEucHJvbWlzZTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb3BlbihmaWxlKSB7XG4gICAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcbiAgICAgICAgdmFyIGNiX2VudHJ5ID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgICAgb3BlbkZpbGVPcGVuZXIoZW50cnkubmF0aXZlVVJMLCBmaWxlLnR5cGUpLnRoZW4oXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBxLnJlamVjdChlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBxLnJlamVjdChlKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBhcGkuZ2V0RmlsZUZ1bGxQYXRoKGZpbGUubmFtZSkudGhlbigoZmlsZUZ1bGxQYXRoKSA9PiB7XG4gICAgICAgICAgZmlsZS5mdWxsUGF0aCA9IGZpbGVGdWxsUGF0aDtcbiAgICAgICAgICBhcGkuZ2V0RmlsZUVudHJ5KGZpbGUuZnVsbFBhdGgpLnRoZW4oXG4gICAgICAgICAgICBmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgICAgY2JfZW50cnkuc3VjY2VzcyhlbnRyeSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgY2JfZW50cnkuZmFpbChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBkb3dubG9hZChmaWxlKSB7XG4gICAgICAgIHZhciBxID0gJHEuZGVmZXIoKTtcbiAgICAgICAgdmFyIGZ0ID0gbmV3IEZpbGVUcmFuc2ZlcigpO1xuICAgICAgICB2YXIgdXJpID0gZW5jb2RlVVJJKGZpbGUudXJsKTtcblxuICAgICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkaW5nO1xuICAgICAgICBmaWxlVHJhbnNmZXJzW2ZpbGUucGF0aF0gPSBmdDtcblxuICAgICAgICBmdC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKHByb2dyZXNzKSB7XG4gICAgICAgICAgcS5ub3RpZnkocHJvZ3Jlc3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHEucHJvbWlzZS5hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmdC5hYm9ydCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjYl9kb3dubG9hZCA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZmlsZUVudHJ5KSB7XG4gICAgICAgICAgICBmaWxlLnN0YXR1cyA9IHN0YXR1c2VzLmRvd25sb2FkZWQ7XG4gICAgICAgICAgICBhcGkuYWRkRmlsZShmaWxlKTtcbiAgICAgICAgICAgIGRlbGV0ZSBmaWxlVHJhbnNmZXJzW2ZpbGUucGF0aF07XG4gICAgICAgICAgICBxLnJlc29sdmUoZmlsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZDtcbiAgICAgICAgICAgIGVycm9yID0gYXBpLmZpbGVUcmFuc2ZlckVycm9ySGFuZGxlcihlcnJvcik7XG4gICAgICAgICAgICBkZWxldGUgZmlsZVRyYW5zZmVyc1tmaWxlLnBhdGhdO1xuICAgICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBhcGkuZ2V0RmlsZUZ1bGxQYXRoKGZpbGUubmFtZSkudGhlbigoZmlsZUZ1bGxQYXRoKSA9PiB7XG4gICAgICAgICAgZmlsZS5mdWxsUGF0aCA9IGZpbGVGdWxsUGF0aDtcbiAgICAgICAgICBmdC5kb3dubG9hZChcbiAgICAgICAgICAgIHVyaSxcbiAgICAgICAgICAgIGZpbGUuZnVsbFBhdGgsXG4gICAgICAgICAgICBjYl9kb3dubG9hZC5zdWNjZXNzLFxuICAgICAgICAgICAgY2JfZG93bmxvYWQuZmFpbCxcbiAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiByZW1vdmUoZmlsZSkge1xuICAgICAgICB2YXIgcSA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgdmFyIGNiX3JlbW92ZSA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICBhcGkucmVtb3ZlRmlsZShmaWxlLnBhdGgpO1xuICAgICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZDtcbiAgICAgICAgICAgIHEucmVzb2x2ZShmaWxlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5uYW1lKS50aGVuKChmaWxlRnVsbFBhdGgpID0+IHtcbiAgICAgICAgICBmaWxlLmZ1bGxQYXRoID0gZmlsZUZ1bGxQYXRoO1xuICAgICAgICAgIGFwaS5nZXRGaWxlRW50cnkoZmlsZS5mdWxsUGF0aCkudGhlbihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgICAgICBlbnRyeS5yZW1vdmUoY2JfcmVtb3ZlLnN1Y2Nlc3MsIGNiX3JlbW92ZS5mYWlsKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgZmlsZS5zdGF0dXMgPSBzdGF0dXNlcy5kb3dubG9hZDtcbiAgICAgICAgICAgICAgcS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICByZXR1cm4gcS5wcm9taXNlO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZGVjb3JhdGVGaWxlKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIEZpbGVSZXBvLiRwcm9taXNlLnRoZW4oKF8pID0+IHtcbiAgICAgICAgICBmaWxlLm5hbWUgPSBmaWxlLm5hbWUgfHwgYXBpLmdldEZpbGVOYW1lKGZpbGUpO1xuICAgICAgICAgIGZpbGUucGF0aCA9IGZpbGUucGF0aCB8fCBhcGkuZ2V0RmlsZVBhdGgoZmlsZS5uYW1lKTtcbiAgICAgICAgICBpZiAoZmlsZXNbZmlsZS5wYXRoXSkge1xuICAgICAgICAgICAgcmV0dXJuIGZpbGVzW2ZpbGUucGF0aF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gYXBpLmdldEZpbGVTdGF0dXMoZmlsZS5wYXRoKTtcblxuICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXRGaWxlRnVsbFBhdGgoZmlsZS5uYW1lKS50aGVuKChmaWxlRnVsbFBhdGgpID0+IHtcbiAgICAgICAgICAgICAgLy8gSWYgZGV2aWNlIG5vdCBleGlzdHMgdGhlbiBhcHAgcnVuIG9uIGJyb3dzZXJcbiAgICAgICAgICAgICAgaWYgKCF0eXBlb2YgZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFwaS5pc0Rvd25sb2FkZWQoZmlsZS5wYXRoKSkgZmlsZS5mdWxsUGF0aCA9IGZpbGVGdWxsUGF0aDtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBmaWxlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5kaWFsb2dzJywgW10pXG5cdC5mYWN0b3J5KCdtZXVEaWFsb2dzJywgZGlhbG9ncyk7XG4gIFxuICAvKlxuICAgIGluc3RhbGwgICA6ICAgICBjb3Jkb3ZhIHBsdWdpbiBhZGQgY29yZG92YS1wbHVnaW4tZGlhbG9ncyBubC54LXNlcnZpY2VzLnBsdWdpbnMudG9hc3RcbiAgICBsaW5rICAgICAgOiAgICAgaHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9jb3Jkb3ZhLXBsdWdpbi1kaWFsb2dzXG4gICAgbGluayAgICAgIDogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9FZGR5VmVyYnJ1Z2dlbi9Ub2FzdC1QaG9uZUdhcC1QbHVnaW4gIFxuICAqL1xuICBcbiAgZnVuY3Rpb24gZGlhbG9ncygkcSwgJHdpbmRvdywgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuYWxlcnQgPSBhbGVydDtcbiAgICBzZXJ2aWNlLmNvbmZpcm0gPSBjb25maXJtO1xuICAgIHNlcnZpY2UudG9hc3QgPSB0b2FzdDtcbiAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgICBcbiAgICBmdW5jdGlvbiBhbGVydChtZXNzYWdlLCB0aXRsZSwgYnV0dG9uTmFtZSkge1xuICAgICAgdmFyIHEgPSAkcS5kZWZlcigpO1xuXG4gICAgICBpZiAoISR3aW5kb3cubmF2aWdhdG9yLm5vdGlmaWNhdGlvbikge1xuICAgICAgICAkd2luZG93LmFsZXJ0KG1lc3NhZ2UpO1xuICAgICAgICBxLnJlc29sdmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5hdmlnYXRvci5ub3RpZmljYXRpb24uYWxlcnQobWVzc2FnZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHEucmVzb2x2ZSgpO1xuICAgICAgICB9LCB0aXRsZSwgYnV0dG9uTmFtZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBxLnByb21pc2U7XG4gICAgfTtcbiAgICBcbiAgICAvKlxuICAgICAgXG4gICAgICBidXR0b25MYWJlbHM6IEFycmF5IG9mIHN0cmluZ3Mgc3BlY2lmeWluZyBidXR0b24gbGFiZWxzLiAoQXJyYXkpIChPcHRpb25hbCwgZGVmYXVsdHMgdG8gW09LLENhbmNlbF0pXG4gICAgKi9cbiAgICBmdW5jdGlvbiBjb25maXJtKG1lc3NhZ2UsIHRpdGxlLCBidXR0b25MYWJlbHMpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aXRsZSA9IChhbmd1bGFyLmlzRGVmaW5lZCh0aXRsZSkpID8gdGl0bGUgOiAnQ29uZmlybSc7XG5cbiAgICAgICAgICBpZiAoISR3aW5kb3cubmF2aWdhdG9yLm5vdGlmaWNhdGlvbikge1xuICAgICAgICAgICAgaWYgKCR3aW5kb3cuY29uZmlybShtZXNzYWdlKSkge1xuICAgICAgICAgICAgICByZXNvbHZlKDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmF2aWdhdG9yLm5vdGlmaWNhdGlvbi5jb25maXJtKG1lc3NhZ2UsIGZ1bmN0aW9uIChidXR0b25JbmRleCkge1xuICAgICAgICAgICAgICByZXNvbHZlKGJ1dHRvbkluZGV4KTtcbiAgICAgICAgICAgIH0sIHRpdGxlLCBidXR0b25MYWJlbHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gdG9hc3QobWVzc2FnZSkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgIFx0XHRcdHZhciB0b2FzdCA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMudG9hc3Q7XG4gICAgICBcbiAgICBcdFx0XHRpZiAodG9hc3QpIHtcbiAgICAgICAgICAgIHRvYXN0LnNob3dMb25nQm90dG9tKG1lc3NhZ2UsIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFsZXJ0KG1lc3NhZ2UpO1xuICAgICAgICAgIH0gICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuICBcblx0YW5ndWxhclxuXHQubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5kZXZpY2UnLCBbXSlcblx0LmZhY3RvcnkoJ21ldURldmljZScsIGNkdkRldmljZSk7XG4gIFxuICAvKlxuICAgIG5wbSBpbnN0YWxsOiBcbiAgICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NvcmRvdmEtcGx1Z2luLWRldmljZVxuICAgICAgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29yZG92YS1wbHVnaW4tdW5pcXVlZGV2aWNlaWRcbiAgICAgIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NvcmRvdmEtcGx1Z2luLWFwcHZlcnNpb25cbiAgXG4gICAgaW5zdGFsbDogY29yZG92YSBwbHVnaW4gYWRkIGNvcmRvdmEtcGx1Z2luLWRldmljZSBjb3Jkb3ZhLXBsdWdpbi11bmlxdWVkZXZpY2VpZCBjb3Jkb3ZhLXBsdWdpbi1hcHB2ZXJzaW9uXG4gIFxuICAgIEhvdyB0byB1c2UgaXQ6IFxuICAgICAgbWV1RGV2aWNlLmdldFVVSUQoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7fSlcbiAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge30pO1xuICAqL1xuICBcblx0ZnVuY3Rpb24gY2R2RGV2aWNlKCRsb2csICR3aW5kb3csICRxLCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgIFxuICAgIHZhciBzZXJ2aWNlID0ge307XG4gICAgXG4gICAgc2VydmljZS5nZXRVVUlEID0gZ2V0VVVJRDtcbiAgICBzZXJ2aWNlLmdldEluZm9ybWF0aW9ucyA9IGdldEluZm9ybWF0aW9ucztcbiAgICBzZXJ2aWNlLmdldEFwcFZlcnNpb24gPSBnZXRBcHBWZXJzaW9uO1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIC8qXG4gICAgICBSZXR1cm4gKFN0cmluZykgVmFsdWVcbiAgICAqL1xuICAgIFxuICAgIGZ1bmN0aW9uIGdldFVVSUQoKSB7XG4gICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFxuICAgICAgICB2YXIgY2JfdXVpZCA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbih1dWlkKSB7XG4gICAgICAgICAgICByZXNvbHZlKHV1aWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tDQUxMQkFDSyBGQUlMVVJFXTogdW5pcXVlRGV2aWNlSUQuZ2V0Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciB1bmlxdWVEZXZpY2VJRCA9ICR3aW5kb3cucGx1Z2lucyAmJiAkd2luZG93LnBsdWdpbnMudW5pcXVlRGV2aWNlSUQ7XG4gICAgICAgIFxuICAgICAgICAgIGlmICh1bmlxdWVEZXZpY2VJRCkge1xuICAgICAgICAgICAgdW5pcXVlRGV2aWNlSUQuZ2V0KGNiX3V1aWQuc3VjY2VzcywgY2JfdXVpZC5mYWlsKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbUExVR0lOIE1JU1NJTkddOiBjb3Jkb3ZhLXBsdWdpbi11bmlxdWVkZXZpY2VpZCcpO1xuICAgICAgICAgIH0gICAgICBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8qXG4gICAgICBSZXR1cm4gT2JqZWN0IHttb2RlbDogLi4uLCBwbGF0Zm9ybTogLi4uLCBwbGF0Zm9ybV92ZXJzaW9uOiAuLi4sIG1hbnVmYWN0dXJlcjogLi4ufVxuICAgICovXG4gICAgXG4gICAgZnVuY3Rpb24gZ2V0SW5mb3JtYXRpb25zKCkge1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB7fTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLyplc2xpbnQtZGlzYWJsZSBhbmd1bGFyL2RlZmluZWR1bmRlZmluZWQgKi9cbiAgICAgICAgICBpZiAodHlwZW9mIGRldmljZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAvKmVzbGludC1lbmFibGUgYW5ndWxhci9kZWZpbmVkdW5kZWZpbmVkICovXG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLm1vZGVsID0gZGV2aWNlLm1vZGVsO1xuICAgIFx0XHRcdFx0cHJvcGVydGllcy5wbGF0Zm9ybSA9IGRldmljZS5wbGF0Zm9ybTtcbiAgICBcdFx0XHRcdHByb3BlcnRpZXMucGxhdGZvcm1fdmVyc2lvbiA9IGRldmljZS52ZXJzaW9uO1xuICAgIFx0XHRcdFx0cHJvcGVydGllcy5tYW51ZmFjdHVyZXIgPSBkZXZpY2UubWFudWZhY3R1cmVyO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgXHRcdFx0XHQvLyBSdW5uaW5nIG9uIFdlYiBCcm93c2VyXG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLm1vZGVsID0gbmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzb2x2ZShwcm9wZXJ0aWVzKTsgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH0gICAgIFxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8qXG4gICAgICBSZXR1cm4gT2JqZWN0IHthcHBfdmVyc2lvbjogLi4uLCBhcHBfYnVpbGQ6IC4uLn1cbiAgICAqL1xuICAgIFxuICAgIGZ1bmN0aW9uIGdldEFwcFZlcnNpb24oKSB7XG4gICAgICBcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB7fTtcbiAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgIC8qZXNsaW50LWRpc2FibGUgYW5ndWxhci9kZWZpbmVkdW5kZWZpbmVkICovXG4gICAgICAgICAgaWYgKHR5cGVvZiBBcHBWZXJzaW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIC8qZXNsaW50LWVuYWJsZSBhbmd1bGFyL2RlZmluZWR1bmRlZmluZWQgKi9cbiAgICBcdFx0XHRcdHByb3BlcnRpZXMuYXBwX3ZlcnNpb24gPSBBcHBWZXJzaW9uLnZlcnNpb247XG4gICAgXHRcdFx0XHRwcm9wZXJ0aWVzLmFwcF9idWlsZCA9IEFwcFZlcnNpb24uYnVpbGQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4tYXBwdmVyc2lvbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICByZXNvbHZlKHByb3BlcnRpZXMpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9IFxuICAgICAgfSk7XG4gICAgfVxuXHR9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuQ29yZG92YS5jYWxsTnVtYmVyJywgW10pXG4gIC5mYWN0b3J5KCdjYWxsTnVtYmVyQ29yZG92YScsIGNhbGxOdW1iZXJDb3Jkb3ZhKVxuICAuZmFjdG9yeSgnY2FsbE51bWJlcicsIGNhbGxOdW1iZXIpXG4gIC5mYWN0b3J5KCdtZXVDYWxsTnVtYmVyJywgbWV1Q2FsbE51bWJlcik7XG4gIFxuICAvKlxuICBpbnN0YWxsICAgOiAgICAgY29yZG92YSBwbHVnaW4gYWRkIGh0dHBzOi8vZ2l0aHViLmNvbS9Sb2hmb3Noby9Db3Jkb3ZhQ2FsbE51bWJlclBsdWdpbi5naXRcbiAgXG4gIG5wbSBpbnN0YWxsIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NhbGwtbnVtYmVyXG4gIFxuICBIb3cgdG8gdXNlIGl0OiBcbiAgbWV1Q29yZG92YS5jYWxsTnVtYmVyKG51bWJlciwgdHJ1ZSlcbiAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7fSlcbiAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7fSk7XG4gICovXG5cdFx0XG4gIGZ1bmN0aW9uIGNhbGxOdW1iZXJDb3Jkb3ZhKCRsb2csICR3aW5kb3csICRxLCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgIFxuICAgIHJldHVybiBmdW5jdGlvbihudW1iZXIsIGJ5cGFzc0FwcENob29zZXIpIHtcbiAgICAgIFxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKGJ5cGFzc0FwcENob29zZXIpKSB7XG4gICAgICAgICAgICBieXBhc3NBcHBDaG9vc2VyID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBjYl9jYWxsTnVtYmVyID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsOiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgJGxvZy5kZWJ1ZyhyZXN1bHQpO1xuICAgICAgICAgICAgICByZWplY3QocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgXG4gICAgICAgICAgdmFyIENhbGxOdW1iZXIgPSAkd2luZG93LnBsdWdpbnMgJiYgJHdpbmRvdy5wbHVnaW5zLkNhbGxOdW1iZXI7XG4gICAgICBcbiAgICAgICAgICBpZiAoQ2FsbE51bWJlcikge1xuICAgICAgICAgICAgQ2FsbE51bWJlci5jYWxsTnVtYmVyKGNiX2NhbGxOdW1iZXIuc3VjY2VzcywgY2JfY2FsbE51bWJlci5mYWlsLCBudW1iZXIsIGJ5cGFzc0FwcENob29zZXIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgQ29yZG92YUNhbGxOdW1iZXIgUGx1Z2luJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gY2FsbE51bWJlcigkbG9nLCAkd2luZG93LCAkcSwgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICByZXR1cm4gZnVuY3Rpb24obnVtYmVyLCBieXBhc3NBcHBDaG9vc2VyKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoYnlwYXNzQXBwQ2hvb3NlcikpIHtcbiAgICAgICAgICAgIGJ5cGFzc0FwcENob29zZXIgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHBhc3NlZE51bWJlciA9IGVuY29kZVVSSUNvbXBvbmVudChudW1iZXIpO1xuICAgICAgICAgICR3aW5kb3cubG9jYXRpb24gPSAndGVsOicgKyBwYXNzZWROdW1iZXI7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gbWV1Q2FsbE51bWJlcigkaW5qZWN0b3IsICR3aW5kb3cpIHtcblxuICAgIHZhciBDYWxsTnVtYmVyID0gJHdpbmRvdy5wbHVnaW5zICYmICR3aW5kb3cucGx1Z2lucy5DYWxsTnVtYmVyO1xuICAgIFxuICAgIGlmICgkd2luZG93LmNvcmRvdmEgJiYgQ2FsbE51bWJlcikge1xuICAgICAgcmV0dXJuICRpbmplY3Rvci5nZXQoJ2NhbGxOdW1iZXJDb3Jkb3ZhJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAkaW5qZWN0b3IuZ2V0KCdjYWxsTnVtYmVyJyk7XG4gICAgfVxuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0Lm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEuY2FsZW5kYXInLCBbXSlcblx0LmZhY3RvcnkoJ21ldUNhbGVuZGFyJywgWyckcScsICckd2luZG93JywgJ3N0cmlwdGFnc0ZpbHRlcicsICdicjJubEZpbHRlcicsIGNhbGVuZGFyXSk7XG4gIFxuICAvKlxuICAgIGNvcmRvdmEgcGx1Z2luIGFkZCBodHRwczovL2dpdGh1Yi5jb20vRWRkeVZlcmJydWdnZW4vQ2FsZW5kYXItUGhvbmVHYXAtUGx1Z2luLmdpdFxuICAgIElmIHN0YXJ0IGFuZCBlbmRfZGF0ZSBlcXVhbCAwMDowMCB0aGVuIHRoZSBldmVudCBvY2N1cnMgYWxsIGRheSBsb25nXG4gICovXG4gIFxuICBmdW5jdGlvbiBjYWxlbmRhcigkcSwgJHdpbmRvdywgc3RyaXB0YWdzLCBicjJubCwgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuICAgIFxuICAgIHNlcnZpY2UuY3JlYXRlRXZlbnRJbnRlcmFjdGl2ZWx5ID0gY3JlYXRlRXZlbnRJbnRlcmFjdGl2ZWx5O1xuICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIFxuICAgIGZ1bmN0aW9uIGNyZWF0ZUV2ZW50SW50ZXJhY3RpdmVseShvcHRpb25zKSB7XG4gICAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIHRpdGxlOiBudWxsLFxuICAgICAgICBhZGRyZXNzOiBudWxsLFxuICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgIHN0YXJ0X2RhdGU6IG51bGwsXG4gICAgICAgIGVuZF9kYXRlOiBudWxsXG4gICAgICB9O1xuXG4gICAgICBkZWZhdWx0T3B0aW9ucyA9IGFuZ3VsYXIuZXh0ZW5kKGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIFxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICR3aW5kb3cucGx1Z2lucy5jYWxlbmRhci5jcmVhdGVFdmVudEludGVyYWN0aXZlbHkoXG4gICAgICAgICAgICBzdHJpcHRhZ3MoZGVmYXVsdE9wdGlvbnMudGl0bGUpLFxuICAgICAgICAgICAgc3RyaXB0YWdzKGRlZmF1bHRPcHRpb25zLmFkZHJlc3MpLFxuICAgICAgICAgICAgc3RyaXB0YWdzKGJyMm5sKGRlZmF1bHRPcHRpb25zLmRlc2NyaXB0aW9uKSksXG4gICAgICAgICAgICBuZXcgRGF0ZShkZWZhdWx0T3B0aW9ucy5zdGFydF9kYXRlICAqIDEwMDApLFxuICAgICAgICAgICAgbmV3IERhdGUoZGVmYXVsdE9wdGlvbnMuZW5kX2RhdGUgICogMTAwMCksXG4gICAgICAgICAgICBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG4gIFxuXHRhbmd1bGFyXG4gICAgLm1vZHVsZShcIm5nTWV1bW9iaS5Db3Jkb3ZhLmFuYWx5dGljc1wiLCBbXSlcbiAgICAuZmFjdG9yeShcImZpcmViYXNlQW5hbHl0aWNzXCIsIGZpcmViYXNlQW5hbHl0aWNzKVxuICAgIC5mYWN0b3J5KFwiZmlyZWJhc2VYQW5hbHl0aWNzXCIsIGZpcmViYXNlWEFuYWx5dGljcylcbiAgICAuZmFjdG9yeShcIm1ldUFuYWx5dGljc1wiLCBhbmFseXRpY3MpO1xuXG4gIGZ1bmN0aW9uIGZpcmViYXNlQW5hbHl0aWNzKCRxLCAkbG9nLCAkZXhjZXB0aW9uSGFuZGxlcikge1xuICAgIHZhciBzZXJ2aWNlID0ge307XG5cbiAgICBzZXJ2aWNlLnRyYWNrVmlldyA9IHRyYWNrVmlldztcbiAgICBzZXJ2aWNlLnRyYWNrRXZlbnQgPSB0cmFja0V2ZW50O1xuICAgIHNlcnZpY2UuZXZlbnRzID0ge1xuICAgICAgRVZFTlRfU0FWRTogXCJpcm1vYmlfZXZlbnRfc2F2ZVwiLFxuICAgICAgRU1BSUxfU0VORDogXCJpcm1vYmlfZW1haWxfc2VuZFwiLFxuICAgICAgTUVESUFfT1BFTjogXCJpcm1vYmlfbWVkaWFfb3BlblwiLFxuICAgICAgTUVESUFfREVMRVRFOiBcImlybW9iaV9tZWRpYV9kZWxldGVcIixcbiAgICAgIE1FRElBX0RPV05MT0FEOiBcImlybW9iaV9tZWRpYV9kb3dubG9hZFwiLFxuICAgICAgSVRFTV9TSEFSRTogXCJpcm1vYmlfaXRlbV9zaGFyZVwiLFxuICAgICAgTUVESUFfU0hBUkU6IFwiaXJtb2JpX21lZGlhX3NoYXJlXCIsXG4gICAgfTtcblxuICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgZnVuY3Rpb24gdHJhY2tWaWV3KHNjcmVlbk5hbWUpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIGFuYWx5dGljcyA9IGNvcmRvdmEucGx1Z2lucy5maXJlYmFzZS5hbmFseXRpY3M7XG5cbiAgICAgICAgICBpZiAoYW5hbHl0aWNzKSB7XG4gICAgICAgICAgICByZXR1cm4gYW5hbHl0aWNzXG4gICAgICAgICAgICAgIC5zZXRDdXJyZW50U2NyZWVuKHNjcmVlbk5hbWUpXG4gICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKFwiVHJhY2sgdmlldzogXCIgKyB7IG5hbWU6IHNjcmVlbk5hbWUsIHJlc3VsdDogcmVzIH0pO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byB0cmFjayB2aWV3XCIsIHtcbiAgICAgICAgICAgICAgICAgIGNhdXNlOiBKU09OLnN0cmluZ2lmeShlcnJvciksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIFwiW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4tZmlyZWJhc2UtYW5hbHl0aWNzXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGNvcmRvdmEucGx1Z2lucy5maXJlYmFzZS5hbmFseXRpY3Muc2V0Q3VycmVudFNjcmVlbihcIlVzZXIgZGFzaGJvYXJkXCIpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0cmFja0V2ZW50KG5hbWUsIHBhcmFtcykge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgYW5hbHl0aWNzID0gY29yZG92YS5wbHVnaW5zLmZpcmViYXNlLmFuYWx5dGljcztcblxuICAgICAgICAgIGlmIChhbmFseXRpY3MpIHtcbiAgICAgICAgICAgIHJldHVybiBhbmFseXRpY3NcbiAgICAgICAgICAgICAgLmxvZ0V2ZW50KG5hbWUsIHBhcmFtcylcbiAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICRsb2cuZGVidWcoXCJUcmFjayBldmVudDogXCIsIHtcbiAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHRyYWNrIGV2ZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgIGNhdXNlOiBKU09OLnN0cmluZ2lmeShlcnJvciksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIFwiW1BMVUdJTiBNSVNTSU5HXTogY29yZG92YS1wbHVnaW4tZmlyZWJhc2UtYW5hbHl0aWNzXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGNvcmRvdmEucGx1Z2lucy5maXJlYmFzZS5hbmFseXRpY3MubG9nRXZlbnQoXCJteV9ldmVudFwiLCB7cGFyYW0xOiBcInZhbHVlMVwifSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcmViYXNlWEFuYWx5dGljcygkcSwgJGxvZywgJHdpbmRvdywgJGV4Y2VwdGlvbkhhbmRsZXIpIHtcbiAgICB2YXIgc2VydmljZSA9IHt9O1xuXG4gICAgc2VydmljZS50cmFja1ZpZXcgPSB0cmFja1ZpZXc7XG4gICAgc2VydmljZS50cmFja0V2ZW50ID0gdHJhY2tFdmVudDtcbiAgICBzZXJ2aWNlLmV2ZW50cyA9IHtcbiAgICAgIEVWRU5UX1NBVkU6IFwiaXJtb2JpX2V2ZW50X3NhdmVcIixcbiAgICAgIEVNQUlMX1NFTkQ6IFwiaXJtb2JpX2VtYWlsX3NlbmRcIixcbiAgICAgIE1FRElBX09QRU46IFwiaXJtb2JpX21lZGlhX29wZW5cIixcbiAgICAgIE1FRElBX0RFTEVURTogXCJpcm1vYmlfbWVkaWFfZGVsZXRlXCIsXG4gICAgICBNRURJQV9ET1dOTE9BRDogXCJpcm1vYmlfbWVkaWFfZG93bmxvYWRcIixcbiAgICAgIElURU1fU0hBUkU6IFwiaXJtb2JpX2l0ZW1fc2hhcmVcIixcbiAgICAgIE1FRElBX1NIQVJFOiBcImlybW9iaV9tZWRpYV9zaGFyZVwiLFxuICAgIH07XG5cbiAgICByZXR1cm4gc2VydmljZTtcblxuICAgIGZ1bmN0aW9uIHRyYWNrVmlldyhzY3JlZW5OYW1lKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBhbmFseXRpY3MgPSAkd2luZG93LkZpcmViYXNlUGx1Z2luO1xuXG4gICAgICAgICAgJGxvZy5kZWJ1Zygkd2luZG93KTtcblxuICAgICAgICAgIGlmIChhbmFseXRpY3MpIHtcbiAgICAgICAgICAgIEZpcmViYXNlUGx1Z2luLnNldFNjcmVlbk5hbWUoXG4gICAgICAgICAgICAgIHNjcmVlbk5hbWUsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKFwiU2VudCBzY3JlZW4gbmFtZTogXCIgKyBzY3JlZW5OYW1lKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBzZW5kIHNjcmVlbiBuYW1lXCIsIHtcbiAgICAgICAgICAgICAgICAgIGNhdXNlOiBKU09OLnN0cmluZ2lmeShlcnJvciksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgXCJbUExVR0lOIE1JU1NJTkddOiBjb3Jkb3ZhLXBsdWdpbi1maXJlYmFzZS1hbmFseXRpY3NcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gY29yZG92YS5wbHVnaW5zLmZpcmViYXNlLmFuYWx5dGljcy5zZXRDdXJyZW50U2NyZWVuKFwiVXNlciBkYXNoYm9hcmRcIik7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRyYWNrRXZlbnQobmFtZSwgcGFyYW1zKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBhbmFseXRpY3MgPSAkd2luZG93LkZpcmViYXNlUGx1Z2luO1xuXG4gICAgICAgICAgaWYgKGFuYWx5dGljcykge1xuICAgICAgICAgICAgRmlyZWJhc2VQbHVnaW4ubG9nRXZlbnQoXG4gICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgIHBhcmFtcyxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRsb2cuZGVidWcoXCJUcmFjayBldmVudDogXCIsIHtcbiAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gbG9nIGV2ZW50XCIsIHtcbiAgICAgICAgICAgICAgICAgIGNhdXNlOiBKU09OLnN0cmluZ2lmeShlcnJvciksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgXCJbUExVR0lOIE1JU1NJTkddOiBjb3Jkb3ZhLXBsdWdpbi1maXJlYmFzZS1hbmFseXRpY3NcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gY29yZG92YS5wbHVnaW5zLmZpcmViYXNlLmFuYWx5dGljcy5sb2dFdmVudChcIm15X2V2ZW50XCIsIHtwYXJhbTE6IFwidmFsdWUxXCJ9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYW5hbHl0aWNzKCRpbmplY3RvciwgJHdpbmRvdykge1xuICAgIHJldHVybiAkaW5qZWN0b3IuZ2V0KFwiZmlyZWJhc2VBbmFseXRpY3NcIik7XG4gIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKGdsb2JhbCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAubW9kdWxlKCduZ01ldW1vYmkuVXRpbHMnLCBbXG4gICAgJ25nTWV1bW9iaS5VdGlscy5sb2NhbFN0b3JhZ2UnLFxuICAgICduZ01ldW1vYmkuVXRpbHMuZGV2aWNlUmVhZHknLFxuICAgICduZ01ldW1vYmkuVXRpbHMuaHR0cEludGVyY2VwdG9ycycsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5hdXRoZW50aWNhdGlvbicsXG4gICAgJ25nTWV1bW9iaS5VdGlscy5odHRwV2l0aEZhbGxiYWNrJ1xuICBdKVxuICAuZmFjdG9yeSgnbWV1VXRpbHMnLCB1dGlscyk7XG4gIFxuICBmdW5jdGlvbiB1dGlscyhcbiAgICBtZXVMb2NhbFN0b3JhZ2UsXG4gICAgbWV1RGV2aWNlUmVhZHksXG4gICAgbWV1TG9hZGluZ0ludGVyY2VwdG9yLFxuICAgIG1ldUVycm9ySW50ZXJjZXB0b3IsXG4gICAgbWV1SHR0cFdpdGhGYWxsYmFja1xuICApIHtcblx0XG4gICAgdmFyIHNlcnZpY2UgPSB7fTtcblx0XG4gICAgc2VydmljZS5sb2NhbFN0b3JhZ2UgPSBtZXVMb2NhbFN0b3JhZ2U7XG4gICAgc2VydmljZS5kZXZpY2VSZWFkeSA9IG1ldURldmljZVJlYWR5O1xuICAgIHNlcnZpY2UubG9hZGluZ0ludGVyY2VwdG9yID0gbWV1TG9hZGluZ0ludGVyY2VwdG9yO1xuICAgIHNlcnZpY2UuZXJyb3JJbnRlcmNlcHRvciA9IG1ldUVycm9ySW50ZXJjZXB0b3I7XG4gICAgc2VydmljZS5odHRwV2l0aEZhbGxiYWNrID0gbWV1SHR0cFdpdGhGYWxsYmFjaztcbiAgICAgIFxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSh0aGlzKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnbmdNZXVtb2JpLkNvcmRvdmEnLCBbXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmFuYWx5dGljcycsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmNhbGVuZGFyJyxcbiAgICAnbmdNZXVtb2JpLkNvcmRvdmEuY2FsbE51bWJlcicsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmRldmljZScsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLmRpYWxvZ3MnLFxuICAgICduZ01ldW1vYmkuQ29yZG92YS5maWxlcycsXG4gICAgJ25nTWV1bW9iaS5Db3Jkb3ZhLnNvY2lhbFNoYXJpbmcnLFxuICAgICduZ01ldW1vYmkuQ29yZG92YS5zcGlubmVyRGlhbG9nJyxcbiAgICAnbmdNZXVtb2JpLkNvcmRvdmEuc3BsYXNoc2NyZWVuJyxcbiAgICAnbmdNZXVtb2JpLkNvcmRvdmEucHVzaCdcbiAgXSlcbiAgLmZhY3RvcnkoJ21ldUNvcmRvdmEnLCBjb3Jkb3ZhKTtcbiAgXG4gIGZ1bmN0aW9uIGNvcmRvdmEoXG4gICAgbWV1QW5hbHl0aWNzLCBcbiAgICBtZXVDYWxlbmRhciwgXG4gICAgbWV1Q2FsbE51bWJlciwgXG4gICAgbWV1RGV2aWNlLCBcbiAgICBtZXVEaWFsb2dzLFxuICAgIG1ldUZpbGVzLFxuICAgIG1ldVNvY2lhbFNoYXJpbmcsXG4gICAgbWV1U3Bpbm5lckRpYWxvZyxcbiAgICBtZXVTcGxhc2hzY3JlZW5cbiAgKSB7XG5cdFxuICAgIHZhciBzZXJ2aWNlID0ge307XG5cdFxuICAgIHNlcnZpY2UuYW5hbHl0aWNzID0gbWV1QW5hbHl0aWNzO1xuICAgIHNlcnZpY2UuY2FsZW5kYXIgPSBtZXVDYWxlbmRhcjtcbiAgICBzZXJ2aWNlLmNhbGxOdW1iZXIgPSBtZXVDYWxsTnVtYmVyOyBcbiAgICBzZXJ2aWNlLmRldmljZSA9IG1ldURldmljZTtcbiAgICBzZXJ2aWNlLmRpYWxvZ3MgPSBtZXVEaWFsb2dzO1xuICAgIHNlcnZpY2UuZmlsZXMgPSBtZXVGaWxlcztcbiAgICBzZXJ2aWNlLnNvY2lhbFNoYXJpbmcgPSBtZXVTb2NpYWxTaGFyaW5nO1xuICAgIHNlcnZpY2Uuc3Bpbm5lckRpYWxvZyA9IG1ldVNwaW5uZXJEaWFsb2c7XG4gICAgc2VydmljZS5zcGxhc2hzY3JlZW4gPSBtZXVTcGxhc2hzY3JlZW47XG4gICAgICBcbiAgICByZXR1cm4gc2VydmljZTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gIC5tb2R1bGUoJ25nTWV1bW9iaS5VdGlscycpXG4gIC5wcm92aWRlcignbWV1Q2xvdWQnLCBtZXVDbG91ZFByb3ZpZGVyKVxuICAuZmFjdG9yeSgnbWV1QVBJJywgQVBJKTtcbiAgXG4gIGZ1bmN0aW9uIG1ldUNsb3VkUHJvdmlkZXIoKSB7XG4gICAgXG4gICAgdmFyIG9wdGlvbnMgPSB7fSxcbiAgICAgICAgZGF0YSA9IHt9O1xuICAgIFxuICAgIHRoaXMuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uKG9wdCkge1xuICAgICAgYW5ndWxhci5leHRlbmQob3B0aW9ucywgb3B0KTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZXRPcHRpb24gPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgb3B0aW9uc1tuYW1lXSA9IHZhbHVlO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy4kZ2V0ID0gbWV1Q2xvdWQ7XG4gICAgXG4gICAgZnVuY3Rpb24gbWV1Q2xvdWQoJHEsICR3aW5kb3csICRsb2csICRleGNlcHRpb25IYW5kbGVyLCBtZXVVdGlscywgbWV1QVBJKSB7XG4gICAgXG4vKlxuICBIZWxwZXJzXG4qL1xuICAgICAgdmFyIEhlbHBlcnMgPSB7XG4gICAgICAgIGxvb2t1cDogZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgICB2YXIgdG9rZW4gPSAnaWQnO1xuICAgICAgICAgIC8vIElkZW50aWZ5IGlmIGl0J3MgYW4gYXJyYXkgb2YgaXRlbXMgKGl0ZW0uX2lkKSBvciBjYXRlZ29yeSAoY2F0ZWdvcnkuaWQpXG4gICAgICAgICAgaWYgKGFycmF5WzBdICYmIGFycmF5WzBdLmhhc093blByb3BlcnR5KCdfaWQnKSlcbiAgICAgICAgICAgIHRva2VuID0gJ19pZCc7XG4gICAgICAgICAgcmV0dXJuIEhlbHBlcnMubG9va3VwQnlUb2tlbihhcnJheSwgdG9rZW4pO1xuICAgICAgICB9LFxuICAgICAgICBsb29rdXBCeVRva2VuOiBmdW5jdGlvbihhcnJheSwgdG9rZW4pIHtcbiAgICAgICAgICB2YXIgbG9va3VwID0gW107XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgIGxvb2t1cFthcnJheVtpXVt0b2tlbl1dID0gYXJyYXlbaV07XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBsb29rdXA7XG4gICAgICAgIH0sXG4gICAgICAgIGlzRnJlc2hSZXNwb25zZTogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICB2YXIgaXNGYWxsYmFjayA9IHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdpc0ZhbGxiYWNrJykgPyByZXNwb25zZS5pc0ZhbGxiYWNrIDogbnVsbDtcbiAgICAgICAgICB2YXIgdW5jaGFuZ2VkID0gcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3VuY2hhbmdlZCcpID8gcmVzcG9uc2UudW5jaGFuZ2VkIDogbnVsbDtcbiAgICAgICAgXG4gICAgICAgICAgcmV0dXJuICEodW5jaGFuZ2VkIHx8IGlzRmFsbGJhY2spO1xuICAgICAgICB9LFxuICAgICAgICBnZXRDYXRlZ29yaWVzVHJlZTogZnVuY3Rpb24oY2F0ZWdvcmllcykge1xuICAgICAgICAgIHZhciBjaGlsZHJlbiA9IFtdO1xuICAgICAgICAgIGNoaWxkcmVuWzBdID0gW107XG4gICAgICAgICAgZm9yKHZhciBrZXkgaW4gY2F0ZWdvcmllcykge1xuICAgICAgICAgICAgdmFyIHBhcmVudF9pZCA9IGNhdGVnb3JpZXNba2V5XS5wYXJlbnRfaWQgIT0gbnVsbCA/IGNhdGVnb3JpZXNba2V5XS5wYXJlbnRfaWQgOiAwO1xuICAgICAgICAgICAgaWYgKCFjaGlsZHJlbltwYXJlbnRfaWRdKVxuICAgICAgICAgICAgICBjaGlsZHJlbltwYXJlbnRfaWRdID0gW107XG4gICAgICAgICAgICBjaGlsZHJlbltwYXJlbnRfaWRdLnB1c2goY2F0ZWdvcmllc1trZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yKHZhciBrZXkgaW4gY2F0ZWdvcmllcykge1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcmllc1trZXldO1xuICAgICAgICAgICAgY2F0ZWdvcnkuY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgICAgIGlmIChjaGlsZHJlbltjYXRlZ29yeS5pZF0pXG4gICAgICAgICAgICAgIGNhdGVnb3J5LmNoaWxkcmVuID0gY2hpbGRyZW5bY2F0ZWdvcnkuaWRdO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY2hpbGRyZW5bMF07XG4gICAgICAgIH1cbiAgICAgIH07XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLyBcbiAgICBcbiAgICAgIHZhciBzZXJ2aWNlID0ge307XG5cbiAgICAgIHNlcnZpY2UuaGVscGVycyA9IEhlbHBlcnM7XG4gICAgICBzZXJ2aWNlLmdldENhdGVnb3J5ID0gZ2V0Q2F0ZWdvcnk7XG4gICAgICBzZXJ2aWNlLnN5bmNQZXJmb3JtYW5jZSA9IHN5bmNQZXJmb3JtYW5jZTtcbiAgICAgIHNlcnZpY2UuQVBJID0gbWV1QVBJO1xuICAgICAgc2VydmljZS5pbml0ID0gaW5pdDtcbiAgICAgIHNlcnZpY2UuZ2V0U2l0ZUxvZ29VcmwgPSBnZXRTaXRlTG9nb1VybDtcbiAgICAgIHNlcnZpY2UuZ2V0U2l0ZVByb3BlcnR5ID0gZ2V0U2l0ZVByb3BlcnR5O1xuICAgICAgc2VydmljZS5nZXRBc3NldFVybCA9IGdldEFzc2V0VXJsO1xuICAgIFxuICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgXG4gICAgICAvKlxuICAgICAgICBtZXVDbG91ZC5BUEkuU2l0ZS5wZXJmb3JtYW5jZSgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgdXBkYXRlRGF0YShyZXNwb25zZSk7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlLnByb21pc2UpXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucHJvbWlzZTtcbiAgICAgICAgfSlcbiAgICAgICAgLy8gSWYgcmVzcG9uc2UgY29udGFpbnMgYSBwcm9taXNlLCBtZWFucyBpcyBmcm9tIGNhY2hlIGFuZCBwcm9taXNlIHdpbGwgc3luYyB3LyBTZXJ2ZXJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICB1cGRhdGVEYXRhKHJlc3BvbnNlKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICB9KVxuICAgICAgXG4gICAgICAqL1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnYXBpVXJsJykpXG4gICAgICAgICAgbWV1QVBJLkNvbmZpZy5zZXRQcm9wZXJ0eSgnYXBpVXJsJywgb3B0aW9ucy5hcGlVcmwpO1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgndGltZW91dCcpKVxuICAgICAgICAgIG1ldUFQSS5Db25maWcuc2V0UHJvcGVydHkoJ3RpbWVvdXQnLCBvcHRpb25zLnRpbWVvdXQpO1xuICAgICAgfVxuICAgICAgICAgICBcbiAgICAgIGZ1bmN0aW9uIGdldENhdGVnb3J5KGlkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIGNhdGVnb3JpZXMgPSBIZWxwZXJzLmxvb2t1cChkYXRhLmNhdGVnb3JpZXMpO1xuICAgICAgICAgIGlmIChjYXRlZ29yaWVzLmhhc093blByb3BlcnR5KGlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhdGVnb3JpZXNbaWRdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgXG4gICAgICBmdW5jdGlvbiBnZXREYXRhKHByb3BlcnR5KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGFbcHJvcGVydHldOyBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBnZXRTaXRlUHJvcGVydHkocHJvcGVydHkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gZGF0YS5zaXRlW3Byb3BlcnR5XTsgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gZ2V0Q2F0ZWdvcmllcygpIHtcbiAgICAgICAgcmV0dXJuIGdldERhdGEoJ2NhdGVnb3JpZXMnKTtcbiAgICAgIH1cbiAgXG4gICAgICBmdW5jdGlvbiBzZXRDYXRlZ29yaWVzKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgZGF0YS5jYXRlZ29yaWVzID0gY2F0ZWdvcmllcztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gc2V0U2l0ZShzaXRlKSB7XG4gICAgICAgIGRhdGEuc2l0ZSA9IHNpdGU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHNldFZpc2l0b3IodmlzaXRvcikge1xuICAgICAgICBkYXRhLnZpc2l0b3IgPSB2aXNpdG9yO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBnZXRWaXNpdG9yKCkge1xuICAgICAgICByZXR1cm4gZGF0YS52aXNpdG9yO1xuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBnZXRTaXRlTG9nb1VybCgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5jZG5VcmwgKyBkYXRhLnNpdGUubG9nbzsgXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkZXhjZXB0aW9uSGFuZGxlcihlKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gZ2V0QXNzZXRVcmwocGF0aCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmNkblVybCArIHBhdGg7IFxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gXG4gICAgICB9XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHNldEJ1c2luZXNzKGJ1c2luZXNzKSB7XG4gICAgICAgIGRhdGEuYnVzaW5lc3MgPSBidXNpbmVzcztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gc3luY1BlcmZvcm1hbmNlKGRhdGEpIHtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZXRDYXRlZ29yaWVzKGRhdGEuY2F0ZWdvcmllcyk7XG4gICAgICAgICAgICBzZXRTaXRlKGRhdGEuc2l0ZSk7XG4gICAgICAgICAgICBzZXRCdXNpbmVzcyhkYXRhLmJ1c2luZXNzKTtcbiAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgJGV4Y2VwdGlvbkhhbmRsZXIoZSk7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICBmdW5jdGlvbiBBUEkoJHJvb3RTY29wZSwgJGh0dHAsICRsb2csICRleGNlcHRpb25IYW5kbGVyLCBtZXVIdHRwV2l0aEZhbGxiYWNrKSB7XG4gIFxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICB0aW1lb3V0OiAxMDAwMFxuICAgIH07XG4gICAgICAgIFxuICAgIHZhciBjb252ZXJ0SnNvbkFzVXJpUGFyYW1ldGVycyA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIHZhciB1cmwgPSBPYmplY3Qua2V5cyhkYXRhKS5tYXAoZnVuY3Rpb24oaykge1xuICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KGspICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGFba10pO1xuICAgICAgfSkuam9pbignJicpO1xuICAgIFxuICAgICAgcmV0dXJuIHVybDtcbiAgICB9O1xuXG4gICAgdmFyIGJ1aWxkVXJsID0gZnVuY3Rpb24oZW5kcCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLypcbiAgICAgICAgICBJZiBjb25maWcuZG9tYWluIGlzIG51bGwgdGhlbiB1c2UgZG9tYWluIGVtcHR5XG4gICAgICAgIGNvbmZpZy5kb21haW4gIT09IG51bGwgJiYgY29uZmlnLmRvbWFpbiAhPSB1bmRlZmluZWRcbiAgICAgICAgKi9cbiAgICAgICAgdmFyIGRvbWFpbiA9IChjb25maWcuZG9tYWluKSA/IGNvbmZpZy5kb21haW4gOiAnJztcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBjb25maWcuYXBpVXJsICsgZG9tYWluICsgZW5kcDsgXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICRleGNlcHRpb25IYW5kbGVyKGUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgYXBpID0gKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbihlbmRwLCBvYmopIHtcbiAgICAgICAgICBhbmd1bGFyLmV4dGVuZChvYmosIHt0aW1lb3V0OiBjb25maWcudGltZW91dH0pO1xuICAgICAgXG4gICAgICAgICAgcmV0dXJuIG1ldUh0dHBXaXRoRmFsbGJhY2suZ2V0KGJ1aWxkVXJsKGVuZHApLCBvYmopO1xuICAgICAgICB9LFxuICAgICAgICBwb3N0OiBmdW5jdGlvbihlbmRwLCBvYmopIHsgICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdGltZW91dDogY29uZmlnLnRpbWVvdXQsXG4gICAgICAgICAgICB1cmw6IGJ1aWxkVXJsKGVuZHApLFxuICAgICAgICAgICAgZGF0YTogYW5ndWxhci50b0pzb24ob2JqKSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHB1dDogZnVuY3Rpb24oZW5kcCwgb2JqKSB7ICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAgdGltZW91dDogY29uZmlnLnRpbWVvdXQsXG4gICAgICAgICAgICB1cmw6IGJ1aWxkVXJsKGVuZHApLFxuICAgICAgICAgICAgZGF0YTogYW5ndWxhci50b0pzb24ob2JqKSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlbDogZnVuY3Rpb24oZW5kcCwgaWQpIHtcbiAgICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHRpbWVvdXQ6IGNvbmZpZy50aW1lb3V0LFxuICAgICAgICAgICAgdXJsOiBidWlsZFVybChlbmRwKSxcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pKCk7XG5cbiAgICB2YXIgYXBwID0ge1xuICAgICAgQ2F0ZWdvcmllczogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvY2F0ZWdvcmllcy8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHF1ZXJ5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IE5lZWQgdG8gYmUgdGVzdGVkXG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldChwYXRoLCB7fSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpdGVtczogZnVuY3Rpb24oY2F0ZWdvcnlfaWQsIGNvbmZpZykge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5nZXQocGF0aCArIGNhdGVnb3J5X2lkICsgJy9pdGVtcycsIGNvbmZpZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkoKSxcbiAgICAgIEl0ZW1zOiAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYXRoID0gJy9pdGVtcy8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGxhdGVzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldChwYXRoICsgJ2xhdGVzdCcsIHt9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaDogZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gcGF0aCArICdzZWFyY2g/JyArIGNvbnZlcnRKc29uQXNVcmlQYXJhbWV0ZXJzKG9iaik7XG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldCh1cmwsIHt9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgU2l0ZTogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvcGVyZm9ybWFuY2UnO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHBlcmZvcm1hbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkuZ2V0KHBhdGgsIHt9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgTG9naW46IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBhdGggPSAnL3Zpc2l0b3JzLyc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2lnbmluOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkucG9zdChwYXRoICsgJ2xvZ2luJywgb2JqKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLmdldChwYXRoLCB7fSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzYXZlOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkucHV0KHBhdGgsIG9iaik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyBUT0RPOiBOZWVkIHRvIGJlIHRlc3RlZFxuICAgICAgICAgIGRldmljZTogZnVuY3Rpb24ob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLnBvc3QocGF0aCArICdkZXZpY2VzJywgb2JqKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIFRPRE86IE5lZWQgdG8gYmUgdGVzdGVkXG4gICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBhcGkucHV0KHBhdGggKyAnZGV2aWNlcy8nICsgb2JqLnV1aWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wb3N0KHBhdGggKyAnZm9yZ290X3Bhc3N3b3JkJywgb2JqKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgRGV2aWNlczogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvZGV2aWNlcy8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wdXQocGF0aCArIG9iai51dWlkLCBvYmopO1xuICAgICAgICAgIH0gXG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgUG9sbDogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvaXRlbXMvJztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWJtaXQ6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wb3N0KHBhdGggKyBvYmouaWQgKyAnL3BvbGwnLCBvYmoucGFyYW1zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSgpLFxuICAgICAgTWFpbDogKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGF0aCA9ICcvbWFpbC8nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGFwaS5wb3N0KHBhdGgsIG9iaik7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkoKSxcbiAgICAgIENvbmZpZzogKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNldFByb3BlcnRpZXM6IGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGNvbmZpZywgcHJvcCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXRQcm9wZXJ0eTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIGNvbmZpZ1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0UHJvcGVydHk6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWdbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSkoKVxuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIGFwcDtcbiAgfVxufSkoKTsiLCIvKiBnbG9iYWwgYW5ndWxhciAqL1xuLyogZXNsaW50IG5vLXVuZGVmOiBcImVycm9yXCIgKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnbmdNZXVtb2JpLlV0aWxzLmZpbHRlcnMnLCBbJ25nU2FuaXRpemUnXSlcbiAgLmZpbHRlcignaXNFbXB0eScsIGlzRW1wdHkpXG4gIC5maWx0ZXIoJ2JyMm5sJywgYnIybmwpXG4gIC5maWx0ZXIoJ3N0cmlwdGFncycsIHN0cmlwdGFncylcbiAgLmZpbHRlcignYnl0ZXNUb1NpemUnLCBieXRlc1RvU2l6ZSlcbiAgLmZpbHRlcignaHJlZlRvSlMnLCBocmVmVG9KUylcbiAgLmZpbHRlcignY2FwaXRhbGl6ZScsIGNhcGl0YWxpemUpO1xuXG4gIGZ1bmN0aW9uIGlzRW1wdHkoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiAhT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJyMm5sKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvPGJyXFxzKltcXC9dPz4vZ2ksICdcXG4nKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gc3RyaXB0YWdzKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXJcbiAgICAgIC5lbGVtZW50KCc8ZGl2Lz4nKVxuICAgICAgLmh0bWwodGV4dClcbiAgICAgIC50ZXh0KCk7XG4gICAgfTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gY2FwaXRhbGl6ZSgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHNjb3BlKSB7XG4gICAgICBpZiAoaW5wdXQhPW51bGwpXG4gICAgICBpbnB1dCA9IGlucHV0LnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gaW5wdXQuc3Vic3RyaW5nKDAsMSkudG9VcHBlckNhc2UoKStpbnB1dC5zdWJzdHJpbmcoMSk7XG4gICAgfSBcbiAgfVxuICBcbiAgZnVuY3Rpb24gYnl0ZXNUb1NpemUoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGJ5dGVzKSB7XG4gICAgICBpZiAoYnl0ZXMgPT0gMCkgcmV0dXJuICcwIEJ5dGUnO1xuICAgICAgdmFyIGsgPSAxMDAwO1xuICAgICAgdmFyIHNpemVzID0gWydCeXRlcycsICdLQicsICdNQicsICdHQicsICdUQicsICdQQicsICdFQicsICdaQicsICdZQiddO1xuICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKE1hdGgubG9nKGJ5dGVzKSAvIE1hdGgubG9nKGspKTtcbiAgICAgIHJldHVybiAoYnl0ZXMgLyBNYXRoLnBvdyhrLCBpKSkudG9QcmVjaXNpb24oMykgKyAnICcgKyBzaXplc1tpXTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBocmVmVG9KUyAoJHNjZSwgJHNhbml0aXplKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHZhciByZWdleCA9IC9ocmVmPVwiKFtcXFNdKylcIi9nO1xuICAgICAgdmFyIG5ld1N0cmluZyA9ICRzYW5pdGl6ZSh0ZXh0KS5yZXBsYWNlKHJlZ2V4LCBcIm9uQ2xpY2s9XFxcIndpbmRvdy5vcGVuKCckMScsICdfYmxhbmsnLCAnbG9jYXRpb249eWVzJylcXFwiXCIpO1xuICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwobmV3U3RyaW5nKTtcbiAgICB9XG4gIH1cbn0pKCk7XG4iXX0=
